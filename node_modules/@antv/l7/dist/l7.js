!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],t):t((e=e||self).L7={},e.mapboxgl)}(this,(function(e,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function o(e,t){return e(t={exports:{}},t.exports),t.exports
/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */}!function(e){!function(t){var n="object"==typeof r?r:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:i=o(n.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,u=!o&&!a,s={create:o?function(){return P(Object.create(null))}:a?function(){return P({__proto__:null})}:function(){return P({})},has:u?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:u?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,h=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(l||"function"!=typeof WeakMap?function(){var e=s.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&s.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?s.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+a()}while(s.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:s.create()})}return e[n]}function o(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function p(e,t,n){var r=d.get(e);if(_(r)){if(!n)return;r=new f,d.set(e,r)}var i=r.get(t);if(_(i)){if(!n)return;i=new f,r.set(t,i)}return i}function v(e,t,n){var r=p(t,n,!1);return!_(r)&&!!r.has(e)}function g(e,t,n){var r=p(t,n,!1);if(!_(r))return r.get(e)}function m(e,t,n,r){p(n,r,!0).set(e,t)}function y(e,t){var n=[],r=p(e,t,!1);if(_(r))return n;for(var o=function(e){var t=k(e,i);if(!T(t))throw new TypeError;var n=t.call(e);if(!S(n))throw new TypeError;return n}(r.keys()),a=0;;){var u=M(o);if(!u)return n.length=a,n;var s=u.value;try{n[a]=s}catch(e){try{I(o)}finally{throw e}}a++}}function b(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function _(e){return void 0===e}function x(e){return null===e}function S(e){return"object"==typeof e?null!==e:"function"==typeof e}function E(e,t){switch(b(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=k(e,r);if(void 0!==i){var o=i.call(e,n);if(S(o))throw new TypeError;return o}return function(e,t){if("string"===t){var n=e.toString;if(T(n))if(!S(i=n.call(e)))return i;if(T(r=e.valueOf))if(!S(i=r.call(e)))return i}else{var r;if(T(r=e.valueOf))if(!S(i=r.call(e)))return i;var i,o=e.toString;if(T(o))if(!S(i=o.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function A(e){var t=E(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function w(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function T(e){return"function"==typeof e}function C(e){return"function"==typeof e}function k(e,t){var n=e[t];if(null!=n){if(!T(n))throw new TypeError;return n}}function M(e){var t=e.next();return!t.done&&t}function I(e){var t=e.return;t&&t.call(e)}function O(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function P(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(_(n)){if(!w(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!_(r)&&!x(r)){if(!C(r))throw new TypeError;t=r}}return t}(e,t)}if(!w(e))throw new TypeError;if(!S(t))throw new TypeError;if(!S(r)&&!_(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!_(o)&&!x(o)){if(!S(o))throw new TypeError;r=o}}return r}(e,t,n=A(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!S(n))throw new TypeError;if(!_(r)&&!function(e){switch(b(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!S(n))throw new TypeError;return _(r)||(r=A(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return!0;var i=O(n);return!x(i)&&e(t,i,r)}(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),function e(t,n,r){if(v(t,n,r))return g(t,n,r);var i=O(n);return x(i)?void 0:e(t,i,r)}(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!S(t))throw new TypeError;return _(n)||(n=A(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return _(t)||(t=A(t)),function e(t,n){var r=y(t,n),i=O(t);if(null===i)return r;var o=e(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new h,u=[],s=0,c=r;s<c.length;s++){var l=c[s];a.has(l)||(a.add(l),u.push(l))}for(var f=0,d=o;f<d.length;f++){l=d[f];a.has(l)||(a.add(l),u.push(l))}return u}(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!S(e))throw new TypeError;return _(t)||(t=A(t)),y(e,t)})),e("deleteMetadata",(function(e,t,n){if(!S(t))throw new TypeError;_(n)||(n=A(n));var r=p(t,n,!1);if(_(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||d.delete(t),!0}))}(i)}()}(n||(n={}));var a=o((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var u=new i(r,o||e,a),s=n?n+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],u]:e._events[s].push(u):(e._events[s]=u,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),u.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,o,a){var u=n?n+e:e;if(!this._events[u])return!1;var s,c,l=this._events[u],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,a),!0}for(c=1,s=new Array(f-1);c<f;c++)s[c-1]=arguments[c];l.fn.apply(l.context,s)}else{var h,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!s)for(h=1,s=new Array(f-1);h<f;h++)s[h-1]=arguments[h];l[c].fn.apply(l[c].context,s)}}return!0},u.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var u=this._events[o];if(u.fn)u.fn!==t||i&&!u.once||r&&u.context!==r||a(this,o);else{for(var s=0,c=[],l=u.length;s<l;s++)(u[s].fn!==t||i&&!u[s].once||r&&u[s].context!==r)&&c.push(u[s]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,e.exports=u})),u=a.EventEmitter,s=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct"}));i(s);s.NAMED_TAG,s.NAME_TAG,s.UNMANAGED_TAG,s.OPTIONAL_TAG,s.INJECT_TAG,s.MULTI_INJECT_TAG,s.TAGGED,s.TAGGED_PROP,s.PARAM_TYPES,s.DESIGN_PARAM_TYPES,s.POST_CONSTRUCT;var c=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}}));i(c);c.BindingScopeEnum,c.BindingTypeEnum,c.TargetTypeEnum;var l=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=0;t.id=function(){return n++}}));i(l);l.id;var f=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.id=l.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=c.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=!1,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=n}));i(f);f.Binding;var h=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"}));i(h);h.DUPLICATED_INJECTABLE_DECORATOR,h.DUPLICATED_METADATA,h.NULL_ARGUMENT,h.KEY_NOT_FOUND,h.AMBIGUOUS_MATCH,h.CANNOT_UNBIND,h.NOT_REGISTERED,h.MISSING_INJECTABLE_ANNOTATION,h.MISSING_INJECT_ANNOTATION,h.UNDEFINED_INJECT_ANNOTATION,h.CIRCULAR_DEPENDENCY,h.NOT_IMPLEMENTED,h.INVALID_BINDING_TYPE,h.NO_MORE_SNAPSHOTS_AVAILABLE,h.INVALID_MIDDLEWARE_RETURN,h.INVALID_FUNCTION_BINDING,h.INVALID_TO_SELF_VALUE,h.INVALID_DECORATOR_OPERATION,h.ARGUMENTS_LENGTH_MISMATCH,h.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT,h.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE,h.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE,h.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK,h.MULTIPLE_POST_CONSTRUCT_METHODS,h.POST_CONSTRUCT_ERROR,h.CIRCULAR_DEPENDENCY_IN_FACTORY,h.STACK_OVERFLOW;var d=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(s.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(s.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(s.TAGGED_PROP,e)||[]},e}();t.MetadataReader=n}));i(d);d.MetadataReader;var p=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}}));i(p);p.BindingCount;var v=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===h.STACK_OVERFLOW}}));i(v);v.isStackOverflowExeption;var g=o((function(e,t){function n(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function r(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.getServiceIdentifierAsString=n,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var i="",o=n(e,t);return 0!==o.length&&(i="\nRegistered bindings:",o.forEach((function(e){var t="Object";null!==e.implementationType&&(t=r(e.implementationType)),i=i+"\n "+t,e.constraint.metaData&&(i=i+" - "+e.constraint.metaData)}))),i},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var r=function(e){return function e(t,r){void 0===r&&(r=[]);var i=n(t.serviceIdentifier);return r.push(i),null!==t.parentRequest?e(t.parentRequest,r):r}(e).reverse().join(" --\x3e ")}(t);throw new Error(h.CIRCULAR_DEPENDENCY+" "+r)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=r}));i(g);g.getServiceIdentifierAsString,g.listRegisteredBindingsForServiceIdentifier,g.circularDependencyToException,g.listMetadataForTarget,g.getFunctionName;var m=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.id=l.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=n}));i(m);m.Context;var y=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===s.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=n}));i(y);y.Metadata;var b=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n}));i(b);b.Plan;var _=o((function(e,t){function n(e,t,n,r,i){var o={},a="number"==typeof i,u=void 0!==i&&a?i.toString():n;if(a&&void 0!==n)throw new Error(h.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var s=o[u];if(Array.isArray(s))for(var c=0,l=s;c<l.length;c++){var f=l[c];if(f.key===r.key)throw new Error(h.DUPLICATED_METADATA+" "+f.key.toString())}else s=[];s.push(r),o[u]=s,Reflect.defineMetadata(e,o,t)}function r(e,t){Reflect.decorate(e,t)}function i(e,t){return function(n,r){t(n,r,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagParameter=function(e,t,r,i){n(s.TAGGED,e,t,i,r)},t.tagProperty=function(e,t,r){n(s.TAGGED_PROP,e.constructor,t,r)},t.decorate=function(e,t,n){"number"==typeof n?r([i(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):r([e],t)}}));i(_);_.tagParameter,_.tagProperty,_.decorate;var x=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=n,t.inject=function(e){return function(t,n,r){if(void 0===e)throw new Error(h.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new y.Metadata(s.INJECT_TAG,e);"number"==typeof r?_.tagParameter(t,n,r,i):_.tagProperty(t,n,i)}}}));i(x);x.LazyServiceIdentifer,x.inject;var S=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n}));i(S);S.QueryableString;var E=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,r){this.id=l.id(),this.type=e,this.serviceIdentifier=n,this.name=new S.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new y.Metadata(s.NAMED_TAG,r):r instanceof y.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(s.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(s.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(s.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return e.key!==s.INJECT_TAG&&e.key!==s.MULTI_INJECT_TAG&&e.key!==s.NAME_TAG&&e.key!==s.UNMANAGED_TAG&&e.key!==s.NAMED_TAG}))},e.prototype.isOptional=function(){return this.matchesTag(s.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===s.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return e.key!==s.INJECT_TAG&&e.key!==s.MULTI_INJECT_TAG&&e.key!==s.NAME_TAG&&e.key!==s.UNMANAGED_TAG&&e.key!==s.NAMED_TAG})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(s.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=n}));i(E);E.Target;var A=o((function(e,t){function n(e,t,n,o){var a=e.getConstructorMetadata(n),u=a.compilerGeneratedMetadata;if(void 0===u){var s=h.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(s)}var l=a.userGeneratedMetadata,f=Object.keys(l),d=function(e,t,n,i,o){for(var a=[],u=0;u<o;u++){var s=r(u,e,t,n,i);null!==s&&a.push(s)}return a}(o,t,u,l,0===n.length&&f.length>0?f.length:n.length),p=function e(t,n){for(var r=t.getPropertiesMetadata(n),o=[],a=Object.keys(r),u=0,s=a;u<s.length;u++){var l=s[u],f=r[l],h=i(r[l]),d=h.targetName||l,p=h.inject||h.multiInject,v=new E.Target(c.TargetTypeEnum.ClassProperty,d,p);v.metadata=f,o.push(v)}var g=Object.getPrototypeOf(n.prototype).constructor;if(g!==Object){var m=e(t,g);o=o.concat(m)}return o}(e,n);return d.concat(p)}function r(e,t,n,r,o){var a=o[e.toString()]||[],u=i(a),s=!0!==u.unmanaged,l=r[e],f=u.inject||u.multiInject;if((l=f||l)instanceof x.LazyServiceIdentifer&&(l=l.unwrap()),s){if(!t&&(l===Object||l===Function||void 0===l)){var d=h.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(d)}var p=new E.Target(c.TargetTypeEnum.ConstructorArgument,u.targetName,l);return p.metadata=a,p}return null}function i(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s.INJECT_TAG],multiInject:t[s.MULTI_INJECT_TAG],targetName:t[s.NAME_TAG],unmanaged:t[s.UNMANAGED_TAG]}}Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=g.getFunctionName,t.getDependencies=function(e,t){return n(e,g.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,r){var i=Object.getPrototypeOf(r.prototype).constructor;if(i!==Object){var o=n(t,g.getFunctionName(i),i,!0),a=o.map((function(e){return e.metadata.filter((function(e){return e.key===s.UNMANAGED_TAG}))})),u=[].concat.apply([],a).length,c=o.length-u;return c>0?c:e(t,i)}return 0}}));i(A);A.getFunctionName,A.getDependencies,A.getBaseClassDependencyCount;var w=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,r,i){this.id=l.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=n}));i(w);w.Request;var T=o((function(e,t){function n(e){return e._bindingDictionary}function r(e,t,n,r,i,o){var a=e?s.MULTI_INJECT_TAG:s.INJECT_TAG,u=new y.Metadata(a,n),c=new E.Target(t,r,n,u);if(void 0!==i){var l=new y.Metadata(i,o);c.metadata.push(l)}return c}function i(e,t,n,r,i){var a=o(n.container,i.serviceIdentifier),u=[];return a.length===p.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=o(n.container,i.serviceIdentifier)),u=t?a:a.filter((function(e){var t=new w.Request(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case p.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=g.getServiceIdentifierAsString(e),a=h.NOT_REGISTERED;throw a+=g.listMetadataForTarget(i,n),a+=g.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a);case p.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case p.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=g.getServiceIdentifierAsString(e),a=h.AMBIGUOUS_MATCH+" "+i;throw a+=g.listRegisteredBindingsForServiceIdentifier(r,i,o),new Error(a)}}(i.serviceIdentifier,u,i,n.container),u}function o(e,t){var r=[],i=n(e);return i.hasKey(t)?r=i.get(t):null!==e.parent&&(r=o(e.parent,t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=n,t.plan=function(e,t,n,o,a,u,s,l){void 0===l&&(l=!1);var f=new m.Context(t),d=r(n,o,a,"",u,s);try{return function e(t,n,r,o,a,u){var s,l;if(null===a){s=i(t,n,o,null,u),l=new w.Request(r,o,null,s,u);var f=new b.Plan(o,l);o.addPlan(f)}else s=i(t,n,o,a,u),l=a.addChildRequest(u.serviceIdentifier,s,u);s.forEach((function(n){var r=null;if(u.isArray())r=l.addChildRequest(n.serviceIdentifier,n,u);else{if(n.cache)return;r=l}if(n.type===c.BindingTypeEnum.Instance&&null!==n.implementationType){var i=A.getDependencies(t,n.implementationType);if(!o.container.options.skipBaseClassChecks){var a=A.getBaseClassDependencyCount(t,n.implementationType);if(i.length<a){var s=h.ARGUMENTS_LENGTH_MISMATCH(A.getFunctionName(n.implementationType));throw new Error(s)}}i.forEach((function(n){e(t,!1,n.serviceIdentifier,o,r,n)}))}}))}(e,l,a,f,null,d),f}catch(e){throw v.isStackOverflowExeption(e)&&f.plan&&g.circularDependencyToException(f.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new E.Target(c.TargetTypeEnum.Variable,"",t,new y.Metadata(n,r)),o=new m.Context(e);return new w.Request(t,o,null,[],i)}}));i(T);T.getBindingDictionary,T.plan,T.createMockRequest;var C=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=function(e,t,n){var r,i,o=null;if(t.length>0){var a=t.filter((function(e){return null!==e.target&&e.target.type===c.TargetTypeEnum.ConstructorArgument})).map(n);i=a,o=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===c.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(o=new((r=e).bind.apply(r,[void 0].concat(i))),t,n)}else o=new e;return function(e,t){if(Reflect.hasMetadata(s.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(s.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(h.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,o),o}}));i(C);C.resolveInstance;var k=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){try{return n()}catch(n){throw v.isStackOverflowExeption(n)?new Error(h.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},r=function(e){return function(t){t.parentContext.setCurrentRequest(t);var i=t.bindings,o=t.childRequests,a=t.target&&t.target.isArray(),u=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(a&&u)return o.map((function(t){return r(e)(t)}));var s=null;if(!t.target.isOptional()||0!==i.length){var l=i[0],f=l.scope===c.BindingScopeEnum.Singleton,d=l.scope===c.BindingScopeEnum.Request;if(f&&l.activated)return l.cache;if(d&&null!==e&&e.has(l.id))return e.get(l.id);if(l.type===c.BindingTypeEnum.ConstantValue)s=l.cache;else if(l.type===c.BindingTypeEnum.Function)s=l.cache;else if(l.type===c.BindingTypeEnum.Constructor)s=l.implementationType;else if(l.type===c.BindingTypeEnum.DynamicValue&&null!==l.dynamicValue)s=n("toDynamicValue",l.serviceIdentifier,(function(){return l.dynamicValue(t.parentContext)}));else if(l.type===c.BindingTypeEnum.Factory&&null!==l.factory)s=n("toFactory",l.serviceIdentifier,(function(){return l.factory(t.parentContext)}));else if(l.type===c.BindingTypeEnum.Provider&&null!==l.provider)s=n("toProvider",l.serviceIdentifier,(function(){return l.provider(t.parentContext)}));else{if(l.type!==c.BindingTypeEnum.Instance||null===l.implementationType){var p=g.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(h.INVALID_BINDING_TYPE+" "+p)}s=C.resolveInstance(l.implementationType,o,r(e))}return"function"==typeof l.onActivation&&(s=l.onActivation(t.parentContext,s)),f&&(l.cache=s,l.activated=!0),d&&null!==e&&!e.has(l.id)&&e.set(l.id,s),s}}};t.resolve=function(e){return r(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}}));i(k);k.resolve;var M=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){var r=e.parentRequest;return null!==r&&(!!t(r)||n(r,t))};t.traverseAncerstors=n;var r=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new y.Metadata(e,t),n}};t.taggedConstraint=r;var i=r(s.NAMED_TAG);t.namedConstraint=i;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}}));i(M);M.traverseAncerstors,M.taggedConstraint,M.namedConstraint,M.typeConstraint;var I=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new O.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=M.namedConstraint(e),new O.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new O.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=M.taggedConstraint(e)(t),new O.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return M.typeConstraint(e)(t.parentRequest)},new O.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return M.namedConstraint(e)(t.parentRequest)},new O.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return M.taggedConstraint(e)(t)(n.parentRequest)},new O.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return M.traverseAncerstors(t,M.typeConstraint(e))},new O.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!M.traverseAncerstors(t,M.typeConstraint(e))},new O.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return M.traverseAncerstors(t,M.namedConstraint(e))},new O.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!M.traverseAncerstors(t,M.namedConstraint(e))},new O.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return M.traverseAncerstors(n,M.taggedConstraint(e)(t))},new O.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!M.traverseAncerstors(n,M.taggedConstraint(e)(t))},new O.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return M.traverseAncerstors(t,e)},new O.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!M.traverseAncerstors(t,e)},new O.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=n}));i(I);I.BindingWhenSyntax;var O=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new I.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=n}));i(O);O.BindingOnSyntax;var P=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new I.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new O.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=n}));i(P);P.BindingWhenOnSyntax;var R=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=c.BindingScopeEnum.Request,new P.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=c.BindingScopeEnum.Singleton,new P.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=c.BindingScopeEnum.Transient,new P.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=n}));i(R);R.BindingInSyntax;var L=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new I.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new O.BindingOnSyntax(this._binding),this._bindingInSyntax=new R.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=n}));i(L);L.BindingInWhenOnSyntax;var N=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=c.BindingTypeEnum.Instance,this._binding.implementationType=e,new L.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+h.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=c.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=c.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new L.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=c.BindingTypeEnum.Constructor,this._binding.implementationType=e,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=c.BindingTypeEnum.Factory,this._binding.factory=e,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(h.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=c.BindingTypeEnum.Function,t},e.prototype.toAutoFactory=function(e){return this._binding.type=c.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},new P.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=c.BindingTypeEnum.Provider,this._binding.provider=e,new P.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=n}));i(N);N.BindingToSyntax;var D=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n}));i(D);D.ContainerSnapshot;var j=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(h.NULL_ARGUMENT);if(null==t)throw new Error(h.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(h.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(h.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(h.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(h.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(h.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=n}));i(j);j.Lookup;var F=o((function(e,t){var n=r&&r.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},i=r&&r.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){var t=e||{};if("object"!=typeof t)throw new Error(""+h.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=c.BindingScopeEnum.Transient;else if(t.defaultScope!==c.BindingScopeEnum.Singleton&&t.defaultScope!==c.BindingScopeEnum.Transient&&t.defaultScope!==c.BindingScopeEnum.Request)throw new Error(""+h.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+h.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+h.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=l.id(),this._bindingDictionary=new j.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new d.MetadataReader}return e.merge=function(t,n){var r=new e,i=T.getBindingDictionary(r),o=T.getBindingDictionary(t),a=T.getBindingDictionary(n);function u(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return u(o,i),u(a,i),r},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||c.BindingScopeEnum.Transient,n=new f.Binding(e,t);return this._bindingDictionary.add(e,n),new N.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(h.CANNOT_UNBIND+" "+g.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new j.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,s.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=T.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(D.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(h.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,c.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,c.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,s.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,c.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,c.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,s.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,u={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(u)))throw new Error(h.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(u);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=T.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),k.resolve(n)}},e}();t.Container=o}));i(F);F.Container;var z=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.id=l.id(),this.registry=e};t.ContainerModule=n;var r=function(e){this.id=l.id(),this.registry=e};t.AsyncContainerModule=r}));i(z);z.ContainerModule,z.AsyncContainerModule;var U=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(s.PARAM_TYPES,e))throw new Error(h.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(s.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(s.PARAM_TYPES,t,e),e}}}));i(U);U.injectable;var B=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=function(e,t){return function(n,r,i){var o=new y.Metadata(e,t);"number"==typeof i?_.tagParameter(n,r,i,o):_.tagProperty(n,r,o)}}}));i(B);B.tagged;var V=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.named=function(e){return function(t,n,r){var i=new y.Metadata(s.NAMED_TAG,e);"number"==typeof r?_.tagParameter(t,n,r,i):_.tagProperty(t,n,i)}}}));i(V);V.named;var G=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.optional=function(){return function(e,t,n){var r=new y.Metadata(s.OPTIONAL_TAG,!0);"number"==typeof n?_.tagParameter(e,t,n,r):_.tagProperty(e,t,r)}}}));i(G);G.optional;var H=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=function(){return function(e,t,n){var r=new y.Metadata(s.UNMANAGED_TAG,!0);_.tagParameter(e,t,n,r)}}}));i(H);H.unmanaged;var W=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=function(e){return function(t,n,r){var i=new y.Metadata(s.MULTI_INJECT_TAG,e);"number"==typeof r?_.tagParameter(t,n,r,i):_.tagProperty(t,n,i)}}}));i(W);W.multiInject;var q=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=function(e){return function(t,n,r){var i=new y.Metadata(s.NAME_TAG,e);_.tagParameter(t,n,r,i)}}}));i(q);q.targetName;var X=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=function(){return function(e,t,n){var r=new y.Metadata(s.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(s.POST_CONSTRUCT,e.constructor))throw new Error(h.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(s.POST_CONSTRUCT,r,e.constructor)}}}));i(X);X.postConstruct;var Z=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}}));i(Z);Z.multiBindToService;var Y=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.METADATA_KEY=s,t.Container=F.Container,t.BindingScopeEnum=c.BindingScopeEnum,t.BindingTypeEnum=c.BindingTypeEnum,t.TargetTypeEnum=c.TargetTypeEnum,t.AsyncContainerModule=z.AsyncContainerModule,t.ContainerModule=z.ContainerModule,t.injectable=U.injectable,t.tagged=B.tagged,t.named=V.named,t.inject=x.inject,t.LazyServiceIdentifer=x.LazyServiceIdentifer,t.optional=G.optional,t.unmanaged=H.unmanaged,t.multiInject=W.multiInject,t.targetName=q.targetName,t.postConstruct=X.postConstruct,t.MetadataReader=d.MetadataReader,t.id=l.id,t.decorate=_.decorate,t.traverseAncerstors=M.traverseAncerstors,t.taggedConstraint=M.taggedConstraint,t.namedConstraint=M.namedConstraint,t.typeConstraint=M.typeConstraint,t.getServiceIdentifierAsString=g.getServiceIdentifierAsString,t.multiBindToService=Z.multiBindToService}));i(Y);Y.METADATA_KEY;var K=Y.Container,Q=(Y.BindingScopeEnum,Y.BindingTypeEnum,Y.TargetTypeEnum,Y.AsyncContainerModule,Y.ContainerModule,Y.injectable),J=(Y.tagged,Y.named,Y.inject),$=(Y.LazyServiceIdentifer,Y.optional,Y.unmanaged,Y.multiInject,Y.targetName,Y.postConstruct),ee=(Y.MetadataReader,Y.id,Y.decorate),te=(Y.traverseAncerstors,Y.taggedConstraint,Y.namedConstraint,Y.typeConstraint,Y.getServiceIdentifierAsString,Y.multiBindToService,o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(o,a){r(o,a,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,o){return function(a,u){r(a,u,(function(){return e.getTagged(n,i,o)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,o){r(i,o,(function(){return e.getAll(n)}),t)}}}})));i(te);te.makePropertyInjectDecorator,te.makePropertyInjectNamedDecorator,te.makePropertyInjectTaggedDecorator,te.makePropertyMultiInjectDecorator;var ne=i(o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return void 0===t&&(t=!0),{lazyInject:te.makePropertyInjectDecorator(e,t),lazyInjectNamed:te.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:te.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:te.makePropertyMultiInjectDecorator(e,t)}}}))),re=function(e){return e&&e.Math==Math&&e},ie=re("object"==typeof globalThis&&globalThis)||re("object"==typeof window&&window)||re("object"==typeof self&&self)||re("object"==typeof r&&r)||Function("return this")(),oe=function(e){try{return!!e()}catch(e){return!0}},ae=!oe((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),ue={}.propertyIsEnumerable,se=Object.getOwnPropertyDescriptor,ce={f:se&&!ue.call({1:2},1)?function(e){var t=se(this,e);return!!t&&t.enumerable}:ue},le=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},fe={}.toString,he=function(e){return fe.call(e).slice(8,-1)},de="".split,pe=oe((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==he(e)?de.call(e,""):Object(e)}:Object,ve=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},ge=function(e){return pe(ve(e))},me=function(e){return"object"==typeof e?null!==e:"function"==typeof e},ye=function(e,t){if(!me(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!me(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!me(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!me(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},be={}.hasOwnProperty,_e=function(e,t){return be.call(e,t)},xe=ie.document,Se=me(xe)&&me(xe.createElement),Ee=function(e){return Se?xe.createElement(e):{}},Ae=!ae&&!oe((function(){return 7!=Object.defineProperty(Ee("div"),"a",{get:function(){return 7}}).a})),we=Object.getOwnPropertyDescriptor,Te={f:ae?we:function(e,t){if(e=ge(e),t=ye(t,!0),Ae)try{return we(e,t)}catch(e){}if(_e(e,t))return le(!ce.f.call(e,t),e[t])}},Ce=function(e){if(!me(e))throw TypeError(String(e)+" is not an object");return e},ke=Object.defineProperty,Me={f:ae?ke:function(e,t,n){if(Ce(e),t=ye(t,!0),Ce(n),Ae)try{return ke(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Ie=ae?function(e,t,n){return Me.f(e,t,le(1,n))}:function(e,t,n){return e[t]=n,e},Oe=function(e,t){try{Ie(ie,e,t)}catch(n){ie[e]=t}return t},Pe=ie["__core-js_shared__"]||Oe("__core-js_shared__",{}),Re=Function.toString;"function"!=typeof Pe.inspectSource&&(Pe.inspectSource=function(e){return Re.call(e)});var Le,Ne,De,je=Pe.inspectSource,Fe=ie.WeakMap,ze="function"==typeof Fe&&/native code/.test(je(Fe)),Ue=o((function(e){(e.exports=function(e,t){return Pe[e]||(Pe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})})),Be=0,Ve=Math.random(),Ge=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Be+Ve).toString(36)},He=Ue("keys"),We=function(e){return He[e]||(He[e]=Ge(e))},qe={},Xe=ie.WeakMap;if(ze){var Ze=new Xe,Ye=Ze.get,Ke=Ze.has,Qe=Ze.set;Le=function(e,t){return Qe.call(Ze,e,t),t},Ne=function(e){return Ye.call(Ze,e)||{}},De=function(e){return Ke.call(Ze,e)}}else{var Je=We("state");qe[Je]=!0,Le=function(e,t){return Ie(e,Je,t),t},Ne=function(e){return _e(e,Je)?e[Je]:{}},De=function(e){return _e(e,Je)}}var $e,et={set:Le,get:Ne,has:De,enforce:function(e){return De(e)?Ne(e):Le(e,{})},getterFor:function(e){return function(t){var n;if(!me(t)||(n=Ne(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},tt=o((function(e){var t=et.get,n=et.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var a=!!o&&!!o.unsafe,u=!!o&&!!o.enumerable,s=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof t||_e(i,"name")||Ie(i,"name",t),n(i).source=r.join("string"==typeof t?t:"")),e!==ie?(a?!s&&e[t]&&(u=!0):delete e[t],u?e[t]=i:Ie(e,t,i)):u?e[t]=i:Oe(t,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||je(this)}))})),nt=ie,rt=function(e){return"function"==typeof e?e:void 0},it=function(e,t){return arguments.length<2?rt(nt[e])||rt(ie[e]):nt[e]&&nt[e][t]||ie[e]&&ie[e][t]},ot=Math.ceil,at=Math.floor,ut=function(e){return isNaN(e=+e)?0:(e>0?at:ot)(e)},st=Math.min,ct=function(e){return e>0?st(ut(e),9007199254740991):0},lt=Math.max,ft=Math.min,ht=function(e,t){var n=ut(e);return n<0?lt(n+t,0):ft(n,t)},dt=function(e){return function(t,n,r){var i,o=ge(t),a=ct(o.length),u=ht(r,a);if(e&&n!=n){for(;a>u;)if((i=o[u++])!=i)return!0}else for(;a>u;u++)if((e||u in o)&&o[u]===n)return e||u||0;return!e&&-1}},pt={includes:dt(!0),indexOf:dt(!1)},vt=pt.indexOf,gt=function(e,t){var n,r=ge(e),i=0,o=[];for(n in r)!_e(qe,n)&&_e(r,n)&&o.push(n);for(;t.length>i;)_e(r,n=t[i++])&&(~vt(o,n)||o.push(n));return o},mt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yt=mt.concat("length","prototype"),bt={f:Object.getOwnPropertyNames||function(e){return gt(e,yt)}},_t={f:Object.getOwnPropertySymbols},xt=it("Reflect","ownKeys")||function(e){var t=bt.f(Ce(e)),n=_t.f;return n?t.concat(n(e)):t},St=function(e,t){for(var n=xt(t),r=Me.f,i=Te.f,o=0;o<n.length;o++){var a=n[o];_e(e,a)||r(e,a,i(t,a))}},Et=/#|\.prototype\./,At=function(e,t){var n=Tt[wt(e)];return n==kt||n!=Ct&&("function"==typeof t?oe(t):!!t)},wt=At.normalize=function(e){return String(e).replace(Et,".").toLowerCase()},Tt=At.data={},Ct=At.NATIVE="N",kt=At.POLYFILL="P",Mt=At,It=Te.f,Ot=function(e,t){var n,r,i,o,a,u=e.target,s=e.global,c=e.stat;if(n=s?ie:c?ie[u]||Oe(u,{}):(ie[u]||{}).prototype)for(r in t){if(o=t[r],i=e.noTargetGet?(a=It(n,r))&&a.value:n[r],!Mt(s?r:u+(c?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;St(o,i)}(e.sham||i&&i.sham)&&Ie(o,"sham",!0),tt(n,r,o,e)}},Pt=!!Object.getOwnPropertySymbols&&!oe((function(){return!String(Symbol())})),Rt=Pt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Lt=Array.isArray||function(e){return"Array"==he(e)},Nt=function(e){return Object(ve(e))},Dt=Object.keys||function(e){return gt(e,mt)},jt=ae?Object.defineProperties:function(e,t){Ce(e);for(var n,r=Dt(t),i=r.length,o=0;i>o;)Me.f(e,n=r[o++],t[n]);return e},Ft=it("document","documentElement"),zt=We("IE_PROTO"),Ut=function(){},Bt=function(e){return"<script>"+e+"<\/script>"},Vt=function(){try{$e=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Vt=$e?function(e){e.write(Bt("")),e.close();var t=e.parentWindow.Object;return e=null,t}($e):((t=Ee("iframe")).style.display="none",Ft.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Bt("document.F=Object")),e.close(),e.F);for(var n=mt.length;n--;)delete Vt.prototype[mt[n]];return Vt()};qe[zt]=!0;var Gt=Object.create||function(e,t){var n;return null!==e?(Ut.prototype=Ce(e),n=new Ut,Ut.prototype=null,n[zt]=e):n=Vt(),void 0===t?n:jt(n,t)},Ht=bt.f,Wt={}.toString,qt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Xt={f:function(e){return qt&&"[object Window]"==Wt.call(e)?function(e){try{return Ht(e)}catch(e){return qt.slice()}}(e):Ht(ge(e))}},Zt=Ue("wks"),Yt=ie.Symbol,Kt=Rt?Yt:Yt&&Yt.withoutSetter||Ge,Qt=function(e){return _e(Zt,e)||(Pt&&_e(Yt,e)?Zt[e]=Yt[e]:Zt[e]=Kt("Symbol."+e)),Zt[e]},Jt={f:Qt},$t=Me.f,en=Me.f,tn=Qt("toStringTag"),nn=function(e,t,n){e&&!_e(e=n?e:e.prototype,tn)&&en(e,tn,{configurable:!0,value:t})},rn=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},on=function(e,t,n){if(rn(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},an=Qt("species"),un=function(e,t){var n;return Lt(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Lt(n.prototype)?me(n)&&null===(n=n[an])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},sn=[].push,cn=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=5==e||o;return function(u,s,c,l){for(var f,h,d=Nt(u),p=pe(d),v=on(s,c,3),g=ct(p.length),m=0,y=l||un,b=t?y(u,g):n?y(u,0):void 0;g>m;m++)if((a||m in p)&&(h=v(f=p[m],m,d),e))if(t)b[m]=h;else if(h)switch(e){case 3:return!0;case 5:return f;case 6:return m;case 2:sn.call(b,f)}else if(i)return!1;return o?-1:r||i?i:b}},ln={forEach:cn(0),map:cn(1),filter:cn(2),some:cn(3),every:cn(4),find:cn(5),findIndex:cn(6)},fn=ln.forEach,hn=We("hidden"),dn=Qt("toPrimitive"),pn=et.set,vn=et.getterFor("Symbol"),gn=Object.prototype,mn=ie.Symbol,yn=it("JSON","stringify"),bn=Te.f,_n=Me.f,xn=Xt.f,Sn=ce.f,En=Ue("symbols"),An=Ue("op-symbols"),wn=Ue("string-to-symbol-registry"),Tn=Ue("symbol-to-string-registry"),Cn=Ue("wks"),kn=ie.QObject,Mn=!kn||!kn.prototype||!kn.prototype.findChild,In=ae&&oe((function(){return 7!=Gt(_n({},"a",{get:function(){return _n(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=bn(gn,t);r&&delete gn[t],_n(e,t,n),r&&e!==gn&&_n(gn,t,r)}:_n,On=function(e,t){var n=En[e]=Gt(mn.prototype);return pn(n,{type:"Symbol",tag:e,description:t}),ae||(n.description=t),n},Pn=Rt?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof mn},Rn=function(e,t,n){e===gn&&Rn(An,t,n),Ce(e);var r=ye(t,!0);return Ce(n),_e(En,r)?(n.enumerable?(_e(e,hn)&&e[hn][r]&&(e[hn][r]=!1),n=Gt(n,{enumerable:le(0,!1)})):(_e(e,hn)||_n(e,hn,le(1,{})),e[hn][r]=!0),In(e,r,n)):_n(e,r,n)},Ln=function(e,t){Ce(e);var n=ge(t),r=Dt(n).concat(Fn(n));return fn(r,(function(t){ae&&!Nn.call(n,t)||Rn(e,t,n[t])})),e},Nn=function(e){var t=ye(e,!0),n=Sn.call(this,t);return!(this===gn&&_e(En,t)&&!_e(An,t))&&(!(n||!_e(this,t)||!_e(En,t)||_e(this,hn)&&this[hn][t])||n)},Dn=function(e,t){var n=ge(e),r=ye(t,!0);if(n!==gn||!_e(En,r)||_e(An,r)){var i=bn(n,r);return!i||!_e(En,r)||_e(n,hn)&&n[hn][r]||(i.enumerable=!0),i}},jn=function(e){var t=xn(ge(e)),n=[];return fn(t,(function(e){_e(En,e)||_e(qe,e)||n.push(e)})),n},Fn=function(e){var t=e===gn,n=xn(t?An:ge(e)),r=[];return fn(n,(function(e){!_e(En,e)||t&&!_e(gn,e)||r.push(En[e])})),r};if(Pt||(tt((mn=function(){if(this instanceof mn)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ge(e),n=function(e){this===gn&&n.call(An,e),_e(this,hn)&&_e(this[hn],t)&&(this[hn][t]=!1),In(this,t,le(1,e))};return ae&&Mn&&In(gn,t,{configurable:!0,set:n}),On(t,e)}).prototype,"toString",(function(){return vn(this).tag})),tt(mn,"withoutSetter",(function(e){return On(Ge(e),e)})),ce.f=Nn,Me.f=Rn,Te.f=Dn,bt.f=Xt.f=jn,_t.f=Fn,Jt.f=function(e){return On(Qt(e),e)},ae&&(_n(mn.prototype,"description",{configurable:!0,get:function(){return vn(this).description}}),tt(gn,"propertyIsEnumerable",Nn,{unsafe:!0}))),Ot({global:!0,wrap:!0,forced:!Pt,sham:!Pt},{Symbol:mn}),fn(Dt(Cn),(function(e){!function(e){var t=nt.Symbol||(nt.Symbol={});_e(t,e)||$t(t,e,{value:Jt.f(e)})}(e)})),Ot({target:"Symbol",stat:!0,forced:!Pt},{for:function(e){var t=String(e);if(_e(wn,t))return wn[t];var n=mn(t);return wn[t]=n,Tn[n]=t,n},keyFor:function(e){if(!Pn(e))throw TypeError(e+" is not a symbol");if(_e(Tn,e))return Tn[e]},useSetter:function(){Mn=!0},useSimple:function(){Mn=!1}}),Ot({target:"Object",stat:!0,forced:!Pt,sham:!ae},{create:function(e,t){return void 0===t?Gt(e):Ln(Gt(e),t)},defineProperty:Rn,defineProperties:Ln,getOwnPropertyDescriptor:Dn}),Ot({target:"Object",stat:!0,forced:!Pt},{getOwnPropertyNames:jn,getOwnPropertySymbols:Fn}),Ot({target:"Object",stat:!0,forced:oe((function(){_t.f(1)}))},{getOwnPropertySymbols:function(e){return _t.f(Nt(e))}}),yn){var zn=!Pt||oe((function(){var e=mn();return"[null]"!=yn([e])||"{}"!=yn({a:e})||"{}"!=yn(Object(e))}));Ot({target:"JSON",stat:!0,forced:zn},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(me(t)||void 0!==e)&&!Pn(e))return Lt(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Pn(t))return t}),i[1]=t,yn.apply(null,i)}})}mn.prototype[dn]||Ie(mn.prototype,dn,mn.prototype.valueOf),nn(mn,"Symbol"),qe[hn]=!0;var Un=Me.f,Bn=ie.Symbol;if(ae&&"function"==typeof Bn&&(!("description"in Bn.prototype)||void 0!==Bn().description)){var Vn={},Gn=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Gn?new Bn(e):void 0===e?Bn():Bn(e);return""===e&&(Vn[t]=!0),t};St(Gn,Bn);var Hn=Gn.prototype=Bn.prototype;Hn.constructor=Gn;var Wn=Hn.toString,qn="Symbol(test)"==String(Bn("test")),Xn=/^Symbol\((.*)\)[^)]+$/;Un(Hn,"description",{configurable:!0,get:function(){var e=me(this)?this.valueOf():this,t=Wn.call(e);if(_e(Vn,e))return"";var n=qn?t.slice(7,-1):t.replace(Xn,"$1");return""===n?void 0:n}}),Ot({global:!0,forced:!0},{Symbol:Gn})}var Zn={};Zn[Qt("toStringTag")]="z";var Yn="[object z]"===String(Zn),Kn=Qt("toStringTag"),Qn="Arguments"==he(function(){return arguments}()),Jn=Yn?he:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Kn))?n:Qn?he(t):"Object"==(r=he(t))&&"function"==typeof t.callee?"Arguments":r},$n=Yn?{}.toString:function(){return"[object "+Jn(this)+"]"};Yn||tt(Object.prototype,"toString",$n,{unsafe:!0});var er,tr,nr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},rr=function(e,t,n){var r=ye(t);r in e?Me.f(e,r,le(0,n)):e[r]=n},ir=it("navigator","userAgent")||"",or=ie.process,ar=or&&or.versions,ur=ar&&ar.v8;ur?tr=(er=ur.split("."))[0]+er[1]:ir&&(!(er=ir.match(/Edge\/(\d+)/))||er[1]>=74)&&(er=ir.match(/Chrome\/(\d+)/))&&(tr=er[1]);var sr=tr&&+tr,cr=Qt("species"),lr=function(e){return sr>=51||!oe((function(){var t=[];return(t.constructor={})[cr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},fr=Qt("isConcatSpreadable"),hr=sr>=51||!oe((function(){var e=[];return e[fr]=!1,e.concat()[0]!==e})),dr=lr("concat"),pr=function(e){if(!me(e))return!1;var t=e[fr];return void 0!==t?!!t:Lt(e)};Ot({target:"Array",proto:!0,forced:!hr||!dr},{concat:function(e){var t,n,r,i,o,a=Nt(this),u=un(a,0),s=0;for(t=-1,r=arguments.length;t<r;t++)if(pr(o=-1===t?a:arguments[t])){if(s+(i=ct(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,s++)n in o&&rr(u,s,o[n])}else{if(s>=9007199254740991)throw TypeError("Maximum allowed index exceeded");rr(u,s++,o)}return u.length=s,u}});var vr=function(e,t){var n=[][e];return!!n&&oe((function(){n.call(null,t||function(){throw 1},1)}))},gr=Object.defineProperty,mr={},yr=function(e){throw e},br=function(e,t){if(_e(mr,e))return mr[e];t||(t={});var n=[][e],r=!!_e(t,"ACCESSORS")&&t.ACCESSORS,i=_e(t,0)?t[0]:yr,o=_e(t,1)?t[1]:void 0;return mr[e]=!!n&&!oe((function(){if(r&&!ae)return!0;var e={length:-1};r?gr(e,1,{enumerable:!0,get:yr}):e[1]=1,n.call(e,i,o)}))},_r=ln.forEach,xr=vr("forEach"),Sr=br("forEach"),Er=xr&&Sr?[].forEach:function(e){return _r(this,e,arguments.length>1?arguments[1]:void 0)};Ot({target:"Array",proto:!0,forced:[].forEach!=Er},{forEach:Er});var Ar=Qt("unscopables"),wr=Array.prototype;null==wr[Ar]&&Me.f(wr,Ar,{configurable:!0,value:Gt(null)});var Tr,Cr,kr,Mr=function(e){wr[Ar][e]=!0},Ir={},Or=!oe((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Pr=We("IE_PROTO"),Rr=Object.prototype,Lr=Or?Object.getPrototypeOf:function(e){return e=Nt(e),_e(e,Pr)?e[Pr]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Rr:null},Nr=Qt("iterator"),Dr=!1;[].keys&&("next"in(kr=[].keys())?(Cr=Lr(Lr(kr)))!==Object.prototype&&(Tr=Cr):Dr=!0),null==Tr&&(Tr={}),_e(Tr,Nr)||Ie(Tr,Nr,(function(){return this}));var jr={IteratorPrototype:Tr,BUGGY_SAFARI_ITERATORS:Dr},Fr=jr.IteratorPrototype,zr=function(){return this},Ur=function(e,t,n){var r=t+" Iterator";return e.prototype=Gt(Fr,{next:le(1,n)}),nn(e,r,!1),Ir[r]=zr,e},Br=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ce(n),function(e){if(!me(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),Vr=jr.IteratorPrototype,Gr=jr.BUGGY_SAFARI_ITERATORS,Hr=Qt("iterator"),Wr=function(){return this},qr=function(e,t,n,r,i,o,a){Ur(n,t,r);var u,s,c,l=function(e){if(e===i&&v)return v;if(!Gr&&e in d)return d[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",h=!1,d=e.prototype,p=d[Hr]||d["@@iterator"]||i&&d[i],v=!Gr&&p||l(i),g="Array"==t&&d.entries||p;if(g&&(u=Lr(g.call(new e)),Vr!==Object.prototype&&u.next&&(Lr(u)!==Vr&&(Br?Br(u,Vr):"function"!=typeof u[Hr]&&Ie(u,Hr,Wr)),nn(u,f,!0))),"values"==i&&p&&"values"!==p.name&&(h=!0,v=function(){return p.call(this)}),d[Hr]!==v&&Ie(d,Hr,v),Ir[t]=v,i)if(s={values:l("values"),keys:o?v:l("keys"),entries:l("entries")},a)for(c in s)(Gr||h||!(c in d))&&tt(d,c,s[c]);else Ot({target:t,proto:!0,forced:Gr||h},s);return s},Xr=et.set,Zr=et.getterFor("Array Iterator"),Yr=qr(Array,"Array",(function(e,t){Xr(this,{type:"Array Iterator",target:ge(e),index:0,kind:t})}),(function(){var e=Zr(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Ir.Arguments=Ir.Array,Mr("keys"),Mr("values"),Mr("entries");var Kr=Me.f,Qr=Function.prototype,Jr=Qr.toString,$r=/^\s*function ([^ (]*)/;ae&&!("name"in Qr)&&Kr(Qr,"name",{configurable:!0,get:function(){try{return Jr.call(this).match($r)[1]}catch(e){return""}}});var ei=oe((function(){Dt(1)}));Ot({target:"Object",stat:!0,forced:ei},{keys:function(e){return Dt(Nt(e))}});var ti=!oe((function(){return Object.isExtensible(Object.preventExtensions({}))})),ni=o((function(e){var t=Me.f,n=Ge("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!me(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!_e(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!_e(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return ti&&a.REQUIRED&&i(e)&&!_e(e,n)&&o(e),e}};qe[n]=!0})),ri=(ni.REQUIRED,ni.fastKey,ni.getWeakData,ni.onFreeze,Qt("iterator")),ii=Array.prototype,oi=function(e){return void 0!==e&&(Ir.Array===e||ii[ri]===e)},ai=Qt("iterator"),ui=function(e){if(null!=e)return e[ai]||e["@@iterator"]||Ir[Jn(e)]},si=function(e,t,n,r){try{return r?t(Ce(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&Ce(i.call(e)),t}},ci=o((function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,o){var a,u,s,c,l,f,h,d=on(n,r,i?2:1);if(o)a=e;else{if("function"!=typeof(u=ui(e)))throw TypeError("Target is not iterable");if(oi(u)){for(s=0,c=ct(e.length);c>s;s++)if((l=i?d(Ce(h=e[s])[0],h[1]):d(e[s]))&&l instanceof t)return l;return new t(!1)}a=u.call(e)}for(f=a.next;!(h=f.call(a)).done;)if("object"==typeof(l=si(a,d,h.value,i))&&l&&l instanceof t)return l;return new t(!1)}).stop=function(e){return new t(!0,e)}})),li=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},fi=Qt("iterator"),hi=!1;try{var di=0,pi={next:function(){return{done:!!di++}},return:function(){hi=!0}};pi[fi]=function(){return this},Array.from(pi,(function(){throw 2}))}catch(e){}var vi=function(e,t){if(!t&&!hi)return!1;var n=!1;try{var r={};r[fi]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},gi=function(e,t,n){var r,i;return Br&&"function"==typeof(r=t.constructor)&&r!==n&&me(i=r.prototype)&&i!==n.prototype&&Br(e,i),e},mi=function(e,t,n){for(var r in t)tt(e,r,t[r],n);return e},yi=Qt("species"),bi=function(e){var t=it(e),n=Me.f;ae&&t&&!t[yi]&&n(t,yi,{configurable:!0,get:function(){return this}})},_i=Me.f,xi=ni.fastKey,Si=et.set,Ei=et.getterFor,Ai=(function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=ie[e],u=a&&a.prototype,s=a,c={},l=function(e){var t=u[e];tt(u,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!me(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!me(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!me(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Mt(e,"function"!=typeof a||!(i||u.forEach&&!oe((function(){(new a).entries().next()})))))s=n.getConstructor(t,e,r,o),ni.REQUIRED=!0;else if(Mt(e,!0)){var f=new s,h=f[o](i?{}:-0,1)!=f,d=oe((function(){f.has(1)})),p=vi((function(e){new a(e)})),v=!i&&oe((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));p||((s=t((function(t,n){li(t,s,e);var i=gi(new a,t,s);return null!=n&&ci(n,i[o],i,r),i}))).prototype=u,u.constructor=s),(d||v)&&(l("delete"),l("has"),r&&l("get")),(v||h)&&l(o),i&&u.clear&&delete u.clear}c[e]=s,Ot({global:!0,forced:s!=a},c),nn(s,e),i||n.setStrong(s,e,r)}("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(e,t,n,r){var i=e((function(e,o){li(e,i,t),Si(e,{type:t,index:Gt(null),first:void 0,last:void 0,size:0}),ae||(e.size=0),null!=o&&ci(o,e[r],e,n)})),o=Ei(t),a=function(e,t,n){var r,i,a=o(e),s=u(e,t);return s?s.value=n:(a.last=s={index:i=xi(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),ae?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},u=function(e,t){var n,r=o(e),i=xi(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return mi(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ae?e.size=0:this.size=0},delete:function(e){var t=o(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),ae?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=on(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),mi(i.prototype,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),ae&&_i(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Ei(t),o=Ei(r);qr(e,t,(function(e,t){Si(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),bi(t)}}),function(e){return function(t,n){var r,i,o=String(ve(t)),a=ut(n),u=o.length;return a<0||a>=u?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===u||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}),wi={codeAt:Ai(!1),charAt:Ai(!0)},Ti=wi.charAt,Ci=et.set,ki=et.getterFor("String Iterator");qr(String,"String",(function(e){Ci(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=ki(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Ti(n,r),t.index+=e.length,{value:e,done:!1})}));var Mi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var Ii in Mi){var Oi=ie[Ii],Pi=Oi&&Oi.prototype;if(Pi&&Pi.forEach!==Er)try{Ie(Pi,"forEach",Er)}catch(e){Pi.forEach=Er}}var Ri=Qt("iterator"),Li=Qt("toStringTag"),Ni=Yr.values;for(var Di in Mi){var ji=ie[Di],Fi=ji&&ji.prototype;if(Fi){if(Fi[Ri]!==Ni)try{Ie(Fi,Ri,Ni)}catch(e){Fi[Ri]=Ni}if(Fi[Li]||Ie(Fi,Li,Di),Mi[Di])for(var zi in Yr)if(Fi[zi]!==Yr[zi])try{Ie(Fi,zi,Yr[zi])}catch(e){Fi[zi]=Yr[zi]}}}function Ui(e){return(Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bi(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function Vi(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Bi(o,r,i,a,u,"next",e)}function u(e){Bi(o,r,i,a,u,"throw",e)}a(void 0)}))}}function Gi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wi(e,t,n){return t&&Hi(e.prototype,t),n&&Hi(e,n),e}function qi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xi(Object(n),!0).forEach((function(t){qi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Yi(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qi(e,t)}function Ki(e){return(Ki=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qi(e,t){return(Qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ji(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function $i(e,t,n){return($i=Ji()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Qi(i,n.prototype),i}).apply(null,arguments)}function eo(e){var t="function"==typeof Map?new Map:void 0;return(eo=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return $i(e,arguments,Ki(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Qi(r,e)})(e)}function to(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function no(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ro(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?no(e):t}function io(e){var t=Ji();return function(){var n,r=Ki(e);if(t){var i=Ki(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ro(this,n)}}function oo(e,t,n){return(oo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ki(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ao(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(e,t)||so(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uo(e){return function(e){if(Array.isArray(e))return co(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||so(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function so(e,t){if(e){if("string"==typeof e)return co(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?co(e,t):void 0}}function co(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lo(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=so(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function fo(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function ho(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var po=function(){var e=Ce(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},vo=RegExp.prototype,go=vo.toString,mo=oe((function(){return"/a/b"!=go.call({source:"a",flags:"b"})})),yo="toString"!=go.name;(mo||yo)&&tt(RegExp.prototype,"toString",(function(){var e=Ce(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in vo)?po.call(e):n)}),{unsafe:!0});var bo=[].join,_o=pe!=Object,xo=vr("join",",");Ot({target:"Array",proto:!0,forced:_o||!xo},{join:function(e){return bo.call(ge(this),void 0===e?",":e)}});var So=Qt("match"),Eo=function(e){var t;return me(e)&&(void 0!==(t=e[So])?!!t:"RegExp"==he(e))};function Ao(e,t){return RegExp(e,t)}var wo={UNSUPPORTED_Y:oe((function(){var e=Ao("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:oe((function(){var e=Ao("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},To=Me.f,Co=bt.f,ko=et.set,Mo=Qt("match"),Io=ie.RegExp,Oo=Io.prototype,Po=/a/g,Ro=/a/g,Lo=new Io(Po)!==Po,No=wo.UNSUPPORTED_Y;if(ae&&Mt("RegExp",!Lo||No||oe((function(){return Ro[Mo]=!1,Io(Po)!=Po||Io(Ro)==Ro||"/a/i"!=Io(Po,"i")})))){for(var Do=function(e,t){var n,r=this instanceof Do,i=Eo(e),o=void 0===t;if(!r&&i&&e.constructor===Do&&o)return e;Lo?i&&!o&&(e=e.source):e instanceof Do&&(o&&(t=po.call(e)),e=e.source),No&&(n=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var a=gi(Lo?new Io(e,t):Io(e,t),r?this:Oo,Do);return No&&n&&ko(a,{sticky:n}),a},jo=function(e){e in Do||To(Do,e,{configurable:!0,get:function(){return Io[e]},set:function(t){Io[e]=t}})},Fo=Co(Io),zo=0;Fo.length>zo;)jo(Fo[zo++]);Oo.constructor=Do,Do.prototype=Oo,tt(ie,"RegExp",Do)}bi("RegExp");var Uo=RegExp.prototype.exec,Bo=String.prototype.replace,Vo=Uo,Go=function(){var e=/a/,t=/b*/g;return Uo.call(e,"a"),Uo.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Ho=wo.UNSUPPORTED_Y||wo.BROKEN_CARET,Wo=void 0!==/()??/.exec("")[1];(Go||Wo||Ho)&&(Vo=function(e){var t,n,r,i,o=this,a=Ho&&o.sticky,u=po.call(o),s=o.source,c=0,l=e;return a&&(-1===(u=u.replace("y","")).indexOf("g")&&(u+="g"),l=String(e).slice(o.lastIndex),o.lastIndex>0&&(!o.multiline||o.multiline&&"\n"!==e[o.lastIndex-1])&&(s="(?: "+s+")",l=" "+l,c++),n=new RegExp("^(?:"+s+")",u)),Wo&&(n=new RegExp("^"+s+"$(?!\\s)",u)),Go&&(t=o.lastIndex),r=Uo.call(a?n:o,l),a?r?(r.input=r.input.slice(c),r[0]=r[0].slice(c),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:Go&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),Wo&&r&&r.length>1&&Bo.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r});var qo=Vo;Ot({target:"RegExp",proto:!0,forced:/./.exec!==qo},{exec:qo});var Xo=Qt("species"),Zo=!oe((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Yo="$0"==="a".replace(/./,"$0"),Ko=Qt("replace"),Qo=!!/./[Ko]&&""===/./[Ko]("a","$0"),Jo=!oe((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),$o=function(e,t,n,r){var i=Qt(e),o=!oe((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!oe((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Xo]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||"replace"===e&&(!Zo||!Yo||Qo)||"split"===e&&!Jo){var u=/./[i],s=n(i,""[e],(function(e,t,n,r,i){return t.exec===qo?o&&!i?{done:!0,value:u.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Yo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Qo}),c=s[0],l=s[1];tt(String.prototype,e,c),tt(RegExp.prototype,i,2==t?function(e,t){return l.call(e,this,t)}:function(e){return l.call(e,this)})}r&&Ie(RegExp.prototype[i],"sham",!0)},ea=wi.charAt,ta=function(e,t,n){return t+(n?ea(e,t).length:1)},na=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==he(e))throw TypeError("RegExp#exec called on incompatible receiver");return qo.call(e,t)},ra=Math.max,ia=Math.min,oa=Math.floor,aa=/\$([$&'`]|\d\d?|<[^>]*>)/g,ua=/\$([$&'`]|\d\d?)/g;$o("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=ve(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var s=n(t,e,this,r);if(s.done)return s.value}var c=Ce(e),l=String(this),f="function"==typeof r;f||(r=String(r));var h=c.global;if(h){var d=c.unicode;c.lastIndex=0}for(var p=[];;){var v=na(c,l);if(null===v)break;if(p.push(v),!h)break;""===String(v[0])&&(c.lastIndex=ta(l,ct(c.lastIndex),d))}for(var g,m="",y=0,b=0;b<p.length;b++){v=p[b];for(var _=String(v[0]),x=ra(ia(ut(v.index),l.length),0),S=[],E=1;E<v.length;E++)S.push(void 0===(g=v[E])?g:String(g));var A=v.groups;if(f){var w=[_].concat(S,x,l);void 0!==A&&w.push(A);var T=String(r.apply(void 0,w))}else T=u(_,l,x,S,A,r);x>=y&&(m+=l.slice(y,x)+T,y=x+_.length)}return m+l.slice(y)}];function u(e,n,r,i,o,a){var u=r+e.length,s=i.length,c=ua;return void 0!==o&&(o=Nt(o),c=aa),t.call(a,c,(function(t,a){var c;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(u);case"<":c=o[a.slice(1,-1)];break;default:var l=+a;if(0===l)return t;if(l>s){var f=oa(l/10);return 0===f?t:f<=s?void 0===i[f-1]?a.charAt(1):i[f-1]+a.charAt(1):t}c=i[l-1]}return void 0===c?"":c}))}}));var sa=Qt("species"),ca=function(e,t){var n,r=Ce(e).constructor;return void 0===r||null==(n=Ce(r)[sa])?t:rn(n)},la=[].push,fa=Math.min,ha=!oe((function(){return!RegExp(4294967295,"y")}));$o("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(ve(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!Eo(e))return t.call(r,e,i);for(var o,a,u,s=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,f=new RegExp(e.source,c+"g");(o=qo.call(f,r))&&!((a=f.lastIndex)>l&&(s.push(r.slice(l,o.index)),o.length>1&&o.index<r.length&&la.apply(s,o.slice(1)),u=o[0].length,l=a,s.length>=i));)f.lastIndex===o.index&&f.lastIndex++;return l===r.length?!u&&f.test("")||s.push(""):s.push(r.slice(l)),s.length>i?s.slice(0,i):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=ve(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=Ce(e),u=String(this),s=ca(a,RegExp),c=a.unicode,l=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(ha?"y":"g"),f=new s(ha?a:"^(?:"+a.source+")",l),h=void 0===i?4294967295:i>>>0;if(0===h)return[];if(0===u.length)return null===na(f,u)?[u]:[];for(var d=0,p=0,v=[];p<u.length;){f.lastIndex=ha?p:0;var g,m=na(f,ha?u:u.slice(p));if(null===m||(g=fa(ct(f.lastIndex+(ha?0:p)),u.length))===d)p=ta(u,p,c);else{if(v.push(u.slice(d,p)),v.length===h)return v;for(var y=1;y<=m.length-1;y++)if(v.push(m[y]),v.length===h)return v;p=d=g}}return v.push(u.slice(d)),v}]}),!ha);var da="\t\n\v\f\r \u2028\u2029\ufeff",pa="["+da+"]",va=RegExp("^"+pa+pa+"*"),ga=RegExp(pa+pa+"*$"),ma=function(e){return function(t){var n=String(ve(t));return 1&e&&(n=n.replace(va,"")),2&e&&(n=n.replace(ga,"")),n}},ya={start:ma(1),end:ma(2),trim:ma(3)},ba=ya.trim;Ot({target:"String",proto:!0,forced:function(e){return oe((function(){return!!da[e]()||""!=""[e]()||da[e].name!==e}))}("trim")},{trim:function(){return ba(this)}});var _a=window.document.documentElement.style;function xa(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}function Sa(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ea(e){return Sa(e).split(/\s+/)}function Aa(e,t,n){var r=document.createElement(e);return r.className=t||"",n&&n.appendChild(r),r}function wa(e){var t=e.parentNode;t&&t.removeChild(e)}function Ta(e,t){if(void 0!==e.classList)for(var n=Ea(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!ka(e,t)){var o=Ia(e);Ma(e,(o?o+" ":"")+t)}}function Ca(e,t){void 0!==e.classList?e.classList.remove(t):Ma(e,Sa((" "+Ia(e)+" ").replace(" "+t+" "," ")))}function ka(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Ia(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function Ma(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Ia(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function Oa(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Pa=function(e){if(!_a)return e[0];for(var t in e)if(e[t]&&e[t]in _a)return e[t];return e[0]}(["transform","WebkitTransform"]);function Ra(e,t){e.style[Pa]=t}function La(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}var Na,Da=Object.freeze({__proto__:null,getContainer:xa,trim:Sa,splitWords:Ea,create:Aa,remove:wa,addClass:Ta,removeClass:Ca,hasClass:ka,setClass:Ma,getClass:Ia,empty:Oa,setTransform:Ra,triggerResize:La,printCanvas:function(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))}}),ja="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Fa=Me.f,za=ie.Int8Array,Ua=za&&za.prototype,Ba=ie.Uint8ClampedArray,Va=Ba&&Ba.prototype,Ga=za&&Lr(za),Ha=Ua&&Lr(Ua),Wa=Object.prototype,qa=Wa.isPrototypeOf,Xa=Qt("toStringTag"),Za=Ge("TYPED_ARRAY_TAG"),Ya=ja&&!!Br&&"Opera"!==Jn(ie.opera),Ka=!1,Qa={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ja=function(e){return me(e)&&_e(Qa,Jn(e))};for(Na in Qa)ie[Na]||(Ya=!1);if((!Ya||"function"!=typeof Ga||Ga===Function.prototype)&&(Ga=function(){throw TypeError("Incorrect invocation")},Ya))for(Na in Qa)ie[Na]&&Br(ie[Na],Ga);if((!Ya||!Ha||Ha===Wa)&&(Ha=Ga.prototype,Ya))for(Na in Qa)ie[Na]&&Br(ie[Na].prototype,Ha);if(Ya&&Lr(Va)!==Ha&&Br(Va,Ha),ae&&!_e(Ha,Xa))for(Na in Ka=!0,Fa(Ha,Xa,{get:function(){return me(this)?this[Za]:void 0}}),Qa)ie[Na]&&Ie(ie[Na],Za,Na);var $a={NATIVE_ARRAY_BUFFER_VIEWS:Ya,TYPED_ARRAY_TAG:Ka&&Za,aTypedArray:function(e){if(Ja(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Br){if(qa.call(Ga,e))return e}else for(var t in Qa)if(_e(Qa,Na)){var n=ie[t];if(n&&(e===n||qa.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(ae){if(n)for(var r in Qa){var i=ie[r];i&&_e(i.prototype,e)&&delete i.prototype[e]}Ha[e]&&!n||tt(Ha,e,n?t:Ya&&Ua[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(ae){if(Br){if(n)for(r in Qa)(i=ie[r])&&_e(i,e)&&delete i[e];if(Ga[e]&&!n)return;try{return tt(Ga,e,n?t:Ya&&za[e]||t)}catch(e){}}for(r in Qa)!(i=ie[r])||i[e]&&!n||tt(i,e,t)}},isView:function(e){var t=Jn(e);return"DataView"===t||_e(Qa,t)},isTypedArray:Ja,TypedArray:Ga,TypedArrayPrototype:Ha},eu=$a.NATIVE_ARRAY_BUFFER_VIEWS,tu=ie.ArrayBuffer,nu=ie.Int8Array,ru=!eu||!oe((function(){nu(1)}))||!oe((function(){new nu(-1)}))||!vi((function(e){new nu,new nu(null),new nu(1.5),new nu(e)}),!0)||oe((function(){return 1!==new nu(new tu(2),1,void 0).length})),iu=function(e){if(void 0===e)return 0;var t=ut(e),n=ct(t);if(t!==n)throw RangeError("Wrong length or index");return n},ou=Math.abs,au=Math.pow,uu=Math.floor,su=Math.log,cu=Math.LN2,lu=function(e,t,n){var r,i,o,a=new Array(n),u=8*n-t-1,s=(1<<u)-1,c=s>>1,l=23===t?au(2,-24)-au(2,-77):0,f=e<0||0===e&&1/e<0?1:0,h=0;for((e=ou(e))!=e||e===1/0?(i=e!=e?1:0,r=s):(r=uu(su(e)/cu),e*(o=au(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*au(2,1-c))*o>=2&&(r++,o/=2),r+c>=s?(i=0,r=s):r+c>=1?(i=(e*o-1)*au(2,t),r+=c):(i=e*au(2,c-1)*au(2,t),r=0));t>=8;a[h++]=255&i,i/=256,t-=8);for(r=r<<t|i,u+=t;u>0;a[h++]=255&r,r/=256,u-=8);return a[--h]|=128*f,a},fu=function(e,t){var n,r=e.length,i=8*r-t-1,o=(1<<i)-1,a=o>>1,u=i-7,s=r-1,c=e[s--],l=127&c;for(c>>=7;u>0;l=256*l+e[s],s--,u-=8);for(n=l&(1<<-u)-1,l>>=-u,u+=t;u>0;n=256*n+e[s],s--,u-=8);if(0===l)l=1-a;else{if(l===o)return n?NaN:c?-1/0:1/0;n+=au(2,t),l-=a}return(c?-1:1)*n*au(2,l-t)},hu=function(e){for(var t=Nt(this),n=ct(t.length),r=arguments.length,i=ht(r>1?arguments[1]:void 0,n),o=r>2?arguments[2]:void 0,a=void 0===o?n:ht(o,n);a>i;)t[i++]=e;return t},du=bt.f,pu=Me.f,vu=et.get,gu=et.set,mu=ie.ArrayBuffer,yu=mu,bu=ie.DataView,_u=bu&&bu.prototype,xu=Object.prototype,Su=ie.RangeError,Eu=lu,Au=fu,wu=function(e){return[255&e]},Tu=function(e){return[255&e,e>>8&255]},Cu=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},ku=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Mu=function(e){return Eu(e,23,4)},Iu=function(e){return Eu(e,52,8)},Ou=function(e,t){pu(e.prototype,t,{get:function(){return vu(this)[t]}})},Pu=function(e,t,n,r){var i=iu(n),o=vu(e);if(i+t>o.byteLength)throw Su("Wrong index");var a=vu(o.buffer).bytes,u=i+o.byteOffset,s=a.slice(u,u+t);return r?s:s.reverse()},Ru=function(e,t,n,r,i,o){var a=iu(n),u=vu(e);if(a+t>u.byteLength)throw Su("Wrong index");for(var s=vu(u.buffer).bytes,c=a+u.byteOffset,l=r(+i),f=0;f<t;f++)s[c+f]=l[o?f:t-f-1]};if(ja){if(!oe((function(){mu(1)}))||!oe((function(){new mu(-1)}))||oe((function(){return new mu,new mu(1.5),new mu(NaN),"ArrayBuffer"!=mu.name}))){for(var Lu,Nu=(yu=function(e){return li(this,yu),new mu(iu(e))}).prototype=mu.prototype,Du=du(mu),ju=0;Du.length>ju;)(Lu=Du[ju++])in yu||Ie(yu,Lu,mu[Lu]);Nu.constructor=yu}Br&&Lr(_u)!==xu&&Br(_u,xu);var Fu=new bu(new yu(2)),zu=_u.setInt8;Fu.setInt8(0,2147483648),Fu.setInt8(1,2147483649),!Fu.getInt8(0)&&Fu.getInt8(1)||mi(_u,{setInt8:function(e,t){zu.call(this,e,t<<24>>24)},setUint8:function(e,t){zu.call(this,e,t<<24>>24)}},{unsafe:!0})}else yu=function(e){li(this,yu,"ArrayBuffer");var t=iu(e);gu(this,{bytes:hu.call(new Array(t),0),byteLength:t}),ae||(this.byteLength=t)},bu=function(e,t,n){li(this,bu,"DataView"),li(e,yu,"DataView");var r=vu(e).byteLength,i=ut(t);if(i<0||i>r)throw Su("Wrong offset");if(i+(n=void 0===n?r-i:ct(n))>r)throw Su("Wrong length");gu(this,{buffer:e,byteLength:n,byteOffset:i}),ae||(this.buffer=e,this.byteLength=n,this.byteOffset=i)},ae&&(Ou(yu,"byteLength"),Ou(bu,"buffer"),Ou(bu,"byteLength"),Ou(bu,"byteOffset")),mi(bu.prototype,{getInt8:function(e){return Pu(this,1,e)[0]<<24>>24},getUint8:function(e){return Pu(this,1,e)[0]},getInt16:function(e){var t=Pu(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Pu(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return ku(Pu(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return ku(Pu(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return Au(Pu(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return Au(Pu(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Ru(this,1,e,wu,t)},setUint8:function(e,t){Ru(this,1,e,wu,t)},setInt16:function(e,t){Ru(this,2,e,Tu,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Ru(this,2,e,Tu,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Ru(this,4,e,Cu,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Ru(this,4,e,Cu,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Ru(this,4,e,Mu,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Ru(this,8,e,Iu,t,arguments.length>2?arguments[2]:void 0)}});nn(yu,"ArrayBuffer"),nn(bu,"DataView");var Uu={ArrayBuffer:yu,DataView:bu},Bu=function(e,t){var n=function(e){var t=ut(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}(e);if(n%t)throw RangeError("Wrong offset");return n},Vu=$a.aTypedArrayConstructor,Gu=function(e){var t,n,r,i,o,a,u=Nt(e),s=arguments.length,c=s>1?arguments[1]:void 0,l=void 0!==c,f=ui(u);if(null!=f&&!oi(f))for(a=(o=f.call(u)).next,u=[];!(i=a.call(o)).done;)u.push(i.value);for(l&&s>2&&(c=on(c,arguments[2],2)),n=ct(u.length),r=new(Vu(this))(n),t=0;n>t;t++)r[t]=l?c(u[t],t):u[t];return r},Hu=o((function(e){var t=bt.f,n=ln.forEach,r=et.get,i=et.set,o=Me.f,a=Te.f,u=Math.round,s=ie.RangeError,c=Uu.ArrayBuffer,l=Uu.DataView,f=$a.NATIVE_ARRAY_BUFFER_VIEWS,h=$a.TYPED_ARRAY_TAG,d=$a.TypedArray,p=$a.TypedArrayPrototype,v=$a.aTypedArrayConstructor,g=$a.isTypedArray,m=function(e,t){for(var n=0,r=t.length,i=new(v(e))(r);r>n;)i[n]=t[n++];return i},y=function(e,t){o(e,t,{get:function(){return r(this)[t]}})},b=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=Jn(e))||"SharedArrayBuffer"==t},_=function(e,t){return g(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},x=function(e,t){return _(e,t=ye(t,!0))?le(2,e[t]):a(e,t)},S=function(e,t,n){return!(_(e,t=ye(t,!0))&&me(n)&&_e(n,"value"))||_e(n,"get")||_e(n,"set")||n.configurable||_e(n,"writable")&&!n.writable||_e(n,"enumerable")&&!n.enumerable?o(e,t,n):(e[t]=n.value,e)};ae?(f||(Te.f=x,Me.f=S,y(p,"buffer"),y(p,"byteOffset"),y(p,"byteLength"),y(p,"length")),Ot({target:"Object",stat:!0,forced:!f},{getOwnPropertyDescriptor:x,defineProperty:S}),e.exports=function(e,a,v){var y=e.match(/\d+$/)[0]/8,_=e+(v?"Clamped":"")+"Array",x="get"+e,S="set"+e,E=ie[_],A=E,w=A&&A.prototype,T={},C=function(e,t){o(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[x](t*y+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=r(e);v&&(n=(n=u(n))<0?0:n>255?255:255&n),i.view[S](t*y+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};f?ru&&(A=a((function(e,t,n,r){return li(e,A,_),gi(me(t)?b(t)?void 0!==r?new E(t,Bu(n,y),r):void 0!==n?new E(t,Bu(n,y)):new E(t):g(t)?m(A,t):Gu.call(A,t):new E(iu(t)),e,A)})),Br&&Br(A,d),n(t(E),(function(e){e in A||Ie(A,e,E[e])})),A.prototype=w):(A=a((function(e,t,n,r){li(e,A,_);var o,a,u,f=0,h=0;if(me(t)){if(!b(t))return g(t)?m(A,t):Gu.call(A,t);o=t,h=Bu(n,y);var d=t.byteLength;if(void 0===r){if(d%y)throw s("Wrong length");if((a=d-h)<0)throw s("Wrong length")}else if((a=ct(r)*y)+h>d)throw s("Wrong length");u=a/y}else u=iu(t),o=new c(a=u*y);for(i(e,{buffer:o,byteOffset:h,byteLength:a,length:u,view:new l(o)});f<u;)C(e,f++)})),Br&&Br(A,d),w=A.prototype=Gt(p)),w.constructor!==A&&Ie(w,"constructor",A),h&&Ie(w,h,_),T[_]=A,Ot({global:!0,forced:A!=E,sham:!f},T),"BYTES_PER_ELEMENT"in A||Ie(A,"BYTES_PER_ELEMENT",y),"BYTES_PER_ELEMENT"in w||Ie(w,"BYTES_PER_ELEMENT",y),bi(_)}):e.exports=function(){}}));Hu("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Wu=Math.min,qu=[].copyWithin||function(e,t){var n=Nt(this),r=ct(n.length),i=ht(e,r),o=ht(t,r),a=arguments.length>2?arguments[2]:void 0,u=Wu((void 0===a?r:ht(a,r))-o,r-i),s=1;for(o<i&&i<o+u&&(s=-1,o+=u-1,i+=u-1);u-- >0;)o in n?n[i]=n[o]:delete n[i],i+=s,o+=s;return n},Xu=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("copyWithin",(function(e,t){return qu.call(Xu(this),e,t,arguments.length>2?arguments[2]:void 0)}));var Zu=ln.every,Yu=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("every",(function(e){return Zu(Yu(this),e,arguments.length>1?arguments[1]:void 0)}));var Ku=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("fill",(function(e){return hu.apply(Ku(this),arguments)}));var Qu=ln.filter,Ju=$a.aTypedArray,$u=$a.aTypedArrayConstructor;(0,$a.exportTypedArrayMethod)("filter",(function(e){for(var t=Qu(Ju(this),e,arguments.length>1?arguments[1]:void 0),n=ca(this,this.constructor),r=0,i=t.length,o=new($u(n))(i);i>r;)o[r]=t[r++];return o}));var es=ln.find,ts=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("find",(function(e){return es(ts(this),e,arguments.length>1?arguments[1]:void 0)}));var ns=ln.findIndex,rs=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("findIndex",(function(e){return ns(rs(this),e,arguments.length>1?arguments[1]:void 0)}));var is=ln.forEach,os=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("forEach",(function(e){is(os(this),e,arguments.length>1?arguments[1]:void 0)}));var as=pt.includes,us=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("includes",(function(e){return as(us(this),e,arguments.length>1?arguments[1]:void 0)}));var ss=pt.indexOf,cs=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("indexOf",(function(e){return ss(cs(this),e,arguments.length>1?arguments[1]:void 0)}));var ls=Qt("iterator"),fs=ie.Uint8Array,hs=Yr.values,ds=Yr.keys,ps=Yr.entries,vs=$a.aTypedArray,gs=$a.exportTypedArrayMethod,ms=fs&&fs.prototype[ls],ys=!!ms&&("values"==ms.name||null==ms.name),bs=function(){return hs.call(vs(this))};gs("entries",(function(){return ps.call(vs(this))})),gs("keys",(function(){return ds.call(vs(this))})),gs("values",bs,!ys),gs(ls,bs,!ys);var _s=$a.aTypedArray,xs=[].join;(0,$a.exportTypedArrayMethod)("join",(function(e){return xs.apply(_s(this),arguments)}));var Ss=Math.min,Es=[].lastIndexOf,As=!!Es&&1/[1].lastIndexOf(1,-0)<0,ws=vr("lastIndexOf"),Ts=br("indexOf",{ACCESSORS:!0,1:0}),Cs=As||!ws||!Ts?function(e){if(As)return Es.apply(this,arguments)||0;var t=ge(this),n=ct(t.length),r=n-1;for(arguments.length>1&&(r=Ss(r,ut(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:Es,ks=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("lastIndexOf",(function(e){return Cs.apply(ks(this),arguments)}));var Ms=ln.map,Is=$a.aTypedArray,Os=$a.aTypedArrayConstructor;(0,$a.exportTypedArrayMethod)("map",(function(e){return Ms(Is(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Os(ca(e,e.constructor)))(t)}))}));var Ps=function(e){return function(t,n,r,i){rn(n);var o=Nt(t),a=pe(o),u=ct(o.length),s=e?u-1:0,c=e?-1:1;if(r<2)for(;;){if(s in a){i=a[s],s+=c;break}if(s+=c,e?s<0:u<=s)throw TypeError("Reduce of empty array with no initial value")}for(;e?s>=0:u>s;s+=c)s in a&&(i=n(i,a[s],s,o));return i}},Rs={left:Ps(!1),right:Ps(!0)},Ls=Rs.left,Ns=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("reduce",(function(e){return Ls(Ns(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Ds=Rs.right,js=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("reduceRight",(function(e){return Ds(js(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Fs=$a.aTypedArray,zs=$a.exportTypedArrayMethod,Us=Math.floor;zs("reverse",(function(){for(var e,t=Fs(this).length,n=Us(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var Bs=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("set",(function(e){Bs(this);var t=Bu(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=Nt(e),i=ct(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),oe((function(){new Int8Array(1).set({})})));var Vs=$a.aTypedArray,Gs=$a.aTypedArrayConstructor,Hs=[].slice;(0,$a.exportTypedArrayMethod)("slice",(function(e,t){for(var n=Hs.call(Vs(this),e,t),r=ca(this,this.constructor),i=0,o=n.length,a=new(Gs(r))(o);o>i;)a[i]=n[i++];return a}),oe((function(){new Int8Array(1).slice()})));var Ws=ln.some,qs=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("some",(function(e){return Ws(qs(this),e,arguments.length>1?arguments[1]:void 0)}));var Xs=$a.aTypedArray,Zs=[].sort;(0,$a.exportTypedArrayMethod)("sort",(function(e){return Zs.call(Xs(this),e)}));var Ys=$a.aTypedArray;(0,$a.exportTypedArrayMethod)("subarray",(function(e,t){var n=Ys(this),r=n.length,i=ht(e,r);return new(ca(n,n.constructor))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,ct((void 0===t?r:ht(t,r))-i))}));var Ks=ie.Int8Array,Qs=$a.aTypedArray,Js=$a.exportTypedArrayMethod,$s=[].toLocaleString,ec=[].slice,tc=!!Ks&&oe((function(){$s.call(new Ks(1))}));Js("toLocaleString",(function(){return $s.apply(tc?ec.call(Qs(this)):Qs(this),arguments)}),oe((function(){return[1,2].toLocaleString()!=new Ks([1,2]).toLocaleString()}))||!oe((function(){Ks.prototype.toLocaleString.call([1,2])})));var nc=$a.exportTypedArrayMethod,rc=ie.Uint8Array,ic=rc&&rc.prototype||{},oc=[].toString,ac=[].join;oe((function(){oc.call({})}))&&(oc=function(){return ac.call(this)});var uc=ic.toString!=oc;nc("toString",oc,uc);var sc=Qt("iterator"),cc=!oe((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[sc]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),lc=Object.assign,fc=Object.defineProperty,hc=!lc||oe((function(){if(ae&&1!==lc({b:1},lc(fc({},"a",{enumerable:!0,get:function(){fc(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=lc({},e)[n]||"abcdefghijklmnopqrst"!=Dt(lc({},t)).join("")}))?function(e,t){for(var n=Nt(e),r=arguments.length,i=1,o=_t.f,a=ce.f;r>i;)for(var u,s=pe(arguments[i++]),c=o?Dt(s).concat(o(s)):Dt(s),l=c.length,f=0;l>f;)u=c[f++],ae&&!a.call(s,u)||(n[u]=s[u]);return n}:lc,dc=function(e){var t,n,r,i,o,a,u=Nt(e),s="function"==typeof this?this:Array,c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,h=ui(u),d=0;if(f&&(l=on(l,c>2?arguments[2]:void 0,2)),null==h||s==Array&&oi(h))for(n=new s(t=ct(u.length));t>d;d++)a=f?l(u[d],d):u[d],rr(n,d,a);else for(o=(i=h.call(u)).next,n=new s;!(r=o.call(i)).done;d++)a=f?si(i,l,[r.value,d],!0):r.value,rr(n,d,a);return n.length=d,n},pc=/[^\0-\u007E]/,vc=/[.\u3002\uFF0E\uFF61]/g,gc="Overflow: input needs wider integers to process",mc=Math.floor,yc=String.fromCharCode,bc=function(e){return e+22+75*(e<26)},_c=function(e,t,n){var r=0;for(e=n?mc(e/700):e>>1,e+=mc(e/t);e>455;r+=36)e=mc(e/35);return mc(r+36*e/(e+38))},xc=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,o=128,a=0,u=72;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(yc(n));var s=r.length,c=s;for(s&&r.push("-");c<i;){var l=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<l&&(l=n);var f=c+1;if(l-o>mc((2147483647-a)/f))throw RangeError(gc);for(a+=(l-o)*f,o=l,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw RangeError(gc);if(n==o){for(var h=a,d=36;;d+=36){var p=d<=u?1:d>=u+26?26:d-u;if(h<p)break;var v=h-p,g=36-p;r.push(yc(bc(p+v%g))),h=mc(v/g)}r.push(yc(bc(h))),u=_c(a,f,c==s),a=0,++c}}++a,++o}return r.join("")},Sc=function(e){var t=ui(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return Ce(t.call(e))},Ec=it("fetch"),Ac=it("Headers"),wc=Qt("iterator"),Tc=et.set,Cc=et.getterFor("URLSearchParams"),kc=et.getterFor("URLSearchParamsIterator"),Mc=/\+/g,Ic=Array(4),Oc=function(e){return Ic[e-1]||(Ic[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},Pc=function(e){try{return decodeURIComponent(e)}catch(t){return e}},Rc=function(e){var t=e.replace(Mc," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(Oc(n--),Pc);return t}},Lc=/[!'()~]|%20/g,Nc={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Dc=function(e){return Nc[e]},jc=function(e){return encodeURIComponent(e).replace(Lc,Dc)},Fc=function(e,t){if(t)for(var n,r,i=t.split("&"),o=0;o<i.length;)(n=i[o++]).length&&(r=n.split("="),e.push({key:Rc(r.shift()),value:Rc(r.join("="))}))},zc=function(e){this.entries.length=0,Fc(this.entries,e)},Uc=function(e,t){if(e<t)throw TypeError("Not enough arguments")},Bc=Ur((function(e,t){Tc(this,{type:"URLSearchParamsIterator",iterator:Sc(Cc(e).entries),kind:t})}),"Iterator",(function(){var e=kc(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),Vc=function(){li(this,Vc,"URLSearchParams");var e,t,n,r,i,o,a,u,s,c=arguments.length>0?arguments[0]:void 0,l=this,f=[];if(Tc(l,{type:"URLSearchParams",entries:f,updateURL:function(){},updateSearchParams:zc}),void 0!==c)if(me(c))if("function"==typeof(e=ui(c)))for(n=(t=e.call(c)).next;!(r=n.call(t)).done;){if((a=(o=(i=Sc(Ce(r.value))).next).call(i)).done||(u=o.call(i)).done||!o.call(i).done)throw TypeError("Expected sequence with length 2");f.push({key:a.value+"",value:u.value+""})}else for(s in c)_e(c,s)&&f.push({key:s,value:c[s]+""});else Fc(f,"string"==typeof c?"?"===c.charAt(0)?c.slice(1):c:c+"")},Gc=Vc.prototype;mi(Gc,{append:function(e,t){Uc(arguments.length,2);var n=Cc(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){Uc(arguments.length,1);for(var t=Cc(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){Uc(arguments.length,1);for(var t=Cc(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){Uc(arguments.length,1);for(var t=Cc(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){Uc(arguments.length,1);for(var t=Cc(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){Uc(arguments.length,1);for(var n,r=Cc(this),i=r.entries,o=!1,a=e+"",u=t+"",s=0;s<i.length;s++)(n=i[s]).key===a&&(o?i.splice(s--,1):(o=!0,n.value=u));o||i.push({key:a,value:u}),r.updateURL()},sort:function(){var e,t,n,r=Cc(this),i=r.entries,o=i.slice();for(i.length=0,n=0;n<o.length;n++){for(e=o[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=Cc(this).entries,r=on(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new Bc(this,"keys")},values:function(){return new Bc(this,"values")},entries:function(){return new Bc(this,"entries")}},{enumerable:!0}),tt(Gc,wc,Gc.entries),tt(Gc,"toString",(function(){for(var e,t=Cc(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(jc(e.key)+"="+jc(e.value));return n.join("&")}),{enumerable:!0}),nn(Vc,"URLSearchParams"),Ot({global:!0,forced:!cc},{URLSearchParams:Vc}),cc||"function"!=typeof Ec||"function"!=typeof Ac||Ot({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,r,i=[e];return arguments.length>1&&(me(t=arguments[1])&&(n=t.body,"URLSearchParams"===Jn(n)&&((r=t.headers?new Ac(t.headers):new Ac).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=Gt(t,{body:le(0,String(n)),headers:le(0,r)}))),i.push(t)),Ec.apply(this,i)}});var Hc,Wc={URLSearchParams:Vc,getState:Cc},qc=wi.codeAt,Xc=ie.URL,Zc=Wc.URLSearchParams,Yc=Wc.getState,Kc=et.set,Qc=et.getterFor("URL"),Jc=Math.floor,$c=Math.pow,el=/[A-Za-z]/,tl=/[\d+-.A-Za-z]/,nl=/\d/,rl=/^(0x|0X)/,il=/^[0-7]+$/,ol=/^\d+$/,al=/^[\dA-Fa-f]+$/,ul=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,sl=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,cl=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,ll=/[\u0009\u000A\u000D]/g,fl=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";if(!(n=dl(t.slice(1,-1))))return"Invalid host";e.host=n}else if(xl(e)){if(t=function(e){var t,n,r=[],i=e.toLowerCase().replace(vc,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(pc.test(n)?"xn--"+xc(n):n);return r.join(".")}(t),ul.test(t))return"Invalid host";if(null===(n=hl(t)))return"Invalid host";e.host=n}else{if(sl.test(t))return"Invalid host";for(n="",r=dc(t),i=0;i<r.length;i++)n+=bl(r[i],vl);e.host=n}},hl=function(e){var t,n,r,i,o,a,u,s=e.split(".");if(s.length&&""==s[s.length-1]&&s.pop(),(t=s.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=s[r]))return e;if(o=10,i.length>1&&"0"==i.charAt(0)&&(o=rl.test(i)?16:8,i=i.slice(8==o?1:2)),""===i)a=0;else{if(!(10==o?ol:8==o?il:al).test(i))return e;a=parseInt(i,o)}n.push(a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=$c(256,5-t))return null}else if(a>255)return null;for(u=n.pop(),r=0;r<n.length;r++)u+=n[r]*$c(256,3-r);return u},dl=function(e){var t,n,r,i,o,a,u,s=[0,0,0,0,0,0,0,0],c=0,l=null,f=0,h=function(){return e.charAt(f)};if(":"==h()){if(":"!=e.charAt(1))return;f+=2,l=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=n=0;n<4&&al.test(h());)t=16*t+parseInt(h(),16),f++,n++;if("."==h()){if(0==n)return;if(f-=n,c>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;f++}if(!nl.test(h()))return;for(;nl.test(h());){if(o=parseInt(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;f++}s[c]=256*s[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==h()){if(f++,!h())return}else if(h())return;s[c++]=t}else{if(null!==l)return;f++,l=++c}}if(null!==l)for(a=c-l,c=7;0!=c&&a>0;)u=s[c],s[c--]=s[l+a-1],s[l+--a]=u;else if(8!=c)return;return s},pl=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=Jc(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},vl={},gl=hc({},vl,{" ":1,'"':1,"<":1,">":1,"`":1}),ml=hc({},gl,{"#":1,"?":1,"{":1,"}":1}),yl=hc({},ml,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),bl=function(e,t){var n=qc(e,0);return n>32&&n<127&&!_e(t,e)?e:encodeURIComponent(e)},_l={ftp:21,file:null,http:80,https:443,ws:80,wss:443},xl=function(e){return _e(_l,e.scheme)},Sl=function(e){return""!=e.username||""!=e.password},El=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},Al=function(e,t){var n;return 2==e.length&&el.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},wl=function(e){var t;return e.length>1&&Al(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},Tl=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&Al(t[0],!0)||t.pop()},Cl=function(e){return"."===e||"%2e"===e.toLowerCase()},kl={},Ml={},Il={},Ol={},Pl={},Rl={},Ll={},Nl={},Dl={},jl={},Fl={},zl={},Ul={},Bl={},Vl={},Gl={},Hl={},Wl={},ql={},Xl={},Zl={},Yl=function(e,t,n,r){var i,o,a,u,s,c=n||kl,l=0,f="",h=!1,d=!1,p=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(cl,"")),t=t.replace(ll,""),i=dc(t);l<=i.length;){switch(o=i[l],c){case kl:if(!o||!el.test(o)){if(n)return"Invalid scheme";c=Il;continue}f+=o.toLowerCase(),c=Ml;break;case Ml:if(o&&(tl.test(o)||"+"==o||"-"==o||"."==o))f+=o.toLowerCase();else{if(":"!=o){if(n)return"Invalid scheme";f="",c=Il,l=0;continue}if(n&&(xl(e)!=_e(_l,f)||"file"==f&&(Sl(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=f,n)return void(xl(e)&&_l[e.scheme]==e.port&&(e.port=null));f="","file"==e.scheme?c=Bl:xl(e)&&r&&r.scheme==e.scheme?c=Ol:xl(e)?c=Nl:"/"==i[l+1]?(c=Pl,l++):(e.cannotBeABaseURL=!0,e.path.push(""),c=ql)}break;case Il:if(!r||r.cannotBeABaseURL&&"#"!=o)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==o){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,c=Zl;break}c="file"==r.scheme?Bl:Rl;continue;case Ol:if("/"!=o||"/"!=i[l+1]){c=Rl;continue}c=Dl,l++;break;case Pl:if("/"==o){c=jl;break}c=Wl;continue;case Rl:if(e.scheme=r.scheme,o==Hc)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==o||"\\"==o&&xl(e))c=Ll;else if("?"==o)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",c=Xl;else{if("#"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),c=Wl;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",c=Zl}break;case Ll:if(!xl(e)||"/"!=o&&"\\"!=o){if("/"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,c=Wl;continue}c=jl}else c=Dl;break;case Nl:if(c=Dl,"/"!=o||"/"!=f.charAt(l+1))continue;l++;break;case Dl:if("/"!=o&&"\\"!=o){c=jl;continue}break;case jl:if("@"==o){h&&(f="%40"+f),h=!0,a=dc(f);for(var v=0;v<a.length;v++){var g=a[v];if(":"!=g||p){var m=bl(g,yl);p?e.password+=m:e.username+=m}else p=!0}f=""}else if(o==Hc||"/"==o||"?"==o||"#"==o||"\\"==o&&xl(e)){if(h&&""==f)return"Invalid authority";l-=dc(f).length+1,f="",c=Fl}else f+=o;break;case Fl:case zl:if(n&&"file"==e.scheme){c=Gl;continue}if(":"!=o||d){if(o==Hc||"/"==o||"?"==o||"#"==o||"\\"==o&&xl(e)){if(xl(e)&&""==f)return"Invalid host";if(n&&""==f&&(Sl(e)||null!==e.port))return;if(u=fl(e,f))return u;if(f="",c=Hl,n)return;continue}"["==o?d=!0:"]"==o&&(d=!1),f+=o}else{if(""==f)return"Invalid host";if(u=fl(e,f))return u;if(f="",c=Ul,n==zl)return}break;case Ul:if(!nl.test(o)){if(o==Hc||"/"==o||"?"==o||"#"==o||"\\"==o&&xl(e)||n){if(""!=f){var y=parseInt(f,10);if(y>65535)return"Invalid port";e.port=xl(e)&&y===_l[e.scheme]?null:y,f=""}if(n)return;c=Hl;continue}return"Invalid port"}f+=o;break;case Bl:if(e.scheme="file","/"==o||"\\"==o)c=Vl;else{if(!r||"file"!=r.scheme){c=Wl;continue}if(o==Hc)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==o)e.host=r.host,e.path=r.path.slice(),e.query="",c=Xl;else{if("#"!=o){wl(i.slice(l).join(""))||(e.host=r.host,e.path=r.path.slice(),Tl(e)),c=Wl;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",c=Zl}}break;case Vl:if("/"==o||"\\"==o){c=Gl;break}r&&"file"==r.scheme&&!wl(i.slice(l).join(""))&&(Al(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),c=Wl;continue;case Gl:if(o==Hc||"/"==o||"\\"==o||"?"==o||"#"==o){if(!n&&Al(f))c=Wl;else if(""==f){if(e.host="",n)return;c=Hl}else{if(u=fl(e,f))return u;if("localhost"==e.host&&(e.host=""),n)return;f="",c=Hl}continue}f+=o;break;case Hl:if(xl(e)){if(c=Wl,"/"!=o&&"\\"!=o)continue}else if(n||"?"!=o)if(n||"#"!=o){if(o!=Hc&&(c=Wl,"/"!=o))continue}else e.fragment="",c=Zl;else e.query="",c=Xl;break;case Wl:if(o==Hc||"/"==o||"\\"==o&&xl(e)||!n&&("?"==o||"#"==o)){if(".."===(s=(s=f).toLowerCase())||"%2e."===s||".%2e"===s||"%2e%2e"===s?(Tl(e),"/"==o||"\\"==o&&xl(e)||e.path.push("")):Cl(f)?"/"==o||"\\"==o&&xl(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&Al(f)&&(e.host&&(e.host=""),f=f.charAt(0)+":"),e.path.push(f)),f="","file"==e.scheme&&(o==Hc||"?"==o||"#"==o))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==o?(e.query="",c=Xl):"#"==o&&(e.fragment="",c=Zl)}else f+=bl(o,ml);break;case ql:"?"==o?(e.query="",c=Xl):"#"==o?(e.fragment="",c=Zl):o!=Hc&&(e.path[0]+=bl(o,vl));break;case Xl:n||"#"!=o?o!=Hc&&("'"==o&&xl(e)?e.query+="%27":e.query+="#"==o?"%23":bl(o,vl)):(e.fragment="",c=Zl);break;case Zl:o!=Hc&&(e.fragment+=bl(o,gl))}l++}},Kl=function(e){var t,n,r=li(this,Kl,"URL"),i=arguments.length>1?arguments[1]:void 0,o=String(e),a=Kc(r,{type:"URL"});if(void 0!==i)if(i instanceof Kl)t=Qc(i);else if(n=Yl(t={},String(i)))throw TypeError(n);if(n=Yl(a,o,null,t))throw TypeError(n);var u=a.searchParams=new Zc,s=Yc(u);s.updateSearchParams(a.query),s.updateURL=function(){a.query=String(u)||null},ae||(r.href=Jl.call(r),r.origin=$l.call(r),r.protocol=ef.call(r),r.username=tf.call(r),r.password=nf.call(r),r.host=rf.call(r),r.hostname=of.call(r),r.port=af.call(r),r.pathname=uf.call(r),r.search=sf.call(r),r.searchParams=cf.call(r),r.hash=lf.call(r))},Ql=Kl.prototype,Jl=function(){var e=Qc(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,u=e.query,s=e.fragment,c=t+":";return null!==i?(c+="//",Sl(e)&&(c+=n+(r?":"+r:"")+"@"),c+=pl(i),null!==o&&(c+=":"+o)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==u&&(c+="?"+u),null!==s&&(c+="#"+s),c},$l=function(){var e=Qc(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&xl(e)?t+"://"+pl(e.host)+(null!==n?":"+n:""):"null"},ef=function(){return Qc(this).scheme+":"},tf=function(){return Qc(this).username},nf=function(){return Qc(this).password},rf=function(){var e=Qc(this),t=e.host,n=e.port;return null===t?"":null===n?pl(t):pl(t)+":"+n},of=function(){var e=Qc(this).host;return null===e?"":pl(e)},af=function(){var e=Qc(this).port;return null===e?"":String(e)},uf=function(){var e=Qc(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},sf=function(){var e=Qc(this).query;return e?"?"+e:""},cf=function(){return Qc(this).searchParams},lf=function(){var e=Qc(this).fragment;return e?"#"+e:""},ff=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(ae&&jt(Ql,{href:ff(Jl,(function(e){var t=Qc(this),n=String(e),r=Yl(t,n);if(r)throw TypeError(r);Yc(t.searchParams).updateSearchParams(t.query)})),origin:ff($l),protocol:ff(ef,(function(e){var t=Qc(this);Yl(t,String(e)+":",kl)})),username:ff(tf,(function(e){var t=Qc(this),n=dc(String(e));if(!El(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=bl(n[r],yl)}})),password:ff(nf,(function(e){var t=Qc(this),n=dc(String(e));if(!El(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=bl(n[r],yl)}})),host:ff(rf,(function(e){var t=Qc(this);t.cannotBeABaseURL||Yl(t,String(e),Fl)})),hostname:ff(of,(function(e){var t=Qc(this);t.cannotBeABaseURL||Yl(t,String(e),zl)})),port:ff(af,(function(e){var t=Qc(this);El(t)||(""==(e=String(e))?t.port=null:Yl(t,e,Ul))})),pathname:ff(uf,(function(e){var t=Qc(this);t.cannotBeABaseURL||(t.path=[],Yl(t,e+"",Hl))})),search:ff(sf,(function(e){var t=Qc(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Yl(t,e,Xl)),Yc(t.searchParams).updateSearchParams(t.query)})),searchParams:ff(cf),hash:ff(lf,(function(e){var t=Qc(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Yl(t,e,Zl)):t.fragment=null}))}),tt(Ql,"toJSON",(function(){return Jl.call(this)}),{enumerable:!0}),tt(Ql,"toString",(function(){return Jl.call(this)}),{enumerable:!0}),Xc){var hf=Xc.createObjectURL,df=Xc.revokeObjectURL;hf&&tt(Kl,"createObjectURL",(function(e){return hf.apply(Xc,arguments)})),df&&tt(Kl,"revokeObjectURL",(function(e){return df.apply(Xc,arguments)}))}nn(Kl,"URL"),Ot({global:!0,forced:!cc,sham:!ae},{URL:Kl});var pf=function(e){Yi(n,e);var t=io(n);function n(e,r,i){var o;return Gi(this,n),(o=t.call(this,e)).status=void 0,o.url=void 0,o.status=r,o.url=i,o.name=o.constructor.name,o.message=e,o}return Wi(n,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),n}(eo(Error));function vf(e){var t=new XMLHttpRequest;for(var n in t.open("GET",e.url,!0),e.headers)e.headers.hasOwnProperty(n)&&t.setRequestHeader(n,e.headers[n]);return t.withCredentials="include"===e.credentials,t}var gf=function(e,t){var n=vf(e);return n.responseType="arraybuffer",n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){var r=n.response;if(0===r.byteLength&&200===n.status)return t(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?t(null,{data:r,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):t(new pf(n.statusText,n.status,e.url))},n.send(),n},mf=function(e,t){return gf(e,(function(e,n){if(e)t(e);else if(n){var r=new window.Image;r.crossOrigin="anonymous";var i=window.URL||window.webkitURL;r.onload=function(){t(null,r),i.revokeObjectURL(r.src)};var o=new window.Blob([new Uint8Array(n.data)],{type:"image/png"});r.src=n.data.byteLength?i.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}))},yf=ln.map,bf=lr("map"),_f=br("map");Ot({target:"Array",proto:!0,forced:!bf||!_f},{map:function(e){return yf(this,e,arguments.length>1?arguments[1]:void 0)}});var xf=bt.f,Sf=Te.f,Ef=Me.f,Af=ya.trim,wf=ie.Number,Tf=wf.prototype,Cf="Number"==he(Gt(Tf)),kf=function(e){var t,n,r,i,o,a,u,s,c=ye(e,!1);if("string"==typeof c&&c.length>2)if(43===(t=(c=Af(c)).charCodeAt(0))||45===t){if(88===(n=c.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=c.slice(2)).length,u=0;u<a;u++)if((s=o.charCodeAt(u))<48||s>i)return NaN;return parseInt(o,r)}return+c};if(Mt("Number",!wf(" 0o1")||!wf("0b1")||wf("+0x1"))){for(var Mf,If=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof If&&(Cf?oe((function(){Tf.valueOf.call(n)})):"Number"!=he(n))?gi(new wf(kf(t)),n,If):kf(t)},Of=ae?xf(wf):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Pf=0;Of.length>Pf;Pf++)_e(wf,Mf=Of[Pf])&&!_e(If,Mf)&&Ef(If,Mf,Sf(wf,Mf));If.prototype=Tf,Tf.constructor=If,tt(ie,"Number",If)}var Rf="".repeat||function(e){var t=String(ve(this)),n="",r=ut(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},Lf=1..toFixed,Nf=Math.floor,Df=function(e,t,n){return 0===t?n:t%2==1?Df(e,t-1,n*e):Df(e*e,t/2,n)},jf=Lf&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!oe((function(){Lf.call({})}));Ot({target:"Number",proto:!0,forced:jf},{toFixed:function(e){var t,n,r,i,o=function(e){if("number"!=typeof e&&"Number"!=he(e))throw TypeError("Incorrect invocation");return+e}(this),a=ut(e),u=[0,0,0,0,0,0],s="",c="0",l=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*u[n],u[n]=r%1e7,r=Nf(r/1e7)},f=function(e){for(var t=6,n=0;--t>=0;)n+=u[t],u[t]=Nf(n/e),n=n%e*1e7},h=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==u[e]){var n=String(u[e]);t=""===t?n:t+Rf.call("0",7-n.length)+n}return t};if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(s="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*Df(2,69,1))-69)<0?o*Df(2,-t,1):o/Df(2,t,1),n*=4503599627370496,(t=52-t)>0){for(l(0,n),r=a;r>=7;)l(1e7,0),r-=7;for(l(Df(10,r,1),0),r=t-1;r>=23;)f(1<<23),r-=23;f(1<<r),l(1,1),f(2),c=h()}else l(0,n),l(1<<-t,0),c=h()+Rf.call("0",a);return c=a>0?s+((i=c.length)<=a?"0."+Rf.call("0",a-i)+c:c.slice(0,i-a)+"."+c.slice(i-a)):s+c}});var Ff=pt.indexOf,zf=[].indexOf,Uf=!!zf&&1/[1].indexOf(1,-0)<0,Bf=vr("indexOf"),Vf=br("indexOf",{ACCESSORS:!0,1:0});Ot({target:"Array",proto:!0,forced:Uf||!Bf||!Vf},{indexOf:function(e){return Uf?zf.apply(this,arguments)||0:Ff(this,e,arguments.length>1?arguments[1]:void 0)}});var Gf=o((function(e,t){function n(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function r(e,t,r){return void 0===r&&(r={}),n({type:"Point",coordinates:e},t,r)}function i(e,t,r){void 0===r&&(r={});for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<a[a.length-1].length;u++)if(a[a.length-1][u]!==a[0][u])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:e},t,r)}function o(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:e},t,r)}function a(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function u(e,t,r){return void 0===r&&(r={}),n({type:"MultiLineString",coordinates:e},t,r)}function s(e,t,r){return void 0===r&&(r={}),n({type:"MultiPoint",coordinates:e},t,r)}function c(e,t,r){return void 0===r&&(r={}),n({type:"MultiPolygon",coordinates:e},t,r)}function l(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e*r}function f(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e/r}function h(e){return 180*(e%(2*Math.PI))/Math.PI}function d(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)&&!/^\s*$/.test(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:t.earthRadius/1.0936},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1/1.0936},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=n,t.geometry=function(e,t,n){switch(e){case"Point":return r(t).geometry;case"LineString":return o(t).geometry;case"Polygon":return i(t).geometry;case"MultiPoint":return s(t).geometry;case"MultiLineString":return u(t).geometry;case"MultiPolygon":return c(t).geometry;default:throw new Error(e+" is invalid")}},t.point=r,t.points=function(e,t,n){return void 0===n&&(n={}),a(e.map((function(e){return r(e,t)})),n)},t.polygon=i,t.polygons=function(e,t,n){return void 0===n&&(n={}),a(e.map((function(e){return i(e,t)})),n)},t.lineString=o,t.lineStrings=function(e,t,n){return void 0===n&&(n={}),a(e.map((function(e){return o(e,t)})),n)},t.featureCollection=a,t.multiLineString=u,t.multiPoint=s,t.multiPolygon=c,t.geometryCollection=function(e,t,r){return void 0===r&&(r={}),n({type:"GeometryCollection",geometries:e},t,r)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n},t.radiansToLength=l,t.lengthToRadians=f,t.lengthToDegrees=function(e,t){return h(f(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=h,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,n){if(void 0===t&&(t="kilometers"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return l(f(e,t),n)},t.convertArea=function(e,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=t.areaFactors[n];if(!i)throw new Error("invalid original units");var o=t.areaFactors[r];if(!o)throw new Error("invalid final units");return e/i*o},t.isNumber=d,t.isObject=function(e){return!!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!d(e))throw new Error("bbox must only contain numbers")}))},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(Ui(e)))throw new Error("id must be a number or a string")},t.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},t.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},t.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},t.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},t.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},t.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},t.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}}));i(Gf);Gf.earthRadius,Gf.factors,Gf.unitsFactors,Gf.areaFactors,Gf.feature,Gf.geometry,Gf.point,Gf.points,Gf.polygon,Gf.polygons,Gf.lineString,Gf.lineStrings,Gf.featureCollection,Gf.multiLineString,Gf.multiPoint,Gf.multiPolygon,Gf.geometryCollection,Gf.round;var Hf=Gf.radiansToLength,Wf=(Gf.lengthToRadians,Gf.lengthToDegrees,Gf.bearingToAzimuth,Gf.radiansToDegrees,Gf.degreesToRadians),qf=(Gf.convertLength,Gf.convertArea,Gf.isNumber,Gf.isObject,Gf.validateBBox,Gf.validateId,Gf.radians2degrees,Gf.degrees2radians,Gf.distanceToDegrees,Gf.distanceToRadians,Gf.radiansToDistance,Gf.bearingToAngle,Gf.convertDistance,2*Math.PI*6378137/2);function Xf(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;!function e(t,n){Array.isArray(n[0])?n.forEach((function(n){e(t,n)})):(t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1]));return t}(t,n)})),t}function Zf(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Qf(e,t))[0],i=e[1],o=r*qf/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*qf/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function Yf(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function Kf(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Qf(e,t){if(!1===t)return e;var n=Yf(e[0]),r=Kf(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function Jf(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return r=(256<<20)*(.5/Math.PI*r+.5),i=(256<<20)*(-.5/Math.PI*i+(n=.5)),[Math.floor(r),Math.floor(i)]}function $f(e,t,n){var r=Wf(t[1]-e[1]),i=Wf(t[0]-e[0]),o=Wf(e[1]),a=Wf(t[1]),u=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return Hf(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),"meters")}function eh(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function th(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}var nh=ln.findIndex,rh=!0,ih=br("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){rh=!1})),Ot({target:"Array",proto:!0,forced:rh||!ih},{findIndex:function(e){return nh(this,e,arguments.length>1?arguments[1]:void 0)}}),Mr("findIndex");var oh=lr("splice"),ah=br("splice",{ACCESSORS:!0,0:0,1:2}),uh=Math.max,sh=Math.min;Ot({target:"Array",proto:!0,forced:!oh||!ah},{splice:function(e,t){var n,r,i,o,a,u,s=Nt(this),c=ct(s.length),l=ht(e,c),f=arguments.length;if(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=sh(uh(ut(t),0),c-l)),c+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=un(s,r),o=0;o<r;o++)(a=l+o)in s&&rr(i,o,s[a]);if(i.length=r,n<r){for(o=l;o<c-r;o++)u=o+n,(a=o+r)in s?s[u]=s[a]:delete s[u];for(o=c;o>c-r+n;o--)delete s[o-1]}else if(n>r)for(o=c-r;o>l;o--)u=o+n-1,(a=o+r-1)in s?s[u]=s[a]:delete s[u];for(o=0;o<n;o++)s[o+l]=arguments[o+2];return s.length=c-r+n,i}});var ch=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;Gi(this,e),this.limit=void 0,this.cache=void 0,this.destroy=void 0,this.order=void 0,this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return Wi(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function lh(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function fh(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function hh(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function dh(){}Hu("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0);var ph,vh="\\s*([+-]?\\d+)\\s*",gh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",mh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yh=/^#([0-9a-f]{3,8})$/,bh=new RegExp("^rgb\\("+[vh,vh,vh]+"\\)$"),_h=new RegExp("^rgb\\("+[mh,mh,mh]+"\\)$"),xh=new RegExp("^rgba\\("+[vh,vh,vh,gh]+"\\)$"),Sh=new RegExp("^rgba\\("+[mh,mh,mh,gh]+"\\)$"),Eh=new RegExp("^hsl\\("+[gh,mh,mh]+"\\)$"),Ah=new RegExp("^hsla\\("+[gh,mh,mh,gh]+"\\)$"),wh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Th(){return this.rgb().formatHex()}function Ch(){return this.rgb().formatRgb()}function kh(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=yh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Mh(t):3===n?new Rh(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ih(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ih(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=bh.exec(e))?new Rh(t[1],t[2],t[3],1):(t=_h.exec(e))?new Rh(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=xh.exec(e))?Ih(t[1],t[2],t[3],t[4]):(t=Sh.exec(e))?Ih(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Eh.exec(e))?jh(t[1],t[2]/100,t[3]/100,1):(t=Ah.exec(e))?jh(t[1],t[2]/100,t[3]/100,t[4]):wh.hasOwnProperty(e)?Mh(wh[e]):"transparent"===e?new Rh(NaN,NaN,NaN,0):null}function Mh(e){return new Rh(e>>16&255,e>>8&255,255&e,1)}function Ih(e,t,n,r){return r<=0&&(e=t=n=NaN),new Rh(e,t,n,r)}function Oh(e){return e instanceof dh||(e=kh(e)),e?new Rh((e=e.rgb()).r,e.g,e.b,e.opacity):new Rh}function Ph(e,t,n,r){return 1===arguments.length?Oh(e):new Rh(e,t,n,null==r?1:r)}function Rh(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Lh(){return"#"+Dh(this.r)+Dh(this.g)+Dh(this.b)}function Nh(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Dh(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function jh(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new zh(e,t,n,r)}function Fh(e){if(e instanceof zh)return new zh(e.h,e.s,e.l,e.opacity);if(e instanceof dh||(e=kh(e)),!e)return new zh;if(e instanceof zh)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,u=o-i,s=(o+i)/2;return u?(a=t===o?(n-r)/u+6*(n<r):n===o?(r-t)/u+2:(t-n)/u+4,u/=s<.5?o+i:2-o-i,a*=60):u=s>0&&s<1?0:a,new zh(a,u,s,e.opacity)}function zh(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Uh(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Bh(e){var t=kh(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function Vh(e){var t=ao(e,3);return t[0]+256*t[1]+65536*t[2]-1}function Gh(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Hh(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],u=0;u<e.colors.length;++u){var s=(e.positions[u]-o)/(a-o);i.addColorStop(s,e.colors[u])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),new ImageData(r,256,1)}fh(dh,kh,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Th,formatHex:Th,formatHsl:function(){return Fh(this).formatHsl()},formatRgb:Ch,toString:Ch}),fh(Rh,Ph,hh(dh,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Rh(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Rh(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Lh,formatHex:Lh,formatRgb:Nh,toString:Nh})),fh(zh,(function(e,t,n,r){return 1===arguments.length?Fh(e):new zh(e,t,n,null==r?1:r)}),hh(dh,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new zh(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new zh(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Rh(Uh(e>=240?e-240:e+120,i,r),Uh(e,i,r),Uh(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),(ph=e.anchorType||(e.anchorType={})).CENTER="center",ph.TOP="top",ph["TOP-LEFT"]="top-left",ph["TOP-RIGHT"]="top-right",ph.BOTTOM="bottom",ph["BOTTOM-LEFT"]="bottom-left",ph.LEFT="left",ph.RIGHT="right";var Wh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qh(e,t,n){var r=e.classList;for(var i in Wh)Wh.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}var Xh=[],Zh=Xh.sort,Yh=oe((function(){Xh.sort(void 0)})),Kh=oe((function(){Xh.sort(null)})),Qh=vr("sort");function Jh(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function $h(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function ed(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function td(e){if(0===e.length)throw new Error("mean requires at least one data point");return ed(e)/e.length}function nd(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}Ot({target:"Array",proto:!0,forced:Yh||!Kh||!Qh},{sort:function(e){return void 0===e?Zh.call(Nt(this)):Zh.call(Nt(this),rn(e))}});var rd={min:$h,max:Jh,mean:td,sum:ed,mode:nd};function id(e,t){return e.map((function(e){return e[t]}))}function od(e,t){return rd[e](t)}var ad=Object.freeze({__proto__:null,sum:ed,max:Jh,min:$h,mean:td,mode:nd,statMap:rd,getColumn:id,getSatByColumn:od}),ud=ld,sd=ld,cd=1e20;function ld(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function fd(e,t,n,r,i,o,a){for(var u=0;u<t;u++){for(var s=0;s<n;s++)r[s]=e[s*t+u];for(hd(r,i,o,a,n),s=0;s<n;s++)e[s*t+u]=i[s]}for(s=0;s<n;s++){for(u=0;u<t;u++)r[u]=e[s*t+u];for(hd(r,i,o,a,t),u=0;u<t;u++)e[s*t+u]=Math.sqrt(i[u])}}function hd(e,t,n,r,i){n[0]=0,r[0]=-cd,r[1]=+cd;for(var o=1,a=0;o<i;o++){for(var u=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);u<=r[a];)a--,u=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=u,r[a+1]=+cd}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;t[o]=(o-n[a])*(o-n[a])+e[n[a]]}}ld.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=t.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?cd:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?cd:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(fd(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),fd(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var o=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(o/this.radius+this.cutoff))))}return n},ud.default=sd;var dd=!vi((function(e){Array.from(e)}));Ot({target:"Array",stat:!0,forced:dd},{from:dc});var pd=Math.log,vd=Math.LN2;Ot({target:"Math",stat:!0},{log2:function(e){return pd(e)/vd}});var gd;function md(e,t,n){var r,i=lo(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,u=o.xOffset;e[a.id]=Zi(Zi({},a),{},{x:u,y:n,image:a.image})}}catch(e){i.e(e)}finally{i.f()}}function yd(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var bd=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function _d(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function xd(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var Sd=Q()(gd=function(){function e(){Gi(this,e),this.fontAtlas=void 0,this.iconFontGlyphs={},this.fontOptions=void 0,this.key=void 0,this.cache=new ch(3)}return Wi(e,[{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:bd,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8},this.key=""}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=Zi(Zi({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"destroy",value:function(){this.cache.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,u=r.buffer,s=r.sdf,c=r.radius,l=r.cutoff,f=n&&n.data;f||((f=document.createElement("canvas")).width=1024);var h=f.getContext("2d");_d(h,i,a,o);var d=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,u=void 0===a?{}:a,s=e.xOffset,c=void 0===s?0:s,l=e.yOffset,f=void 0===l?0:l,h=0,d=c;Array.from(t).forEach((function(e,t){if(!u[e]){var r=n(e,t);d+30>o&&(d=0,h++),u[e]={x:d,y:f+30*h,width:30,height:30,advance:r},d+=30}}));var p=r+2*i;return{mapping:u,xOffset:d,yOffset:f+h*p,canvasHeight:yd(f+(h+1)*p)}}(Zi({getFontWidth:function(e){return h.measureText(e).width},fontHeight:1*a,buffer:u,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),p=d.mapping,v=d.canvasHeight,g=d.xOffset,m=d.yOffset;if(f.height!==v){var y=h.getImageData(0,0,f.width,f.height);f.height=v,h.putImageData(y,0,0)}if(_d(h,i,a,o),s){var b,_=new ud(a,u,c,l,i,o),x=h.getImageData(0,0,_.size,_.size),S=lo(t);try{for(S.s();!(b=S.n()).done;){var E=b.value;xd(_.draw(E),x),h.putImageData(x,p[E].x,p[E].y)}}catch(e){S.e(e)}finally{S.f()}}else{var A,w=lo(t);try{for(w.s();!(A=w.n()).done;){var T=A.value;h.fillText(T,p[T].x,p[T].y+1*a)}}catch(e){w.e(e)}finally{w.f()}}return{xOffset:g,yOffset:m,mapping:p,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight,r=e.fontSize,i=e.buffer,o=e.sdf,a=e.radius,u=e.cutoff;return o?"".concat(t," ").concat(n," ").concat(r," ").concat(i," ").concat(a," ").concat(u):"".concat(t," ").concat(n," ").concat(r," ").concat(i)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}},{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping}}]),e}())||gd,Ed=ln.filter,Ad=lr("filter"),wd=br("filter");Ot({target:"Array",proto:!0,forced:!Ad||!wd},{filter:function(e){return Ed(this,e,arguments.length>1?arguments[1]:void 0)}});var Td=ln.find,Cd=!0,kd=br("find");"find"in[]&&Array(1).find((function(){Cd=!1})),Ot({target:"Array",proto:!0,forced:Cd||!kd},{find:function(e){return Td(this,e,arguments.length>1?arguments[1]:void 0)}}),Mr("find");var Md,Id,Od,Pd=ie.Promise,Rd=/(iphone|ipod|ipad).*applewebkit/i.test(ir),Ld=ie.location,Nd=ie.setImmediate,Dd=ie.clearImmediate,jd=ie.process,Fd=ie.MessageChannel,zd=ie.Dispatch,Ud=0,Bd={},Vd=function(e){if(Bd.hasOwnProperty(e)){var t=Bd[e];delete Bd[e],t()}},Gd=function(e){return function(){Vd(e)}},Hd=function(e){Vd(e.data)},Wd=function(e){ie.postMessage(e+"",Ld.protocol+"//"+Ld.host)};Nd&&Dd||(Nd=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Bd[++Ud]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Md(Ud),Ud},Dd=function(e){delete Bd[e]},"process"==he(jd)?Md=function(e){jd.nextTick(Gd(e))}:zd&&zd.now?Md=function(e){zd.now(Gd(e))}:Fd&&!Rd?(Od=(Id=new Fd).port2,Id.port1.onmessage=Hd,Md=on(Od.postMessage,Od,1)):!ie.addEventListener||"function"!=typeof postMessage||ie.importScripts||oe(Wd)||"file:"===Ld.protocol?Md="onreadystatechange"in Ee("script")?function(e){Ft.appendChild(Ee("script")).onreadystatechange=function(){Ft.removeChild(this),Vd(e)}}:function(e){setTimeout(Gd(e),0)}:(Md=Wd,ie.addEventListener("message",Hd,!1)));var qd,Xd,Zd,Yd,Kd,Qd,Jd,$d,ep={set:Nd,clear:Dd},tp=Te.f,np=ep.set,rp=ie.MutationObserver||ie.WebKitMutationObserver,ip=ie.process,op=ie.Promise,ap="process"==he(ip),up=tp(ie,"queueMicrotask"),sp=up&&up.value;sp||(qd=function(){var e,t;for(ap&&(e=ip.domain)&&e.exit();Xd;){t=Xd.fn,Xd=Xd.next;try{t()}catch(e){throw Xd?Yd():Zd=void 0,e}}Zd=void 0,e&&e.enter()},ap?Yd=function(){ip.nextTick(qd)}:rp&&!Rd?(Kd=!0,Qd=document.createTextNode(""),new rp(qd).observe(Qd,{characterData:!0}),Yd=function(){Qd.data=Kd=!Kd}):op&&op.resolve?(Jd=op.resolve(void 0),$d=Jd.then,Yd=function(){$d.call(Jd,qd)}):Yd=function(){np.call(ie,qd)});var cp,lp,fp,hp,dp,pp=sp||function(e){var t={fn:e,next:void 0};Zd&&(Zd.next=t),Xd||(Xd=t,Yd()),Zd=t},vp=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=rn(t),this.reject=rn(n)},gp={f:function(e){return new vp(e)}},mp=function(e,t){if(Ce(e),me(t)&&t.constructor===e)return t;var n=gp.f(e);return(0,n.resolve)(t),n.promise},yp=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},bp=ep.set,_p=Qt("species"),xp="Promise",Sp=et.get,Ep=et.set,Ap=et.getterFor(xp),wp=Pd,Tp=ie.TypeError,Cp=ie.document,kp=ie.process,Mp=it("fetch"),Ip=gp.f,Op=Ip,Pp="process"==he(kp),Rp=!!(Cp&&Cp.createEvent&&ie.dispatchEvent),Lp=Mt(xp,(function(){if(!(je(wp)!==String(wp))){if(66===sr)return!0;if(!Pp&&"function"!=typeof PromiseRejectionEvent)return!0}if(sr>=51&&/native code/.test(wp))return!1;var e=wp.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[_p]=t,!(e.then((function(){}))instanceof t)})),Np=Lp||!vi((function(e){wp.all(e).catch((function(){}))})),Dp=function(e){var t;return!(!me(e)||"function"!=typeof(t=e.then))&&t},jp=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;pp((function(){for(var i=t.value,o=1==t.state,a=0;r.length>a;){var u,s,c,l=r[a++],f=o?l.ok:l.fail,h=l.resolve,d=l.reject,p=l.domain;try{f?(o||(2===t.rejection&&Bp(e,t),t.rejection=1),!0===f?u=i:(p&&p.enter(),u=f(i),p&&(p.exit(),c=!0)),u===l.promise?d(Tp("Promise-chain cycle")):(s=Dp(u))?s.call(u,h,d):h(u)):d(i)}catch(e){p&&!c&&p.exit(),d(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&zp(e,t)}))}},Fp=function(e,t,n){var r,i;Rp?((r=Cp.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ie.dispatchEvent(r)):r={promise:t,reason:n},(i=ie["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=ie.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},zp=function(e,t){bp.call(ie,(function(){var n,r=t.value;if(Up(t)&&(n=yp((function(){Pp?kp.emit("unhandledRejection",r,e):Fp("unhandledrejection",e,r)})),t.rejection=Pp||Up(t)?2:1,n.error))throw n.value}))},Up=function(e){return 1!==e.rejection&&!e.parent},Bp=function(e,t){bp.call(ie,(function(){Pp?kp.emit("rejectionHandled",e):Fp("rejectionhandled",e,t.value)}))},Vp=function(e,t,n,r){return function(i){e(t,n,i,r)}},Gp=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,jp(e,t,!0))},Hp=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw Tp("Promise can't be resolved itself");var i=Dp(n);i?pp((function(){var r={done:!1};try{i.call(n,Vp(Hp,e,r,t),Vp(Gp,e,r,t))}catch(n){Gp(e,r,n,t)}})):(t.value=n,t.state=1,jp(e,t,!1))}catch(n){Gp(e,{done:!1},n,t)}}};Lp&&(wp=function(e){li(this,wp,xp),rn(e),cp.call(this);var t=Sp(this);try{e(Vp(Hp,this,t),Vp(Gp,this,t))}catch(e){Gp(this,t,e)}},(cp=function(e){Ep(this,{type:xp,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=mi(wp.prototype,{then:function(e,t){var n=Ap(this),r=Ip(ca(this,wp));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Pp?kp.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&jp(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),lp=function(){var e=new cp,t=Sp(e);this.promise=e,this.resolve=Vp(Hp,e,t),this.reject=Vp(Gp,e,t)},gp.f=Ip=function(e){return e===wp||e===fp?new lp(e):Op(e)},"function"==typeof Pd&&(hp=Pd.prototype.then,tt(Pd.prototype,"then",(function(e,t){var n=this;return new wp((function(e,t){hp.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof Mp&&Ot({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return mp(wp,Mp.apply(ie,arguments))}}))),Ot({global:!0,wrap:!0,forced:Lp},{Promise:wp}),nn(wp,xp,!1),bi(xp),fp=it(xp),Ot({target:xp,stat:!0,forced:Lp},{reject:function(e){var t=Ip(this);return t.reject.call(void 0,e),t.promise}}),Ot({target:xp,stat:!0,forced:Lp},{resolve:function(e){return mp(this,e)}}),Ot({target:xp,stat:!0,forced:Np},{all:function(e){var t=this,n=Ip(t),r=n.resolve,i=n.reject,o=yp((function(){var n=rn(t.resolve),o=[],a=0,u=1;ci(e,(function(e){var s=a++,c=!1;o.push(void 0),u++,n.call(t,e).then((function(e){c||(c=!0,o[s]=e,--u||r(o))}),i)})),--u||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Ip(t),r=n.reject,i=yp((function(){var i=rn(t.resolve);ci(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Wp=Q()(dp=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).canvasHeight=void 0,e.texture=void 0,e.canvas=void 0,e.iconData=void 0,e.iconMap=void 0,e.ctx=void 0,e}return Wi(n,[{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(e,t){var n=this,r=new Image;if(this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,width:64,height:64}),this.updateIconMap(),this.loadImage(t).then((function(t){r=t;var i=n.iconData.find((function(t){return t.id===e}));i&&(i.image=r),n.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image;o&&e.ctx.drawImage(o,r,i,64,64)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,a=0,u=[],s={},c=lo(e);try{for(c.s();!(r=c.n()).done;){var l=r.value;if(!s[l.id]){var f=l.height,h=l.width;i+h+t>n&&(md(s,u,o),i=0,o=a+o+t,a=0,u=[]),u.push({icon:l,xOffset:i}),i=i+h+t,a=Math.max(a,f)}}}catch(e){c.e(e)}finally{c.f()}return u.length>0&&md(s,u,o),{mapping:s,canvasHeight:yd(a+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}}]),n}(u))||dp,qp=1e-6,Xp="undefined"!=typeof Float32Array?Float32Array:Array,Zp=Math.random;function Yp(){var e=new Xp(16);return Xp!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Kp(e){var t=new Xp(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qp(e,t,n,r,i,o,a,u,s,c,l,f,h,d,p,v){var g=new Xp(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=a,g[7]=u,g[8]=s,g[9]=c,g[10]=l,g[11]=f,g[12]=h,g[13]=d,g[14]=p,g[15]=v,g}function Jp(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $p(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15],y=n*u-r*a,b=n*s-i*a,_=n*c-o*a,x=r*s-i*u,S=r*c-o*u,E=i*c-o*s,A=l*v-f*p,w=l*g-h*p,T=l*m-d*p,C=f*g-h*v,k=f*m-d*v,M=h*m-d*g,I=y*M-b*k+_*C+x*T-S*w+E*A;return I?(I=1/I,e[0]=(u*M-s*k+c*C)*I,e[1]=(i*k-r*M-o*C)*I,e[2]=(v*E-g*S+m*x)*I,e[3]=(h*S-f*E-d*x)*I,e[4]=(s*T-a*M-c*w)*I,e[5]=(n*M-i*T+o*w)*I,e[6]=(g*_-p*E-m*b)*I,e[7]=(l*E-h*_+d*b)*I,e[8]=(a*k-u*T+c*A)*I,e[9]=(r*T-n*k-o*A)*I,e[10]=(p*S-v*_+m*y)*I,e[11]=(f*_-l*S-d*y)*I,e[12]=(u*w-a*C-s*A)*I,e[13]=(n*C-r*w+i*A)*I,e[14]=(v*b-p*x-g*y)*I,e[15]=(l*x-f*b+h*y)*I,e):null}function ev(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],v=t[12],g=t[13],m=t[14],y=t[15],b=n[0],_=n[1],x=n[2],S=n[3];return e[0]=b*r+_*u+x*f+S*v,e[1]=b*i+_*s+x*h+S*g,e[2]=b*o+_*c+x*d+S*m,e[3]=b*a+_*l+x*p+S*y,b=n[4],_=n[5],x=n[6],S=n[7],e[4]=b*r+_*u+x*f+S*v,e[5]=b*i+_*s+x*h+S*g,e[6]=b*o+_*c+x*d+S*m,e[7]=b*a+_*l+x*p+S*y,b=n[8],_=n[9],x=n[10],S=n[11],e[8]=b*r+_*u+x*f+S*v,e[9]=b*i+_*s+x*h+S*g,e[10]=b*o+_*c+x*d+S*m,e[11]=b*a+_*l+x*p+S*y,b=n[12],_=n[13],x=n[14],S=n[15],e[12]=b*r+_*u+x*f+S*v,e[13]=b*i+_*s+x*h+S*g,e[14]=b*o+_*c+x*d+S*m,e[15]=b*a+_*l+x*p+S*y,e}function tv(e,t,n){var r,i,o,a,u,s,c,l,f,h,d,p,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=u,e[5]=s,e[6]=c,e[7]=l,e[8]=f,e[9]=h,e[10]=d,e[11]=p,e[12]=r*v+u*g+f*m+t[12],e[13]=i*v+s*g+h*m+t[13],e[14]=o*v+c*g+d*m+t[14],e[15]=a*v+l*g+p*m+t[15]),e}function nv(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rv(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],u=t[6],s=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=a*i+l*r,e[6]=u*i+f*r,e[7]=s*i+h*r,e[8]=c*i-o*r,e[9]=l*i-a*r,e[10]=f*i-u*r,e[11]=h*i-s*r,e}function iv(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],u=t[2],s=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=a*i-l*r,e[2]=u*i-f*r,e[3]=s*i-h*r,e[8]=o*r+c*i,e[9]=a*r+l*i,e[10]=u*r+f*i,e[11]=s*r+h*i,e}function ov(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],u=t[2],s=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=a*i+l*r,e[2]=u*i+f*r,e[3]=s*i+h*r,e[4]=c*i-o*r,e[5]=l*i-a*r,e[6]=f*i-u*r,e[7]=h*i-s*r,e}function av(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function uv(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],u=r+r,s=i+i,c=o+o,l=r*u,f=r*s,h=r*c,d=i*s,p=i*c,v=o*c,g=a*u,m=a*s,y=a*c;return e[0]=1-(d+v),e[1]=f+y,e[2]=h-m,e[3]=0,e[4]=f-y,e[5]=1-(l+v),e[6]=p+g,e[7]=0,e[8]=h+m,e[9]=p-g,e[10]=1-(l+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function sv(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],u=t[6],s=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,u),e[2]=Math.hypot(s,c,l),e}function cv(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}function lv(e,t,n,r){var i,o,a,u,s,c,l,f,h,d,p=t[0],v=t[1],g=t[2],m=r[0],y=r[1],b=r[2],_=n[0],x=n[1],S=n[2];return Math.abs(p-_)<qp&&Math.abs(v-x)<qp&&Math.abs(g-S)<qp?Jp(e):(l=p-_,f=v-x,h=g-S,i=y*(h*=d=1/Math.hypot(l,f,h))-b*(f*=d),o=b*(l*=d)-m*h,a=m*f-y*l,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),u=f*a-h*o,s=h*i-l*a,c=l*o-f*i,(d=Math.hypot(u,s,c))?(u*=d=1/d,s*=d,c*=d):(u=0,s=0,c=0),e[0]=i,e[1]=u,e[2]=l,e[3]=0,e[4]=o,e[5]=s,e[6]=f,e[7]=0,e[8]=a,e[9]=c,e[10]=h,e[11]=0,e[12]=-(i*p+o*v+a*g),e[13]=-(u*p+s*v+c*g),e[14]=-(l*p+f*v+h*g),e[15]=1,e)}function fv(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function hv(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],y=t[0],b=t[1],_=t[2],x=t[3],S=t[4],E=t[5],A=t[6],w=t[7],T=t[8],C=t[9],k=t[10],M=t[11],I=t[12],O=t[13],P=t[14],R=t[15];return Math.abs(n-y)<=qp*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-b)<=qp*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-_)<=qp*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-x)<=qp*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=qp*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(u-E)<=qp*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(s-A)<=qp*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(c-w)<=qp*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-T)<=qp*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(f-C)<=qp*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-k)<=qp*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-M)<=qp*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-I)<=qp*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(v-O)<=qp*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(g-P)<=qp*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(m-R)<=qp*Math.max(1,Math.abs(m),Math.abs(R))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var dv=ev,pv=fv,vv=Object.freeze({__proto__:null,create:Yp,clone:Kp,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:Qp,set:function(e,t,n,r,i,o,a,u,s,c,l,f,h,d,p,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=u,e[7]=s,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=v,e[15]=g,e},identity:Jp,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:$p,adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15];return e[0]=u*(h*m-d*g)-f*(s*m-c*g)+v*(s*d-c*h),e[1]=-(r*(h*m-d*g)-f*(i*m-o*g)+v*(i*d-o*h)),e[2]=r*(s*m-c*g)-u*(i*m-o*g)+v*(i*c-o*s),e[3]=-(r*(s*d-c*h)-u*(i*d-o*h)+f*(i*c-o*s)),e[4]=-(a*(h*m-d*g)-l*(s*m-c*g)+p*(s*d-c*h)),e[5]=n*(h*m-d*g)-l*(i*m-o*g)+p*(i*d-o*h),e[6]=-(n*(s*m-c*g)-a*(i*m-o*g)+p*(i*c-o*s)),e[7]=n*(s*d-c*h)-a*(i*d-o*h)+l*(i*c-o*s),e[8]=a*(f*m-d*v)-l*(u*m-c*v)+p*(u*d-c*f),e[9]=-(n*(f*m-d*v)-l*(r*m-o*v)+p*(r*d-o*f)),e[10]=n*(u*m-c*v)-a*(r*m-o*v)+p*(r*c-o*u),e[11]=-(n*(u*d-c*f)-a*(r*d-o*f)+l*(r*c-o*u)),e[12]=-(a*(f*g-h*v)-l*(u*g-s*v)+p*(u*h-s*f)),e[13]=n*(f*g-h*v)-l*(r*g-i*v)+p*(r*h-i*f),e[14]=-(n*(u*g-s*v)-a*(r*g-i*v)+p*(r*s-i*u)),e[15]=n*(u*h-s*f)-a*(r*h-i*f)+l*(r*s-i*u),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],u=e[6],s=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],p=e[13],v=e[14],g=e[15];return(t*a-n*o)*(f*g-h*v)-(t*u-r*o)*(l*g-h*p)+(t*s-i*o)*(l*v-f*p)+(n*u-r*a)*(c*g-h*d)-(n*s-i*a)*(c*v-f*d)+(r*s-i*u)*(c*p-l*d)},multiply:ev,translate:tv,scale:nv,rotate:function(e,t,n,r){var i,o,a,u,s,c,l,f,h,d,p,v,g,m,y,b,_,x,S,E,A,w,T,C,k=r[0],M=r[1],I=r[2],O=Math.hypot(k,M,I);return O<qp?null:(k*=O=1/O,M*=O,I*=O,i=Math.sin(n),a=1-(o=Math.cos(n)),u=t[0],s=t[1],c=t[2],l=t[3],f=t[4],h=t[5],d=t[6],p=t[7],v=t[8],g=t[9],m=t[10],y=t[11],b=k*k*a+o,_=M*k*a+I*i,x=I*k*a-M*i,S=k*M*a-I*i,E=M*M*a+o,A=I*M*a+k*i,w=k*I*a+M*i,T=M*I*a-k*i,C=I*I*a+o,e[0]=u*b+f*_+v*x,e[1]=s*b+h*_+g*x,e[2]=c*b+d*_+m*x,e[3]=l*b+p*_+y*x,e[4]=u*S+f*E+v*A,e[5]=s*S+h*E+g*A,e[6]=c*S+d*E+m*A,e[7]=l*S+p*E+y*A,e[8]=u*w+f*T+v*C,e[9]=s*w+h*T+g*C,e[10]=c*w+d*T+m*C,e[11]=l*w+p*T+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:rv,rotateY:iv,rotateZ:ov,fromTranslation:av,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,i,o,a=n[0],u=n[1],s=n[2],c=Math.hypot(a,u,s);return c<qp?null:(a*=c=1/c,u*=c,s*=c,r=Math.sin(t),o=1-(i=Math.cos(t)),e[0]=a*a*o+i,e[1]=u*a*o+s*r,e[2]=s*a*o-u*r,e[3]=0,e[4]=a*u*o-s*r,e[5]=u*u*o+i,e[6]=s*u*o+a*r,e[7]=0,e[8]=a*s*o+u*r,e[9]=u*s*o-a*r,e[10]=s*s*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:uv,fromQuat2:function(e,t){var n=new Xp(3),r=-t[0],i=-t[1],o=-t[2],a=t[3],u=t[4],s=t[5],c=t[6],l=t[7],f=r*r+i*i+o*o+a*a;return f>0?(n[0]=2*(u*a+l*r+s*o-c*i)/f,n[1]=2*(s*a+l*i+c*r-u*o)/f,n[2]=2*(c*a+l*o+u*i-s*r)/f):(n[0]=2*(u*a+l*r+s*o-c*i),n[1]=2*(s*a+l*i+c*r-u*o),n[2]=2*(c*a+l*o+u*i-s*r)),uv(e,t,n),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:sv,getRotation:function(e,t){var n=new Xp(3);sv(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],a=t[0]*r,u=t[1]*i,s=t[2]*o,c=t[4]*r,l=t[5]*i,f=t[6]*o,h=t[8]*r,d=t[9]*i,p=t[10]*o,v=a+l+p,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(f-d)/g,e[1]=(h-s)/g,e[2]=(u-c)/g):a>l&&a>p?(g=2*Math.sqrt(1+a-l-p),e[3]=(f-d)/g,e[0]=.25*g,e[1]=(u+c)/g,e[2]=(h+s)/g):l>p?(g=2*Math.sqrt(1+l-a-p),e[3]=(h-s)/g,e[0]=(u+c)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=2*Math.sqrt(1+p-a-l),e[3]=(u-c)/g,e[0]=(h+s)/g,e[1]=(f+d)/g,e[2]=.25*g),e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],u=t[3],s=i+i,c=o+o,l=a+a,f=i*s,h=i*c,d=i*l,p=o*c,v=o*l,g=a*l,m=u*s,y=u*c,b=u*l,_=r[0],x=r[1],S=r[2];return e[0]=(1-(p+g))*_,e[1]=(h+b)*_,e[2]=(d-y)*_,e[3]=0,e[4]=(h-b)*x,e[5]=(1-(f+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(d+y)*S,e[9]=(v-m)*S,e[10]=(1-(f+p))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,i){var o=t[0],a=t[1],u=t[2],s=t[3],c=o+o,l=a+a,f=u+u,h=o*c,d=o*l,p=o*f,v=a*l,g=a*f,m=u*f,y=s*c,b=s*l,_=s*f,x=r[0],S=r[1],E=r[2],A=i[0],w=i[1],T=i[2],C=(1-(v+m))*x,k=(d+_)*x,M=(p-b)*x,I=(d-_)*S,O=(1-(h+m))*S,P=(g+y)*S,R=(p+b)*E,L=(g-y)*E,N=(1-(h+v))*E;return e[0]=C,e[1]=k,e[2]=M,e[3]=0,e[4]=I,e[5]=O,e[6]=P,e[7]=0,e[8]=R,e[9]=L,e[10]=N,e[11]=0,e[12]=n[0]+A-(C*A+I*w+R*T),e[13]=n[1]+w-(k*A+O*w+L*T),e[14]=n[2]+T-(M*A+P*w+N*T),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,u=r+r,s=i+i,c=n*a,l=r*a,f=r*u,h=i*a,d=i*u,p=i*s,v=o*a,g=o*u,m=o*s;return e[0]=1-f-p,e[1]=l+m,e[2]=h-g,e[3]=0,e[4]=l-m,e[5]=1-c-p,e[6]=d+v,e[7]=0,e[8]=h+g,e[9]=d-v,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,i,o,a){var u=1/(n-t),s=1/(i-r),c=1/(o-a);return e[0]=2*o*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*s,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},perspective:cv,perspectiveFromFieldOfView:function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(a+u),c=2/(i+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-u)*s*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},ortho:function(e,t,n,r,i,o,a){var u=1/(t-n),s=1/(r-i),c=1/(o-a);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*s,e[14]=(a+o)*c,e[15]=1,e},lookAt:lv,targetTo:function(e,t,n,r){var i=t[0],o=t[1],a=t[2],u=r[0],s=r[1],c=r[2],l=i-n[0],f=o-n[1],h=a-n[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var p=s*h-c*f,v=c*l-u*h,g=u*f-s*l;return(d=p*p+v*v+g*g)>0&&(p*=d=1/Math.sqrt(d),v*=d,g*=d),e[0]=p,e[1]=v,e[2]=g,e[3]=0,e[4]=f*g-h*v,e[5]=h*p-l*g,e[6]=l*v-f*p,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:fv,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:hv,mul:dv,sub:pv});function gv(){var e=new Xp(3);return Xp!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function mv(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function yv(e,t,n){var r=new Xp(3);return r[0]=e,r[1]=t,r[2]=n,r}function bv(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function _v(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function xv(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Sv(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function Ev(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function Av(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function wv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Tv(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Cv(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function kv(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],u=n[1],s=n[2];return e[0]=i*s-o*u,e[1]=o*a-r*s,e[2]=r*u-i*a,e}var Mv,Iv=bv,Ov=_v,Pv=xv,Rv=Sv,Lv=Ev,Nv=mv,Dv=Av,jv=(Mv=gv(),function(e,t,n,r,i,o){var a,u;for(t||(t=3),n||(n=0),u=r?Math.min(r*t+n,e.length):e.length,a=n;a<u;a+=t)Mv[0]=e[a],Mv[1]=e[a+1],Mv[2]=e[a+2],i(Mv,Mv,o),e[a]=Mv[0],e[a+1]=Mv[1],e[a+2]=Mv[2];return e}),Fv=Object.freeze({__proto__:null,create:gv,clone:function(e){var t=new Xp(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:mv,fromValues:yv,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:bv,multiply:_v,divide:xv,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:Sv,squaredDistance:Ev,squaredLength:Av,negate:wv,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:Tv,dot:Cv,cross:kv,lerp:function(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e},hermite:function(e,t,n,r,i,o){var a=o*o,u=a*(2*o-3)+1,s=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*u+n[0]*s+r[0]*c+i[0]*l,e[1]=t[1]*u+n[1]*s+r[1]*c+i[1]*l,e[2]=t[2]*u+n[2]*s+r[2]*c+i[2]*l,e},bezier:function(e,t,n,r,i,o){var a=1-o,u=a*a,s=o*o,c=u*a,l=3*o*u,f=3*s*a,h=s*o;return e[0]=t[0]*c+n[0]*l+r[0]*f+i[0]*h,e[1]=t[1]*c+n[1]*l+r[1]*f+i[1]*h,e[2]=t[2]*c+n[2]*l+r[2]*f+i[2]*h,e},random:function(e,t){t=t||1;var n=2*Zp()*Math.PI,r=2*Zp()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:function(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e},transformMat3:function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},transformQuat:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],u=t[0],s=t[1],c=t[2],l=i*c-o*s,f=o*u-r*c,h=r*s-i*u,d=i*h-o*f,p=o*l-r*h,v=r*f-i*l,g=2*a;return l*=g,f*=g,h*=g,d*=2,p*=2,v*=2,e[0]=u+l+d,e[1]=s+f+p,e[2]=c+h+v,e},rotateX:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},angle:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],u=t[2],s=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+u*u),c=s&&Cv(e,t)/s;return Math.acos(Math.min(Math.max(c,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],u=t[2];return Math.abs(n-o)<=qp*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=qp*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=qp*Math.max(1,Math.abs(i),Math.abs(u))},sub:Iv,mul:Ov,div:Pv,dist:Rv,sqrDist:Lv,len:Nv,sqrLen:Dv,forEach:jv});function zv(){var e=new Xp(4);return Xp!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Uv(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}!function(){var e=zv()}();function Bv(){var e=new Xp(2);return Xp!=Float32Array&&(e[0]=0,e[1]=0),e}function Vv(e,t){var n=new Xp(2);return n[0]=e,n[1]=t,n}function Gv(e,t){return e[0]=t[0],e[1]=t[1],e}function Hv(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Wv(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function qv(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Xv(e,t){return e[0]*t[0]+e[1]*t[1]}function Zv(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var Yv,Kv,Qv,Jv,$v=Wv,eg=(function(){var e=Bv()}(),Q()(Yv=function(){function e(){Gi(this,e),this.viewport=void 0,this.overridedViewProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0,this.jitteredProjectionMatrix=void 0,this.viewMatrixInverse=void 0,this.cameraPosition=void 0}return Wi(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=$p(Yp(),this.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=ao(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=av(Yp(),[e,t,0]);this.jitteredProjectionMatrix=ev(Yp(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ev(Yp(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Yv),tg=Q()(Kv=function(){function e(){Gi(this,e),this.container=void 0,this.controlCorners=void 0,this.controlContainer=void 0,this.scene=void 0,this.mapsService=void 0,this.controls=[],this.unAddControls=[]}return Wi(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(nr.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(nr.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=lo(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=Aa("div","l7-control-container",this.container);function r(r,i){var o=t+r+" "+t+i;e[r+i]=Aa("div",o,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&wa(this.controlCorners[e]);this.controlContainer&&wa(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Kv,ng=Q()(Qv=function(){function e(){Gi(this,e),this.container=void 0,this.scene=void 0,this.mapsService=void 0,this.markers=[],this.markerLayers=[],this.unAddMarkers=[],this.unAddMarkerLayers=[]}return Wi(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(nr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||Qv,rg=Q()(Jv=function(){function e(){Gi(this,e),this.scene=void 0,this.popup=void 0,this.mapsService=void 0,this.unAddPopup=void 0}return Wi(e,[{key:"removePopup",value:function(e){e.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(e){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(e.addTo(this.scene),this.popup=e):this.unAddPopup=e}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(nr.IMapService)}}]),e}())||Jv;var ig=function(){this.__data__=[],this.size=0};var og=function(e,t){return e===t||e!=e&&t!=t};var ag=function(e,t){for(var n=e.length;n--;)if(og(e[n][0],t))return n;return-1},ug=Array.prototype.splice;var sg=function(e){var t=this.__data__,n=ag(t,e);return!(n<0)&&(n==t.length-1?t.pop():ug.call(t,n,1),--this.size,!0)};var cg=function(e){var t=this.__data__,n=ag(t,e);return n<0?void 0:t[n][1]};var lg=function(e){return ag(this.__data__,e)>-1};var fg=function(e,t){var n=this.__data__,r=ag(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function hg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}hg.prototype.clear=ig,hg.prototype.delete=sg,hg.prototype.get=cg,hg.prototype.has=lg,hg.prototype.set=fg;var dg=hg;var pg=function(){this.__data__=new dg,this.size=0};var vg=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var gg=function(e){return this.__data__.get(e)};var mg=function(e){return this.__data__.has(e)},yg="object"==typeof r&&r&&r.Object===Object&&r,bg="object"==typeof self&&self&&self.Object===Object&&self,_g=yg||bg||Function("return this")(),xg=_g.Symbol,Sg=Object.prototype,Eg=Sg.hasOwnProperty,Ag=Sg.toString,wg=xg?xg.toStringTag:void 0;var Tg=function(e){var t=Eg.call(e,wg),n=e[wg];try{e[wg]=void 0;var r=!0}catch(e){}var i=Ag.call(e);return r&&(t?e[wg]=n:delete e[wg]),i},Cg=Object.prototype.toString;var kg=function(e){return Cg.call(e)},Mg=xg?xg.toStringTag:void 0;var Ig=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Mg&&Mg in Object(e)?Tg(e):kg(e)};var Og=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Pg=function(e){if(!Og(e))return!1;var t=Ig(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Rg=_g["__core-js_shared__"],Lg=function(){var e=/[^.]+$/.exec(Rg&&Rg.keys&&Rg.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var Ng=function(e){return!!Lg&&Lg in e},Dg=Function.prototype.toString;var jg=function(e){if(null!=e){try{return Dg.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Fg=/^\[object .+?Constructor\]$/,zg=Function.prototype,Ug=Object.prototype,Bg=zg.toString,Vg=Ug.hasOwnProperty,Gg=RegExp("^"+Bg.call(Vg).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Hg=function(e){return!(!Og(e)||Ng(e))&&(Pg(e)?Gg:Fg).test(jg(e))};var Wg=function(e,t){return null==e?void 0:e[t]};var qg=function(e,t){var n=Wg(e,t);return Hg(n)?n:void 0},Xg=qg(_g,"Map"),Zg=qg(Object,"create");var Yg=function(){this.__data__=Zg?Zg(null):{},this.size=0};var Kg=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Qg=Object.prototype.hasOwnProperty;var Jg=function(e){var t=this.__data__;if(Zg){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Qg.call(t,e)?t[e]:void 0},$g=Object.prototype.hasOwnProperty;var em=function(e){var t=this.__data__;return Zg?void 0!==t[e]:$g.call(t,e)};var tm=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zg&&void 0===t?"__lodash_hash_undefined__":t,this};function nm(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}nm.prototype.clear=Yg,nm.prototype.delete=Kg,nm.prototype.get=Jg,nm.prototype.has=em,nm.prototype.set=tm;var rm=nm;var im=function(){this.size=0,this.__data__={hash:new rm,map:new(Xg||dg),string:new rm}};var om=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var am=function(e,t){var n=e.__data__;return om(t)?n["string"==typeof t?"string":"hash"]:n.map};var um=function(e){var t=am(this,e).delete(e);return this.size-=t?1:0,t};var sm=function(e){return am(this,e).get(e)};var cm=function(e){return am(this,e).has(e)};var lm=function(e,t){var n=am(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function fm(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}fm.prototype.clear=im,fm.prototype.delete=um,fm.prototype.get=sm,fm.prototype.has=cm,fm.prototype.set=lm;var hm=fm;var dm=function(e,t){var n=this.__data__;if(n instanceof dg){var r=n.__data__;if(!Xg||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new hm(r)}return n.set(e,t),this.size=n.size,this};function pm(e){var t=this.__data__=new dg(e);this.size=t.size}pm.prototype.clear=pg,pm.prototype.delete=vg,pm.prototype.get=gg,pm.prototype.has=mg,pm.prototype.set=dm;var vm=pm,gm=function(){try{var e=qg(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var mm=function(e,t,n){"__proto__"==t&&gm?gm(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var ym=function(e,t,n){(void 0!==n&&!og(e[t],n)||void 0===n&&!(t in e))&&mm(e,t,n)};var bm=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),u=a.length;u--;){var s=a[e?u:++i];if(!1===n(o[s],s,o))break}return t}}(),_m=o((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?_g.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}})),xm=_g.Uint8Array;var Sm=function(e){var t=new e.constructor(e.byteLength);return new xm(t).set(new xm(e)),t};var Em=function(e,t){var n=t?Sm(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Am=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},wm=Object.create,Tm=function(){function e(){}return function(t){if(!Og(t))return{};if(wm)return wm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Cm=function(e,t){return function(n){return e(t(n))}},km=Cm(Object.getPrototypeOf,Object),Mm=Object.prototype;var Im=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Mm)};var Om=function(e){return"function"!=typeof e.constructor||Im(e)?{}:Tm(km(e))};var Pm=function(e){return null!=e&&"object"==typeof e};var Rm=function(e){return Pm(e)&&"[object Arguments]"==Ig(e)},Lm=Object.prototype,Nm=Lm.hasOwnProperty,Dm=Lm.propertyIsEnumerable,jm=Rm(function(){return arguments}())?Rm:function(e){return Pm(e)&&Nm.call(e,"callee")&&!Dm.call(e,"callee")},Fm=Array.isArray;var zm=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Um=function(e){return null!=e&&zm(e.length)&&!Pg(e)};var Bm=function(e){return Pm(e)&&Um(e)};var Vm=function(){return!1},Gm=o((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?_g.Buffer:void 0,o=(i?i.isBuffer:void 0)||Vm;e.exports=o})),Hm=Function.prototype,Wm=Object.prototype,qm=Hm.toString,Xm=Wm.hasOwnProperty,Zm=qm.call(Object);var Ym=function(e){if(!Pm(e)||"[object Object]"!=Ig(e))return!1;var t=km(e);if(null===t)return!0;var n=Xm.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&qm.call(n)==Zm},Km={};Km["[object Float32Array]"]=Km["[object Float64Array]"]=Km["[object Int8Array]"]=Km["[object Int16Array]"]=Km["[object Int32Array]"]=Km["[object Uint8Array]"]=Km["[object Uint8ClampedArray]"]=Km["[object Uint16Array]"]=Km["[object Uint32Array]"]=!0,Km["[object Arguments]"]=Km["[object Array]"]=Km["[object ArrayBuffer]"]=Km["[object Boolean]"]=Km["[object DataView]"]=Km["[object Date]"]=Km["[object Error]"]=Km["[object Function]"]=Km["[object Map]"]=Km["[object Number]"]=Km["[object Object]"]=Km["[object RegExp]"]=Km["[object Set]"]=Km["[object String]"]=Km["[object WeakMap]"]=!1;var Qm=function(e){return Pm(e)&&zm(e.length)&&!!Km[Ig(e)]};var Jm=function(e){return function(t){return e(t)}},$m=o((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&yg.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),ey=$m&&$m.isTypedArray,ty=ey?Jm(ey):Qm;var ny=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},ry=Object.prototype.hasOwnProperty;var iy=function(e,t,n){var r=e[t];ry.call(e,t)&&og(r,n)&&(void 0!==n||t in e)||mm(e,t,n)};var oy=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var u=t[o],s=r?r(n[u],e[u],u,n,e):void 0;void 0===s&&(s=e[u]),i?mm(n,u,s):iy(n,u,s)}return n};var ay=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},uy=/^(?:0|[1-9]\d*)$/;var sy=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&uy.test(e))&&e>-1&&e%1==0&&e<t},cy=Object.prototype.hasOwnProperty;var ly=function(e,t){var n=Fm(e),r=!n&&jm(e),i=!n&&!r&&Gm(e),o=!n&&!r&&!i&&ty(e),a=n||r||i||o,u=a?ay(e.length,String):[],s=u.length;for(var c in e)!t&&!cy.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||sy(c,s))||u.push(c);return u};var fy=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},hy=Object.prototype.hasOwnProperty;var dy=function(e){if(!Og(e))return fy(e);var t=Im(e),n=[];for(var r in e)("constructor"!=r||!t&&hy.call(e,r))&&n.push(r);return n};var py=function(e){return Um(e)?ly(e,!0):dy(e)};var vy=function(e){return oy(e,py(e))};var gy=function(e,t,n,r,i,o,a){var u=ny(e,n),s=ny(t,n),c=a.get(s);if(c)ym(e,n,c);else{var l=o?o(u,s,n+"",e,t,a):void 0,f=void 0===l;if(f){var h=Fm(s),d=!h&&Gm(s),p=!h&&!d&&ty(s);l=s,h||d||p?Fm(u)?l=u:Bm(u)?l=Am(u):d?(f=!1,l=_m(s,!0)):p?(f=!1,l=Em(s,!0)):l=[]:Ym(s)||jm(s)?(l=u,jm(u)?l=vy(u):Og(u)&&!Pg(u)||(l=Om(s))):f=!1}f&&(a.set(s,l),i(l,s,r,o,a),a.delete(s)),ym(e,n,l)}};var my=function e(t,n,r,i,o){t!==n&&bm(n,(function(a,u){if(o||(o=new vm),Og(a))gy(t,n,u,r,e,i,o);else{var s=i?i(ny(t,u),a,u+"",t,n,o):void 0;void 0===s&&(s=a),ym(t,u,s)}}),py)};var yy=function(e){return e};var by=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},_y=Math.max;var xy=function(e,t,n){return t=_y(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=_y(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var u=Array(t+1);++i<t;)u[i]=r[i];return u[t]=n(a),by(e,this,u)}};var Sy=function(e){return function(){return e}},Ey=gm?function(e,t){return gm(e,"toString",{configurable:!0,enumerable:!1,value:Sy(t),writable:!0})}:yy,Ay=Date.now;var wy=function(e){var t=0,n=0;return function(){var r=Ay(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Ey);var Ty=function(e,t){return wy(xy(e,t,yy),e+"")};var Cy=function(e,t,n){if(!Og(n))return!1;var r=typeof t;return!!("number"==r?Um(n)&&sy(t,n.length):"string"==r&&t in n)&&og(n[t],e)};var ky,My=function(e){return Ty((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&Cy(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var u=n[r];u&&e(t,u,r,o)}return t}))}((function(e,t,n){my(e,t,n)})),Iy={MapToken:" DemotokenToken",SDK:"mapbox-gl apiL7"},Oy={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Py={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15}},Ry=Q()(ky=function(){function e(){Gi(this,e),this.sceneConfigCache={},this.layerConfigCache={}}return Wi(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return Iy[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=Zi(Zi({},Oy),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=Zi({},My({},this.sceneConfigCache[e],Py,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||ky,Ly=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1},Ny=Math.abs,Dy=Math.pow,jy=Dy(2,-52),Fy=Dy(2,-23),zy=Dy(2,127)*(2-Fy),Uy=Dy(2,-126),By=Math.fround||function(e){var t,n,r=Ny(e),i=Ly(e);return r<Uy?i*(r/Uy/Fy+1/jy-1/jy)*Uy*Fy:(n=(t=(1+Fy/jy)*r)-(t-r))>zy||n!=n?i*(1/0):i*n};Ot({target:"Math",stat:!0},{fround:By});var Vy,Gy=Math.PI/180;function Hy(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,u=void 0!==a&&a,s=e.flipY,c=void 0!==s&&s,l={},f=512*(o=void 0!==o?o:Math.pow(2,i)),h=Math.cos(n*Gy),d=f/360,p=d/h,v=f/4003e4/h;if(l.pixelsPerMeter=[v,-v,v],l.metersPerPixel=[1/v,-1/v,1/v],l.pixelsPerDegree=[d,-p,v],l.degreesPerPixel=[1/d,-1/p,1/v],u){var g=Gy*Math.tan(n*Gy)/h,m=d*g/2,y=f/4003e4*g,b=y/p*v;l.pixelsPerDegree2=[0,-m,y],l.pixelsPerMeter2=[b,0,b],c&&(l.pixelsPerDegree2[1]=-l.pixelsPerDegree2[1],l.pixelsPerMeter2[1]=-l.pixelsPerMeter2[1])}return c&&(l.pixelsPerMeter[1]=-l.pixelsPerMeter[1],l.metersPerPixel[1]=-l.metersPerPixel[1],l.pixelsPerDegree[1]=-l.pixelsPerDegree[1],l.degreesPerPixel[1]=-l.degreesPerPixel[1]),l}(Vy=e.CoordinateSystem||(e.CoordinateSystem={}))[Vy.LNGLAT=1]="LNGLAT",Vy[Vy.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",Vy[Vy.VECTOR_TILE=3]="VECTOR_TILE",Vy[Vy.IDENTITY=4]="IDENTITY",Vy[Vy.P20=5]="P20",Vy[Vy.P20_OFFSET=6]="P20_OFFSET",Vy[Vy.METER_OFFSET=7]="METER_OFFSET";var Wy,qy,Xy,Zy,Yy,Ky,Qy,Jy,$y,eb,tb,nb,rb,ib={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter"},ob=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ab=(Wy=Q(),qy=J(nr.ICameraService),Wy((Yy=ho((Zy=function(){function t(){Gi(this,t),this.needRefresh=!0,fo(this,"cameraService",Yy,this),this.coordinateSystem=void 0,this.viewportCenter=void 0,this.viewportCenterProjection=void 0,this.pixelsPerDegree=void 0,this.pixelsPerDegree2=void 0,this.pixelsPerMeter=void 0}return Wi(t,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=this.cameraService.getCenter(),i=Hy({latitude:r[1],zoom:t}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===e.CoordinateSystem.LNGLAT||this.coordinateSystem===e.CoordinateSystem.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===e.CoordinateSystem.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===e.CoordinateSystem.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=Hy({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,u=i.pixelsPerDegree2,s=this.cameraService.getViewMatrix(),c=this.cameraService.getProjectionMatrix(),l=ev([],c,s),f=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=Uv([],[f[0],f[1],0,1],l),l=ev([],c,s=this.cameraService.getViewMatrixUncentered()||s),l=ev([],l,ob),this.cameraService.setViewProjectionMatrix(l),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=u}}]),t}()).prototype,"cameraService",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=Zy))||Xy),ub=o((function(e){
/*! Hammer.JS - v2.0.7 - 2016-04-22
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2016 Jorik Tangelder;
	 * Licensed under the MIT license */
!function(t,n,r,i){var o,a=["","webkit","Moz","MS","ms","o"],u=n.createElement("div"),s=Math.round,c=Math.abs,l=Date.now;function f(e,t,n){return setTimeout(y(e,n),t)}function h(e,t,n){return!!Array.isArray(e)&&(d(e,n[t],n),!0)}function d(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function p(e,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,i,r),e.apply(this,arguments)}}o="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var v=p((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),g=p((function(e,t){return v(e,t,!0)}),"merge","Use `assign`.");function m(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&o(r,n)}function y(e,t){return function(){return e.apply(t,arguments)}}function b(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function _(e,t){return void 0===e?t:e}function x(e,t,n){d(w(t),(function(t){e.addEventListener(t,n,!1)}))}function S(e,t,n){d(w(t),(function(t){e.removeEventListener(t,n,!1)}))}function E(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function A(e,t){return e.indexOf(t)>-1}function w(e){return e.trim().split(/\s+/g)}function T(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function C(e){return Array.prototype.slice.call(e,0)}function k(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];T(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function M(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<a.length;){if((r=(n=a[o])?n+i:t)in e)return r;o++}}var I=1;function O(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var P="ontouchstart"in t,R=void 0!==M(t,"PointerEvent"),L=P&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),N=["x","y"],D=["clientX","clientY"];function j(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){b(e.options.enable,[e])&&n.handler(t)},this.init()}function F(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=z(t));i>1&&!n.firstMultiple?n.firstMultiple=z(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,s=t.center=U(r);t.timeStamp=l(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=H(u,s),t.distance=G(u,s),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=V(t.deltaX,t.deltaY);var f=B(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=c(f.x)>c(f.y)?f.x:f.y,t.scale=a?(h=a.pointers,d=r,G(d[0],d[1],D)/G(h[0],h[1],D)):1,t.rotation=a?function(e,t){return H(t[1],t[0],D)+H(e[1],e[0],D)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,u=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(u>25||void 0===a.velocity)){var s=t.deltaX-a.deltaX,l=t.deltaY-a.deltaY,f=B(u,s,l);r=f.x,i=f.y,n=c(f.x)>c(f.y)?f.x:f.y,o=V(s,l),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var h,d;var p=e.element;E(t.srcEvent.target,p)&&(p=t.srcEvent.target);t.target=p}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function z(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:s(e.pointers[n].clientX),clientY:s(e.pointers[n].clientY)},n++;return{timeStamp:l(),pointers:t,center:U(t),deltaX:e.deltaX,deltaY:e.deltaY}}function U(e){var t=e.length;if(1===t)return{x:s(e[0].clientX),y:s(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:s(n/t),y:s(r/t)}}function B(e,t,n){return{x:t/e||0,y:n/e||0}}function V(e,t){return e===t?1:c(e)>=c(t)?e<0?2:4:t<0?8:16}function G(e,t,n){n||(n=N);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function H(e,t,n){n||(n=N);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}j.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(O(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(O(this.element),this.evWin,this.domHandler)}};var W={mousedown:1,mousemove:2,mouseup:4};function q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,j.apply(this,arguments)}m(q,j,{handler:function(e){var t=W[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var X={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Z={2:"touch",3:"pen",4:"mouse",5:"kinect"},Y="pointerdown",K="pointermove pointerup pointercancel";function Q(){this.evEl=Y,this.evWin=K,j.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}t.MSPointerEvent&&!t.PointerEvent&&(Y="MSPointerDown",K="MSPointerMove MSPointerUp MSPointerCancel"),m(Q,j,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=X[r],o=Z[e.pointerType]||e.pointerType,a="touch"==o,u=T(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?u<0&&(t.push(e),u=t.length-1):12&i&&(n=!0),u<0||(t[u]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(u,1))}});var J={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function $(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,j.apply(this,arguments)}function ee(e,t){var n=C(e.touches),r=C(e.changedTouches);return 12&t&&(n=k(n.concat(r),"identifier",!0)),[n,r]}m($,j,{handler:function(e){var t=J[e.type];if(1===t&&(this.started=!0),this.started){var n=ee.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},j.apply(this,arguments)}function re(e,t){var n=C(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=C(e.changedTouches),u=[],s=this.target;if(o=n.filter((function(e){return E(e.target,s)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&u.push(a[i]),12&t&&delete r[a[i].identifier],i++;return u.length?[k(o.concat(u),"identifier",!0),u]:void 0}m(ne,j,{handler:function(e){var t=te[e.type],n=re.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function ie(){j.apply(this,arguments);var e=y(this.handler,this);this.touch=new ne(this.manager,e),this.mouse=new q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function oe(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ae.call(this,t)):12&e&&ae.call(this,t)}function ae(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function ue(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}m(ie,j,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)oe.call(this,t,n);else if(i&&ue.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var se=M(u.style,"touchAction"),ce=void 0!==se,le=function(){if(!ce)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!n||t.CSS.supports("touch-action",r)})),e}();function fe(e,t){this.manager=e,this.set(t)}fe.prototype={set:function(e){"compute"==e&&(e=this.compute()),ce&&this.manager.element.style&&le[e]&&(this.manager.element.style[se]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return d(this.manager.recognizers,(function(t){b(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(A(e,"none"))return"none";var t=A(e,"pan-x"),n=A(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(A(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=A(r,"none")&&!le.none,o=A(r,"pan-y")&&!le["pan-y"],a=A(r,"pan-x")&&!le["pan-x"];if(i){var u=1===e.pointers.length,s=e.distance<2,c=e.deltaTime<250;if(u&&s&&c)return}if(!a||!o)return i||o&&6&n||a&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function he(e){this.options=o({},this.defaults,e||{}),this.id=I++,this.manager=null,this.options.enable=_(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function de(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function pe(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ve(e,t){var n=t.manager;return n?n.get(e):e}function ge(){he.apply(this,arguments)}function me(){ge.apply(this,arguments),this.pX=null,this.pY=null}function ye(){ge.apply(this,arguments)}function be(){he.apply(this,arguments),this._timer=null,this._input=null}function _e(){ge.apply(this,arguments)}function xe(){ge.apply(this,arguments)}function Se(){he.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ee(e,t){return(t=t||{}).recognizers=_(t.recognizers,Ee.defaults.preset),new Ae(e,t)}he.prototype={defaults:{},set:function(e){return o(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(h(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ve(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return h(e,"dropRecognizeWith",this)||(e=ve(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(h(e,"requireFailure",this))return this;var t=this.requireFail;return-1===T(t,e=ve(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(h(e,"dropRequireFailure",this))return this;e=ve(e,this);var t=T(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+de(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+de(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=o({},e);if(!b(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},m(ge,he,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),m(me,ge,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return ge.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=pe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),m(ye,ge,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),m(be,he,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=f((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}}),m(_e,ge,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),m(xe,ge,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return me.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&c(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=pe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),m(Se,he,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||G(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=f((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=f((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ee.VERSION="2.0.7",Ee.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[_e,{enable:!1}],[ye,{enable:!1},["rotate"]],[xe,{direction:6}],[me,{direction:6},["swipe"]],[Se],[Se,{event:"doubletap",taps:2},["tap"]],[be]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ae(e,t){var n;this.options=o({},Ee.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(R?Q:L?ne:P?ie:q))(n,F),this.touchAction=new fe(this,this.options.touchAction),we(this,!0),d(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function we(e,t){var n,r=e.element;r.style&&(d(e.options.cssProps,(function(i,o){n=M(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ae.prototype={set:function(e){return o(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof he)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(h(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(h(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=T(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return d(w(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return d(w(e),(function(e){t?n[e]&&n[e].splice(T(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var r=n.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&we(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(Ee,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ae,Input:j,TouchAction:fe,TouchInput:ne,MouseInput:q,PointerEventInput:Q,TouchMouseInput:ie,SingleTouchInput:$,Recognizer:he,AttrRecognizer:ge,Tap:Se,Pan:me,Swipe:xe,Pinch:ye,Rotate:_e,Press:be,on:x,off:S,each:d,merge:g,extend:v,assign:o,inherit:m,bindFn:y,prefixed:M}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=Ee,e.exports?e.exports=Ee:t.Hammer=Ee}(window,document)}));(Ky=e.InteractionEvent||(e.InteractionEvent={})).Hover="hover",Ky.Click="click",Ky.Select="select",Ky.Active="active",Ky.Drag="drag";var sb={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancle"},cb=(Qy=Q(),Jy=J(nr.IMapService),$y=J(nr.ILogService),Qy((nb=ho((tb=function(t){Yi(r,t);var n=io(r);function r(){var t;Gi(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return fo(t=n.call.apply(n,[this].concat(o)),"mapService",nb,no(t)),fo(t,"logger",rb,no(t)),t.hammertime=void 0,t.lastClickTime=0,t.lastClickXY=[-1,-1],t.clickTimer=void 0,t.onDrag=function(n){var r=t.interactionEvent(n);r.type=sb[r.type],t.emit(e.InteractionEvent.Drag,r)},t.onHammer=function(n){n.srcEvent.stopPropagation();var r=t.interactionEvent(n);t.emit(e.InteractionEvent.Hover,r)},t.onTouch=function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})},t.onHover=function(n){var r=n.x,i=n.y,o=n.type,a=t.mapService.getMapContainer();if(a){var u=a.getBoundingClientRect(),s=u.top;r-=u.left,i-=s}var c=t.mapService.containerToLngLat([r,i]);if("click"!==o)"touch"!==o?"click"!==o&&"dblclick"!==o&&t.emit(e.InteractionEvent.Hover,{x:r,y:i,lngLat:c,type:o}):t.isDoubleTap(r,i,c);else{if("ontouchstart"in document.documentElement==!0)return;t.isDoubleTap(r,i,c)}},t}return Wi(r,[{key:"init",value:function(){this.addEventListenerOnMap()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(e.InteractionEvent.Hover)}},{key:"triggerHover",value:function(t){var n=t.x,r=t.y;this.emit(e.InteractionEvent.Hover,{x:n,y:r})}},{key:"triggerSelect",value:function(t){this.emit(e.InteractionEvent.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(e.InteractionEvent.Active,{featureId:t})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e){var t=new ub.Manager(e);t.add(new ub.Tap({event:"dblclick",taps:2})),t.add(new ub.Tap({event:"click"})),t.add(new ub.Pan({threshold:0,pointers:0})),t.add(new ub.Press({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r}}},{key:"isDoubleTap",value:function(t,n,r){var i=this,o=(new Date).getTime(),a="click";o-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-n)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),a="dblclick",this.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:a})):(this.lastClickTime=o,this.lastClickXY=[t,n],this.clickTimer=setTimeout((function(){a="click",i.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:a})}),400))}}]),r}(a)).prototype,"mapService",[Jy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rb=ho(tb.prototype,"logger",[$y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=tb))||eb),lb=ln.some,fb=vr("some"),hb=br("some");Ot({target:"Array",proto:!0,forced:!fb||!hb},{some:function(e){return lb(this,e,arguments.length>1?arguments[1]:void 0)}});var db,pb,vb,gb,mb,yb,bb,_b,xb,Sb,Eb,Ab;o((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(e,t,n,r){var i=t&&t.prototype instanceof l?t:l,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=b(a,n);if(u){if(u===c)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c={};function l(){}function f(){}function h(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(E([])));v&&v!==t&&n.call(v,i)&&(d=v);var g=h.prototype=l.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,u){var c=s(e[i],e,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,u)}),(function(e){r("throw",e,a,u)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,u)}))}u(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=g.constructor=h,h.constructor=f,h[a]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},m(y.prototype),y.prototype[o]=function(){return this},e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},m(g),g[a]="Generator",g[i]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));(db=e.gl||(e.gl={}))[db.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",db[db.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",db[db.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",db[db.POINTS=0]="POINTS",db[db.LINES=1]="LINES",db[db.LINE_LOOP=2]="LINE_LOOP",db[db.LINE_STRIP=3]="LINE_STRIP",db[db.TRIANGLES=4]="TRIANGLES",db[db.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",db[db.TRIANGLE_FAN=6]="TRIANGLE_FAN",db[db.ZERO=0]="ZERO",db[db.ONE=1]="ONE",db[db.SRC_COLOR=768]="SRC_COLOR",db[db.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",db[db.SRC_ALPHA=770]="SRC_ALPHA",db[db.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",db[db.DST_ALPHA=772]="DST_ALPHA",db[db.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",db[db.DST_COLOR=774]="DST_COLOR",db[db.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",db[db.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",db[db.FUNC_ADD=32774]="FUNC_ADD",db[db.BLEND_EQUATION=32777]="BLEND_EQUATION",db[db.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",db[db.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",db[db.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",db[db.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",db[db.MAX_EXT=32776]="MAX_EXT",db[db.MIN_EXT=32775]="MIN_EXT",db[db.BLEND_DST_RGB=32968]="BLEND_DST_RGB",db[db.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",db[db.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",db[db.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",db[db.CONSTANT_COLOR=32769]="CONSTANT_COLOR",db[db.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",db[db.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",db[db.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",db[db.BLEND_COLOR=32773]="BLEND_COLOR",db[db.ARRAY_BUFFER=34962]="ARRAY_BUFFER",db[db.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",db[db.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",db[db.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",db[db.STREAM_DRAW=35040]="STREAM_DRAW",db[db.STATIC_DRAW=35044]="STATIC_DRAW",db[db.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",db[db.BUFFER_SIZE=34660]="BUFFER_SIZE",db[db.BUFFER_USAGE=34661]="BUFFER_USAGE",db[db.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",db[db.FRONT=1028]="FRONT",db[db.BACK=1029]="BACK",db[db.FRONT_AND_BACK=1032]="FRONT_AND_BACK",db[db.CULL_FACE=2884]="CULL_FACE",db[db.BLEND=3042]="BLEND",db[db.DITHER=3024]="DITHER",db[db.STENCIL_TEST=2960]="STENCIL_TEST",db[db.DEPTH_TEST=2929]="DEPTH_TEST",db[db.SCISSOR_TEST=3089]="SCISSOR_TEST",db[db.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",db[db.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",db[db.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",db[db.NO_ERROR=0]="NO_ERROR",db[db.INVALID_ENUM=1280]="INVALID_ENUM",db[db.INVALID_VALUE=1281]="INVALID_VALUE",db[db.INVALID_OPERATION=1282]="INVALID_OPERATION",db[db.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",db[db.CW=2304]="CW",db[db.CCW=2305]="CCW",db[db.LINE_WIDTH=2849]="LINE_WIDTH",db[db.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",db[db.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",db[db.CULL_FACE_MODE=2885]="CULL_FACE_MODE",db[db.FRONT_FACE=2886]="FRONT_FACE",db[db.DEPTH_RANGE=2928]="DEPTH_RANGE",db[db.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",db[db.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",db[db.DEPTH_FUNC=2932]="DEPTH_FUNC",db[db.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",db[db.STENCIL_FUNC=2962]="STENCIL_FUNC",db[db.STENCIL_FAIL=2964]="STENCIL_FAIL",db[db.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",db[db.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",db[db.STENCIL_REF=2967]="STENCIL_REF",db[db.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",db[db.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",db[db.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",db[db.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",db[db.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",db[db.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",db[db.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",db[db.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",db[db.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",db[db.VIEWPORT=2978]="VIEWPORT",db[db.SCISSOR_BOX=3088]="SCISSOR_BOX",db[db.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",db[db.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",db[db.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",db[db.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",db[db.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",db[db.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",db[db.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",db[db.RED_BITS=3410]="RED_BITS",db[db.GREEN_BITS=3411]="GREEN_BITS",db[db.BLUE_BITS=3412]="BLUE_BITS",db[db.ALPHA_BITS=3413]="ALPHA_BITS",db[db.DEPTH_BITS=3414]="DEPTH_BITS",db[db.STENCIL_BITS=3415]="STENCIL_BITS",db[db.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",db[db.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",db[db.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",db[db.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",db[db.SAMPLES=32937]="SAMPLES",db[db.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",db[db.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",db[db.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",db[db.DONT_CARE=4352]="DONT_CARE",db[db.FASTEST=4353]="FASTEST",db[db.NICEST=4354]="NICEST",db[db.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",db[db.BYTE=5120]="BYTE",db[db.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",db[db.SHORT=5122]="SHORT",db[db.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",db[db.INT=5124]="INT",db[db.UNSIGNED_INT=5125]="UNSIGNED_INT",db[db.FLOAT=5126]="FLOAT",db[db.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",db[db.ALPHA=6406]="ALPHA",db[db.RGB=6407]="RGB",db[db.RGBA=6408]="RGBA",db[db.LUMINANCE=6409]="LUMINANCE",db[db.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",db[db.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",db[db.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",db[db.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",db[db.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",db[db.VERTEX_SHADER=35633]="VERTEX_SHADER",db[db.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",db[db.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",db[db.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",db[db.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",db[db.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",db[db.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",db[db.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",db[db.SHADER_TYPE=35663]="SHADER_TYPE",db[db.DELETE_STATUS=35712]="DELETE_STATUS",db[db.LINK_STATUS=35714]="LINK_STATUS",db[db.VALIDATE_STATUS=35715]="VALIDATE_STATUS",db[db.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",db[db.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",db[db.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",db[db.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",db[db.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",db[db.NEVER=512]="NEVER",db[db.LESS=513]="LESS",db[db.EQUAL=514]="EQUAL",db[db.LEQUAL=515]="LEQUAL",db[db.GREATER=516]="GREATER",db[db.NOTEQUAL=517]="NOTEQUAL",db[db.GEQUAL=518]="GEQUAL",db[db.ALWAYS=519]="ALWAYS",db[db.KEEP=7680]="KEEP",db[db.REPLACE=7681]="REPLACE",db[db.INCR=7682]="INCR",db[db.DECR=7683]="DECR",db[db.INVERT=5386]="INVERT",db[db.INCR_WRAP=34055]="INCR_WRAP",db[db.DECR_WRAP=34056]="DECR_WRAP",db[db.VENDOR=7936]="VENDOR",db[db.RENDERER=7937]="RENDERER",db[db.VERSION=7938]="VERSION",db[db.NEAREST=9728]="NEAREST",db[db.LINEAR=9729]="LINEAR",db[db.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",db[db.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",db[db.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",db[db.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",db[db.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",db[db.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",db[db.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",db[db.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",db[db.TEXTURE_2D=3553]="TEXTURE_2D",db[db.TEXTURE=5890]="TEXTURE",db[db.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",db[db.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",db[db.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",db[db.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",db[db.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",db[db.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",db[db.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",db[db.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",db[db.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",db[db.TEXTURE0=33984]="TEXTURE0",db[db.TEXTURE1=33985]="TEXTURE1",db[db.TEXTURE2=33986]="TEXTURE2",db[db.TEXTURE3=33987]="TEXTURE3",db[db.TEXTURE4=33988]="TEXTURE4",db[db.TEXTURE5=33989]="TEXTURE5",db[db.TEXTURE6=33990]="TEXTURE6",db[db.TEXTURE7=33991]="TEXTURE7",db[db.TEXTURE8=33992]="TEXTURE8",db[db.TEXTURE9=33993]="TEXTURE9",db[db.TEXTURE10=33994]="TEXTURE10",db[db.TEXTURE11=33995]="TEXTURE11",db[db.TEXTURE12=33996]="TEXTURE12",db[db.TEXTURE13=33997]="TEXTURE13",db[db.TEXTURE14=33998]="TEXTURE14",db[db.TEXTURE15=33999]="TEXTURE15",db[db.TEXTURE16=34e3]="TEXTURE16",db[db.TEXTURE17=34001]="TEXTURE17",db[db.TEXTURE18=34002]="TEXTURE18",db[db.TEXTURE19=34003]="TEXTURE19",db[db.TEXTURE20=34004]="TEXTURE20",db[db.TEXTURE21=34005]="TEXTURE21",db[db.TEXTURE22=34006]="TEXTURE22",db[db.TEXTURE23=34007]="TEXTURE23",db[db.TEXTURE24=34008]="TEXTURE24",db[db.TEXTURE25=34009]="TEXTURE25",db[db.TEXTURE26=34010]="TEXTURE26",db[db.TEXTURE27=34011]="TEXTURE27",db[db.TEXTURE28=34012]="TEXTURE28",db[db.TEXTURE29=34013]="TEXTURE29",db[db.TEXTURE30=34014]="TEXTURE30",db[db.TEXTURE31=34015]="TEXTURE31",db[db.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",db[db.REPEAT=10497]="REPEAT",db[db.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",db[db.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",db[db.FLOAT_VEC2=35664]="FLOAT_VEC2",db[db.FLOAT_VEC3=35665]="FLOAT_VEC3",db[db.FLOAT_VEC4=35666]="FLOAT_VEC4",db[db.INT_VEC2=35667]="INT_VEC2",db[db.INT_VEC3=35668]="INT_VEC3",db[db.INT_VEC4=35669]="INT_VEC4",db[db.BOOL=35670]="BOOL",db[db.BOOL_VEC2=35671]="BOOL_VEC2",db[db.BOOL_VEC3=35672]="BOOL_VEC3",db[db.BOOL_VEC4=35673]="BOOL_VEC4",db[db.FLOAT_MAT2=35674]="FLOAT_MAT2",db[db.FLOAT_MAT3=35675]="FLOAT_MAT3",db[db.FLOAT_MAT4=35676]="FLOAT_MAT4",db[db.SAMPLER_2D=35678]="SAMPLER_2D",db[db.SAMPLER_CUBE=35680]="SAMPLER_CUBE",db[db.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",db[db.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",db[db.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",db[db.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",db[db.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",db[db.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",db[db.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",db[db.COMPILE_STATUS=35713]="COMPILE_STATUS",db[db.LOW_FLOAT=36336]="LOW_FLOAT",db[db.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",db[db.HIGH_FLOAT=36338]="HIGH_FLOAT",db[db.LOW_INT=36339]="LOW_INT",db[db.MEDIUM_INT=36340]="MEDIUM_INT",db[db.HIGH_INT=36341]="HIGH_INT",db[db.FRAMEBUFFER=36160]="FRAMEBUFFER",db[db.RENDERBUFFER=36161]="RENDERBUFFER",db[db.RGBA4=32854]="RGBA4",db[db.RGB5_A1=32855]="RGB5_A1",db[db.RGB565=36194]="RGB565",db[db.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",db[db.STENCIL_INDEX=6401]="STENCIL_INDEX",db[db.STENCIL_INDEX8=36168]="STENCIL_INDEX8",db[db.DEPTH_STENCIL=34041]="DEPTH_STENCIL",db[db.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",db[db.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",db[db.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",db[db.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",db[db.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",db[db.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",db[db.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",db[db.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",db[db.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",db[db.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",db[db.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",db[db.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",db[db.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",db[db.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",db[db.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",db[db.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",db[db.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",db[db.NONE=0]="NONE",db[db.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",db[db.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",db[db.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",db[db.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",db[db.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",db[db.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",db[db.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",db[db.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",db[db.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",db[db.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",db[db.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",db[db.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",db[db.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",db[db.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL";var wb,Tb,Cb,kb,Mb,Ib,Ob,Pb=(pb=Q(),vb=J(nr.IRendererService),gb=J(nr.IGlobalConfigService),mb=J(nr.IInteractionService),yb=J(nr.ILayerService),pb((xb=ho((_b=function(){function t(){var e=this;Gi(this,t),fo(this,"rendererService",xb,this),fo(this,"configService",Sb,this),fo(this,"interactionService",Eb,this),fo(this,"layerService",Ab,this),this.pickingFBO=void 0,this.width=0,this.height=0,this.alreadyInPicking=!1,this.pickBufferScale=1,this.pickFromPickingFBO=function(t,n){var r,i,o=n.x,a=n.y,u=n.lngLat,s=n.type,c=!1,l=e.rendererService,f=l.getViewportSize,h=l.readPixels,d=f(),p=d.width,v=d.height,g=t.getLayerConfig(),m=g.enableHighlight,y=g.enableSelect,b=o*window.devicePixelRatio,_=a*window.devicePixelRatio;if(b>p-1*window.devicePixelRatio||b<0||_>v-1*window.devicePixelRatio||_<0)return!1;if(0!==(i=h({x:Math.floor(b/e.pickBufferScale),y:Math.floor((v-(a+1)*window.devicePixelRatio)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==i[1]||0!==i[2]){var x=Vh(i),S=t.getSource().getFeatureById(x);x!==t.getCurrentPickId()&&"mousemove"===s&&(s="mouseenter");var E={x:o,y:a,type:s,lngLat:u,featureId:x,feature:S};S&&(c=!0,t.setCurrentPickId(x),e.triggerHoverOnLayer(t,E))}else{var A={x:o,y:a,lngLat:u,type:null!==t.getCurrentPickId()&&"mousemove"===s?"mouseout":"un"+s,featureId:null,feature:null};e.triggerHoverOnLayer(t,Zi(Zi({},A),{},{type:"unpick"})),e.triggerHoverOnLayer(t,A),t.setCurrentPickId(null)}if(m&&e.highlightPickedFeature(t,i),y&&"click"===s&&(null===(r=i)||void 0===r?void 0:r.toString())!==[0,0,0,0].toString()){var w=Vh(i);null===t.getCurrentSelectedId()||w!==t.getCurrentSelectedId()?(e.selectFeature(t,i),t.setCurrentSelectedId(w)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return c}}var n,r;return Wi(t,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,i=n.createFramebuffer,o=(0,n.getViewportSize)(),a=o.width,u=o.height;this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=i({color:r({width:Math.round(a/this.pickBufferScale),height:Math.round(u/this.pickBufferScale),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickingAllLayer.bind(this))}},{key:"pickingAllLayer",value:(r=Vi(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInPicking&&!this.layerService.alreadyInRendering){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"pickingLayers",value:(n=Vi(regeneratorRuntime.mark((function e(t){var n,r,i,o,a,u,s,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),u=a.width,s=a.height,this.width===u&&this.height===s||(this.pickingFBO.resize({width:Math.round(u/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=u,this.height=s),i(this.pickingFBO,(function(){c.layerService.getLayers().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){return o({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(),e.hooks.afterPickingEncode.call(),c.pickFromPickingFBO(e,t)&&!e.getLayerConfig().enablePropagation}))}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){e.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(e,t){var n=ao(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeHighlight.call([r,i,o])}},{key:"selectFeature",value:function(e,t){var n=ao(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}}]),t}()).prototype,"rendererService",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=ho(_b.prototype,"configService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=ho(_b.prototype,"interactionService",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ab=ho(_b.prototype,"layerService",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bb=_b))||bb),Rb=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Gi(this,e),this.autoStart=void 0,this.startTime=0,this.oldTime=0,this.running=!1,this.elapsedTime=0,this.autoStart=t}return Wi(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),Lb=(wb=Q(),Tb=J(nr.IRendererService),Cb=J(nr.IGlobalConfigService),wb((Ib=ho((Mb=function(){function e(){Gi(this,e),this.clock=new Rb,this.alreadyInRendering=!1,this.layers=[],this.layerRenderID=void 0,this.sceneInited=!1,this.animateInstanceCount=0,fo(this,"renderService",Ib,this),fo(this,"configService",Ob,this)}return Wi(e,[{key:"add",value:function(e){this.sceneInited&&e.init(),this.layers.push(e)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(e){e.inited||e.init()}))}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:function(e){var t=this.layers.indexOf(e);t>-1&&this.layers.splice(t,1),e.emit("remove",null),e.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).forEach((function(e){e.hooks.beforeRenderData.call(),e.hooks.beforeRender.call(),e.render(),e.hooks.afterRender.call()})),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort((function(e,t){return e.zIndex-t.zIndex}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()})),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),e}()).prototype,"renderService",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=ho(Mb.prototype,"configService",[Cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=Mb))||kb),Nb=Rs.left,Db=vr("reduce"),jb=br("reduce",{1:0});Ot({target:"Array",proto:!0,forced:!Db||!jb},{reduce:function(e){return Nb(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Fb=lr("slice"),zb=br("slice",{ACCESSORS:!0,0:0,1:2}),Ub=Qt("species"),Bb=[].slice,Vb=Math.max;Ot({target:"Array",proto:!0,forced:!Fb||!zb},{slice:function(e,t){var n,r,i,o=ge(this),a=ct(o.length),u=ht(e,a),s=ht(void 0===t?a:t,a);if(Lt(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Lt(n.prototype)?me(n)&&null===(n=n[Ub])&&(n=void 0):n=void 0,n===Array||void 0===n))return Bb.call(o,u,s);for(r=new(void 0===n?Array:n)(Vb(s-u,0)),i=0;u<s;u++,i++)u in o&&rr(r,i,o[u]);return r.length=i,r}}),Ot({target:"Object",stat:!0,forced:Object.assign!==hc},{assign:hc});var Gb,Hb,Wb,qb,Xb,Zb,Yb=function(e){return null==e},Kb=function(){function e(t){var n=this;Gi(this,e),this.name=void 0,this.type=void 0,this.scale=void 0,this.descriptor=void 0,this.featureBufferLayout=[],this.needRescale=!1,this.needRemapping=!1,this.needRegenerateVertices=!1,this.featureRange={startIndex:0,endIndex:1/0},this.vertexAttribute=void 0,this.defaultCallback=function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(0,(null===(r=n.scale)||void 0===r?void 0:r.scalers)[t].func)(e)}))},this.setProps(t)}return Wi(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null===(t=this.scale)||void 0===t?void 0:t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,uo(e));if(!Yb(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Qb=(qi(Gb={},e.gl.FLOAT,4),qi(Gb,e.gl.UNSIGNED_BYTE,1),qi(Gb,e.gl.UNSIGNED_SHORT,2),Gb),Jb=(Hb=Q(),Wb=J(nr.IRendererService),Hb((Zb=ho((Xb=function(){function t(){Gi(this,t),this.attributesAndIndices=void 0,fo(this,"rendererService",Zb,this),this.attributes=[],this.triangulation=void 0,this.featureLayout={sizePerElement:0,elements:[]}}return Wi(t,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new Kb(e),this.attributes.push(t)),t}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(Zi(Zi({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,o=this.attributes.find((function(e){return e.name===t}));if(o&&o.descriptor){var a=o.descriptor,u=a.update,s=a.buffer,c=a.size,l=void 0===c?0:c,f=Qb[s.type||e.gl.FLOAT];if(u){var h=this.featureLayout,d=h.elements,p=h.sizePerElement,v=d.slice(r,i);if(!v.length)return;var g=v[0].offset,m=g*l*f,y=v.map((function(e,t){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/p,s=[],c=0;c<a;c++){var l=o?o.slice(3*c,3*c+3):[];s.push.apply(s,uo(u(n[r],r,i.slice(c*p,c*p+p),t,l)))}return s})).reduce((function(e,t){return e.push.apply(e,uo(t)),e}),[]);o.vertexAttribute.updateBuffer({data:y,offset:m})}}}},{key:"createAttributesAndIndices",value:function(t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var i=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=[];t.forEach((function(e,t){var n=r.triangulation(e),u=n.indices,s=n.vertices,c=n.normals,l=n.size;u.forEach((function(e){a.push(e+o)}));var f=s.length/l;o+=f;for(var h=function(n){var r=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=s.slice(n*l,n*l+l);i.forEach((function(i,a){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,uo(i.update(e,t,o,n,r)))}))},d=0;d<f;d++)h(d)}));var u=this.rendererService,s=u.createAttribute,c=u.createBuffer,l=u.createElements,f={};i.forEach((function(e,t){if(e){var n=e.buffer,i=(e.update,e.name,to(e,["buffer","update","name"])),o=s(Zi({buffer:c(n)},i));f[e.name||""]=o,r.attributes[t].vertexAttribute=o}}));var h=l({data:a,type:e.gl.UNSIGNED_INT,count:a.length});return this.attributesAndIndices={attributes:f,elements:h},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),this.attributesAndIndices.elements.destroy(),this.attributes=[]}}]),t}()).prototype,"rendererService",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb=Xb))||qb);function $b(e){return($b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var e_={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":$b(process))&&process},t_=e_.window||e_.self||e_.global,n_=e_.process||{},r_="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",i_=!("object"===("undefined"==typeof process?"undefined":$b(process))&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"===$b(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===$b(process.versions)&&Boolean(process.versions.electron))return!0;var t="object"===("undefined"==typeof navigator?"undefined":$b(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}();function o_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a_(e,t){if(e){if("string"==typeof e)return o_(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o_(e,t):void 0}}function u_(e){return function(e){if(Array.isArray(e))return o_(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||a_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s_(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c_(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l_(e,t,n){return t&&c_(e.prototype,t),n&&c_(e,n),e}function f_(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}var h_=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";s_(this,e),this.storage=f_(r),this.id=t,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return l_(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function d_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>r&&(n=Math.min(n,r/e.width));var o=e.width*n,a=e.height*n,u=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),u]}var p_={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function v_(e){return"string"==typeof e?p_[e.toUpperCase()]||p_.WHITE:e}function g_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(n),i=!0,o=!1,a=void 0;try{for(var u,s=function(){var n=u.value;"function"==typeof e[n]&&(t.find((function(e){return n===e}))||(e[n]=e[n].bind(e)))},c=r[Symbol.iterator]();!(i=(u=c.next()).done);i=!0)s()}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}}function m_(e,t){if(!e)throw new Error(t||"Assertion failed")}function y_(){var e;if(i_&&t_.performance)e=t_.performance.now();else if(n_.hrtime){var t=n_.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var b_={debug:i_&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},__={enabled:!0,level:0};function x_(){}var S_={},E_={once:!0};function A_(e){for(var t in e)for(var n in e[t])return n||"untitled";return"empty"}var w_,T_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.id;s_(this,e),this.id=n,this.VERSION=r_,this._startTs=y_(),this._deltaTs=y_(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new h_("__probe-".concat(this.id,"__"),__),this.userData={},this.timeStamp("".concat(this.id," started")),g_(this),Object.seal(this)}return l_(e,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((y_()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((y_()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"assert",value:function(e,t){m_(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,b_.warn,arguments,E_)}},{key:"error",value:function(e){return this._getLogFunction(0,e,b_.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,b_.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,b_.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){return this._getLogFunction(e,t,b_.debug||b_.info,arguments,E_)}},{key:"table",value:function(e,t,n){return t?this._getLogFunction(e,t,console.table||x_,n&&[n],{tag:A_(t)}):x_}},{key:"image",value:function(e){var t=e.logLevel,n=e.priority,r=e.image,i=e.message,o=void 0===i?"":i,a=e.scale,u=void 0===a?1:a;return this._shouldLog(t||n)?i_?function(e){var t=e.image,n=e.message,r=void 0===n?"":n,i=e.scale,o=void 0===i?1:i;if("string"==typeof t){var a=new Image;return a.onload=function(){var e,t=d_(a,r,o);(e=console).log.apply(e,u_(t))},a.src=t,x_}var u=t.nodeName||"";if("img"===u.toLowerCase()){var s;return(s=console).log.apply(s,u_(d_(t,r,o))),x_}if("canvas"===u.toLowerCase()){var c=new Image;return c.onload=function(){var e;return(e=console).log.apply(e,u_(d_(c,r,o)))},c.src=t.toDataURL(),x_}return x_}({image:r,message:o,scale:u}):function(e){var t=e.image,n=(e.message,e.scale),r=void 0===n?1:n,i=null;try{i=module.require("asciify-image")}catch(e){}if(i)return function(){return i(t,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then((function(e){return console.log(e)}))};return x_}({image:r,message:o,scale:u}):x_}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t))}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||x_)}},{key:"group",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},r=n=k_({logLevel:e,message:t,opts:n}),i=r.collapsed;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}},{key:"groupCollapsed",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||x_)}},{key:"withGroup",value:function(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=C_(e)}},{key:"_getLogFunction",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(e)){var o;i=k_({logLevel:e,message:t,args:r,opts:i}),m_(n=n||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=y_();var a=i.tag||i.message;if(i.once){if(S_[a])return x_;S_[a]=y_()}return t=M_(this.id,i.message,i),(o=n).bind.apply(o,[console,t].concat(u_(i.args)))}return x_}},{key:"level",set:function(e){this.setLevel(e)},get:function(){return this.getLevel()}},{key:"priority",set:function(e){this.level=e},get:function(){return this.level}}]),e}();function C_(e){if(!e)return 0;var t;switch($b(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return m_(Number.isFinite(t)&&t>=0),t}function k_(e){var t=e.logLevel,n=e.message;e.logLevel=C_(t);for(var r=e.args?Array.from(e.args):[];r.length&&r.shift()!==n;);switch(e.args=r,$b(t)){case"string":case"function":void 0!==n&&r.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var i=$b(e.message);return m_("string"===i||"object"===i),Object.assign(e,e.opts)}function M_(e,t,n){if("string"==typeof t){var r=n.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}((i=n.total)<10?"".concat(i.toFixed(2),"ms"):i<100?"".concat(i.toFixed(1),"ms"):i<1e3?"".concat(i.toFixed(0),"ms"):"".concat((i/1e3).toFixed(2),"s")):"";t=function(e,t,n){return i_||"string"!=typeof e||(t&&(t=v_(t),e="[".concat(t,"m").concat(e,"[39m")),n&&(t=v_(n),e="[".concat(n+10,"m").concat(e,"[49m"))),e}(t=n.time?"".concat(e,": ").concat(r,"  ").concat(t):"".concat(e,": ").concat(t),n.color,n.background)}var i;return t}T_.VERSION=r_;var I_=new T_({id:"L7"}).enable(!1);I_.priority=5;var O_=Q()(w_=function(){function e(){Gi(this,e)}return Wi(e,[{key:"error",value:function(e){I_.error(e)()}},{key:"warn",value:function(e){I_.probe(1,e)()}},{key:"info",value:function(e){I_.info(3,e)()}},{key:"debug",value:function(e){I_.probe(4,e)()}}]),e}())||w_;
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */function P_(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((r=r.apply(e,t||[])).next())}))}function R_(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function L_(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function N_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function D_(e,t){return e(t={exports:{}},t.exports),t.exports}var j_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}));N_(j_);var F_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}));N_(F_);var z_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fallback=o,t.wrap=a;var n,r=t.hasSetImmediate="function"==typeof setImmediate&&setImmediate,i=t.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function o(e){setTimeout(e,0)}function a(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}n=r?setImmediate:i?process.nextTick:o,t.default=a(n)}));N_(z_);z_.fallback,z_.wrap,z_.hasSetImmediate,z_.hasNextTick;var U_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,B_.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return o(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return o(r,n);n(null,r)}))};var n=i(F_),r=i(z_);function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return e.then((function(e){a(t,null,e)}),(function(e){a(t,e&&e.message?e:new Error(e))}))}function a(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}));N_(U_);var B_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isAsyncIterable=t.isAsyncGenerator=t.isAsync=void 0;var n,r=(n=U_)&&n.__esModule?n:{default:n};function i(e){return"AsyncFunction"===e[Symbol.toStringTag]}t.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return i(e)?(0,r.default)(e):e},t.isAsync=i,t.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},t.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]}}));N_(B_);B_.isAsyncIterable,B_.isAsyncGenerator,B_.isAsync;var V_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");function n(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}return Object.defineProperty(n,"name",{configurable:!0,value:"awaitable("+e.name+")"}),n},e.exports=t.default}));N_(V_);var G_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(j_),r=o(B_),i=o(V_);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}));N_(G_);var H_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}));N_(H_);var W_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}));N_(W_);var q_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function(){var i=t[++n];return n<r?{value:e[i],key:i}:null}}(e)};var n=i(j_),r=i(W_);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}));N_(q_);var X_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}));N_(X_);var Z_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}));N_(Z_);var Y_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){var o=!1,a=!1,u=!1,s=0,c=0;function l(){s>=t||u||o||(u=!0,e.next().then((function(e){var t=e.value,r=e.done;if(!a&&!o){if(u=!1,r)return o=!0,void(s<=0&&i(null));s++,n(t,c,f),c++,l()}})).catch(h))}function f(e,t){if(s-=1,!a)return e?h(e):!1===e?(o=!0,void(a=!0)):t===r.default||o&&s<=0?(o=!0,i(null)):void l()}function h(e){a||(u=!1,o=!0,i(e))}l()};var n,r=(n=Z_)&&n.__esModule?n:{default:n};e.exports=t.default}));N_(Y_);var K_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(H_),r=u(q_),i=u(X_),o=u(Y_),a=u(Z_);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,s){if(s=(0,n.default)(s),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return s(null);if((0,B_.isAsyncGenerator)(t))return(0,o.default)(t,e,u,s);if((0,B_.isAsyncIterable)(t))return(0,o.default)(t[Symbol.asyncIterator](),e,u,s);var c=(0,r.default)(t),l=!1,f=!1,h=0,d=!1;function p(e,t){if(!f)if(h-=1,e)l=!0,s(e);else if(!1===e)l=!0,f=!0;else{if(t===a.default||l&&h<=0)return l=!0,s(null);d||v()}}function v(){for(d=!0;h<e&&!l;){var t=c();if(null===t)return l=!0,void(h<=0&&s(null));h+=1,u(t.value,t.key,(0,i.default)(p))}d=!1}v()}},e.exports=t.default}));N_(K_);var Q_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(K_),r=o(B_),i=o(V_);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}));N_(Q_);var J_=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Q_),r=i(V_);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}));N_(J_);var $_=N_(D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(G_),r=i(J_);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}))),ex=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,$_(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(L_(arguments[t]));return e}(n.args)),r(null,e)}))},e}(),tx=D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=c(j_),r=c(Z_),i=c(Q_),o=c(H_),a=c(X_),u=c(B_),s=c(V_);function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){n=(0,o.default)(n);var i=0,u=0,s=e.length,c=!1;function l(e,t){!1===e&&(c=!0),!0!==c&&(e?n(e):++u!==s&&t!==r.default||n(null))}for(0===s&&n(null);i<s;i++)t(e[i],i,(0,a.default)(l))}function f(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,s.default)((function(e,t,r){return((0,n.default)(e)?l:f)(e,(0,u.default)(t),r)}),3),e.exports=t.default}));N_(tx);var nx=N_(D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(tx),r=i(G_);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}))),rx=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return nx(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return P_(n,void 0,void 0,(function(){return R_(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),ix=N_(D_((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(H_),r=a(X_),i=a(B_),o=a(V_);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(u)]))}function u(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}))),ox=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return ix(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t()&&null,e)}))},e}(),ax=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return $_(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}();function ux(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var sx=function(e,t){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],i)e.__resizeTrigger__=e,e.attachEvent("onresize",ux);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var o=e.__resizeTrigger__=r.createElement("object");o.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),o.setAttribute("class","resize-sensor"),o.setAttribute("tabindex","-1"),o.__resizeElement__=e,o.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ux)},o.type="text/html",n&&e.appendChild(o),o.data="about:blank",n||e.appendChild(o)}e.__resizeListeners__.push(t)},cx="undefined"==typeof window?sx:sx.bind(window),lx=function(e,t){var n=document.attachEvent,r=e.__resizeListeners__||[];if(t){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}else r=e.__resizeListeners__=[];if(!r.length){if(n)e.detachEvent("onresize",ux);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,a=o&&o.defaultView;a&&(a.removeEventListener("resize",ux),delete a.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};cx.unbind=lx;window.document.documentElement.style;var fx,hx,dx,px,vx,gx,mx,yx,bx,_x,xx,Sx,Ex,Ax,wx,Tx,Cx,kx,Mx,Ix,Ox,Px,Rx,Lx,Nx,Dx,jx,Fx,zx,Ux,Bx,Vx,Gx,Hx,Wx,qx=0;function Xx(e){var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(qx++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var Zx=(fx=Q(),hx=J(nr.SceneID),dx=J(nr.IIconService),px=J(nr.IFontService),vx=J(nr.IControlService),gx=J(nr.ILogService),mx=J(nr.IGlobalConfigService),yx=J(nr.IMapService),bx=J(nr.ICoordinateSystemService),_x=J(nr.IRendererService),xx=J(nr.ILayerService),Sx=J(nr.ICameraService),Ex=J(nr.IInteractionService),Ax=J(nr.IPickingService),wx=J(nr.IShaderModuleService),Tx=J(nr.IMarkerService),Cx=J(nr.IPopupService),fx((Ix=ho((Mx=function(t){Yi(i,t);var n,r=io(i);function i(){var e;return Gi(this,i),(e=r.call(this)).destroyed=!1,e.loaded=!1,fo(e,"id",Ix,no(e)),fo(e,"iconService",Ox,no(e)),fo(e,"fontService",Px,no(e)),fo(e,"controlService",Rx,no(e)),fo(e,"logger",Lx,no(e)),fo(e,"configService",Nx,no(e)),fo(e,"map",Dx,no(e)),fo(e,"coordinateSystemService",jx,no(e)),fo(e,"rendererService",Fx,no(e)),fo(e,"layerService",zx,no(e)),fo(e,"cameraService",Ux,no(e)),fo(e,"interactionService",Bx,no(e)),fo(e,"pickingService",Vx,no(e)),fo(e,"shaderModuleService",Gx,no(e)),fo(e,"markerService",Hx,no(e)),fo(e,"popupService",Wx,no(e)),e.inited=!1,e.initPromise=void 0,e.rendering=!1,e.$container=void 0,e.hooks=void 0,e.handleWindowResized=function(){if(e.emit("resize"),e.$container){var t,n=window.devicePixelRatio,r=window.innerWidth,i=window.innerHeight;if(e.$container!==document.body){var o=e.$container.getBoundingClientRect();r=o.right-o.left,i=o.bottom-o.top}var a=null===(t=e.$container)||void 0===t?void 0:t.getElementsByTagName("canvas")[0];e.rendererService.viewport({x:0,y:0,width:n*r,height:n*i}),La(),e.coordinateSystemService.needRefresh=!0,a&&(a.width=r*n,a.height=i*n),e.render()}},e.handleMapCameraChanged=function(t){e.cameraService.update(t),e.render()},e.hooks={init:new rx},e}return Wi(i,[{key:"init",value:function(t){var n=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",Vi(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){n.map.onCameraChanged((function(t){n.cameraService.init(),n.cameraService.update(t),e()})),n.map.init()}));case 2:n.map.onCameraChanged(n.handleMapCameraChanged),n.map.addMarkerContainer(),n.markerService.addMarkers(),n.markerService.addMarkerLayers(),n.popupService.initPopup(),n.interactionService.init(),n.interactionService.on(e.InteractionEvent.Drag,n.addSceneEvent.bind(n)),n.logger.debug("map ".concat(n.id," loaded"));case 10:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",Vi(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Xx(n.configService.getSceneConfig(n.id).id||""),n.$container=t,!t){e.next=9;break}return e.next=5,n.rendererService.init(t,n.configService.getSceneConfig(n.id));case 5:cx(n.$container,n.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(n.handleWindowResized),e.next=10;break;case 9:n.logger.error(" id ");case 10:n.pickingService.init(n.id),n.logger.debug("scene ".concat(n.id," renderer loaded"));case 12:case"end":return e.stop()}}),e)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.logger.debug("add layer ".concat(e.name," to scene ").concat(this.id)),this.layerService.add(e),this.render()}},{key:"render",value:(n=Vi(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=13;break}return e.next=6,this.initPromise;case 6:this.destroyed&&this.destroy(),this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 13:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(e){var t,n=null===(t=this.$container)||void 0===t?void 0:t.getElementsByTagName("canvas")[0];return this.render(),"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"destroy",value:function(){this.inited?(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,lx(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)):this.destroyed=!0}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(u)).prototype,"id",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=ho(Mx.prototype,"iconService",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Px=ho(Mx.prototype,"fontService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=ho(Mx.prototype,"controlService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lx=ho(Mx.prototype,"logger",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nx=ho(Mx.prototype,"configService",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=ho(Mx.prototype,"map",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jx=ho(Mx.prototype,"coordinateSystemService",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=ho(Mx.prototype,"rendererService",[_x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zx=ho(Mx.prototype,"layerService",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ux=ho(Mx.prototype,"cameraService",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=ho(Mx.prototype,"interactionService",[Ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vx=ho(Mx.prototype,"pickingService",[Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gx=ho(Mx.prototype,"shaderModuleService",[wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hx=ho(Mx.prototype,"markerService",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=ho(Mx.prototype,"popupService",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=Mx))||kx);var Yx=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Kx=function(e){return this.__data__.has(e)};function Qx(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new hm;++t<n;)this.add(e[t])}Qx.prototype.add=Qx.prototype.push=Yx,Qx.prototype.has=Kx;var Jx=Qx;var $x=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var eS=function(e){return e!=e};var tS=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var nS=function(e,t,n){return t==t?tS(e,t,n):$x(e,eS,n)};var rS=function(e,t){return!!(null==e?0:e.length)&&nS(e,t,0)>-1};var iS=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var oS=function(e,t){return e.has(t)},aS=qg(_g,"Set");var uS=function(){};var sS=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},cS=aS&&1/sS(new aS([,-0]))[1]==1/0?function(e){return new aS(e)}:uS;var lS=function(e,t,n){var r=-1,i=rS,o=e.length,a=!0,u=[],s=u;if(n)a=!1,i=iS;else if(o>=200){var c=t?null:cS(e);if(c)return sS(c);a=!1,i=oS,s=new Jx}else s=t?[]:u;e:for(;++r<o;){var l=e[r],f=t?t(l):l;if(l=n||0!==l?l:0,a&&f==f){for(var h=s.length;h--;)if(s[h]===f)continue e;t&&s.push(f),u.push(l)}else i(s,f,n)||(s!==u&&s.push(f),u.push(l))}return u};var fS=function(e){return e&&e.length?lS(e):[]};Ot({target:"Array",proto:!0},{fill:hu}),Mr("fill");var hS=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function dS(e){var t={};return{content:e=e.replace(hS,(function(e,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),uniforms:t}}var pS,vS,gS,mS,yS,bS,_S,xS="#define PI 3.14159265359",SS=/precision\s+(high|low|medium)p\s+float/,ES=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,AS=Q()(pS=function(){function e(){Gi(this,e),this.moduleCache={},this.rawContentCache={}}return Wi(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:xS,fs:xS}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\nvec2 unpack_float(float packedValue) {\nint packedIntValue = int(packedValue);\nint v0 = packedIntValue / 256;\nreturn vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(vec2 encodedColor) {\nreturn vec4(\nunpack_float(encodedColor[0]) / 255.0,\nunpack_float(encodedColor[1]) / 255.0\n);\n}",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\nvec2 project_mercator(vec2 lnglat) {\nfloat x = lnglat.x;\nreturn vec2(\nradians(x) + PI,\nPI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n);\n}\nfloat project_scale(float meters) {\nreturn meters * u_PixelsPerMeter.z;\n}\nvec4 project_offset(vec4 offset) {\nfloat dy = offset.y;\ndy = clamp(dy, -1., 1.);\nvec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\nreturn vec4(offset.xyz * pixels_per_unit, offset.w);\n}\nvec3 project_normal(vec3 normal) {\nvec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\nreturn normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\nvec3 project_offset_normal(vec3 vector) {\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n|| u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn normalize(vector * u_PixelsPerDegree);\n}\nreturn project_normal(vector);\n}\nvec3 reverse_offset_normal(vec3 vector) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\nreturn vector * vec3(1.0, -1.0, 1.0);\n}\nreturn vector;\n}\nvec4 project_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n|| u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nfloat X = position.x - u_ViewportCenter.x;\nfloat Y = position.y - u_ViewportCenter.y;\nreturn project_offset(vec4(X, Y, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn vec4(\n(project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\nproject_scale(position.z),\nposition.w\n);\n}\nreturn position;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\nreturn offset * u_FocalDistance;\n}\nfloat project_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nreturn pixel;\n}\nvec2 project_pixel(vec2 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nreturn pixel * -1.;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nposition.w *= u_PixelsPerMeter.z;\n}\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(\nposition,\nu_ViewProjectionMatrix,\nu_ViewportCenterProjection\n);\n}\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\nvec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\npos.w = pos.w / u_PixelsPerMeter.z;\n}\nreturn pos;\n}\nbool isEqual( float a,  float b) {\nreturn  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\nfloat maxs=85.0511287798;\nfloat lat=max(min(maxs,lnglat.y),-maxs);\nfloat scale= 268435456.;\nfloat d=PI/180.;\nfloat x=lnglat.x*d;\nfloat y=lat*d;\ny=log(tan((PI/4.)+(y/2.)));\nfloat a=.5/PI,\nb=.5,\nc=-.5/PI;\nd=.5;\nx=scale*(a*x+b);\ny=scale*(c*y+d);\nreturn vec2(x,y);\n}\nvec2 unProjectFlat(vec2 px){\nfloat a=.5/PI;\nfloat b=.5;\nfloat c=-.5/PI;\nfloat d=.5;\nfloat scale = 268435456.;\nfloat x=(px.x/scale-b)/a;\nfloat y=(px.y/scale-d)/c;\ny=(atan(pow(E,y))-(PI/4.))*2.;\nd=PI/180.;\nfloat lat=y/d;\nfloat lng=x/d;\nreturn vec2(lng,lat);\n}\nfloat pixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\nfloat sdCircle(vec2 p, float r) {\nreturn length(p) - r;\n}\nfloat sdEquilateralTriangle(vec2 p) {\nfloat k = sqrt(3.0);\np.x = abs(p.x) - 1.0;\np.y = p.y + 1.0/k;\nif( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\np.x -= clamp( p.x, -2.0, 0.0 );\nreturn -length(p)*sign(p.y);\n}\nfloat sdBox(vec2 p, vec2 b) {\nvec2 d = abs(p)-b;\nreturn length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\nfloat sdPentagon(vec2 p, float r) {\nvec3 k = vec3(0.809016994,0.587785252,0.726542528);\np.x = abs(p.x);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagon(vec2 p, float r) {\nvec3 k = vec3(-0.866025404,0.5,0.577350269);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdOctogon(vec2 p, float r) {\nvec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\np = abs(p);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagram(vec2 p, float r) {\nvec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\np -= vec2(clamp(p.x,r*k.z,r*k.w),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdRhombus(vec2 p, vec2 b) {\nvec2 q = abs(p);\nfloat h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\nfloat d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\nreturn d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\nfloat sdVesica(vec2 p, float r, float d) {\np = abs(p);\nfloat b = sqrt(r*r-d*d);\nreturn ((p.y-b)*d>p.x*b)\n? length(p-vec2(0.0,b))\n: length(p-vec2(-d,0.0))-r;\n}"}),this.registerModule("lighting",{vs:"\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\nstruct DirectionalLight {\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\n};\nstruct SpotLight {\nvec3 position;\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\nfloat constant;\nfloat linear;\nfloat quadratic;\nfloat angle;\nfloat blur;\nfloat exponent;\n};\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\nvec3 lightDir = normalize(light.direction);\nfloat diff = max(dot(normal, lightDir), 0.0);\nvec3 halfwayDir = normalize(lightDir + viewDir);\nfloat spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\nvec3 ambient = light.ambient * u_Ambient;\nvec3 diffuse = light.diffuse * diff * u_Diffuse;\nvec3 specular = light.specular * spec * u_Specular;\nreturn ambient + diffuse + specular;\n}\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\nvec3 weight = vec3(0.0);\nfor (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\nif (i >= u_NumOfDirectionalLights) {\nbreak;\n}\nweight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n}\nreturn weight;\n}",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(vec3(1, -10.5, 12));\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\nreturn lightWeight;\n}",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\nbool isVertexPicked(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\nvoid setPickingColor(vec3 pickingColor) {\nv_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\nv_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nfloat setPickingSize(float x) {\nreturn u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\nvec4 filterHighlightColor(vec4 color) {\nbool selected = bool(v_PickingResult.a);\nif (selected) {\nvec4 highLightColor = u_HighlightColor * COLOR_SCALE;\nfloat highLightAlpha = highLightColor.a;\nfloat highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\nvec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\nreturn vec4(resultRGB, color.a);\n} else {\nreturn color;\n}\n}\nvec4 filterPickingColor(vec4 color) {\nvec3 pickingColor = v_PickingResult.rgb;\nif (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\ndiscard;\n}\nreturn u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\nvec4 filterColor(vec4 color) {\nreturn filterPickingColor(filterHighlightColor(color));\n}"})}},{key:"registerModule",value:function(e,t){if(!this.rawContentCache[e]){var n=t.vs,r=t.fs,i=t.uniforms,o=dS(n),a=o.content,u=o.uniforms,s=dS(r),c=s.content,l=s.uniforms;this.rawContentCache[e]={fs:c,uniforms:Zi(Zi(Zi({},u),l),i),vs:a}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this;if(this.moduleCache[e])return this.moduleCache[e];var n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.processModule(n,[],"vs"),o=i.content,a=i.includeList,u=this.processModule(r,[],"fs"),s=u.content,c=u.includeList,l=s,f=fS(a.concat(c).concat(e)).reduce((function(e,n){return Zi(Zi({},e),t.rawContentCache[n].uniforms)}),{});return SS.test(s)||(l="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+s),this.moduleCache[e]={fs:l.trim(),uniforms:f,vs:o.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(ES,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}}]),e}())||pS;(vS=e.PassType||(e.PassType={})).Normal="normal",vS.PostProcessing="post-processing";var wS,TS,CS,kS,MS,IS,OS,PS,RS,LS,NS,DS=(gS=Q(),mS=J(nr.IShaderModuleService),gS((_S=ho((bS=function(){function t(){Gi(this,t),fo(this,"shaderModuleService",_S,this),this.rendererService=void 0,this.cameraService=void 0,this.mapService=void 0,this.interactionService=void 0,this.layerService=void 0,this.config=void 0}return Wi(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return e.PassType.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(nr.IRendererService),this.cameraService=e.getContainer().get(nr.ICameraService),this.mapService=e.getContainer().get(nr.IMapService),this.interactionService=e.getContainer().get(nr.IInteractionService),this.layerService=e.getContainer().get(nr.ILayerService)}},{key:"render",value:function(e){}}]),t}()).prototype,"shaderModuleService",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yS=bS))||yS),jS=Q()(wS=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){oo(Ki(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(DS))||wS,FS=(TS=Q(),CS=J(nr.IPostProcessor),TS((IS=ho((MS=function(){function t(){Gi(this,t),this.passes=[],fo(this,"postProcessor",IS,this),this.layer=void 0,this.renderFlag=void 0,this.width=0,this.height=0}var n;return Wi(t,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(n=Vi(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=lo(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:this.layer.renderModels();case 18:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(t,n){t.getType()===e.PassType.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}()).prototype,"postProcessor",[CS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kS=MS))||kS),zS=(OS=Q(),PS=J(nr.ILogService),OS((NS=ho((LS=function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return fo(e=n.call.apply(n,[this].concat(i)),"logger",NS,no(e)),e.pickingFBO=void 0,e.layer=void 0,e.width=0,e.height=0,e.alreadyInRendering=!1,e.pickFromPickingFBO=function(t){var n=t.x,r=t.y,i=t.lngLat,o=t.type;if(e.layer.isVisible()&&e.layer.needPick(o)){var a,u=e.rendererService,s=u.getViewportSize,c=u.readPixels,l=u.useFramebuffer,f=s(),h=f.width,d=f.height,p=e.layer.getLayerConfig(),v=p.enableHighlight,g=p.enableSelect,m=n*window.devicePixelRatio,y=r*window.devicePixelRatio;if(!(m>h||m<0||y>d||y<0))l(e.pickingFBO,(function(){var t;if(0!==(a=c({x:Math.round(m),y:Math.round(d-(r+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==a[1]||0!==a[2]){e.logger.debug("picked");var u=Vh(a),s=e.layer.getSource().getFeatureById(u),l={x:n,y:r,type:o,lngLat:i,featureId:u,feature:s};s&&(e.layer.setCurrentPickId(u),e.triggerHoverOnLayer(l))}else{var f={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(Zi(Zi({},f),{},{type:"unpick"})),e.triggerHoverOnLayer(f),e.layer.setCurrentPickId(null)}v&&e.highlightPickedFeature(a),g&&"click"===o&&(null===(t=a)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(a)}))}},e}return Wi(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,n){oo(Ki(r.prototype),"init",this).call(this,t,n),this.layer=t;var i=this.rendererService,o=i.createTexture2D,a=i.createFramebuffer,u=(0,i.getViewportSize)(),s=u.width,c=u.height;this.pickingFBO=a({color:o({width:s,height:c,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickFromPickingFBO),this.interactionService.on(e.InteractionEvent.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(e.InteractionEvent.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),u=a.width,s=a.height;this.alreadyInRendering=!0,this.width===u&&this.height===s||(this.pickingFBO.resize({width:u,height:s}),this.width=u,this.height=s),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=ao(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=ao(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=Gh(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=Gh(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}]),r}(DS)).prototype,"logger",[PS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RS=LS))||RS),US="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nvoid main() {\ngl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",BS="attribute vec2 a_Position;\nvarying vec2 v_UV;\nvoid main() {\nv_UV = 0.5 * (a_Position + 1.0);\ngl_Position = vec4(a_Position, 0., 1.);\n}";var VS=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o};var GS=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:VS(e,t,n)},HS=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var WS=function(e){return HS.test(e)};var qS=function(e){return e.split("")},XS="[\\ud800-\\udfff]",ZS="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",YS="\\ud83c[\\udffb-\\udfff]",KS="[^\\ud800-\\udfff]",QS="(?:\\ud83c[\\udde6-\\uddff]){2}",JS="[\\ud800-\\udbff][\\udc00-\\udfff]",$S="(?:"+ZS+"|"+YS+")"+"?",eE="[\\ufe0e\\ufe0f]?"+$S+("(?:\\u200d(?:"+[KS,QS,JS].join("|")+")[\\ufe0e\\ufe0f]?"+$S+")*"),tE="(?:"+[KS+ZS+"?",ZS,QS,JS,XS].join("|")+")",nE=RegExp(YS+"(?="+YS+")|"+tE+eE,"g");var rE=function(e){return e.match(nE)||[]};var iE=function(e){return WS(e)?rE(e):qS(e)};var oE=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var aE=function(e){return"symbol"==typeof e||Pm(e)&&"[object Symbol]"==Ig(e)},uE=xg?xg.prototype:void 0,sE=uE?uE.toString:void 0;var cE=function e(t){if("string"==typeof t)return t;if(Fm(t))return oE(t,e)+"";if(aE(t))return sE?sE.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var lE=function(e){return null==e?"":cE(e)};var fE=function(e){return function(t){t=lE(t);var n=WS(t)?iE(t):void 0,r=n?n[0]:t.charAt(0),i=n?GS(n,1).join(""):t.slice(1);return r[e]()+i}}("toUpperCase");var hE=function(e){return fE(lE(e).toLowerCase())};var dE=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n};var pE=function(e){return function(t){return null==e?void 0:e[t]}}({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),vE=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gE=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var mE=function(e){return(e=lE(e))&&e.replace(vE,pE).replace(gE,"")},yE=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var bE=function(e){return e.match(yE)||[]},_E=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var xE=function(e){return _E.test(e)},SE="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",EE="["+SE+"]",AE="\\d+",wE="[\\u2700-\\u27bf]",TE="[a-z\\xdf-\\xf6\\xf8-\\xff]",CE="[^\\ud800-\\udfff"+SE+AE+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",kE="(?:\\ud83c[\\udde6-\\uddff]){2}",ME="[\\ud800-\\udbff][\\udc00-\\udfff]",IE="[A-Z\\xc0-\\xd6\\xd8-\\xde]",OE="(?:"+TE+"|"+CE+")",PE="(?:"+IE+"|"+CE+")",RE="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",LE="[\\ufe0e\\ufe0f]?"+RE+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",kE,ME].join("|")+")[\\ufe0e\\ufe0f]?"+RE+")*"),NE="(?:"+[wE,kE,ME].join("|")+")"+LE,DE=RegExp([IE+"?"+TE+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[EE,IE,"$"].join("|")+")",PE+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[EE,IE+OE,"$"].join("|")+")",IE+"?"+OE+"+(?:['](?:d|ll|m|re|s|t|ve))?",IE+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",AE,NE].join("|"),"g");var jE=function(e){return e.match(DE)||[]};var FE=function(e,t,n){return e=lE(e),void 0===(t=n?void 0:t)?xE(e)?jE(e):bE(e):e.match(t)||[]},zE=RegExp("[']","g");var UE,BE,VE,GE,HE,WE,qE,XE,ZE,YE,KE,QE,JE,$E,eA,tA,nA,rA,iA,oA=function(e){return function(t){return dE(FE(mE(t).replace(zE,"")),e,"")}}((function(e,t,n){return t=t.toLowerCase(),e+(n?hE(t):t)})),aA=(UE=Q(),BE=J(nr.IShaderModuleService),UE((HE=ho((GE=function(){function t(){Gi(this,t),fo(this,"shaderModuleService",HE,this),this.rendererService=void 0,this.config=void 0,this.quad=BS,this.enabled=!0,this.renderToScreen=!1,this.model=void 0,this.name=void 0,this.optionsToUpdate={}}return Wi(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return e.PassType.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(nr.IRendererService);var r=this.rendererService,i=r.createAttribute,o=r.createBuffer,a=r.createModel,u=this.setupShaders(),s=u.vs,c=u.fs,l=u.uniforms;this.model=a({vs:s,fs:c,attributes:{a_Position:i({buffer:o({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:Zi(Zi({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e){var t=this,n=e.multiPassRenderer.getPostProcessor(),r=this.rendererService,i=r.useFramebuffer,o=r.getViewportSize,a=r.clear,u=o(),s=u.width,c=u.height;i(this.renderToScreen?null:n.getWriteFBO(),(function(){a({framebuffer:n.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),t.model.draw({uniforms:Zi({u_Texture:n.getReadFBO(),u_ViewportSize:[s,c]},t.convertOptionsToUniforms(t.optionsToUpdate))})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=Zi(Zi({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){Yb(e[n])||(t["u_".concat(fE(oA(n)))]=e[n])})),t}}]),t}()).prototype,"shaderModuleService",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VE=GE))||VE),uA=Q()(WE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:BS,fs:US});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:Zi(Zi({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Yb(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(aA))||WE,sA=Q()(qE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:BS,fs:US});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:Zi(Zi({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Yb(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(aA))||qE,cA=Q()(XE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:BS,fs:'varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n#pragma include "common"\nfloat scale = PI / u_Size;\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\nfloat s = sin(u_Angle), c = cos(u_Angle);\nvec2 tex = texCoord * texSize - u_Center * texSize;\nvec2 point = vec2(\nc * tex.x - s * tex.y,\ns * tex.x + c * tex.y\n) * scale;\nreturn (sin(point.x) * sin(point.y)) * 4.0;\n}\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\nvec3 cmy = 1.0 - color.rgb;\nfloat k = min(cmy.x, min(cmy.y, cmy.z));\ncmy = (cmy - k) / (1.0 - k);\ncmy = clamp(\ncmy * 10.0 - 3.0 + vec3(\npattern(u_Angle + 0.26179, texSize, texCoord),\npattern(u_Angle + 1.30899, texSize, texCoord),\npattern(u_Angle, texSize, texCoord)\n),\n0.0,\n1.0\n);\nk = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\nreturn vec4(1.0 - cmy - k, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:Zi(Zi({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(aA))||XE,lA="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",fA=Q()(ZE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:BS,fs:lA}),this.shaderModuleService.getModule("copy-pass")}}]),n}(aA))||ZE,hA=Q()(YE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:BS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\ntex.y /= 0.866025404;\ntex.x -= tex.y * 0.5;\nvec2 a;\nif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\na = vec2(floor(tex.x), floor(tex.y));\n}\nelse a = vec2(ceil(tex.x), ceil(tex.y));\nvec2 b = vec2(ceil(tex.x), floor(tex.y));\nvec2 c = vec2(floor(tex.x), ceil(tex.y));\nvec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\nvec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\nvec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\nvec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\nfloat alen = length(TEX - A);\nfloat blen = length(TEX - B);\nfloat clen = length(TEX - C);\nvec2 choice;\nif (alen < blen) {\nif (alen < clen) choice = a;\nelse choice = c;\n} else {\nif (blen < clen) choice = b;\nelse choice = c;\n}\nchoice.x += choice.y * 0.5;\nchoice.y *= 0.866025404;\nchoice *= u_Scale / texSize;\nreturn texture2D(texture, choice + u_Center);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:Zi(Zi({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(aA))||YE,dA=Q()(KE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:BS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 dx = vec2(1.0 / texSize.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / texSize.y);\nvec4 color = texture2D(texture, texCoord);\nfloat bigTotal = 0.0;\nfloat smallTotal = 0.0;\nvec3 bigAverage = vec3(0.0);\nvec3 smallAverage = vec3(0.0);\nfor (float x = -2.0; x <= 2.0; x += 1.0) {\nfor (float y = -2.0; y <= 2.0; y += 1.0) {\nvec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\nbigAverage += sample;\nbigTotal += 1.0;\nif (abs(x) + abs(y) < 2.0) {\nsmallAverage += sample;\nsmallTotal += 1.0;\n}\n}\n}\nvec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\nfloat power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\nreturn vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:t,fs:n,uniforms:Zi(Zi({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(aA))||KE,pA=Q()(QE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:BS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\nfloat diff = (rand(texCoord) - 0.5) * u_Amount;\ncolor.r += diff;\ncolor.g += diff;\ncolor.b += diff;\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(aA))||QE,vA=Q()(JE=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:BS,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nvec4 sepia_filterColor(vec4 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\ncolor.r =\nmin(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\ncolor.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\ncolor.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(aA))||JE,gA=Te.f,mA=oe((function(){gA(1)}));Ot({target:"Object",stat:!0,forced:!ae||mA,sham:!ae},{getOwnPropertyDescriptor:function(e,t){return gA(ge(e),t)}});var yA,bA,_A,xA,SA,EA,AA,wA,TA=($E=Q(),eA=J(nr.IRendererService),tA=$(),$E((iA=ho((rA=function(){function t(){Gi(this,t),fo(this,"rendererService",iA,this),this.passes=[],this.readFBO=void 0,this.writeFBO=void 0}var n;return Wi(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:(n=Vi(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=10;break}return(r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),e.next=6,r.render(t);case 6:n!==this.passes.length-1&&this.swap();case 7:n++,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),t}()).prototype,"rendererService",[eA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho(rA.prototype,"init",[tA],Object.getOwnPropertyDescriptor(rA.prototype,"init"),rA.prototype),nA=rA))||nA),CA=Q()(yA=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){oo(Ki(r.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}))}}]),r}(DS))||yA;function kA(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var MA=1,IA=(bA=Q(),_A=J(nr.IShaderModuleService),xA=J(nr.ILogService),bA((AA=ho((EA=function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return fo(e=n.call.apply(n,[this].concat(i)),"shaderModuleService",AA,no(e)),fo(e,"logger",wA,no(e)),e.haltonSequence=[],e.accumulatingId=0,e.frame=0,e.timer=void 0,e.sampleRenderTarget=void 0,e.prevRenderTarget=void 0,e.outputRenderTarget=void 0,e.copyRenderTarget=void 0,e.blendModel=void 0,e.outputModel=void 0,e.copyModel=void 0,e}return Wi(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,n){oo(Ki(r.prototype),"init",this).call(this,t,n);var i=this.rendererService,o=i.createFramebuffer,a=i.createTexture2D;this.sampleRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=o({color:a({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})});for(var u=0;u<30;u++)this.haltonSequence.push([kA(u,2),kA(u,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\nvarying vec2 v_UV;\nvoid main() {\nvec4 texel1 = texture2D(u_Diffuse1, v_UV);\nvec4 texel2 = texture2D(u_Diffuse2, v_UV);\ngl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}"),this.outputModel=this.createTriangleModel("copy-pass",lA,{blend:{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:e.gl.ONE,dstAlpha:e.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:e.gl.FUNC_ADD,alpha:e.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",lA)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),u=a.width,s=a.height;this.sampleRenderTarget.resize({width:u,height:s}),this.prevRenderTarget.resize({width:u,height:s}),this.outputRenderTarget.resize({width:u,height:s}),this.copyRenderTarget.resize({width:u,height:s}),this.resetFrame(),this.stopAccumulating();var c=e.multiPassRenderer.getPostProcessor().getReadFBO();o(c,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));this.accumulatingId=MA++,this.timer=window.setTimeout((function(){!function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),requestAnimationFrame((function(){n(r)}))))}(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),u=a.width,s=a.height,c=e.getLayerConfig().jitterScale,l=void 0===c?1:c,f=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*f[0]-1)/u*l,(2*f[1]-1)/s*l),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var h=e.getLayerConfig();o(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:h.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),o(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var d=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=d,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,n,r){this.shaderModuleService.registerModule(t,{vs:BS,fs:n});var i=this.shaderModuleService.getModule(t),o=i.vs,a=i.fs,u=i.uniforms,s=this.rendererService,c=s.createAttribute,l=s.createBuffer;return(0,s.createModel)(Zi({vs:o,fs:a,attributes:{a_Position:c({buffer:l({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:Zi({},u),depth:{enable:!1},count:3},r))}}]),r}(DS)).prototype,"shaderModuleService",[_A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wA=ho(EA.prototype,"logger",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SA=EA))||SA),OA=new K;OA.bind(nr.IGlobalConfigService).to(Ry).inSingletonScope(),OA.bind(nr.IShaderModuleService).to(AS).inSingletonScope(),OA.bind(nr.ILogService).to(O_).inSingletonScope(),ee(Q(),u),OA.bind(nr.IEventEmitter).to(u);var PA=ne(OA,!1),RA=function(e){var t=PA.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},LA=0;function NA(){var e=new K;return e.parent=OA,e.bind(nr.SceneID).toConstantValue("".concat(LA++)),e.bind(nr.ILayerService).to(Lb).inSingletonScope(),e.bind(nr.ISceneService).to(Zx).inSingletonScope(),e.bind(nr.ICameraService).to(eg).inSingletonScope(),e.bind(nr.ICoordinateSystemService).to(ab).inSingletonScope(),e.bind(nr.IInteractionService).to(cb).inSingletonScope(),e.bind(nr.IPickingService).to(Pb).inSingletonScope(),e.bind(nr.IControlService).to(tg).inSingletonScope(),e.bind(nr.IMarkerService).to(ng).inSingletonScope(),e.bind(nr.IIconService).to(Wp).inSingletonScope(),e.bind(nr.IFontService).to(Sd).inSingletonScope(),e.bind(nr.IPopupService).to(rg).inSingletonScope(),e.bind(nr.INormalPass).to(jS).whenTargetNamed("clear"),e.bind(nr.INormalPass).to(zS).whenTargetNamed("pixelPicking"),e.bind(nr.INormalPass).to(CA).whenTargetNamed("render"),e.bind(nr.INormalPass).to(IA).whenTargetNamed("taa"),e.bind(nr.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(nr.INormalPass,t)}})),e.bind(nr.IPostProcessingPass).to(fA).whenTargetNamed("copy"),e.bind(nr.IPostProcessingPass).to(uA).whenTargetNamed("blurH"),e.bind(nr.IPostProcessingPass).to(sA).whenTargetNamed("blurV"),e.bind(nr.IPostProcessingPass).to(pA).whenTargetNamed("noise"),e.bind(nr.IPostProcessingPass).to(vA).whenTargetNamed("sepia"),e.bind(nr.IPostProcessingPass).to(cA).whenTargetNamed("colorHalftone"),e.bind(nr.IPostProcessingPass).to(hA).whenTargetNamed("hexagonalPixelate"),e.bind(nr.IPostProcessingPass).to(dA).whenTargetNamed("ink"),e.bind(nr.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(nr.IPostProcessingPass,t);return n.setName(t),n}})),e}function DA(e){var t=new K;return t.parent=e,t.bind(nr.IStyleAttributeService).to(Jb).inSingletonScope(),t.bind(nr.IMultiPassRenderer).to(FS).inSingletonScope(),t.bind(nr.IPostProcessor).to(TA).inSingletonScope(),t}var jA=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e},FA=/^\s+|\s+$/g,zA=/^[-+]0x[0-9a-f]+$/i,UA=/^0b[01]+$/i,BA=/^0o[0-7]+$/i,VA=parseInt;var GA=function(e){if("number"==typeof e)return e;if(aE(e))return NaN;if(Og(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Og(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(FA,"");var n=UA.test(e);return n||BA.test(e)?VA(e.slice(2),n?2:8):zA.test(e)?NaN:+e};var HA=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=GA(n))==n?n:0),void 0!==t&&(t=(t=GA(t))==t?t:0),jA(GA(e),t,n)},WA=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function qA(e){return WA.indexOf(e)}var XA,ZA,YA,KA;function QA(e,t){return 256*(e=HA(Math.floor(e),0,255))+(t=HA(Math.floor(t),0,255))}(XA=e.BlendType||(e.BlendType={})).normal="normal",XA.additive="additive",XA.subtractive="subtractive",XA.min="min",XA.max="max",(ZA=e.ScaleTypes||(e.ScaleTypes={})).LINEAR="linear",ZA.POWER="power",ZA.LOG="log",ZA.IDENTITY="identity",ZA.TIME="time",ZA.QUANTILE="quantile",ZA.QUANTIZE="quantize",ZA.THRESHOLD="threshold",ZA.CAT="cat",(YA=e.StyleScaleType||(e.StyleScaleType={})).CONSTANT="constant",YA.VARIABLE="variable",(KA=e.AttributeType||(e.AttributeType={}))[KA.Attribute=0]="Attribute",KA[KA.InstancedAttribute=1]="InstancedAttribute",KA[KA.Uniform=2]="Uniform";var JA,$A=["mapload"],ew={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},tw=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];!function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"}(e.PositionType||(e.PositionType={})),function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"}(JA||(JA={}));var nw=0,rw=function(e){Yi(n,e);var t=io(n);function n(e){var r;return Gi(this,n),(r=t.call(this)).controlOption=void 0,r.container=void 0,r.sceneContainer=void 0,r.mapsService=void 0,r.renderService=void 0,r.layerService=void 0,r.controlService=void 0,r.isShow=void 0,r.controlOption=Zi(Zi({},r.getDefault()),e||{}),r}return Wi(n,[{key:"getDefault",value:function(){return{position:JA.TOPRIGHT,name:"".concat(nw++)}}},{key:"setPosition",value:function(e){var t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(e){this.mapsService=e.get(nr.IMapService),this.renderService=e.get(nr.IRendererService),this.layerService=e.get(nr.ILayerService),this.controlService=e.get(nr.IControlService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd();var t=this.container,n=this.controlOption.position,r=this.controlService.controlCorners[n];return Ta(t,"l7-control"),-1!==n.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){Ta(this.container,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){Ca(this.container,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;wa(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}}]),n}(u),iw=function(t){Yi(r,t);var n=io(r);function r(e){var t;return Gi(this,r),(t=n.call(this,e)).layerControlInputs=void 0,t.layers=void 0,t.lastZIndex=void 0,t.handlingClick=void 0,t.layersLink=void 0,t.baseLayersList=void 0,t.separator=void 0,t.overlaysList=void 0,t.form=void 0,t.layerControlInputs=[],t.layers=[],t.lastZIndex=0,t.handlingClick=!1,t.initLayers(),lh(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],no(t)),t}return Wi(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:e.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var e=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach((function(t){t.layer.on("remove",e.onLayerChange),t.layer.on("add",e.onLayerChange)})),this.container}},{key:"addVisualLayer",value:function(e,t){return this.addLayer(e,t,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var e=this.renderService.getViewportSize().height;Ta(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var t=e-(this.container.offsetTop+50);return t<this.form.clientHeight?(Ta(this.form,"l7-control-layers-scrollbar"),this.form.style.height=t+"px"):Ca(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ca(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var e=this;this.mapsService&&(this.mapsService.off("click",this.collapse),this.layers.forEach((function(t){t.layer.off("remove",e.onLayerChange),t.layer.off("add",e.onLayerChange)})))}},{key:"initLayout",value:function(){var e="l7-control-layers",t=this.container=Aa("div",e),n=this.controlOption.collapsed;t.setAttribute("aria-haspopup","true");var r=this.form=Aa("form",e+"-list");n&&(this.mapsService.on("click",this.collapse),t.addEventListener("mouseenter",this.expand),t.addEventListener("mouseleave",this.collapse)),this.layersLink=Aa("a",e+"-toggle",t),this.layersLink.title="Layers",n||this.expand(),this.baseLayersList=Aa("div",e+"-base",r),this.separator=Aa("div",e+"-separator",r),this.overlaysList=Aa("div",e+"-overlays",r),t.appendChild(r)}},{key:"initLayers",value:function(){var e=this,t=this.controlOption,n=t.baseLayers,r=void 0===n?{}:n,i=t.overlayers,o=void 0===i?{}:i;Object.keys(r).forEach((function(t,n){e.addLayer(r[t],t,!1)})),Object.keys(o).forEach((function(t,n){e.addLayer(o[t],t,!0)}))}},{key:"update",value:function(){if(!this.container)return this;var e,t,n,r;Oa(this.baseLayersList),Oa(this.overlaysList),this.layerControlInputs=[];var i=0;for(n=0;n<this.layers.length;n++)r=this.layers[n],this.addItem(r),t=t||r.overlay,e=e||!r.overlay,i+=r.overlay?0:1;return this.controlOption.hideSingleBase&&(e=e&&i>1,this.baseLayersList.style.display=e?"":"none"),this.separator.style.display=t&&e?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var e,t,n=this.layerControlInputs,r=this.mapsService.getZoom(),i=n.length-1;i>=0;i--)if(e=n[i],(t=this.layerService.getLayer(e.layerId))&&t.inited){var o=t.getMinZoom(),a=t.getMaxZoom();e.disabled=r<o||r>a}}},{key:"addLayer",value:function(e,t,n){this.mapsService&&(e.on("add",this.onLayerChange),e.on("remove",this.onLayerChange)),this.layers.push({layer:e,name:t,overlay:n});var r=this.controlOption,i=r.sortLayers,o=r.sortFunction,a=r.autoZIndex;i&&this.layers.sort((function(e,t){return o(e.layer,t.layer,e.name,t.name)})),a&&e.setZIndex&&(this.lastZIndex++,e.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(e){this.handlingClick||this.update();var t=this.layerService.getLayer(e.target.layerId),n=(null==t?void 0:t.overlay)?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this.emit(n,t)}},{key:"createRadioElement",value:function(e,t){var n='<input type="radio" class="l7-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild}},{key:"addItem",value:function(e){var t,n=document.createElement("label"),r=this.layerService.getLayer(e.layer.id),i=r&&r.inited&&e.layer.isVisible();e.overlay?((t=document.createElement("input")).type="checkbox",t.className="l7-control-layers-selector",t.defaultChecked=i):t=this.createRadioElement("l7-base-layers",i),this.layerControlInputs.push(t),t.layerId=e.layer.id,t.addEventListener("click",this.onInputClick);var o=document.createElement("span");o.innerHTML=" "+e.name;var a=document.createElement("div");return n.appendChild(a),a.appendChild(t),a.appendChild(o),(e.overlay?this.overlaysList:this.baseLayersList).appendChild(n),this.checkDisabledLayers(),n}},{key:"onInputClick",value:function(){var e,t,n=this.layerControlInputs,r=[],i=[];this.handlingClick=!0;for(var o=n.length-1;o>=0;o--)e=n[o],t=this.layerService.getLayer(e.layerId),e.checked?r.push(t):e.checked||i.push(t);i.forEach((function(e){e.hide()})),r.forEach((function(e){e.show()})),this.handlingClick=!1}}]),r}(rw),ow=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"getDefault",value:function(){return{position:JA.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var e=Aa("div","l7-control-logo"),t=Aa("a","l7-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://antv.alipay.com/l7",t.setAttribute("aria-label","AntV logo"),t.setAttribute("rel","noopener nofollow"),e.appendChild(t),e}},{key:"onRemove",value:function(){return null}}]),n}(rw),aw=function(e){Yi(n,e);var t=io(n);function n(e){var r;return Gi(this,n),(r=t.call(this,e)).mScale=void 0,r.iScale=void 0,lh(["update"],no(r)),r}return Wi(n,[{key:"getDefault",value:function(){return{position:JA.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var e=Aa("div","l7-control-scale");this.addScales("l7-control-scale-line",e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),this.update(),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var e=this.mapsService,t=this.controlOption.maxWidth,n=e.getSize()[1]/2,r=e.containerToLngLat([0,n]),i=e.containerToLngLat([t,n]),o=$f([r.lng,r.lat],[i.lng,i.lat]);this.updateScales(o)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"addScales",value:function(e,t){var n=this.controlOption,r=n.metric,i=n.imperial;r&&(this.mScale=Aa("div",e,t)),i&&(this.iScale=Aa("div",e,t))}}]),n}(rw),uw=function(e){Yi(n,e);var t=io(n);function n(e){var r;return Gi(this,n),(r=t.call(this,e)).disabled=void 0,r.zoomInButton=void 0,r.zoomOutButton=void 0,lh(["updateDisabled","zoomIn","zoomOut"],no(r)),r}return Wi(n,[{key:"getDefault",value:function(){return{position:JA.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var e=Aa("div","l7-control-zoom l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-control-zoom-in",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-control-zoom-out",e,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(e,t,n,r,i){var o=Aa("a",n,r);return o.innerHTML=e,o.title=t,o.href="javascript:void(0)",o.addEventListener("click",i),o}},{key:"updateDisabled",value:function(){var e=this.mapsService;Ca(this.zoomInButton,"l7-disabled"),Ca(this.zoomOutButton,"l7-disabled"),(this.disabled||e.getZoom()<=e.getMinZoom())&&Ta(this.zoomOutButton,"l7-disabled"),(this.disabled||e.getZoom()>=e.getMaxZoom())&&Ta(this.zoomInButton,"l7-disabled")}}]),n}(rw),sw=/"/g,cw=function(e,t,n,r){var i=String(ve(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+String(r).replace(sw,"&quot;")+'"'),o+">"+i+"</"+t+">"},lw=function(e){return oe((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))};Ot({target:"String",proto:!0,forced:lw("anchor")},{anchor:function(e){return cw(this,"a","name",e)}});var fw=function(t){Yi(r,t);var n=io(r);function r(e){var t;return Gi(this,r),(t=n.call(this)).markerOption=void 0,t.defaultMarker=void 0,t.popup=void 0,t.mapsService=void 0,t.lngLat=void 0,t.scene=void 0,t.added=!1,t.eventHandle=function(e){t.emit(e.type,{target:e,data:t.markerOption.extData,lngLat:t.lngLat})},t.markerOption=Zi(Zi({},t.getDefault()),e),lh(["update","onMove","onUp","addDragHandler","onMapClick"],no(t)),t.init(),t}return Wi(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:e.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(nr.IMapService);var t=this.markerOption,n=t.element;t.draggable;return this.mapsService.getMarkerContainer().appendChild(n),this.registerMarkerEvent(n),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&wa(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&wa(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),Ra(t,"".concat(Wh[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.getBounds(),u=this.mapsService.getZoom();if((i<a[0][0]||i>a[1][0]||o<a[0][1]||o>a[1][1])&&u>3)t&&(t.style.display="none");else{var s=this.mapsService.lngLatToContainer([i,o]);t&&(t.style.display="block",t.style.left=s.x+n[0]+"px",t.style.top=s.y-n[1]+"px")}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=Aa("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}Ta(t,"l7-marker"),t.addEventListener("click",(function(t){e.onMapClick(t)})),t.addEventListener("click",this.eventHandle),qh(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(e){throw new Error("Method not implemented.")}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),r}(u),hw=o((function(e,t){e.exports=function(){function e(n,r,i,o,a,u){if(!(a-o<=i)){var s=o+a>>1;!function e(n,r,i,o,a,u){for(;a>o;){if(a-o>600){var s=a-o+1,c=i-o+1,l=Math.log(s),f=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*f*(s-f)/s)*(c-s/2<0?-1:1),d=Math.max(o,Math.floor(i-c*f/s+h)),p=Math.min(a,Math.floor(i+(s-c)*f/s+h));e(n,r,i,d,p,u)}var v=r[2*i+u],g=o,m=a;for(t(n,r,o,i),r[2*a+u]>v&&t(n,r,o,a);g<m;){for(t(n,r,g,m),g++,m--;r[2*g+u]<v;)g++;for(;r[2*m+u]>v;)m--}r[2*o+u]===v?t(n,r,o,m):(m++,t(n,r,m,a)),m<=i&&(o=m+1),i<=m&&(a=m-1)}}(n,r,s,o,a,u%2),e(n,r,i,o,s-1,u+1),e(n,r,i,s+1,a,u+1)}}function t(e,t,r,i){n(e,r,i),n(t,2*r,2*i),n(t,2*r+1,2*i+1)}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var i=function(e){return e[0]},o=function(e){return e[1]},a=function(t,n,r,a,u){void 0===n&&(n=i),void 0===r&&(r=o),void 0===a&&(a=64),void 0===u&&(u=Float64Array),this.nodeSize=a,this.points=t;for(var s=t.length<65536?Uint16Array:Uint32Array,c=this.ids=new s(t.length),l=this.coords=new u(2*t.length),f=0;f<t.length;f++)c[f]=f,l[2*f]=n(t[f]),l[2*f+1]=r(t[f]);e(c,l,a,0,c.length-1,0)};a.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var u,s,c=[0,e.length-1,0],l=[];c.length;){var f=c.pop(),h=c.pop(),d=c.pop();if(h-d<=a)for(var p=d;p<=h;p++)u=t[2*p],s=t[2*p+1],u>=n&&u<=i&&s>=r&&s<=o&&l.push(e[p]);else{var v=Math.floor((d+h)/2);u=t[2*v],s=t[2*v+1],u>=n&&u<=i&&s>=r&&s<=o&&l.push(e[v]);var g=(f+1)%2;(0===f?n<=u:r<=s)&&(c.push(d),c.push(v-1),c.push(g)),(0===f?i>=u:o>=s)&&(c.push(v+1),c.push(h),c.push(g))}}return l}(this.ids,this.coords,e,t,n,r,this.nodeSize)},a.prototype.within=function(e,t,n){return function(e,t,n,i,o,a){for(var u=[0,e.length-1,0],s=[],c=o*o;u.length;){var l=u.pop(),f=u.pop(),h=u.pop();if(f-h<=a)for(var d=h;d<=f;d++)r(t[2*d],t[2*d+1],n,i)<=c&&s.push(e[d]);else{var p=Math.floor((h+f)/2),v=t[2*p],g=t[2*p+1];r(v,g,n,i)<=c&&s.push(e[p]);var m=(l+1)%2;(0===l?n-o<=v:i-o<=g)&&(u.push(h),u.push(p-1),u.push(m)),(0===l?n+o>=v:i+o>=g)&&(u.push(p+1),u.push(f),u.push(m))}}return s}(this.ids,this.coords,e,t,n,this.nodeSize)};var u={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},s=function(e){this.options=v(Object.create(u),e),this.trees=new Array(this.options.maxZoom+1)};function c(e,t,n,r,i){return{x:e,y:t,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function l(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:d(r),y:p(i),zoom:1/0,index:t,parentId:-1}}function f(e){return{type:"Feature",id:e.id,properties:h(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function h(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return v(v({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function d(e){return e/360+.5}function p(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function v(e,t){for(var n in t)e[n]=t[n];return e}function g(e){return e.x}function m(e){return e.y}return s.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var u="prepare "+e.length+" points";n&&console.time(u),this.points=e;for(var s=[],c=0;c<e.length;c++)e[c].geometry&&s.push(l(e[c],c));this.trees[i+1]=new a(s,g,m,o,Float32Array),n&&console.timeEnd(u);for(var f=i;f>=r;f--){var h=+Date.now();s=this._cluster(s,f),this.trees[f]=new a(s,g,m,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",f,s.length,+Date.now()-h)}return n&&console.timeEnd("total time"),this},s.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),u=this.getClusters([-180,r,i,o],t);return a.concat(u)}for(var s=this.trees[this._limitZoom(t)],c=[],l=0,h=s.range(d(n),p(o),d(i),p(r));l<h.length;l+=1){var v=h[l],g=s.points[v];c.push(g.numPoints?f(g):this.points[g.index])}return c},s.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=[],s=0,c=i.within(o.x,o.y,a);s<c.length;s+=1){var l=c[s],h=i.points[l];h.parentId===e&&u.push(h.numPoints?f(h):this.points[h.index])}if(0===u.length)throw new Error(r);return u},s.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},s.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,u=o.radius/a,s=(n-u)/i,c=(n+1+u)/i,l={features:[]};return this._addTileFeatures(r.range((t-u)/i,s,(t+1+u)/i,c),r.points,t,n,i,l),0===t&&this._addTileFeatures(r.range(1-u/i,s,1,c),r.points,i,n,i,l),t===i-1&&this._addTileFeatures(r.range(0,s,u/i,c),r.points,-1,n,i,l),l.features.length?l:null},s.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},s.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var u=a[o],s=u.properties;if(s&&s.cluster?i+s.point_count<=r?i+=s.point_count:i=this._appendLeaves(e,s.cluster_id,n,r,i):i<r?i++:e.push(u),e.length===n)break}return i},s.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,u=e;a<u.length;a+=1){var s=t[u[a]],c=s.numPoints,l={type:1,geometry:[[Math.round(this.options.extent*(s.x*i-n)),Math.round(this.options.extent*(s.y*i-r))]],tags:c?h(s):this.points[s.index].properties},f=void 0;c?f=s.id:this.options.generateId?f=s.index:this.points[s.index].id&&(f=this.points[s.index].id),void 0!==f&&(l.id=f),o.features.push(l)}},s.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(e,this.options.maxZoom+1))},s.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,u=i/(o*Math.pow(2,t)),s=0;s<e.length;s++){var l=e[s];if(!(l.zoom<=t)){l.zoom=t;for(var f=this.trees[t+1],h=f.within(l.x,l.y,u),d=l.numPoints||1,p=l.x*d,v=l.y*d,g=a&&d>1?this._map(l,!0):null,m=(s<<5)+(t+1)+this.points.length,y=0,b=h;y<b.length;y+=1){var _=b[y],x=f.points[_];if(!(x.zoom<=t)){x.zoom=t;var S=x.numPoints||1;p+=x.x*S,v+=x.y*S,d+=S,x.parentId=m,a&&(g||(g=this._map(l,!0)),a(g,this._map(x)))}}1===d?n.push(l):(l.parentId=m,n.push(c(p/d,v/d,m,d,g)))}}return n},s.prototype._getOriginId=function(e){return e-this.points.length>>5},s.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},s.prototype._map=function(e,t){if(e.numPoints)return t?v({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?v({},r):r},s}()})),dw=function(e){Yi(n,e);var t=io(n);function n(e){var r,i;return Gi(this,n),(i=t.call(this)).markers=[],i.markerLayerOption=void 0,i.clusterIndex=void 0,i.points=[],i.clusterMarkers=[],i.mapsService=void 0,i.scene=void 0,i.zoom=void 0,i.bbox=void 0,i.markerLayerOption=My(i.getDefault(),e),lh(["update"],no(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return Wi(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(nr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(e){this.markerLayerOption.cluster&&this.addPoint(e,this.markers.length),this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:Zi(Zi({},e.getExtData()),{},{marker_id:t})};this.points.push(r)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new hw({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(e.properties&&(null===(t=e.properties)||void 0===t?void 0:t.cluster_id)){var a,u=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=u,i&&o){var s=od(o,id(null==u?void 0:u.map((function(e){return qi({},i,e.properties[i])})),i)),c="point_"+o;e.properties[c]=s.toFixed(2)}}var l=n.clusterMarker(e);n.clusterMarkers.push(l),l.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new fw({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!th(this.bbox,t))&&(this.bbox=eh(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(e){var t=Aa("div","l7-marker-cluster"),n=Aa("div","",t),r=Aa("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var u=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=u,t}}]),n}(u),pw=function(t){Yi(r,t);var n=io(r);function r(e){var t;return Gi(this,r),(t=n.call(this)).popupOption=void 0,t.mapsService=void 0,t.lngLat=void 0,t.content=void 0,t.closeButton=void 0,t.timeoutInstance=void 0,t.container=void 0,t.tip=void 0,t.scene=void 0,t.popupOption=Zi(Zi({},t.getdefault()),e),lh(["update","onClickClose","remove"],no(t)),t}return Wi(r,[{key:"addTo",value:function(e){var t=this;return this.mapsService=e.get(nr.IMapService),this.mapsService.on("camerachange",this.update),this.scene=e,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout((function(){t.mapsService.on("click",t.onClickClose)}),30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(e){var t,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for(r.innerHTML=e;t=r.firstChild;)n.appendChild(t);return this.setDOMContent(n)}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(e){return this.setDOMContent(window.document.createTextNode(e))}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"setDOMContent",value:function(e){return this.createContent(),this.content.appendChild(e),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&wa(this.content),this.content=Aa("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Aa("button","l7-popup-close-button",this.content),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r}},{key:"removeDom",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:e.anchorType.BOTTOM,className:""}}},{key:"onClickClose",value:function(e){e.stopPropagation&&e.stopPropagation(),this.remove()}},{key:"update",value:function(){var e=this,t=this.lngLat,n=this.popupOption,r=n.className,i=n.maxWidth,o=n.anchor;if(this.mapsService&&t&&this.content){var a=this.mapsService.getMarkerContainer();!this.container&&a&&(this.container=this.creatDom("div","l7-popup",a.parentNode),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),r&&r.split(" ").forEach((function(t){return e.container.classList.add(t)})),["mousemove","mousedown","mouseup","click"].forEach((function(t){e.container.addEventListener(t,(function(e){e.stopPropagation()}))}))),i&&this.container.style.maxWidth!==i&&(this.container.style.maxWidth=i),this.updatePosition(),Ra(this.container,"".concat(Wh[o])),qh(this.container,o,"popup")}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.lngLat,t=e.lng,n=e.lat,r=this.popupOption.offsets,i=this.mapsService.lngLatToContainer([t,n]);this.container.style.left=i.x+r[0]+"px",this.container.style.top=i.y-r[1]+"px"}}}]),r}(u);function vw(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}vw('.l7-marker-container {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  position: absolute;\n }\n\n.l7-marker {\n\tposition: absolute !important;\n\ttop: 0;\n\tleft: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n\n.l7-marker-cluster {\n  background-clip: padding-box;\n  border-radius: 20px;\n  background-color: rgba(181, 226, 140, 0.6);\n  width: 40px;\n  height: 40px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-left: 5px;\n  margin-top: 5px;\n  text-align: center;\n  border-radius: 15px;\n  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;\n  background-color: rgba(110, 204, 57, 0.6);\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n\n.l7-popup-anchor-bottom,\n.l7-popup-anchor-bottom-left,\n.l7-popup-anchor-bottom-right {\n    -webkit-flex-direction: column-reverse;\n    flex-direction: column-reverse;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n\t/* layers control */\n\n.l7-control-layers {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.4);\n\tbackground: #fff;\n\tborder-radius: 5px;\n\t}\n.l7-popup-anchor-top,\n.l7-popup-anchor-top-left,\n.l7-popup-anchor-top-right {\n    -webkit-flex-direction: column;\n    flex-direction: column;\n}\n\n\n.l7-popup-anchor-left {\n    -webkit-flex-direction: row;\n    flex-direction: row;\n}\n\n.l7-popup-anchor-right {\n    -webkit-flex-direction: row-reverse;\n    flex-direction: row-reverse;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: -webkit-flex;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n  z-index: 5;\n}\n.l7-popup-tip {\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n  z-index: 1;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-top: none;\n\tborder-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-left .l7-popup-tip {\n\t-webkit-align-self: flex-start;\n\talign-self: flex-start;\n\tborder-top: none;\n\tborder-left: none;\n\tborder-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-right .l7-popup-tip {\n\t-webkit-align-self: flex-end;\n\talign-self: flex-end;\n\tborder-top: none;\n\tborder-right: none;\n\tborder-bottom-color: #fff;\n}\n\n.l7-popup-anchor-bottom .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-bottom: none;\n\tborder-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n\t-webkit-align-self: flex-start;\n\talign-self: flex-start;\n\tborder-bottom: none;\n\tborder-left: none;\n\tborder-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n\t-webkit-align-self: flex-end;\n\talign-self: flex-end;\n\tborder-bottom: none;\n\tborder-right: none;\n\tborder-top-color: #fff;\n}\n\n.l7-popup-anchor-left .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-left: none;\n\tborder-right-color: #fff;\n}\n\n.l7-popup-anchor-right .l7-popup-tip {\n\t-webkit-align-self: center;\n\talign-self: center;\n\tborder-right: none;\n\tborder-left-color: #fff;\n}\n\n.l7-popup-close-button {\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\tborder: 0;\n\tpadding: 0;\n\tfont-size: 25px;\n\tline-height: 20px;\n\tborder-radius: 0 3px 0 0;\n\tcursor: pointer;\n\tbackground-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n\tbackground-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n\tposition: relative;\n\tbackground: #fff;\n\tborder-radius: 3px;\n\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n\tpadding: 10px 10px 15px;\n\tpointer-events: auto;\n}\n\n.l7-popup-anchor-top-left .l7-popup-content {\n\tborder-top-left-radius: 0;\n}\n\n.l7-popup-anchor-top-right .l7-popup-content {\n\tborder-top-right-radius: 0;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-content {\n\tborder-bottom-left-radius: 0;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-content {\n\tborder-bottom-right-radius: 0;\n}\n\n.l7-popup-track-pointer {\n\tdisplay: none;\n}\n\n.l7-popup-track-pointer * {\n\tpointer-events: none;\n\tuser-select: none;\n}\n\n.l7-map:hover .l7-popup-track-pointer {\n\tdisplay: flex;\n}\n\n.l7-map:active .l7-popup-track-pointer {\n\tdisplay: none;\n}\n\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* general toolbar styles */\n\n.l7-bar {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.65);\n\tborder-radius: 4px;\n\t}\n.l7-bar a,\n.l7-bar a:hover {\n\tbackground-color: #fff;\n\twidth: 30px;\n\theight: 30px;\n  font-size: 20px;\n\tdisplay: block;\n\ttext-align: center;\n\ttext-decoration: none;\n\tcolor: #8E9DAB;\n\t}\n.l7-bar a,\n.l7-control-layers-toggle {\n\tbackground-position: 50% 50%;\n\tbackground-repeat: no-repeat;\n\tdisplay: block;\n\t}\n.l7-bar a:hover {\n\tbackground-color: #f4f4f4;\n\t}\n.l7-bar a:first-child {\n\tborder-top-left-radius: 2px;\n\tborder-top-right-radius: 2px;\n\t}\n.l7-bar a:last-child {\n\tborder-bottom-left-radius: 2px;\n\tborder-bottom-right-radius: 2px;\n\tborder-bottom: none;\n\t}\n.l7-bar a.l7-disabled {\n\tcursor: default;\n\tbackground-color: #f4f4f4;\n\tcolor: #bbb;\n\t}\n\n\n/* control positioning */\n\n.l7-control-container {\n\tfont: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;\n}\n.l7-control-hide {\n\tdisplay: none;\n}\n.l7-control {\n\tposition: relative;\n\tz-index: 800;\n\tpointer-events: visiblePainted; /* IE 9-10 doesn\'t have auto */\n\tpointer-events: auto;\n\t}\n.l7-control {\n\tfloat: left;\n\tclear: both;\n\t}.l7-top,\n  .l7-bottom {\n    position: absolute;\n    z-index: 1000;\n    pointer-events: none;\n    }\n  .l7-top {\n    top: 0;\n    }\n  .l7-right {\n    right: 0;\n    }\n  .l7-bottom {\n    bottom: 0;\n    }\n  .l7-left {\n    left: 0;\n    }\n\n  .l7-control {\n    float: left;\n    clear: both;\n    }\n  .l7-right .l7-control {\n    float: right;\n    }\n  .l7-top .l7-control {\n    margin-top: 10px;\n    }\n  .l7-bottom .l7-control {\n    margin-bottom: 10px;\n    }\n  .l7-left .l7-control {\n    margin-left: 10px;\n    }\n  .l7-right .l7-control {\n    margin-right: 10px;\n    }\n\n  /* attribution and scale controls */\n\n.l7-control-container .l7-control-attribution {\n\tbackground: #fff;\n\tbackground: rgba(255, 255, 255, 0.7);\n\tmargin: 0;\n\t}\n.l7-control-attribution,\n.l7-control-scale-line {\n\tpadding: 0 5px;\n  color: #333;\n\t}\n.l7-control-attribution a {\n\ttext-decoration: none;\n\t}\n.l7-control-attribution a:hover {\n\ttext-decoration: underline;\n\t}\n.l7-container .l7-control-attribution,\n.l7-container .l7-control-scale {\n  font-size: 11px;\n  padding: 5px 5px 2px 5px;\n  background: rgba(255, 255, 255, 0.7);\n\t}\n.l7-left .l7-control-scale {\n\tmargin-left: 5px;\n\t}\n.l7-bottom .l7-control-scale {\n\tmargin-bottom: 5px;\n\t}\n.l7-control-scale-line {\n\tborder: 2px solid #000;\n  border-top: none;\n  color: #000;\n\tline-height: 1.1;\n\tpadding: 2px 5px 1px;\n\tfont-size: 11px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\t-moz-box-sizing: border-box;\n\t     box-sizing: border-box;\n\n\tbackground: #fff;\n\t}\n.l7-control-scale-line:not(:first-child) {\n\tborder-top: 2px solid #777;\n\tborder-bottom: none;\n\tmargin-top: -2px;\n\t}\n.l7-control-scale-line:not(:first-child):not(:last-child) {\n\tborder-bottom: 2px solid #777;\n\t}\n\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n\tbox-shadow: none;\n\t}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n\tborder: 2px solid rgba(0,0,0,0.2);\n\tbackground-clip: padding-box;\n  }\n  /*logo */\n\n  .l7-ctrl-logo {\n    background-size: 100% 100%;\n    width: 89px;\n    height: 16px;\n    margin: 0 0 -3px -3px;\n    display: flex;\n    background-repeat: no-repeat;\n    cursor: pointer;\n    background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC\');\n}\n\n\n\t/* layers control */\n\n.l7-control-layers {\n\tbox-shadow: 0 1px 8px rgba(0,0,0,0.4);\n\tbackground: #fff;\n\tborder-radius: 2px;\n\t}\n.l7-control-layers-toggle {\n\tbackground-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC\');\n\twidth: 30px;\n  height: 30px;\n  background-size: 20px 20px;\n\t}\n\n.l7-touch .l7-control-layers-toggle {\n\twidth: 44px;\n\theight: 44px;\n\t}\n.l7-control-layers .l7-control-layers-list,\n.l7-control-layers-expanded .l7-control-layers-toggle {\n\tdisplay: none;\n\t}\n.l7-control-layers-expanded .l7-control-layers-list {\n\tdisplay: block;\n\tposition: relative;\n\t}\n.l7-control-layers-expanded {\n\tpadding: 6px 10px 6px 6px;\n\tcolor: #59626B;\n\tbackground: #fff;\n\t}\n.l7-control-layers-scrollbar {\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n\tpadding-right: 5px;\n\t}\n.l7-control-layers-selector {\n\tmargin-top: 2px;\n\tposition: relative;\n\ttop: 1px;\n\t}\n.l7-control-layers label {\n  display: block;\n  padding: 8px;\n  }\n  .l7-control-layers label input[type="radio"],\n  .l7-control-layers label input[type="checkbox"] {\n  width: 14px;\n  height: 14px;\n  margin: 0;\n}\n.l7-control-layers-separator {\n\theight: 0;\n\tborder-top: 1px solid #D8D8D8;\n\tmargin: 5px -10px 5px -6px;\n}\n.mapboxgl-ctrl-logo {\n  display: none !important;\n }\n .amap-logo{\n  display: none !important;\n }\n\n\n');var gw,mw,yw,bw,_w,xw,Sw,Ew,Aw,ww,Tw,Cw,kw,Mw,Iw=o((function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function n(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function a(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function u(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var s=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function l(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function h(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function p(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function v(e,t){var r=e.split("\n"),i=1,o=0,a={unknown:new l,0:new l};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new f(0,""));for(var u=0;u<r.length;++u){var s=r[u],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(s);if(c)switch(c[1]){case"line":var h=/(\d+)(\s+\d+)?/.exec(c[2]);h&&(i=0|h[1],h[2]&&((o=0|h[2])in a||(a[o]=new l)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);p&&(a[o].name=p[1]?n(p[2]):p[2])}a[o].lines.push(new f(i++,s))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function g(e){e._commandRef=d()}function m(e,t){var n=p();r(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function y(e,t,n,r){a(e,t)||m("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||d())}var b={};function _(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:b[e]*t}function x(e){return!(e&e-1||!e)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var S=t(i,{optional:function(e){e()},raise:r,commandRaise:m,command:function(e,t,n){e||m(t,n||d())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||m("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){s.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+s)}))},type:function(e,t,n){a(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:y,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,n,r,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),u=r===e.FRAGMENT_SHADER?"fragment":"vertex";y(n,"string",u+" shader source must be a string",o);var s=v(n,o),l=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new h(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new h("unknown",0,e))}})),t}(a);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(s,l),Object.keys(s).forEach((function(e){var t=s[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(o){var a=o[1];switch(r=o[2],a){case"assign":a="="}t=Math.max(e.line.indexOf(a,t),0)}else t=0;i(c("| ",6)),i(c("^^^",t+3)+"\n","font-weight:bold"),i(c("| ",6)),i(r+"\n","font-weight:bold")})),i(c("| ",6)+"\n")}else i(c(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+s[0].name)}},linkError:function(e,t,n,r,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),u=v(n,o),s='Error linking program with vertex shader, "'+v(r,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+s+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(s+"\n"+a),i.raise(s)}},callSite:p,saveCommandRef:g,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}g(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var u=e._attributeSet={};o(u,n.static),o(u,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,o=t.width,a=t.height,u=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||i(x(o)&&x(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(x(o)&&x(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var s=t.images;for(r=0;r<16;++r)if(s[r]){var c=o>>r,l=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var f=s[r];if(i(f.width===c&&f.height===l,"invalid shape for mip images"),i(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var h=Math.ceil(_(f.type,u)*c/f.unpackAlignment)*f.unpackAlignment;i(f.data.byteLength===h*l,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,u=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var s=0;s<n.length;++s){var c=n[s];i(c.width===o&&c.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!c.compressed,"can not generate mipmap for compressed textures"),i(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,f=0;f<16;++f){var h=l[f];if(h){var d=o>>f,p=a>>f;i(c.mipmask&1<<f,"missing mipmap data"),i(h.width===d&&h.height===p,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===d*p*Math.max(_(h.type,u),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}}),E=0;function A(e,t){this.id=E++,this.type=e,this.data=t}function w(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function T(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+w(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+w(t)+'"'];for(var a=[],u=0;u<o.length;++u)a=a.concat(e(o[u]));return a}(e).join("][")+"]"}var C={DynamicVariable:A,define:function(e,t){return new A(e,T(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof A},unbox:function(e,t){return"function"==typeof e?new A(0,e):e},accessor:T},k={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},M="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function I(e){return"string"==typeof e?e.split():(S(Array.isArray(e),"invalid extension array"),e)}function O(e){return"string"==typeof e?(S("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function P(e){var n,r,i,o,a,u=e||{},s={},c=[],l=[],f="undefined"==typeof window?1:window.devicePixelRatio,h=!1,d=function(e){e&&S.raise(e)},p=function(){};if("string"==typeof u?(S("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(u),S(n,"invalid query string for element")):"object"==typeof u?"string"==typeof(a=u).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=u:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(u)?i=(o=u).canvas:(S.constructor(u),"gl"in u?o=u.gl:"canvas"in u?i=O(u.canvas):"container"in u&&(r=O(u.container)),"attributes"in u&&(s=u.attributes,S.type(s,"object","invalid context attributes")),"extensions"in u&&(c=I(u.extensions)),"optionalExtensions"in u&&(l=I(u.optionalExtensions)),"onDone"in u&&(S.type(u.onDone,"function","invalid or missing onDone callback"),d=u.onDone),"profile"in u&&(h=!!u.profile),"pixelRatio"in u&&(f=+u.pixelRatio,S(f>0,"invalid pixel ratio"))):S.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){S("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var v=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,f);if(!v)return null;i=v.canvas,p=v.onDestroy}void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,s)}return o?{gl:o,canvas:i,container:r,extensions:c,optionalExtensions:l,pixelRatio:f,profile:h,onDone:d,onDestroy:p}:(p(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function R(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function L(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function N(){var e=R(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[L(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[L(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var D=N();function j(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}D.zero=N();var F=function(e){return Object.keys(e).map((function(t){return e[t]}))},z={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||D.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],u=0;u<n;++u)r[i++]=a[u]}(e,t[0],t[1],a);break;case 3:U(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,u=r+1;u<n.length;++u)a*=n[u];var s=n[r];if(n.length-r==4){var c=n[r+1],l=n[r+2],f=n[r+3];for(u=0;u<s;++u)U(t[u],c,l,f,i,o),o+=a}else for(u=0;u<s;++u)e(t[u],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function U(e,t,n,r,i,o){for(var a=o,u=0;u<t;++u)for(var s=e[u],c=0;c<n;++c)for(var l=s[c],f=0;f<r;++f)i[a++]=l[f]}var B={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},V={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},G={dynamic:35048,stream:35040,static:35044},H=z.flatten,W=z.shape,q=[];function X(e){return 0|B[Object.prototype.toString.call(e)]}function Z(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Y(e,t,n,r,i,o,a){for(var u=0,s=0;s<n;++s)for(var c=0;c<r;++c)e[u++]=t[i*s+o*c+a]}q[5120]=1,q[5122]=2,q[5124]=4,q[5121]=1,q[5123]=2,q[5125]=4,q[5126]=4;var K={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Q=new Float32Array(1),J=new Uint32Array(Q.buffer);function $(e){for(var t=D.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{Q[0]=e[n];var r=J[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var u=-14-o;t[n]=i+(a+1024>>u)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function ee(t){return Array.isArray(t)||e(t)}var te=function(e){return!(e&e-1||!e)},ne=[9984,9986,9985,9987],re=[0,6409,6410,6407,6408],ie={};function oe(e){return"[object "+e+"]"}ie[6409]=ie[6406]=ie[6402]=1,ie[34041]=ie[6410]=2,ie[6407]=ie[35904]=3,ie[6408]=ie[35906]=4;var ae=oe("HTMLCanvasElement"),ue=oe("OffscreenCanvas"),se=oe("CanvasRenderingContext2D"),ce=oe("ImageBitmap"),le=oe("HTMLImageElement"),fe=oe("HTMLVideoElement"),he=Object.keys(B).concat([ae,ue,se,ce,le,fe]),de=[];de[5121]=1,de[5126]=4,de[36193]=2,de[5123]=2,de[5125]=4;var pe=[];function ve(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ge(e){return!!Array.isArray(e)&&!(0===e.length||!ee(e[0]))}function me(e){return Object.prototype.toString.call(e)}function ye(e){return me(e)===ae}function be(e){return me(e)===ue}function _e(e){if(!e)return!1;var t=me(e);return he.indexOf(t)>=0||ve(e)||ge(e)||j(e)}function xe(e){return 0|B[Object.prototype.toString.call(e)]}function Se(e,t){return D.allocType(36193===e.type?5126:e.type,t)}function Ee(e,t){36193===e.type?(e.data=$(t),D.freeType(t)):e.data=t}function Ae(e,t,n,r,i,o){var a;if(a=void 0!==pe[e]?pe[e]:ie[e]*de[t],o&&(a*=6),i){for(var u=0,s=n;s>=1;)u+=a*s*s,s/=2;return u}return a*n*r}function we(n,r,i,o,a,u,s){var c={"don't care":4352,"dont care":4352,nice:4354,fast:4353},l={repeat:10497,clamp:33071,mirror:33648},f={nearest:9728,linear:9729},h=t({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},f),d={none:0,browser:37444},p={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},v={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},g={};r.ext_srgb&&(v.srgb=35904,v.srgba=35906),r.oes_texture_float&&(p.float32=p.float=5126),r.oes_texture_half_float&&(p.float16=p["half float"]=36193),r.webgl_depth_texture&&(t(v,{depth:6402,"depth stencil":34041}),t(p,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(g,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&t(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var m=Array.prototype.slice.call(n.getParameter(34467));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var b=[];Object.keys(v).forEach((function(e){var t=v[e];b[t]=e}));var _=[];Object.keys(p).forEach((function(e){var t=p[e];_[t]=e}));var x=[];Object.keys(f).forEach((function(e){x[f[e]]=e}));var E=[];Object.keys(h).forEach((function(e){var t=h[e];E[t]=e}));var A=[];Object.keys(l).forEach((function(e){A[l[e]]=e}));var w=y.reduce((function(e,t){var n=v[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||r.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||t.indexOf("rgba")>=0?e[n]=6408:e[n]=6407,e}),{});function T(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function C(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function k(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(S.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(S.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(S.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(S.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;S(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),S(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),S(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(n,p,"invalid texture type"),e.type=p[n]}var o=e.width,a=e.height,u=e.channels,s=!1;"shape"in t?(S(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(u=t.shape[2],S(u>0&&u<=4,"invalid number of channels"),s=!0),S(o>=0&&o<=i.maxTextureSize,"invalid width"),S(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,S(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,S(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,S(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(u=t.channels,S(u>0&&u<=4,"invalid number of channels"),s=!0)),e.width=0|o,e.height=0|a,e.channels=0|u;var c=!1;if("format"in t){var l=t.format;S(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(l,v,"invalid texture format");var f=e.internalformat=v[l];e.format=w[f],l in p&&("type"in t||(e.type=p[l])),l in g&&(e.compressed=!0),c=!0}!s&&c?e.channels=ie[e.format]:s&&!c?e.channels!==re[e.format]&&(e.format=e.internalformat=re[e.channels]):c&&s&&S(e.channels===ie[e.format],"number of channels inconsistent with specified format")}}function M(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function I(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(t,n){var r=null;if(_e(n)?r=n:n&&(S.type(n,"object","invalid pixel data type"),k(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),_e(n.data)&&(r=n.data)),S(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){S(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,u=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||u-t.yOffset,t.needsCopy=!0,S(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<u&&t.width>0&&t.width<=o&&t.height>0&&t.height<=u,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||5121!==t.type||(t.type=xe(r));else if(ve(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=D.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=$(t);break;default:S.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(j(r)){var s=r.data;Array.isArray(s)||5121!==t.type||(t.type=xe(s));var c,l,f,h,d,p,v=r.shape,g=r.stride;3===v.length?(f=v[2],p=g[2]):(S(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,p=1),c=v[0],l=v[1],h=g[0],d=g[1],t.alignment=1,t.width=c,t.height=l,t.channels=f,t.format=t.internalformat=re[f],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,u=e.height,s=e.channels,c=Se(e,a*u*s),l=0,f=0;f<u;++f)for(var h=0;h<a;++h)for(var d=0;d<s;++d)c[l++]=t[n*h+r*f+i*d+o];Ee(e,c)}(t,s,h,d,p,r.offset)}else if(ye(r)||be(r)||function(e){return me(e)===se}(r))ye(r)||be(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return me(e)===ce}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return me(e)===le}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return me(e)===fe}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(ge(r)){var m=t.width||r[0].length,y=t.height||r.length,b=t.channels;b=ee(r[0][0])?b||r[0][0].length:b||1;for(var _=z.shape(r),x=1,E=0;E<_.length;++E)x*=_[E];var A=Se(t,x);z.flatten(r,_,"",A),Ee(t,A),t.alignment=1,t.width=m,t.height=y,t.channels=b,t.format=t.internalformat=re[b],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;5126===t.type?S(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===t.type&&S(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function P(e,t,r){var i=e.element,a=e.data,u=e.internalformat,s=e.format,c=e.type,l=e.width,f=e.height;M(e),i?n.texImage2D(t,r,s,s,c,i):e.compressed?n.compressedTexImage2D(t,r,u,l,f,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,s,e.xOffset,e.yOffset,l,f,0)):n.texImage2D(t,r,s,l,f,0,s,c,a||null)}function R(e,t,r,i,a){var u=e.element,s=e.data,c=e.internalformat,l=e.format,f=e.type,h=e.width,d=e.height;M(e),u?n.texSubImage2D(t,a,r,i,l,f,u):e.compressed?n.compressedTexSubImage2D(t,a,r,i,c,h,d,s):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,d)):n.texSubImage2D(t,a,r,i,h,d,l,f,s)}var L=[];function N(){return L.pop()||new I}function U(e){e.needsFree&&D.freeType(e.data),I.call(e),L.push(e)}function B(){T.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function V(e,t,n){var r=e.images[0]=N();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function G(e,t){var n=null;if(_e(t))C(n=e.images[0]=N(),e),O(n,t),e.mipmask=1;else if(k(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)C(n=e.images[i]=N(),e),n.width>>=i,n.height>>=i,O(n,r[i]),e.mipmask|=1<<i;else C(n=e.images[0]=N(),e),O(n,t),e.mipmask=1;C(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||S(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function H(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;P(n[r],t,r)}}var W=[];function q(){var e=W.pop()||new B;T.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function X(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&U(t[n]),t[n]=null;W.push(e)}function Z(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function Y(e,t){if("min"in t){var n=t.min;S.parameter(n,h),e.minFilter=h[n],ne.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;S.parameter(r,f),e.magFilter=f[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var u=t.wrap;"string"==typeof u?(S.parameter(u,l),o=a=l[u]):Array.isArray(u)&&(S.parameter(u[0],l),S.parameter(u[1],l),o=l[u[0]],a=l[u[1]])}else{if("wrapS"in t){var s=t.wrapS;S.parameter(s,l),o=l[s]}if("wrapT"in t){var d=t.wrapT;S.parameter(d,l),a=l[d]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var p=t.anisotropic;S("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":S.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":S(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:S.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=9984)}}function K(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var Q=0,J={},oe=i.maxTextureUnits,ae=Array(oe).map((function(){return null}));function ue(e){T.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Z,s.profile&&(this.stats={size:0})}function he(e){n.activeTexture(33984),n.bindTexture(e.target,e.texture)}function de(){var e=ae[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(3553,null)}function pe(e){var t=e.texture;S(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(33984+r),n.bindTexture(i,null),ae[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],u.textureCount--}return t(ue.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<oe;++t){var r=ae[t];if(r){if(r.bindCount>0)continue;r.unit=-1}ae[t]=this,e=t;break}e>=oe&&S.raise("insufficient number of texture units"),s.profile&&u.maxTextureUnits<e+1&&(u.maxTextureUnits=e+1),this.unit=e,n.activeTexture(33984+e),n.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&pe(this)}}),s.profile&&(u.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(e,t){var r=new ue(3553);function o(e,t){var n=r.texInfo;Z.call(n);var a=q();return"number"==typeof e?V(a,0|e,"number"==typeof t?0|t:0|e):e?(S.type(e,"object","invalid arguments to regl.texture"),Y(n,e),G(a,e)):V(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,C(r,a),S.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,he(r),H(a,3553),K(n,3553),de(),X(a),s.profile&&(r.stats.size=Ae(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=_[r.type],o.mag=x[n.magFilter],o.min=E[n.minFilter],o.wrapS=A[n.wrapS],o.wrapT=A[n.wrapT],o}return J[r.id]=r,u.textureCount++,o(e,t),o.subimage=function(e,t,n,i){S(!!e,"must specify image data");var a=0|t,u=0|n,s=0|i,c=N();return C(c,r),c.width=0,c.height=0,O(c,e),c.width=c.width||(r.width>>s)-a,c.height=c.height||(r.height>>s)-u,S(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),S(a>=0&&u>=0&&a+c.width<=r.width&&u+c.height<=r.height,"texture.subimage write out of bounds"),S(r.mipmask&1<<s,"missing mipmap data"),S(c.data||c.element||c.needsCopy,"missing image data"),he(r),R(c,3553,a,u,s),de(),U(c),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,he(r);for(var u=0;r.mipmask>>u;++u){var c=i>>u,l=a>>u;if(!c||!l)break;n.texImage2D(3553,u,r.format,c,l,0,r.format,r.type,null)}return de(),s.profile&&(r.stats.size=Ae(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,s.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,c){var l=new ue(34067);J[l.id]=l,u.cubeCount++;var f=new Array(6);function h(e,t,n,r,o,a){var u,c=l.texInfo;for(Z.call(c),u=0;u<6;++u)f[u]=q();if("number"!=typeof e&&e)if("object"==typeof e)if(t)G(f[0],e),G(f[1],t),G(f[2],n),G(f[3],r),G(f[4],o),G(f[5],a);else if(Y(c,e),k(l,e),"faces"in e){var d=e.faces;for(S(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),u=0;u<6;++u)S("object"==typeof d[u]&&!!d[u],"invalid input for cube map face"),C(f[u],l),G(f[u],d[u])}else for(u=0;u<6;++u)G(f[u],e);else S.raise("invalid arguments to cube map");else{var p=0|e||1;for(u=0;u<6;++u)V(f[u],p,p)}for(C(l,f[0]),i.npotTextureCube||S(te(l.width)&&te(l.height),"your browser does not support non power or two texture dimensions"),c.genMipmaps?l.mipmask=(f[0].width<<1)-1:l.mipmask=f[0].mipmask,S.textureCube(l,c,f,i),l.internalformat=f[0].internalformat,h.width=f[0].width,h.height=f[0].height,he(l),u=0;u<6;++u)H(f[u],34069+u);for(K(c,34067),de(),s.profile&&(l.stats.size=Ae(l.internalformat,l.type,h.width,h.height,c.genMipmaps,!0)),h.format=b[l.internalformat],h.type=_[l.type],h.mag=x[c.magFilter],h.min=E[c.minFilter],h.wrapS=A[c.wrapS],h.wrapT=A[c.wrapT],u=0;u<6;++u)X(f[u]);return h}return h(e,t,r,o,a,c),h.subimage=function(e,t,n,r,i){S(!!t,"must specify image data"),S("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,u=0|i,s=N();return C(s,l),s.width=0,s.height=0,O(s,t),s.width=s.width||(l.width>>u)-o,s.height=s.height||(l.height>>u)-a,S(l.type===s.type&&l.format===s.format&&l.internalformat===s.internalformat,"incompatible format for texture.subimage"),S(o>=0&&a>=0&&o+s.width<=l.width&&a+s.height<=l.height,"texture.subimage write out of bounds"),S(l.mipmask&1<<u,"missing mipmap data"),S(s.data||s.element||s.needsCopy,"missing image data"),he(l),R(s,34069+e,o,a,u),de(),U(s),h},h.resize=function(e){var t=0|e;if(t!==l.width){h.width=l.width=t,h.height=l.height=t,he(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(34069+r,i,l.format,t>>i,t>>i,0,l.format,l.type,null);return de(),s.profile&&(l.stats.size=Ae(l.internalformat,l.type,h.width,h.height,!1,!0)),h}},h._reglType="textureCube",h._texture=l,s.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h},clear:function(){for(var e=0;e<oe;++e)n.activeTexture(33984+e),n.bindTexture(3553,null),ae[e]=null;F(J).forEach(pe),u.cubeCount=0,u.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<oe;++e){var t=ae[e];t&&(t.bindCount=0,t.unit=-1,ae[e]=null)}F(J).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(3553===e.target)n.texImage2D(3553,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(34069+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);K(e.texInfo,e.target)}))}}}pe[32854]=2,pe[32855]=2,pe[36194]=2,pe[34041]=4,pe[33776]=.5,pe[33777]=.5,pe[33778]=1,pe[33779]=1,pe[35986]=.5,pe[35987]=1,pe[34798]=1,pe[35840]=.5,pe[35841]=.25,pe[35842]=.5,pe[35843]=.25,pe[36196]=.5;var Te=[];function Ce(e,t,n){return Te[e]*t*n}Te[32854]=2,Te[32855]=2,Te[36194]=2,Te[33189]=2,Te[36168]=1,Te[34041]=4,Te[35907]=4,Te[34836]=16,Te[34842]=8,Te[34843]=6;var ke=[6407,6408],Me=[];Me[6408]=4,Me[6407]=3;var Ie=[];Ie[5121]=1,Ie[5126]=4,Ie[36193]=2;var Oe=[32854,32855,36194,35907,34842,34843,34836],Pe={};function Re(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function Le(t,n,r,i,o,a,u){function s(s){var c;null===n.next?(S(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=5121):(S(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(S(5121===c||5126===c,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===c&&S(u.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):S(5121===c,"Reading from a framebuffer is only allowed for the type 'uint8'"));var l=0,f=0,h=i.framebufferWidth,d=i.framebufferHeight,p=null;e(s)?p=s:s&&(S.type(s,"object","invalid arguments to regl.read()"),l=0|s.x,f=0|s.y,S(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),S(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(s.width||i.framebufferWidth-l),d=0|(s.height||i.framebufferHeight-f),p=s.data||null),p&&(5121===c?S(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===c&&S(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),S(h>0&&h+l<=i.framebufferWidth,"invalid width for read pixels"),S(d>0&&d+f<=i.framebufferHeight,"invalid height for read pixels"),r();var v=h*d*4;return p||(5121===c?p=new Uint8Array(v):5126===c&&(p=p||new Float32Array(v))),S.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),S(p.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(l,f,h,d,6408,c,p),p}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=s(e)})),t}(e):s(e)}}function Ne(e){return Array.prototype.slice.call(e)}function De(e){return Ne(e).join("")}Pe[36053]="complete",Pe[36054]="incomplete attachment",Pe[36057]="incomplete dimensions",Pe[36055]="incomplete, missing attachment",Pe[36061]="unsupported";var je="xyzw".split(""),Fe="profile",ze="framebuffer",Ue="vert",Be="frag",Ve="elements",Ge="primitive",He="count",We="offset",qe="instances",Xe="vao",Ze=ze+"Width",Ye=ze+"Height",Ke=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],Qe={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Je=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],$e={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},et={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},tt={frag:35632,vert:35633},nt={cw:2304,ccw:2305};function rt(t){return Array.isArray(t)||e(t)||j(t)}function it(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function ot(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function at(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ut(e){return new ot(!1,!1,!1,e)}function st(e,t){var n=e.type;if(0===n){var r=e.data.length;return new ot(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new ot(i.thisDep,i.contextDep,i.propDep,t)}return new ot(3===n,2===n,1===n,t)}var ct=new ot(!1,!1,!1,(function(){}));function lt(e,n,r,i,o,a,u,s,c,l,f,h,d,p,v){var g=l.Record,m={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(m.min=32775,m.max=32776);var y=r.angle_instanced_arrays,b=r.webgl_draw_buffers,_={dirty:!0,profile:v.profile},x={},E=[],A={},w={};function T(e){return e.replace(".","_")}function k(e,t,n){var r=T(e);E.push(e),x[r]=_[r]=!!n,A[r]=t}function M(e,t,n){var r=T(e);E.push(e),Array.isArray(n)?(_[r]=n.slice(),x[r]=n.slice()):_[r]=x[r]=n,w[r]=t}k("dither",3024),k("blend.enable",3042),M("blend.color","blendColor",[0,0,0,0]),M("blend.equation","blendEquationSeparate",[32774,32774]),M("blend.func","blendFuncSeparate",[1,0,1,0]),k("depth.enable",2929,!0),M("depth.func","depthFunc",513),M("depth.range","depthRange",[0,1]),M("depth.mask","depthMask",!0),M("colorMask","colorMask",[!0,!0,!0,!0]),k("cull.enable",2884),M("cull.face","cullFace",1029),M("frontFace","frontFace",2305),M("lineWidth","lineWidth",1),k("polygonOffset.enable",32823),M("polygonOffset.offset","polygonOffset",[0,0]),k("sample.alpha",32926),k("sample.enable",32928),M("sample.coverage","sampleCoverage",[1,!1]),k("stencil.enable",2960),M("stencil.mask","stencilMask",-1),M("stencil.func","stencilFunc",[519,0,-1]),M("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),M("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),k("scissor.enable",3089),M("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),M("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var I={gl:e,context:d,strings:n,next:x,current:_,draw:h,elements:a,buffer:o,shader:f,attributes:l.state,vao:l,uniforms:c,framebuffer:s,extensions:r,timer:p,isBufferArgs:rt},O={primTypes:K,compareFuncs:$e,blendFuncs:Qe,blendEquations:m,stencilOps:et,glTypes:V,orientationType:nt};S.optional((function(){I.isArrayLike=ee})),b&&(O.backBuffer=[1029],O.drawBuffer=R(i.maxDrawbuffers,(function(e){return 0===e?[0]:R(e,(function(e){return 36064+e}))})));var P=0;function L(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,Ne(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Ne(arguments)),n.push(";")),t},toString:function(){return De([r.length>0?"var "+r.join(",")+";":"",De(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,Ne(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),u={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var s=o(),c=s.toString;return u[e]=t(s,{arg:i,toString:function(){return De(["function(",r.join(),"){",c(),"}"])}})},scope:o,cond:function(){var e=De(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,Ne(arguments)),this},else:function(){return r.apply(r,Ne(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),De(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(u).forEach((function(t){e.push('"',t,'":',u[t].toString(),",")})),e.push("}");var t=De(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=P++,e.batchId="0";var o=r(I),a=e.shared={props:"a0"};Object.keys(I).forEach((function(e){a[e]=i.def(o,".",e)})),S.optional((function(){e.CHECK=r(S),e.commandStr=S.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},O.invalidBlendCombinations=Je}));var u=e.next={},s=e.current={};Object.keys(w).forEach((function(e){Array.isArray(_[e])&&(u[e]=i.def(a.next,".",e),s[e]=i.def(a.current,".",e))}));var c=e.constants={};Object.keys(O).forEach((function(e){c[e]=i.def(JSON.stringify(O[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref}},e.attribCache={};var f={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in f)return f[t];var i=l.scope[t];return i||(i=l.scope[t]=new g),f[t]=r(i)},e}function N(e,t,u,c,h){var d=e.static,p=e.dynamic;S.optional((function(){var e=[ze,Ue,Be,Ve,Ge,We,He,qe,Fe,Xe].concat(E);function t(t){Object.keys(t).forEach((function(t){S.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',h.commandStr)}))}t(d),t(p)}));var v=function(e,t){var n=e.static;if("string"==typeof n[Be]&&"string"==typeof n[Ue]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)S("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),b=function(e,t){var n=e.static,r=e.dynamic;if(ze in n){var i=n[ze];return i?(i=s.getFramebuffer(i),S.command(i,"invalid framebuffer object"),ut((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Ze,n+".width"),t.set(o,"."+Ye,n+".height"),n}))):ut((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Ze,r+".drawingBufferWidth"),t.set(r,"."+Ye,r+".drawingBufferHeight"),"null"}))}if(ze in r){var o=r[ze];return st(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");S.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var u=r.context;return t.set(u,"."+Ze,a+"?"+a+".width:"+u+".drawingBufferWidth"),t.set(u,"."+Ye,a+"?"+a+".height:"+u+".drawingBufferHeight"),a}))}return null}(e),_=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];S.commandType(o,"object","invalid "+e,n.commandStr);var a,u,s=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,S.command(a>=0,"invalid "+e,n.commandStr)):s=!1,"height"in o?(u=0|o.height,S.command(u>=0,"invalid "+e,n.commandStr)):s=!1,new ot(!s&&t&&t.thisDep,!s&&t&&t.contextDep,!s&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Ze,"-",c));var i=u;return"height"in o||(i=t.def(n,".",Ye,"-",l)),[c,l,r,i]}))}if(e in i){var f=i[e],h=st(f,(function(t,n){var r=t.invoke(n,f);S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),u=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Ze,"-",o,")"),s=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Ye,"-",a,")");return S.optional((function(){t.assert(n,u+">=0&&"+s+">=0","invalid "+e)})),[o,a,u,s]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new ot(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Ze),t.def(n,".",Ye)]})):null}var a=o("viewport");if(a){var u=a;a=new ot(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=u.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:a,scissor_box:o("scissor.box")}}(e,b,h),x=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(Ve in n){var e=n[Ve];rt(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),S.command(e,"invalid elements",t.commandStr));var i=ut((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(Ve in r){var o=r[Ve];return st(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),u=t.def("null"),s=t.def(r,"(",a,")"),c=e.cond(s).then(u,"=",i,".createStream(",a,");").else(u,"=",i,".getElements(",a,");");return S.optional((function(){e.assert(c.else,"!"+a+"||"+u,"invalid elements")})),t.entry(c),t.exit(e.cond(s).then(i,".destroyStream(",u,");")),e.ELEMENTS=u,u}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return S.command(!o||a>=0,"invalid "+e,t.commandStr),ut((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var u=r[e];return st(u,(function(t,n){var r=t.invoke(n,u);return o&&(t.OFFSET=r,S.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?ut((function(e,t){return e.OFFSET="0",0})):null}var u=o(We,!0);return{elements:i,primitive:function(){if(Ge in n){var e=n[Ge];return S.commandParameter(e,K,"invalid primitve",t.commandStr),ut((function(t,n){return K[e]}))}if(Ge in r){var o=r[Ge];return st(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return S.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(K))})),t.def(n,"[",r,"]")}))}return i?at(i)?i.value?ut((function(e,t){return t.def(e.ELEMENTS,".primType")})):ut((function(){return 4})):new ot(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(He in n){var e=0|n[He];return S.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ut((function(){return e}))}if(He in r){var o=r[He];return st(o,(function(e,t){var n=e.invoke(t,o);return S.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(at(i)){if(i)return u?new ot(u.thisDep,u.contextDep,u.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return S.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ut((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var a=ut((function(){return-1}));return S.optional((function(){a.MISSING=!0})),a}var s=new ot(i.thisDep||u.thisDep,i.contextDep||u.contextDep,i.propDep||u.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return S.optional((function(){s.DYNAMIC=!0})),s}return null}(),instances:o(qe,!1),offset:u}}(e,h),A=function(e,t){var n=e.static,r=e.dynamic,o={};return E.forEach((function(e){var a=T(e);function u(t,i){if(e in n){var u=t(n[e]);o[a]=ut((function(){return u}))}else if(e in r){var s=r[e];o[a]=st(s,(function(e,t){return i(e,t,e.invoke(t,s))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return u((function(n){return S.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return S.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return u((function(n){return S.commandParameter(n,$e,"invalid "+e,t.commandStr),$e[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return S.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys($e))})),n.def(i,"[",r,"]")}));case"depth.range":return u((function(e){return S.command(ee(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return u((function(e){S.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return S.commandParameter(n,Qe,a+".srcRGB",t.commandStr),S.commandParameter(r,Qe,a+".srcAlpha",t.commandStr),S.commandParameter(i,Qe,a+".dstRGB",t.commandStr),S.commandParameter(o,Qe,a+".dstAlpha",t.commandStr),S.command(-1===Je.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Qe[n],Qe[i],Qe[r],Qe[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var u=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return S.optional((function(){t.assert(n,u+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Qe))})),u}S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),u=o("dst","RGB");S.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+u+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var s=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[s,n.def(i,"[",u,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case"blend.equation":return u((function(n){return"string"==typeof n?(S.commandParameter(n,m,"invalid "+e,t.commandStr),[m[n],m[n]]):"object"==typeof n?(S.commandParameter(n.rgb,m,e+".rgb",t.commandStr),S.commandParameter(n.alpha,m,e+".alpha",t.commandStr),[m[n.rgb],m[n.alpha]]):void S.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),u=t.cond("typeof ",r,'==="string"');return S.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(m))}n(u.then,e,r),t.assert(u.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(u.else,e+".rgb",r+".rgb"),n(u.else,e+".alpha",r+".alpha")})),u.then(o,"=",a,"=",i,"[",r,"];"),u.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(u),[o,a]}));case"blend.color":return u((function(e){return S.command(ee(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),R(4,(function(t){return+e[t]}))}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),R(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return u((function(e){return S.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return S.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return u((function(n){S.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return S.commandParameter(r,$e,e+".cmp",t.commandStr),S.commandType(i,"number",e+".ref",t.commandStr),S.commandType(o,"number",e+".mask",t.commandStr),[$e[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return S.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return u((function(n){S.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return S.commandParameter(r,et,e+".fail",t.commandStr),S.commandParameter(i,et,e+".zfail",t.commandStr),S.commandParameter(o,et,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,et[r],et[i],et[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return S.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(et))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",7680)}return S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,o("fail"),o("zfail"),o("zpass")]}));case"polygonOffset.offset":return u((function(e){S.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return S.commandType(n,"number",a+".factor",t.commandStr),S.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return u((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),S.command(!!n,a,t.commandStr),n}),(function(e,t,n){return S.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return u((function(e){return S.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return S.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return u((function(e){return S.commandParameter(e,nt,a,t.commandStr),nt[e]}),(function(e,t,n){return S.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return u((function(e){return S.command(ee(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),R(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return u((function(e){S.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return S.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return S.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,h),w=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);S.optional((function(){f.shader(tt[e],t,S.guessCommand())}));var r=ut((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return st(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return S.optional((function(){n(t.shared.shader,".shader(",tt[e],",",i,",",t.command,");")})),i}))}return null}var u,s=a(Be),c=a(Ue),l=null;return at(s)&&at(c)?(l=f.program(c.id,s.id,null,r),u=ut((function(e,t){return e.link(l)}))):u=new ot(s&&s.thisDep||c&&c.thisDep,s&&s.contextDep||c&&c.contextDep,s&&s.propDep||c&&c.propDep,(function(e,t){var n,r=e.shared.shader;n=s?s.append(e,t):t.def(r,".",Be);var i=r+".program("+(c?c.append(e,t):t.def(r,".",Ue))+","+n;return S.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:s,vert:c,progVar:u,program:l}}(e,0,v);function C(e){var t=_[e];t&&(A[e]=t)}C("viewport"),C(T("scissor.box"));var k=Object.keys(A).length>0,M={framebuffer:b,draw:x,shader:w,state:A,dirty:k,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(M.profile=function(e){var t,n=e.static,r=e.dynamic;if(Fe in n){var i=!!n[Fe];(t=ut((function(e,t){return i}))).enable=i}else if(Fe in r){var o=r[Fe];t=st(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),M.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=ut((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=ut((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(S.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ut((function(e){return e.link(o.color[0])}))):S.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else ee(o)?r=ut((function(t){return t.global.def("[",R(o.length,(function(n){return S.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):S.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=st(t,(function(e,n){return e.invoke(n,t)}))})),i}(u,h),M.drawVAO=M.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(Xe in n){var i=n[Xe];return null!==i&&null===l.getVAO(i)&&(i=l.createVAO(i)),ut((function(e){return e.link(l.getVAO(i))}))}if(Xe in r){var o=r[Xe];return st(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!M.drawVAO&&w.program&&!v&&r.angle_instanced_arrays){var I=!0,O=w.program.attributes.map((function(e){var n=t.static[e];return I=I&&!!n,n}));if(I&&O.length>0){var P=l.getVAO(l.createVAO(O));M.drawVAO=new ot(null,null,null,(function(e,t){return e.link(P)})),M.useVAO=!0}}return v?M.useVAO=!0:M.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],u=n.id(e),s=new g;if(rt(i))s.state=1,s.buffer=o.getBuffer(o.create(i,34962,!1,!0)),s.type=0;else{var c=o.getBuffer(i);if(c)s.state=1,s.buffer=c,s.type=0;else if(S.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;s.buffer="null",s.state=2,"number"==typeof l?s.x=l:(S.command(ee(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),je.forEach((function(e,t){t<l.length&&(s[e]=l[t])})))}else{c=rt(i.buffer)?o.getBuffer(o.create(i.buffer,34962,!1,!0)):o.getBuffer(i.buffer),S.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var f=0|i.offset;S.command(f>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var h=0|i.stride;S.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;S.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!i.normalized,v=0;"type"in i&&(S.commandParameter(i.type,V,"invalid type for attribute "+e,t.commandStr),v=V[i.type]);var m=0|i.divisor;"divisor"in i&&(S.command(0===m||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),S.command(m>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),S.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){S.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),s.buffer=c,s.state=1,s.size=d,s.normalized=p,s.type=v||c.dtype,s.offset=f,s.stride=h,s.divisor=m}}a[e]=ut((function(e,t){var n=e.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(s).forEach((function(e){r[e]=s[e]})),s.buffer&&(r.buffer=e.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];a[e]=st(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,u=o.isBufferArgs,s=o.buffer;S.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+u+"("+i+")||"+s+".getBuffer("+i+")||"+s+".getBuffer("+i+".buffer)||"+u+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var c={isStream:r.def(!1)},l=new g;l.state=1,Object.keys(l).forEach((function(e){c[e]=r.def(""+l[e])}));var f=c.buffer,h=c.type;function d(e){r(c[e],"=",i,".",e,"|0;")}return r("if(",u,"(",i,")){",c.isStream,"=true;",f,"=",s,".createStream(",34962,",",i,");",h,"=",f,".dtype;","}else{",f,"=",s,".getBuffer(",i,");","if(",f,"){",h,"=",f,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",2,";","if(typeof "+i+'.constant === "number"){',c[je[0]],"=",i,".constant;",je.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",je.map((function(e,t){return c[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",u,"(",i,".buffer)){",f,"=",s,".createStream(",34962,",",i,".buffer);","}else{",f,"=",s,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",f,".dtype;",c.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",c.isStream,"){",s,".destroyStream(",f,");","}"),c}))})),a}(t,h),M.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ut((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=st(t,(function(e,n){return e.invoke(n,t)}))})),r}(c),M}function D(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o];i(r,".",o,"=",a.append(e,t),";")})),t(i)}function j(e,t,n,r){var i,o=e.shared,a=o.gl,u=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var s,c=e.constants,l=c.drawBuffer,f=c.backBuffer;s=n?n.append(e,t):t.def(u,".next"),r||t("if(",s,"!==",u,".cur){"),t("if(",s,"){",a,".bindFramebuffer(",36160,",",s,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",l,"[",s,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",f,");"),t("}",u,".cur=",s,";"),r||t("}")}function F(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,u=r.current,s=r.next,c=e.cond(u,".dirty");E.forEach((function(t){var r,l,f=T(t);if(!(f in n.state))if(f in a){r=a[f],l=o[f];var h=R(_[f].length,(function(e){return c.def(r,"[",e,"]")}));c(e.cond(h.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",w[f],"(",h,");",h.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=c.def(s,".",f);var d=e.cond(r,"!==",u,".",f);c(d),f in A?d(e.cond(r).then(i,".enable(",A[f],");").else(i,".disable(",A[f],");"),u,".",f,"=",r,";"):d(i,".",w[f],"(",r,");",u,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&c(u,".dirty=false;"),t(c)}function z(e,t,n,r){var i=e.shared,o=e.current,a=i.current,u=i.gl;it(Object.keys(n)).forEach((function(i){var s=n[i];if(!r||r(s)){var c=s.append(e,t);if(A[i]){var l=A[i];at(s)?t(u,c?".enable(":".disable(",l,");"):t(e.cond(c).then(u,".enable(",l,");").else(u,".disable(",l,");")),t(a,".",i,"=",c,";")}else if(ee(c)){var f=o[i];t(u,".",w[i],"(",c,");",c.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(u,".",w[i],"(",c,");",a,".",i,"=",c,";")}}))}function U(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function B(e,t,n,r,i){var o,a,u,s=e.shared,c=e.stats,l=s.current,f=s.timer,h=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(e){e(o=t.def(),"=",d(),";"),"string"==typeof i?e(c,".count+=",i,";"):e(c,".count++;"),p&&(r?e(a=t.def(),"=",f,".getNumPendingQueries();"):e(f,".beginQuery(",c,");"))}function g(e){e(c,".cpuTime+=",d(),"-",o,";"),p&&(r?e(f,".pushScopeStats(",a,",",f,".getNumPendingQueries(),",c,");"):e(f,".endQuery();"))}function m(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(h){if(at(h))return void(h.enable?(v(t),g(t.exit),m("true")):m("false"));m(u=h.append(e,t))}else u=t.def(l,".profile");var y=e.block();v(y),t("if(",u,"){",y,"}");var b=e.block();g(b),t.exit("if(",u,"){",b,"}")}function G(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,u=r.name,s=n.attributes[u];if(s){if(!i(s))return;a=s.append(e,t)}else{if(!i(ct))return;var c=e.scopeAttrib(u);S.optional((function(){e.assert(t,c+".state","missing attribute "+u)})),a={},Object.keys(new g).forEach((function(e){a[e]=t.def(c,".",e)}))}!function(n,r,i){var a=o.gl,u=t.def(n,".location"),s=t.def(o.attributes,"[",u,"]"),c=i.state,l=i.buffer,f=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function d(){t("if(!",s,".buffer){",a,".enableVertexAttribArray(",u,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",s,".type!==",o,"||",s,".size!==",n,"||",h.map((function(e){return s+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",34962,",",l,".buffer);",a,".vertexAttribPointer(",[u,n,o,i.normalized,i.stride,i.offset],");",s,".type=",o,";",s,".size=",n,";",h.map((function(e){return s+"."+e+"="+i[e]+";"})).join(""),"}"),y){var c=i.divisor;t("if(",s,".divisor!==",c,"){",e.instancing,".vertexAttribDivisorANGLE(",[u,c],");",s,".divisor=",c,";}")}}function p(){t("if(",s,".buffer){",a,".disableVertexAttribArray(",u,");",s,".buffer=null;","}if(",je.map((function(e,t){return s+"."+e+"!=="+f[t]})).join("||"),"){",a,".vertexAttrib4f(",u,",",f,");",je.map((function(e,t){return s+"."+e+"="+f[t]+";"})).join(""),"}")}1===c?d():2===c?p():(t("if(",c,"===",1,"){"),d(),t("}else{"),p(),t("}"))}(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),a)}))}function H(e,t,r,i,o){for(var a,u=e.shared,s=u.gl,c=0;c<i.length;++c){var l,f=i[c],h=f.name,d=f.info.type,p=r.uniforms[h],v=e.link(f)+".location";if(p){if(!o(p))continue;if(at(p)){var g=p.value;if(S.command(null!=g,'missing uniform "'+h+'"',e.commandStr),35678===d||35680===d){S.command("function"==typeof g&&(35678===d&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||35680===d&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+h,e.commandStr);var m=e.link(g._texture||g.color[0]._texture);t(s,".uniform1i(",v,",",m+".bind());"),t.exit(m,".unbind();")}else if(35674===d||35675===d||35676===d){S.optional((function(){S.command(ee(g),"invalid matrix for uniform "+h,e.commandStr),S.command(35674===d&&4===g.length||35675===d&&9===g.length||35676===d&&16===g.length,"invalid length for matrix uniform "+h,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),b=2;35675===d?b=3:35676===d&&(b=4),t(s,".uniformMatrix",b,"fv(",v,",false,",y,");")}else{switch(d){case 5126:S.commandType(g,"number","uniform "+h,e.commandStr),a="1f";break;case 35664:S.command(ee(g)&&2===g.length,"uniform "+h,e.commandStr),a="2f";break;case 35665:S.command(ee(g)&&3===g.length,"uniform "+h,e.commandStr),a="3f";break;case 35666:S.command(ee(g)&&4===g.length,"uniform "+h,e.commandStr),a="4f";break;case 35670:S.commandType(g,"boolean","uniform "+h,e.commandStr),a="1i";break;case 5124:S.commandType(g,"number","uniform "+h,e.commandStr),a="1i";break;case 35671:case 35667:S.command(ee(g)&&2===g.length,"uniform "+h,e.commandStr),a="2i";break;case 35672:case 35668:S.command(ee(g)&&3===g.length,"uniform "+h,e.commandStr),a="3i";break;case 35673:case 35669:S.command(ee(g)&&4===g.length,"uniform "+h,e.commandStr),a="4i"}t(s,".uniform",a,"(",v,",",ee(g)?Array.prototype.slice.call(g):g,");")}continue}l=p.append(e,t)}else{if(!o(ct))continue;l=t.def(u.uniforms,"[",n.id(h),"]")}35678===d?t("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}"):35680===d&&t("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}"),S.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){n("typeof "+l+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){n(u.isArrayLike+"("+l+")&&"+l+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){n("typeof "+l+'==="function"&&'+l+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:o(3553);break;case 35680:o(34067)}}));var _=1;switch(d){case 35678:case 35680:var x=t.def(l,"._texture");t(s,".uniform1i(",v,",",x,".bind());"),t.exit(x,".unbind();");continue;case 5124:case 35670:a="1i";break;case 35667:case 35671:a="2i",_=2;break;case 35668:case 35672:a="3i",_=3;break;case 35669:case 35673:a="4i",_=4;break;case 5126:a="1f";break;case 35664:a="2f",_=2;break;case 35665:a="3f",_=3;break;case 35666:a="4f",_=4;break;case 35674:a="Matrix2fv";break;case 35675:a="Matrix3fv";break;case 35676:a="Matrix4fv"}if(t(s,".uniform",a,"(",v,","),"M"===a.charAt(0)){var E=Math.pow(d-35674+2,2),A=e.global.def("new Float32Array(",E,")");t("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",R(E,(function(e){return A+"["+e+"]="+l+"["+e+"]"})),",",A,")")}else t(_>1?R(_,(function(e){return l+"["+e+"]"})):l);t(");")}}function W(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,u=r.draw,s=function(){var i,s=u.elements,c=t;return s?((s.contextDep&&r.contextDynamic||s.propDep)&&(c=n),i=s.append(e,c)):i=c.def(a,".",Ve),i&&c("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function c(i){var o=u[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var l,f,h=c(Ge),d=c(We),p=function(){var i,o=u.count,s=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(s=n),i=o.append(e,s),S.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(s,i+">=0","missing vertex count")}))):(i=s.def(a,".",He),S.optional((function(){e.assert(s,i+">=0","missing vertex count")}))),i}();if("number"==typeof p){if(0===p)return}else n("if(",p,"){"),n.exit("}");y&&(l=c(qe),f=e.instancing);var v=s+".type",g=u.elements&&at(u.elements);function m(){function e(){n(f,".drawElementsInstancedANGLE(",[h,p,v,d+"<<(("+v+"-5121)>>1)",l],");")}function t(){n(f,".drawArraysInstancedANGLE(",[h,d,p,l],");")}s?g?e():(n("if(",s,"){"),e(),n("}else{"),t(),n("}")):t()}function b(){function e(){n(o+".drawElements("+[h,p,v,d+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[h,d,p]+");")}s?g?e():(n("if(",s,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!=typeof l||l>=0)?"string"==typeof l?(n("if(",l,">0){"),m(),n("}else if(",l,"<0){"),b(),n("}")):m():b()}function q(e,t,n,r,i){var o=L(),a=o.proc("body",i);return S.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function X(e,t,n,r){U(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),G(e,t,n,r.attributes,(function(){return!0}))),H(e,t,n,r.uniforms,(function(){return!0})),W(e,t,t,n)}function Z(e,t,n,r){function i(){return!0}e.batchId="a1",U(e,t),G(e,t,n,r.attributes,i),H(e,t,n,r.uniforms,i),W(e,t,t,n)}function Y(e,t,n,r){U(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var u=e.scope(),s=e.scope();function c(e){return e.contextDep&&i||e.propDep}function l(e){return!c(e)}if(t(u.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",s,"}",u.exit),n.needsContext&&D(e,s,n.context),n.needsFramebuffer&&j(e,s,n.framebuffer),z(e,s,n.state,c),n.profile&&c(n.profile)&&B(e,s,n,!1,!0),r)n.useVAO?n.drawVAO?c(n.drawVAO)?s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):u(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(u(e.shared.vao,".setVAO(null);"),G(e,u,n,r.attributes,l),G(e,s,n,r.attributes,c)),H(e,u,n,r.uniforms,l),H(e,s,n,r.uniforms,c),W(e,u,s,n);else{var f=e.global.def("{}"),h=n.shader.progVar.append(e,s),d=s.def(h,".id"),p=s.def(f,"[",d,"]");s(e.shared.gl,".useProgram(",h,".program);","if(!",p,"){",p,"=",f,"[",d,"]=",e.link((function(t){return q(Z,e,n,t,2)})),"(",h,");}",p,".call(this,a0[",o,"],",o,");")}}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!ee(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(C.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,u=!1,s=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(C.isDynamic(n)){"function"==typeof n&&(n=r[t]=C.unbox(n));var o=st(n,null);a=a||o.thisDep,s=s||o.propDep,u=u||o.contextDep}else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new C.DynamicVariable(4,{thisDep:a,contextDep:u,propDep:s,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(C.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:x,current:_,procs:function(){var e=L(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,u=e.shared,s=u.gl,c=u.next,l=u.current;o(l,".dirty=false;"),j(e,t),j(e,n,null,!0),y&&(a=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var h=n.def(u.attributes,"[",f,"]"),d=e.cond(h,".buffer");d.then(s,".enableVertexAttribArray(",f,");",s,".bindBuffer(",34962,",",h,".buffer.buffer);",s,".vertexAttribPointer(",f,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(s,".disableVertexAttribArray(",f,");",s,".vertexAttrib4f(",f,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(d),y&&n(a,".vertexAttribDivisorANGLE(",f,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(A).forEach((function(r){var i=A[r],a=o.def(c,".",r),u=e.block();u("if(",a,"){",s,".enable(",i,")}else{",s,".disable(",i,")}",l,".",r,"=",a,";"),n(u),t("if(",a,"!==",l,".",r,"){",u,"}")})),Object.keys(w).forEach((function(r){var i,a,u=w[r],f=_[r],h=e.block();if(h(s,".",u,"("),ee(f)){var d=f.length;i=e.global.def(c,".",r),a=e.global.def(l,".",r),h(R(d,(function(e){return i+"["+e+"]"})),");",R(d,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",R(d,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",h,"}")}else i=o.def(c,".",r),a=o.def(l,".",r),h(i,");",l,".",r,"=",i,";"),t("if(",i,"!==",a,"){",h,"}");n(h)})),e.compile()}(),compile:function(e,t,r,i,o){var a=L();a.stats=a.link(o),Object.keys(t.static).forEach((function(e){Q(a,t,e)})),Ke.forEach((function(t){Q(a,e,t)}));var u=N(e,t,r,i,a);return function(e,t){var n=e.proc("draw",1);U(e,n),D(e,n,t.context),j(e,n,t.framebuffer),F(e,n,t),z(e,n,t.state),B(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)X(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return q(X,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,u),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}D(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),it(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);ee(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),B(e,r,t,!0,!0),[Ve,We,He,qe,Ge].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){r.set(i.uniforms,"["+n.id(o)+"]",t.uniforms[o].append(e,r))})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new g).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(Ue),a(Be),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(a,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",U(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(D(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function u(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||j(e,n,o)):j(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),F(e,n,t),z(e,n,t.state,(function(e){return!u(e)})),t.profile&&u(t.profile)||B(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var s=t.shader.progVar;if(s.contextDep&&r||s.propDep)Y(e,n,t,null);else{var c=s.append(e,n);if(n(e.shared.gl,".useProgram(",c,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),f=n.def(c,".id"),h=n.def(l,"[",f,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",l,"[",f,"]=",e.link((function(n){return q(Y,e,t,n,2)})),"(",c,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,u),a.compile()}}}var ft=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function u(e){a.push(e)}var s=[];function c(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,s.push(r)}var l=[],f=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),c(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:c,update:function(){var e,n,o=i.length;if(0!==o){f.length=Math.max(f.length,o+1),l.length=Math.max(l.length,o+1),l[0]=0,f[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var c=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(c,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),r(c)):i[e++]=c,l[n+1]=a,f[n+1]=e}for(i.length=e,e=0,n=0;n<s.length;++n){var h=s[n],d=h.startQueryIndex,p=h.endQueryIndex;h.sum+=l[p]-l[d];var v=f[d],g=f[p];g===v?(h.stats.gpuTime+=h.sum/1e6,u(h)):(h.startQueryIndex=v,h.endQueryIndex=g,s[e++]=h)}s.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function ht(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=P(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),u=function(e,t){var n={};function r(t){S.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!u)return null;var s,c,l=(s={"":0},c=[""],{id:function(e){var t=s[e];return t||(t=s[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),f={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},h=u.extensions,d=ft(0,h),p=M(),v=i.drawingBufferWidth,g=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:v,viewportHeight:g,framebufferWidth:v,framebufferHeight:g,drawingBufferWidth:v,drawingBufferHeight:g,pixelRatio:r.pixelRatio},y=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var u=e.createFramebuffer();if(e.bindFramebuffer(36160,u),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var s=D.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,s),e.getError()?o=!1:(e.deleteFramebuffer(u),e.deleteTexture(a),o=1===s[0]),D.freeType(s)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),f=D.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,f),D.freeType(f),e.bindTexture(34067,null),e.deleteTexture(l),c=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:c}}(i,h),b=function(t,n,r,i){var o=0,a={};function u(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}u.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},u.prototype.destroy=function(){f(this)};var s=[];function c(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function l(t,n,r,i,o,a){var u,s;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||5126,n.length>0)if(Array.isArray(n[0])){u=W(n);for(var l=1,f=1;f<u.length;++f)l*=u[f];t.dimension=l,c(t,s=H(n,u,t.dtype),r),a?t.persistentData=s:D.freeType(s)}else if("number"==typeof n[0]){t.dimension=o;var h=D.allocType(t.dtype,n.length);Z(h,n),c(t,h,r),a?t.persistentData=h:D.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||X(n[0])||5126,c(t,s=H(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=s:D.freeType(s)):S.raise("invalid buffer data")}else if(e(n))t.dtype=i||X(n),t.dimension=o,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(j(n)){u=n.shape;var d=n.stride,p=n.offset,v=0,g=0,m=0,y=0;1===u.length?(v=u[0],g=1,m=d[0],y=0):2===u.length?(v=u[0],g=u[1],m=d[0],y=d[1]):S.raise("invalid shape"),t.dtype=i||X(n.data)||5126,t.dimension=g;var b=D.allocType(t.dtype,v*g);Y(b,n.data,v,g,m,y,p),c(t,b,r),a?t.persistentData=b:D.freeType(b)}else n instanceof ArrayBuffer?(t.dtype=5121,t.dimension=o,c(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):S.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;S(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,s,c){n.bufferCount++;var h=new u(o);function d(n){var i=35044,o=null,a=0,u=0,s=1;return Array.isArray(n)||e(n)||j(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(S.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(S(null===o||Array.isArray(o)||e(o)||j(o),"invalid data for buffer"),o=n.data),"usage"in n&&(S.parameter(n.usage,G,"invalid buffer usage"),i=G[n.usage]),"type"in n&&(S.parameter(n.type,V,"invalid buffer type"),u=V[n.type]),"dimension"in n&&(S.type(n.dimension,"number","invalid dimension"),s=0|n.dimension),"length"in n&&(S.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),h.bind(),o?l(h,o,i,u,s,c):(a&&t.bufferData(h.type,a,i),h.dtype=u||5121,h.usage=i,h.dimension=s,h.byteLength=a),r.profile&&(h.stats.size=h.byteLength*q[h.dtype]),d}function p(e,n){S(n+e.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),t.bufferSubData(h.type,n,e)}return a[h.id]=h,s||d(i),d._reglType="buffer",d._buffer=h,d.subdata=function(t,n){var r,i=0|(n||0);if(h.bind(),e(t)||t instanceof ArrayBuffer)p(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=D.allocType(h.dtype,t.length);Z(o,t),p(o,i),D.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=W(t);var a=H(t,r,h.dtype);p(a,i),D.freeType(a)}else S.raise("invalid buffer data")}else if(j(t)){r=t.shape;var u=t.stride,s=0,c=0,l=0,f=0;1===r.length?(s=r[0],c=1,l=u[0],f=0):2===r.length?(s=r[0],c=r[1],l=u[0],f=u[1]):S.raise("invalid shape");var v=Array.isArray(t.data)?h.dtype:X(t.data),g=D.allocType(v,s*c);Y(g,t.data,s,c,l,f,t.offset),p(g,i),D.freeType(g)}else S.raise("invalid data for buffer subdata");return d},r.profile&&(d.stats=h.stats),d.destroy=function(){f(h)},d},createStream:function(e,t){var n=s.pop();return n||(n=new u(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){s.push(e)},clear:function(){F(a).forEach(f),s.forEach(f)},getBuffer:function(e){return e&&e._buffer instanceof u?e._buffer:null},restore:function(){F(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:l}}(i,f,r,(function(e){return _.destroyBuffer(e)})),_=function(t,n,r,i,o){for(var a=r.maxAttributes,u=new Array(a),s=0;s<a;++s)u[s]=new Re;var c=0,l={},f={Record:Re,scope:{},state:u,currentVAO:null,targetVAO:null,restore:h()?function(){h()&&F(l).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new p;function u(t){S(Array.isArray(t),"arguments to vertex array constructor must be an array"),S(t.length<a,"too many attributes"),S(t.length>0,"must specify at least one attribute");for(var i=0;i<r.buffers.length;++i)r.buffers[i].destroy();r.buffers.length=0;var s=r.attributes;s.length=t.length;for(var c=0;c<t.length;++c){var l=t[c],f=s[c]=new Re;if(Array.isArray(l)||e(l)||j(l)){var h=o.create(l,34962,!1,!0);f.buffer=o.getBuffer(h),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1,r.buffers.push(h)}else o.getBuffer(l)?(f.buffer=o.getBuffer(l),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1):o.getBuffer(l.buffer)?(f.buffer=o.getBuffer(l.buffer),f.size=0|(+l.size||f.buffer.dimension),f.normalized=!!l.normalized||!1,"type"in l?(S.parameter(l.type,V,"invalid buffer type"),f.type=V[l.type]):f.type=f.buffer.dtype,f.offset=0|(l.offset||0),f.stride=0|(l.stride||0),f.divisor=0|(l.divisor||0),f.state=1,S(f.size>=1&&f.size<=4,"size must be between 1 and 4"),S(f.offset>=0,"invalid offset"),S(f.stride>=0&&f.stride<=255,"stride must be between 0 and 255"),S(f.divisor>=0,"divisor must be positive"),S(!f.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in l?(S(c>0,"first attribute must not be a constant"),f.x=+l.x||0,f.y=+l.y||0,f.z=+l.z||0,f.w=+l.w||0,f.state=2):S(!1,"invalid attribute spec for location "+c)}return r.refresh(),u}return i.vaoCount+=1,u.destroy=function(){r.destroy()},u._vao=r,u._reglType="vao",u(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<u.length;++n){var r=u[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:h()?function(e){if(e!==f.currentVAO){var t=h();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),f.currentVAO=e}}:function(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else for(var n=d(),r=0;r<u.length;++r){var i=u[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}f.currentVAO=e}},clear:h()?function(){F(l).forEach((function(e){e.destroy()}))}:function(){}};function h(){return n.oes_vertex_array_object}function d(){return n.angle_instanced_arrays}function p(){this.id=++c,this.attributes=[];var e=h();this.vao=e?e.createVertexArrayOES():null,l[this.id]=this,this.buffers=[]}return p.prototype.bindAttrs=function(){for(var e=d(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},p.prototype.refresh=function(){var e=h();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=this)},p.prototype.destroy=function(){if(this.vao){var e=h();this===f.currentVAO&&(f.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}l[this.id]&&(delete l[this.id],i.vaoCount-=1)},f}(i,h,y,f,b),x=function(t,n,r,i){var o={},a=0,u={uint8:5121,uint16:5123};function s(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(u.uint32=5125),s.prototype.bind=function(){this.buffer.bind()};var c=[];function l(i,o,a,u,s,c,l){var f;if(i.buffer.bind(),o){var h=l;l||e(o)&&(!j(o)||e(o.data))||(h=n.oes_element_index_uint?5125:5123),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(34963,c,a),i.buffer.dtype=f||5121,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(f=l,!l){switch(i.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;break;case 5125:case 5124:f=5125;break;default:S.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,S(5125!==f||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=s;d<0&&(d=i.buffer.byteLength,5123===f?d>>=1:5125===f&&(d>>=2)),i.vertCount=d;var p=u;if(u<0){p=4;var v=i.buffer.dimension;1===v&&(p=0),2===v&&(p=1),3===v&&(p=4)}i.primType=p}function f(e){i.elementsCount--,S(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,34963,!0),a=new s(o._buffer);function c(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=5121;else{var n=null,r=35044,i=-1,s=-1,f=0,h=0;Array.isArray(t)||e(t)||j(t)?n=t:(S.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,S(Array.isArray(n)||e(n)||j(n),"invalid data for element buffer")),"usage"in t&&(S.parameter(t.usage,G,"invalid element buffer usage"),r=G[t.usage]),"primitive"in t&&(S.parameter(t.primitive,K,"invalid element buffer primitive"),i=K[t.primitive]),"count"in t&&(S("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),s=0|t.count),"type"in t&&(S.parameter(t.type,u,"invalid buffer type"),h=u[t.type]),"length"in t?f=0|t.length:(f=s,5123===h||5122===h?f*=2:5125!==h&&5124!==h||(f*=4))),l(a,n,r,i,s,f,h)}else o(),a.primType=4,a.vertCount=0,a.type=5121;return c}return i.elementsCount++,c(t),c._reglType="elements",c._elements=a,c.subdata=function(e,t){return o.subdata(e,t),c},c.destroy=function(){f(a)},c},createStream:function(e){var t=c.pop();return t||(t=new s(r.create(null,34963,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){c.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof s?e._elements:null},clear:function(){F(o).forEach(f)}}}(i,h,b,f),E=function(e,t,n,r){var i={},o={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function s(n,r,a){var u=35632===n?i:o,s=u[r];if(!s){var c=t.str(r);s=e.createShader(n),e.shaderSource(s,c),e.compileShader(s),S.shaderError(e,s,c,n,a),u[r]=s}return s}var c={},l=[],f=0;function h(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,i,o){var c,l,f=s(35632,n.fragId),h=s(35633,n.vertId),d=n.program=e.createProgram();if(e.attachShader(d,f),e.attachShader(d,h),o)for(c=0;c<o.length;++c){var p=o[c];e.bindAttribLocation(d,p[0],p[1])}e.linkProgram(d),S.linkError(e,d,t.str(n.fragId),t.str(n.vertId),i);var v=e.getProgramParameter(d,35718);r.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(c=0;c<v;++c)if(l=e.getActiveUniform(d,c))if(l.size>1)for(var m=0;m<l.size;++m){var y=l.name.replace("[0]","["+m+"]");u(g,new a(y,t.id(y),e.getUniformLocation(d,y),l))}else u(g,new a(l.name,t.id(l.name),e.getUniformLocation(d,l.name),l));var b=e.getProgramParameter(d,35721);r.profile&&(n.stats.attributesCount=b);var _=n.attributes;for(c=0;c<b;++c)(l=e.getActiveAttrib(d,c))&&u(_,new a(l.name,t.id(l.name),e.getAttribLocation(d,l.name),l))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return l.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return l.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);F(i).forEach(t),i={},F(o).forEach(t),o={},l.forEach((function(t){e.deleteProgram(t.program)})),l.length=0,c={},n.shaderCount=0},program:function(e,t,r,i){S.command(e>=0,"missing vertex shader",r),S.command(t>=0,"missing fragment shader",r);var o=c[t];o||(o=c[t]={});var a=o[e];if(a&&!i)return a;var u=new h(t,e);return n.shaderCount++,d(u,r,i),a||(o[e]=u),l.push(u),u},restore:function(){i={},o={};for(var e=0;e<l.length;++e)d(l[e],null,l[e].attributes.map((function(e){return[e.location,e.name]})))},shader:s,frag:-1,vert:-1}}(i,l,f,r),A=we(i,h,y,(function(){I.procs.poll()}),m,f,r),w=function(e,t,n,r,i){var o={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var u=0,s={};function c(e){this.id=u++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;S(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete s[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(s).forEach((function(t){e+=s[t].stats.size})),e}),{create:function(t,u){var l=new c(e.createRenderbuffer());function f(t,r){var u=0,s=0,c=32854;if("object"==typeof t&&t){var h=t;if("shape"in h){var d=h.shape;S(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),u=0|d[0],s=0|d[1]}else"radius"in h&&(u=s=0|h.radius),"width"in h&&(u=0|h.width),"height"in h&&(s=0|h.height);"format"in h&&(S.parameter(h.format,o,"invalid renderbuffer format"),c=o[h.format])}else"number"==typeof t?(u=0|t,s="number"==typeof r?0|r:u):t?S.raise("invalid arguments to renderbuffer constructor"):u=s=1;if(S(u>0&&s>0&&u<=n.maxRenderbufferSize&&s<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==l.width||s!==l.height||c!==l.format)return f.width=l.width=u,f.height=l.height=s,l.format=c,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,c,u,s),S(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Ce(l.format,l.width,l.height)),f.format=a[l.format],f}return s[l.id]=l,r.renderbufferCount++,f(t,u),f.resize=function(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height||(S(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=l.width=o,f.height=l.height=a,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,l.format,o,a),S(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Ce(l.format,l.width,l.height))),f},f._reglType="renderbuffer",f._renderbuffer=l,i.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f},clear:function(){F(s).forEach(l)},restore:function(){F(s).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(i,h,y,f,r),T=function(e,n,r,i,o,a){var u={cur:null,next:null,dirty:!1,setFBO:null},s=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function f(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);S(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;S(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=3553,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),S.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,S(3553===t)):"textureCube"===o?(n=i,S(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=36161):S.raise("invalid regl object for attachment"),new f(t,n,r)}function g(e,t,n,r,a){if(n){var u=i.create2D({width:e,height:t,format:r,type:a});return u._texture.refCount=0,new f(3553,u,null)}var s=o.create({width:e,height:t,format:r});return s._renderbuffer.refCount=0,new f(36161,null,s)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var b=0,_={};function x(){this.id=b++,_[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function E(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function A(t){var n=t.framebuffer;S(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete _[t.id]}function w(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)p(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),p(36096,t.depthAttachment),p(36128,t.stencilAttachment),p(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(36160);e.isContextLost()||36053===o||S.raise("framebuffer configuration not supported, status = "+Pe[o]),e.bindFramebuffer(36160,u.next?u.next.framebuffer:null),u.cur=u.next,e.getError()}function T(e,i){var o=new x;function f(e,t){var i;S(u.next!==o,"can not update framebuffer which is currently in use");var a=0,h=0,p=!0,y=!0,b=null,_=!0,x="rgba",A="uint8",T=1,C=null,k=null,M=null,I=!1;if("number"==typeof e)a=0|e,h=0|t||a;else if(e){S.type(e,"object","invalid arguments for framebuffer");var O=e;if("shape"in O){var P=O.shape;S(Array.isArray(P)&&P.length>=2,"invalid shape for framebuffer"),a=P[0],h=P[1]}else"radius"in O&&(a=h=O.radius),"width"in O&&(a=O.width),"height"in O&&(h=O.height);("color"in O||"colors"in O)&&(b=O.color||O.colors,Array.isArray(b)&&S(1===b.length||n.webgl_draw_buffers,"multiple render targets not supported")),b||("colorCount"in O&&(T=0|O.colorCount,S(T>0,"invalid color buffer count")),"colorTexture"in O&&(_=!!O.colorTexture,x="rgba4"),"colorType"in O&&(A=O.colorType,_?(S(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),S(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(S(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==A&&"float32"!==A||(S(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),S.oneOf(A,l,"invalid color type")),"colorFormat"in O&&(x=O.colorFormat,s.indexOf(x)>=0?_=!0:c.indexOf(x)>=0?_=!1:_?S.oneOf(O.colorFormat,s,"invalid color format for texture"):S.oneOf(O.colorFormat,c,"invalid color format for renderbuffer"))),("depthTexture"in O||"depthStencilTexture"in O)&&(I=!(!O.depthTexture&&!O.depthStencilTexture),S(!I||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in O&&("boolean"==typeof O.depth?p=O.depth:(C=O.depth,y=!1)),"stencil"in O&&("boolean"==typeof O.stencil?y=O.stencil:(k=O.stencil,p=!1)),"depthStencil"in O&&("boolean"==typeof O.depthStencil?p=y=O.depthStencil:(M=O.depthStencil,p=!1,y=!1))}else a=h=1;var R=null,L=null,N=null,D=null;if(Array.isArray(b))R=b.map(v);else if(b)R=[v(b)];else for(R=new Array(T),i=0;i<T;++i)R[i]=g(a,h,_,x,A);S(n.webgl_draw_buffers||R.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),S(R.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||R[0].width,h=h||R[0].height,C?L=v(C):p&&!y&&(L=g(a,h,I,"depth","uint32")),k?N=v(k):y&&!p&&(N=g(a,h,!1,"stencil","uint8")),M?D=v(M):!C&&!k&&y&&p&&(D=g(a,h,I,"depth stencil","depth stencil")),S(!!C+!!k+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var j=null;for(i=0;i<R.length;++i)if(d(R[i],a,h),S(!R[i]||R[i].texture&&ke.indexOf(R[i].texture._texture.format)>=0||R[i].renderbuffer&&Oe.indexOf(R[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),R[i]&&R[i].texture){var F=Me[R[i].texture._texture.format]*Ie[R[i].texture._texture.type];null===j?j=F:S(j===F,"all color attachments much have the same number of bits per pixel.")}return d(L,a,h),S(!L||L.texture&&6402===L.texture._texture.format||L.renderbuffer&&33189===L.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),d(N,a,h),S(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),d(D,a,h),S(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),E(o),o.width=a,o.height=h,o.colorAttachments=R,o.depthAttachment=L,o.stencilAttachment=N,o.depthStencilAttachment=D,f.color=R.map(m),f.depth=m(L),f.stencil=m(N),f.depthStencil=m(D),f.width=o.width,f.height=o.height,w(o),f}return a.framebufferCount++,f(e,i),t(f,{resize:function(e,t){S(u.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return f;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=f.width=n,o.height=f.height=r,w(o),f},_reglType:"framebuffer",_framebuffer:o,destroy:function(){A(o),E(o)},use:function(e){u.setFBO({framebuffer:f},e)}})}return t(u,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:T,createCube:function(e){var o=Array(6);function a(e){var r;S(o.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var c,f={color:null},h=0,d=null,p="rgba",v="uint8",g=1;if("number"==typeof e)h=0|e;else if(e){S.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;S(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),S(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in m&&(h=0|m.radius),"width"in m?(h=0|m.width,"height"in m&&S(m.height===h,"must be square")):"height"in m&&(h=0|m.height);("color"in m||"colors"in m)&&(d=m.color||m.colors,Array.isArray(d)&&S(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in m&&(g=0|m.colorCount,S(g>0,"invalid color buffer count")),"colorType"in m&&(S.oneOf(m.colorType,l,"invalid color type"),v=m.colorType),"colorFormat"in m&&(p=m.colorFormat,S.oneOf(m.colorFormat,s,"invalid color format for texture"))),"depth"in m&&(f.depth=m.depth),"stencil"in m&&(f.stencil=m.stencil),"depthStencil"in m&&(f.depthStencil=m.depthStencil)}else h=1;if(d)if(Array.isArray(d))for(c=[],r=0;r<d.length;++r)c[r]=d[r];else c=[d];else{c=Array(g);var b={radius:h,format:p,type:v};for(r=0;r<g;++r)c[r]=i.createCube(b)}for(f.color=Array(c.length),r=0;r<c.length;++r){var _=c[r];S("function"==typeof _&&"textureCube"===_._reglType,"invalid cube map"),h=h||_.width,S(_.width===h&&_.height===h,"invalid cube map shape"),f.color[r]={target:34069,data:c[r]}}for(r=0;r<6;++r){for(var x=0;x<c.length;++x)f.color[x].target=34069+r;r>0&&(f.depth=o[0].depth,f.stencil=o[0].stencil,f.depthStencil=o[0].depthStencil),o[r]?o[r](f):o[r]=T(f)}return t(a,{width:h,height:h,color:c})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(S(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){F(_).forEach(A)},restore:function(){u.cur=null,u.next=null,u.dirty=!0,F(_).forEach((function(t){t.framebuffer=e.createFramebuffer(),w(t)}))}})}(i,h,y,A,w,f),I=lt(i,l,h,y,b,x,0,T,{},_,E,{elements:null,primitive:4,count:-1,offset:0,instances:-1},m,d,r),O=Le(i,T,I.procs.poll,m,o,h,y),R=I.next,L=i.canvas,N=[],z=[],U=[],B=[r.onDestroy],Q=null;function J(){if(0===N.length)return d&&d.update(),void(Q=null);Q=k.next(J),se();for(var e=N.length-1;e>=0;--e){var t=N[e];t&&t(m,null,0)}i.flush(),d&&d.update()}function $(){!Q&&N.length>0&&(Q=k.next(J))}function ee(){Q&&(k.cancel(J),Q=null)}function te(e){e.preventDefault(),a=!0,ee(),z.forEach((function(e){e()}))}function ne(e){i.getError(),a=!1,u.restore(),E.restore(),b.restore(),A.restore(),w.restore(),T.restore(),_.restore(),d&&d.restore(),I.procs.refresh(),$(),U.forEach((function(e){e()}))}function re(e){function n(e){var t={},n={};return Object.keys(e).forEach((function(r){var i=e[r];C.isDynamic(i)?n[r]=C.unbox(i,r):t[r]=i})),{dynamic:n,static:t}}S(!!e,"invalid args to regl({...})"),S.type(e,"object","invalid args to regl({...})");var r=n(e.context||{}),i=n(e.uniforms||{}),o=n(e.attributes||{}),u=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e)),s={gpuTime:0,cpuTime:0,count:0},c=I.compile(u,o,i,r,s),l=c.draw,f=c.batch,h=c.scope,d=[];return t((function(e,t){var n;if(a&&S.raise("context lost"),"function"==typeof e)return h.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)h.call(this,null,t,n);else{if(!Array.isArray(e))return h.call(this,e,t,0);for(n=0;n<e.length;++n)h.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return f.call(this,function(e){for(;d.length<e;)d.push(null);return d}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return f.call(this,e,e.length)}}),{stats:s})}L&&(L.addEventListener("webglcontextlost",te,!1),L.addEventListener("webglcontextrestored",ne,!1));var ie=T.setFBO=re({framebuffer:C.define.call(null,1,"framebuffer")});function oe(e,t){var n=0;I.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),S(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function ae(e){return S.type(e,"function","regl.frame() callback must be a function"),N.push(e),$(),{cancel:function(){var t=ht(N,e);S(t>=0,"cannot cancel a frame twice"),N[t]=function e(){var t=ht(N,e);N[t]=N[N.length-1],N.length-=1,N.length<=0&&ee()}}}}function ue(){var e=R.viewport,t=R.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function se(){m.tick+=1,m.time=le(),ue(),I.procs.poll()}function ce(){ue(),I.procs.refresh(),d&&d.update()}function le(){return(M()-p)/1e3}ce();var fe=t(re,{clear:function(e){if(S("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)ie(t({framebuffer:e.framebuffer.faces[n]},e),oe);else ie(e,oe);else oe(0,e)},prop:C.define.bind(null,1),context:C.define.bind(null,2),this:C.define.bind(null,3),draw:re({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:w.create,framebuffer:T.create,framebufferCube:T.createCube,vao:_.createVAO,attributes:o,frame:ae,on:function(e,t){var n;switch(S.type(t,"function","listener callback must be a function"),e){case"frame":return ae(t);case"lost":n=z;break;case"restore":n=U;break;case"destroy":n=B;break;default:S.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:y,hasExtension:function(e){return y.extensions.indexOf(e.toLowerCase())>=0},read:O,destroy:function(){N.length=0,ee(),L&&(L.removeEventListener("webglcontextlost",te),L.removeEventListener("webglcontextrestored",ne)),E.clear(),T.clear(),w.clear(),A.clear(),x.clear(),b.clear(),_.clear(),d&&d.clear(),B.forEach((function(e){e()}))},_gl:i,_refresh:ce,poll:function(){se(),d&&d.update()},now:le,stats:f});return r.onDone(null,fe),fe}}()})),Ow=function(){function e(t,n){Gi(this,e),this.attribute=void 0,this.buffer=void 0;var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,u=n.size,s=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:s||0},u&&(this.attribute.size=u)}return Wi(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Pw=(qi(gw={},e.gl.POINTS,"points"),qi(gw,e.gl.LINES,"lines"),qi(gw,e.gl.LINE_LOOP,"line loop"),qi(gw,e.gl.LINE_STRIP,"line strip"),qi(gw,e.gl.TRIANGLES,"triangles"),qi(gw,e.gl.TRIANGLE_FAN,"triangle fan"),qi(gw,e.gl.TRIANGLE_STRIP,"triangle strip"),gw),Rw=(qi(mw={},e.gl.STATIC_DRAW,"static"),qi(mw,e.gl.DYNAMIC_DRAW,"dynamic"),qi(mw,e.gl.STREAM_DRAW,"stream"),mw),Lw=(qi(yw={},e.gl.BYTE,"int8"),qi(yw,e.gl.UNSIGNED_INT,"int16"),qi(yw,e.gl.INT,"int32"),qi(yw,e.gl.UNSIGNED_BYTE,"uint8"),qi(yw,e.gl.UNSIGNED_SHORT,"uint16"),qi(yw,e.gl.UNSIGNED_INT,"uint32"),qi(yw,e.gl.FLOAT,"float"),yw),Nw=(qi(bw={},e.gl.ALPHA,"alpha"),qi(bw,e.gl.LUMINANCE,"luminance"),qi(bw,e.gl.LUMINANCE_ALPHA,"luminance alpha"),qi(bw,e.gl.RGB,"rgb"),qi(bw,e.gl.RGBA,"rgba"),qi(bw,e.gl.RGBA4,"rgba4"),qi(bw,e.gl.RGB5_A1,"rgb5 a1"),qi(bw,e.gl.RGB565,"rgb565"),qi(bw,e.gl.DEPTH_COMPONENT,"depth"),qi(bw,e.gl.DEPTH_STENCIL,"depth stencil"),bw),Dw=(qi(_w={},e.gl.DONT_CARE,"dont care"),qi(_w,e.gl.NICEST,"nice"),qi(_w,e.gl.FASTEST,"fast"),_w),jw=(qi(xw={},e.gl.NEAREST,"nearest"),qi(xw,e.gl.LINEAR,"linear"),qi(xw,e.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),qi(xw,e.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),qi(xw,e.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),qi(xw,e.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),xw),Fw=(qi(Sw={},e.gl.REPEAT,"repeat"),qi(Sw,e.gl.CLAMP_TO_EDGE,"clamp"),qi(Sw,e.gl.MIRRORED_REPEAT,"mirror"),Sw),zw=(qi(Ew={},e.gl.NONE,"none"),qi(Ew,e.gl.BROWSER_DEFAULT_WEBGL,"browser"),Ew),Uw=(qi(Aw={},e.gl.NEVER,"never"),qi(Aw,e.gl.ALWAYS,"always"),qi(Aw,e.gl.LESS,"less"),qi(Aw,e.gl.LEQUAL,"lequal"),qi(Aw,e.gl.GREATER,"greater"),qi(Aw,e.gl.GEQUAL,"gequal"),qi(Aw,e.gl.EQUAL,"equal"),qi(Aw,e.gl.NOTEQUAL,"notequal"),Aw),Bw=(qi(ww={},e.gl.FUNC_ADD,"add"),qi(ww,e.gl.MIN_EXT,"min"),qi(ww,e.gl.MAX_EXT,"max"),qi(ww,e.gl.FUNC_SUBTRACT,"subtract"),qi(ww,e.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ww),Vw=(qi(Tw={},e.gl.ZERO,"zero"),qi(Tw,e.gl.ONE,"one"),qi(Tw,e.gl.SRC_COLOR,"src color"),qi(Tw,e.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),qi(Tw,e.gl.SRC_ALPHA,"src alpha"),qi(Tw,e.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),qi(Tw,e.gl.DST_COLOR,"dst color"),qi(Tw,e.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),qi(Tw,e.gl.DST_ALPHA,"dst alpha"),qi(Tw,e.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),qi(Tw,e.gl.CONSTANT_COLOR,"constant color"),qi(Tw,e.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),qi(Tw,e.gl.CONSTANT_ALPHA,"constant alpha"),qi(Tw,e.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),qi(Tw,e.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Tw),Gw=(qi(Cw={},e.gl.NEVER,"never"),qi(Cw,e.gl.ALWAYS,"always"),qi(Cw,e.gl.LESS,"less"),qi(Cw,e.gl.LEQUAL,"lequal"),qi(Cw,e.gl.GREATER,"greater"),qi(Cw,e.gl.GEQUAL,"gequal"),qi(Cw,e.gl.EQUAL,"equal"),qi(Cw,e.gl.NOTEQUAL,"notequal"),Cw),Hw=(qi(kw={},e.gl.ZERO,"zero"),qi(kw,e.gl.KEEP,"keep"),qi(kw,e.gl.REPLACE,"replace"),qi(kw,e.gl.INVERT,"invert"),qi(kw,e.gl.INCR,"increment"),qi(kw,e.gl.DECR,"decrement"),qi(kw,e.gl.INCR_WRAP,"increment wrap"),qi(kw,e.gl.DECR_WRAP,"decrement wrap"),kw),Ww=(qi(Mw={},e.gl.FRONT,"front"),qi(Mw,e.gl.BACK,"back"),Mw),qw=function(){function t(n,r){Gi(this,t),this.buffer=void 0;var i=r.data,o=r.usage,a=r.type;this.buffer=n.buffer({data:i,usage:Rw[o||e.gl.STATIC_DRAW],type:Lw[a||e.gl.UNSIGNED_BYTE]})}return Wi(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),t}(),Xw=function(){function t(n,r){Gi(this,t),this.elements=void 0;var i=r.data,o=r.usage,a=r.type,u=r.count;this.elements=n.elements({data:i,usage:Rw[o||e.gl.STATIC_DRAW],type:Lw[a||e.gl.UNSIGNED_BYTE],count:u})}return Wi(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),t}(),Zw=function(){function e(t,n){Gi(this,e),this.framebuffer=void 0;var r=n.width,i=n.height,o=n.color,a=n.colors,u=(n.depth,n.stencil,{width:r,height:i});Array.isArray(a)&&(u.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(u.color=o.get()),this.framebuffer=t.framebuffer(u)}return Wi(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),Yw=ce.f,Kw=function(e){return function(t){for(var n,r=ge(t),i=Dt(r),o=i.length,a=0,u=[];o>a;)n=i[a++],ae&&!Yw.call(r,n)||u.push(e?[n,r[n]]:r[n]);return u}},Qw={entries:Kw(!0),values:Kw(!1)}.values;Ot({target:"Object",stat:!0},{values:function(e){return Qw(e)}});var Jw,$w,eT,tT,nT,rT,iT,oT,aT,uT,sT,cT,lT,fT,hT,dT,pT,vT,gT,mT=function(){function t(n,r){Gi(this,t),this.reGl=void 0,this.destroyed=!1,this.drawCommand=void 0,this.drawParams=void 0,this.options=void 0,this.uniforms={},this.reGl=n;var i=r.vs,o=r.fs,a=r.attributes,u=r.uniforms,s=r.primitive,c=r.count,l=r.elements,f=r.depth,h=r.blend,d=r.stencil,p=r.cull,v=r.instances,g={};this.options=r,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach((function(e){g[e]=n.prop(e)})));var m={};Object.keys(a).forEach((function(e){m[e]=a[e].get()}));var y={attributes:m,frag:o,uniforms:g,vert:i,primitive:Pw[void 0===s?e.gl.TRIANGLES:s]};v&&(y.instances=v),c&&(y.count=c),l&&(y.elements=l.get()),this.initDepthDrawParams({depth:f},y),this.initBlendDrawParams({blend:h},y),this.initStencilDrawParams({stencil:d},y),this.initCullDrawParams({cull:p},y),this.drawCommand=n(y),this.drawParams=y}return Wi(t,[{key:"addUniforms",value:function(e){this.uniforms=Zi(Zi({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var t=Zi(Zi({},this.uniforms),this.extractUniforms(e.uniforms||{})),n={};Object.keys(t).forEach((function(e){var r=Ui(t[e]);"boolean"===r||"number"===r||Array.isArray(t[e])||t[e].BYTES_PER_ELEMENT?n[e]=t[e]:n[e]=t[e].get()})),this.drawCommand(n)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:void 0===r.enable||!!r.enable,mask:void 0===r.mask||!!r.mask,func:Uw[r.func||e.gl.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var i=r.enable,o=r.func,a=r.equation,u=r.color,s=void 0===u?[0,0,0,0]:u;n.blend={enable:!!i,func:{srcRGB:Vw[o&&o.srcRGB||e.gl.SRC_ALPHA],srcAlpha:Vw[o&&o.srcAlpha||e.gl.SRC_ALPHA],dstRGB:Vw[o&&o.dstRGB||e.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Vw[o&&o.dstAlpha||e.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Bw[a&&a.rgb||e.gl.FUNC_ADD],alpha:Bw[a&&a.alpha||e.gl.FUNC_ADD]},color:s}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var i=r.enable,o=r.mask,a=void 0===o?-1:o,u=r.func,s=void 0===u?{cmp:e.gl.ALWAYS,ref:0,mask:-1}:u,c=r.opFront,l=void 0===c?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:c,f=r.opBack,h=void 0===f?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:f;n.stencil={enable:!!i,mask:a,func:Zi(Zi({},s),{},{cmp:Gw[s.cmp]}),opFront:{fail:Hw[l.fail],zfail:Hw[l.zfail],zpass:Hw[l.zpass]},opBack:{fail:Hw[h.fail],zfail:Hw[h.zfail],zpass:Hw[h.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var i=r.enable,o=r.face,a=void 0===o?e.gl.BACK:o;n.cull={enable:!!i,face:Ww[a]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||ty(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Ym(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),t}(),yT=function(){function t(n,r){Gi(this,t),this.texture=void 0,this.width=void 0,this.height=void 0;var i=r.data,o=r.type,a=void 0===o?e.gl.UNSIGNED_BYTE:o,u=r.width,s=r.height,c=r.flipY,l=void 0!==c&&c,f=r.format,h=void 0===f?e.gl.RGBA:f,d=r.mipmap,p=void 0!==d&&d,v=r.wrapS,g=void 0===v?e.gl.CLAMP_TO_EDGE:v,m=r.wrapT,y=void 0===m?e.gl.CLAMP_TO_EDGE:m,b=r.aniso,_=void 0===b?0:b,x=r.alignment,S=void 0===x?1:x,E=r.premultiplyAlpha,A=void 0!==E&&E,w=r.mag,T=void 0===w?e.gl.NEAREST:w,C=r.min,k=void 0===C?e.gl.NEAREST:C,M=r.colorSpace,I=void 0===M?e.gl.BROWSER_DEFAULT_WEBGL:M;this.width=u,this.height=s;var O={width:u,height:s,type:Lw[a],format:Nw[h],wrapS:Fw[g],wrapT:Fw[y],mag:jw[T],min:jw[k],alignment:S,flipY:l,colorSpace:zw[I],premultiplyAlpha:A,aniso:_};i&&(O.data=i),"number"==typeof p?O.mipmap=Dw[p]:"boolean"==typeof p&&(O.mipmap=p),this.texture=n.texture(O)}return Wi(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"destroy",value:function(){this.texture.destroy()}}]),t}(),bT=Q()(Jw=function(){function e(){var t=this;Gi(this,e),this.gl=void 0,this.$container=void 0,this.width=void 0,this.height=void 0,this.isDirty=void 0,this.createModel=function(e){return new mT(t.gl,e)},this.createAttribute=function(e){return new Ow(t.gl,e)},this.createBuffer=function(e){return new qw(t.gl,e)},this.createElements=function(e){return new Xw(t.gl,e)},this.createTexture2D=function(e){return new yT(t.gl,e)},this.createFramebuffer=function(e){return new Zw(t.gl,e)},this.useFramebuffer=function(e,n){t.gl({framebuffer:e?e.get():null})(n)},this.clear=function(e){var n=e.color,r=e.depth,i=e.stencil,o=e.framebuffer,a=void 0===o?null:o,u={color:n,depth:r,stencil:i};u.framebuffer=null===a?a:a.get(),t.gl.clear(u)},this.viewport=function(e){var n,r=e.x,i=e.y,o=e.width,a=e.height,u=null===(n=t.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0];u&&(u.width=o,u.height=a,u.style.width=o/2+"px",u.style.height=a/2+"px"),t.gl._gl.viewport(r,i,o,a),t.width=o,t.height=a,t.gl._refresh()},this.readPixels=function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)},this.getViewportSize=function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}},this.getContainer=function(){return t.$container},this.getCanvas=function(){var e;return(null===(e=t.$container)||void 0===e?void 0:e.getElementsByTagName("canvas")[0])||null},this.getGLContext=function(){return t.gl._gl},this.destroy=function(){t.gl.destroy()}}var t;return Wi(e,[{key:"init",value:(t=Vi(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.$container=t,e.next=3,new Promise((function(e,r){Iw({container:t,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(t,n){!t&&n||r(t),e(n)}})}));case 3:this.gl=e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Jw,_T=function(){function e(t){Gi(this,e),this.sceneService=void 0,this.mapService=void 0,this.controlService=void 0,this.layerService=void 0,this.iconService=void 0,this.markerService=void 0,this.popupService=void 0,this.fontService=void 0,this.interactionService=void 0,this.container=void 0;var n=t.id,r=t.map,i=NA();this.container=i,r.setContainer(i,n),i.bind(nr.IRendererService).to(bT).inSingletonScope(),this.sceneService=i.get(nr.ISceneService),this.mapService=i.get(nr.IMapService),this.iconService=i.get(nr.IIconService),this.fontService=i.get(nr.IFontService),this.controlService=i.get(nr.IControlService),this.layerService=i.get(nr.ILayerService),this.markerService=i.get(nr.IMarkerService),this.interactionService=i.get(nr.IInteractionService),this.popupService=i.get(nr.IPopupService),this.initComponent(n),this.sceneService.init(t),this.initControl()}return Wi(e,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(e){return this.sceneService.exportPng(e)}},{key:"exportMap",value:function(e){return this.sceneService.exportPng(e)}},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"addLayer",value:function(e){var t=DA(this.container);e.setContainer(t),this.sceneService.addLayer(e)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:function(e){this.layerService.remove(e)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addImage",value:function(e,t){this.iconService.addImage(e,t)}},{key:"hasImage",value:function(e){this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"on",value:function(e,t){-1===tw.indexOf(e)?this.mapService.on(e,t):this.sceneService.on(e,t)}},{key:"off",value:function(e,t){-1===tw.indexOf(e)?this.mapService.off(e,t):this.sceneService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(){return this.mapService.getCenter()}},{key:"setCenter",value:function(e){return this.mapService.setCenter(e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e){this.mapService.panTo(e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||Zi(Zi({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(nr.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"initComponent",value:function(e){this.controlService.init({container:xa(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new ow({position:n}))}},{key:"map",get:function(){return this.mapService.map}}]),e}(),xT=($w=RA(nr.ILogService),eT=RA(nr.IGlobalConfigService),nT=ho((tT=function(){function e(t){Gi(this,e),fo(this,"logger",nT,this),fo(this,"configService",rT,this),this.config=void 0,this.config=t}return Wi(e,[{key:"setContainer",value:function(e,t){e.bind(nr.MapConfig).toConstantValue(Zi(Zi({},this.config),{},{id:t})),e.bind(nr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}()).prototype,"logger",[$w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rT=ho(tT.prototype,"configService",[eT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tT),ST={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},ET=Math.PI/180,AT=function(){function e(){Gi(this,e),this.projectionMatrix=Yp(),this.viewMatrix=Yp(),this.viewProjectionMatrix=Yp(),this.ViewProjectionMatrixUncentered=Yp(),this.viewUncenteredMatrix=Yp(),this.zoom=void 0,this.center=void 0}return Wi(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,o=e.bearing,a=void 0===o?0:o,u=e.center,s=void 0===u?[0,0]:u,c=e.offsetOrigin,l=void 0===c?[0,0]:c,f=e.cameraHeight,h=void 0===f?1:f,d=e.aspect,p=void 0===d?1:d,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,b=e.fov,_=void 0===b?0:b;this.zoom=n,this.center=s;var x=i*ET,S=(360-a)*ET;cv(this.projectionMatrix,_,p,g,y);var E=yv(h*Math.sin(x)*Math.sin(S),-h*Math.sin(x)*Math.cos(S),h*Math.cos(x)),A=yv(-Math.cos(x)*Math.sin(S),Math.cos(x)*Math.cos(S),Math.sin(x));lv(this.viewMatrix,E,yv(0,0,0),A),this.viewUncenteredMatrix=Kp(this.viewMatrix),tv(this.viewMatrix,this.viewMatrix,yv(-l[0],l[1],0)),ev(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),ev(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=ao(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){var n=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),r=Math.PI/180,i=e[0]*r,o=n*r;o=Math.log(Math.tan(Math.PI/4+o/2));return[i=(256<<20)*(.5/Math.PI*i+.5)-215440491,o=-((256<<20)*(-.5/Math.PI*o+(r=.5))-106744817)]}}]),e}(),wT=0;window.forceWebGL=!0;var TT=!1,CT=[],kT=(iT=Q(),oT=J(nr.IGlobalConfigService),aT=J(nr.ILogService),uT=J(nr.MapConfig),sT=J(nr.ICoordinateSystemService),cT=J(nr.IEventEmitter),iT((hT=ho((fT=function(){function t(){var n=this;Gi(this,t),this.map=void 0,fo(this,"configService",hT,this),fo(this,"logger",dT,this),fo(this,"config",pT,this),fo(this,"coordinateSystemService",vT,this),fo(this,"eventEmitter",gT,this),this.markerContainer=void 0,this.$mapContainer=void 0,this.viewport=void 0,this.cameraChangedCallback=void 0,this.handleCameraChanged=function(t){var r=t.camera,i=r.fov,o=r.near,a=r.far,u=r.height,s=r.pitch,c=r.rotation,l=r.aspect,f=r.position,h=n.getCenter(),d=h.lng,p=h.lat;n.cameraChangedCallback&&(n.viewport.syncWithMapCamera({aspect:l,bearing:360-c,far:a,fov:i,cameraHeight:u,near:o,pitch:s,zoom:n.map.getZoom()-1,center:[d,p],offsetOrigin:[f.x,f.y]}),n.viewport.getZoom()>12?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20),n.cameraChangedCallback(n.viewport))}}var n;return Wi(t,[{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=Aa("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==$A.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(e,t)}},{key:"off",value:function(e,t){-1!==$A.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){var e=this.map.getCenter();return{lng:e.getLng(),lat:e.getLat()}}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e){this.map.panTo(e)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyle(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=Yp();return tv(o,o,yv(i[0],i[1],t)),nv(o,o,yv(r[0],r[1],r[2])),rv(o,o,n[0]),iv(o,o,n[1]),ov(o,o,n[2]),o}},{key:"init",value:(n=Vi(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,u,s,c,l,f,h,d,p,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,u=t.maxZoom,s=void 0===u?18:u,c=t.token,l=void 0===c?"15cd8a57710d40c9b7c0e3cc120f1200":c,f=t.mapInstance,h=t.plugin,d=void 0===h?[]:h,p=to(t,["id","style","minZoom","maxZoom","token","mapInstance","plugin"]),e.next=3,new Promise((function(e){var t=function(){if(f)v.map=f,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),e()}),30);else{v.$mapContainer=v.creatAmapContainer(n);var t=new AMap.Map(v.$mapContainer,Zi({mapStyle:v.getMapStyle(i),zooms:[a,s],viewMode:"3D"},p));t.on("camerachange",v.handleCameraChanged),v.map=t,setTimeout((function(){e()}),10)}};TT||f?TT&&window.AMap||f?t():CT.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===l&&v.logger.warn(v.configService.getSceneWarninfo("MapToken")),TT=!0,d.push("Map3D"),v.loadAMapScript("https://webapi.amap.com/maps?v=".concat("1.4.15","&key=").concat(l,"&plugin=").concat(d.join(","))).then((function(){t(),CT.length&&(CT.forEach((function(e){return e()})),CT=[])})))}));case 3:this.viewport=new AT;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){this.map.destroy(),delete window.initAMap;var e=document.getElementById("amap-script");e&&document.head.removeChild(e)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"getMapStyle",value:function(e){return ST[e]?ST[e]:e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+wT++,t.appendChild(n),n}},{key:"loadAMapScript",value:function(e){return new Promise((function(t,n){var r=document.createElement("script");r.src=e,r.onload=function(){t()},r.onerror=n,document.head.appendChild(r)}))}}]),t}()).prototype,"configService",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dT=ho(fT.prototype,"logger",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pT=ho(fT.prototype,"config",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vT=ho(fT.prototype,"coordinateSystemService",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gT=ho(fT.prototype,"eventEmitter",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lT=fT))||lT),MT=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"getServiceConstructor",value:function(){return kT}}]),n}(xT);function IT(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function OT(e,t){return!t||"object"!==$b(t)&&"function"!=typeof t?IT(e):t}function PT(e){return(PT=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function RT(e,t){return(RT=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function LT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}(e,t)||a_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function NT(e,t){var n,r,i,o=Uv([],t,e);return n=o,r=o,i=1/o[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,o}function DT(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}vw(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-moz-box-shadow:0 0 2px rgba(0,0,0,.1);-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;-moz-animation:mapboxgl-spin 2s infinite linear;-o-animation:mapboxgl-spin 2s infinite linear;-ms-animation:mapboxgl-spin 2s infinite linear;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@-moz-keyframes mapboxgl-spin{0%{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(1turn)}}@-o-keyframes mapboxgl-spin{0%{-o-transform:rotate(0deg)}to{-o-transform:rotate(1turn)}}@-ms-keyframes mapboxgl-spin{0%{-ms-transform:rotate(0deg)}to{-ms-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:0;margin:10px;position:relative;background-color:#fff;border-radius:3px 12px 12px 3px}.mapboxgl-ctrl-attrib.mapboxgl-compact:hover{padding:2px 24px 2px 4px;visibility:visible;margin-top:6px}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:hover,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:hover{padding:2px 4px 2px 24px;border-radius:12px 3px 3px 12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib.mapboxgl-compact:hover .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact:after{content:\"\";cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;-moz-animation:mapboxgl-user-location-dot-pulse 2s infinite;-ms-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@-ms-keyframes mapboxgl-user-location-dot-pulse{0%{-ms-transform:scale(1);opacity:1}70%{-ms-transform:scale(3);opacity:0}to{-ms-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}");var jT=Math.PI,FT=jT/4,zT=jT/180,UT=180/jT;function BT(e){return Math.pow(2,e)}function VT(e,t){var n=LT(e,2),r=n[0],i=n[1];DT(Number.isFinite(r)&&Number.isFinite(t)),DT(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*zT;return[(t*=512)*(r*zT+jT)/(2*jT),t*(jT-Math.log(Math.tan(FT+.5*o)))/(2*jT)]}function GT(e,t){var n=LT(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*jT)-jT,a=2*(Math.atan(Math.exp(jT-i/t*(2*jT)))-FT);return[o*UT,a*UT]}function HT(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:BT(r),DT(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var u={},s=512*i,c=Math.cos(t*zT),l=s/360,f=l/c,h=s/4003e4/c;if(u.pixelsPerMeter=[h,-h,h],u.metersPerPixel=[1/h,-1/h,1/h],u.pixelsPerDegree=[l,-f,h],u.degreesPerPixel=[1/l,-1/f,1/h],a){var d=zT*Math.tan(t*zT)/c,p=l*d/2,v=s/4003e4*d,g=v/f*h;u.pixelsPerDegree2=[0,-p,v],u.pixelsPerMeter2=[g,0,g]}return u}function WT(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,u=e.flipY,s=void 0!==u&&u,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return tv(c,c,[0,0,-i]),nv(c,c,[1,1,1/t]),rv(c,c,-n*zT),ov(c,c,r*zT),s&&nv(c,c,[1,-1,1]),a&&tv(c,c,wv([],a)),c}function qT(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,u=e.nearZMultiplier,s=void 0===u?1:u,c=e.farZMultiplier,l=void 0===c?1:c,f=a*zT,h=Math.atan(.5/i),d=Math.sin(h)*i/Math.sin(Math.PI/2-f-h),p=Math.cos(Math.PI/2-f)*d+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:s,far:p*l}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier});return cv([],i.fov,i.aspect,i.near,i.far)}function XT(e,t){var n=LT(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return DT(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),NT(t,[r,i,a,1])}function ZT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=LT(e,3),i=r[0],o=r[1],a=r[2];if(DT(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var u=NT(t,[i,o,a,1]);return u}var s=NT(t,[i,o,0,1]),c=NT(t,[i,o,1,1]),l=s[2],f=c[2],h=l===f?0:((n||0)-l)/(f-l);return Zv([],s,c,h)}var YT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function KT(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,u=void 0===a?24:a,s=e.padding,c=void 0===s?0:s,l=e.offset,f=void 0===l?[0,0]:l,h=LT(r,2),d=LT(h[0],2),p=d[0],v=d[1],g=LT(h[1],2),m=g[0],y=g[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else DT(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var b=new lC({width:t,height:n,longitude:0,latitude:0,zoom:0}),_=b.project([p,y]),x=b.project([m,v]),S=[Math.max(Math.abs(x[0]-_[0]),o),Math.max(Math.abs(x[1]-_[1]),o)],E=[t-c.left-c.right-2*Math.abs(f[0]),n-c.top-c.bottom-2*Math.abs(f[1])];DT(E[0]>0&&E[1]>0);var A=E[0]/S[0],w=E[1]/S[1],T=(c.right-c.left)/2/A,C=(c.bottom-c.top)/2/w,k=[(x[0]+_[0])/2+T,(x[1]+_[1])/2+C],M=b.unproject(k),I=b.zoom+Math.log2(Math.abs(Math.min(A,w)));return{longitude:M[0],latitude:M[1],zoom:Math.min(I,u)}}var QT,JT,$T,eC,tC,nC,rC,iC,oC,aC,uC,sC,cC,lC=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,u=n.longitude,s=void 0===u?0:u,c=n.zoom,l=void 0===c?0:c,f=n.pitch,h=void 0===f?0:f,d=n.bearing,p=void 0===d?0:d,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;s_(this,t),r=r||1,i=i||1;var b=BT(l);g=Math.max(.75,g);var _=VT([s,a],b);_[2]=0;var x=qT({width:r,height:i,pitch:h,bearing:p,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),S=WT({height:i,center:_,pitch:h,bearing:p,altitude:g,flipY:!0});return(e=OT(this,PT(t).call(this,{width:r,height:i,viewMatrix:S,projectionMatrix:x}))).latitude=a,e.longitude=s,e.zoom=l,e.pitch=h,e.bearing=p,e.altitude=g,e.scale=b,e.center=_,e.pixelsPerMeter=HT(IT(IT(e))).pixelsPerMeter[2],Object.freeze(IT(IT(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&RT(e,t)}(t,e),l_(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return VT(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return GT(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=ZT(e.pos,this.pixelUnprojectionMatrix),o=Hv([],VT(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return GT(Hv([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=KT(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,u=o.latitude,s=o.zoom;return new t({width:r,height:i,longitude:a,latitude:u,zoom:s})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?YT:i,a=t.projectionMatrix,u=void 0===a?YT:a;s_(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ev(s,s,this.projectionMatrix),ev(s,s,this.viewMatrix),this.viewProjectionMatrix=s;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];nv(c,c,[this.width/2,-this.height/2,1]),tv(c,c,[1,-1,0]),ev(c,c,this.viewProjectionMatrix);var l=$p([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=l,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return l_(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&hv(t.projectionMatrix,this.projectionMatrix)&&hv(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=XT(i,this.pixelProjectionMatrix),a=LT(o,2),u=a[0],s=a[1],c=r?s:this.height-s;return 2===e.length?[u,c]:[u,c,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=LT(e,3),a=o[0],u=o[1],s=o[2],c=r?u:this.height-u,l=i&&i*this.pixelsPerMeter,f=ZT([a,c,s],this.pixelUnprojectionMatrix,l),h=this.unprojectPosition(f),d=LT(h,3),p=d[0],v=d[1],g=d[2];return Number.isFinite(s)?[p,v,g]:Number.isFinite(i)?[p,v,i]:[p,v]}},{key:"projectPosition",value:function(e){var t=LT(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=LT(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}()),fC=function(){function e(){Gi(this,e),this.viewport=void 0}return Wi(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth;this.viewport=new lC({width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),hC={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}};window.mapboxgl=t;var dC={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},pC="pk.eyJ1IjoibHp4dWUiLCJhIjoiYnhfTURyRSJ9.Ugm314vAKPHBzcPmY1p4KQ",vC=(QT=Q(),JT=J(nr.MapConfig),$T=J(nr.IGlobalConfigService),eC=J(nr.ILogService),tC=J(nr.ICoordinateSystemService),nC=J(nr.IEventEmitter),QT((oC=ho((iC=function(){function t(){var n=this;Gi(this,t),this.map=void 0,fo(this,"config",oC,this),fo(this,"configService",aC,this),fo(this,"logger",uC,this),fo(this,"coordinateSystemService",sC,this),fo(this,"eventEmitter",cC,this),this.viewport=void 0,this.markerContainer=void 0,this.cameraChangedCallback=void 0,this.$mapContainer=void 0,this.handleCameraChanged=function(){var t=n.map.getCenter().wrap(),r=t.lat,i=t.lng;n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.viewport.getZoom()>12?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),n.cameraChangedCallback(n.viewport)}}var n;return Wi(t,[{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=Aa("div","l7-marker-container",e)}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==$A.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(dC[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(dC[e]||e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e){this.panTo(e)}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyle(e))}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,u=n.z;return{x:i,y:a,z:void 0===u?0:u}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),u=Yp();return tv(u,u,yv(o.x-i.x,o.y-i.y,o.z||0-i.z)),nv(u,u,yv(a*r[0],-a*r[1],a*r[2])),rv(u,u,n[0]),iv(u,u,n[1]),ov(u,u,n[2]),u}},{key:"init",value:(n=Vi(regeneratorRuntime.mark((function e(){var t,n,r,i,o,a,u,s,c,l,f,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,u=void 0===a?"light":a,s=t.token,c=void 0===s?pC:s,l=t.rotation,f=void 0===l?0:l,h=t.mapInstance,d=to(t,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new fC,h||window.mapboxgl||this.logger.error(this.configService.getSceneWarninfo("SDK")),c!==pC||"blank"===u||window.mapboxgl.accessToken||h||this.logger.warn(this.configService.getSceneWarninfo("MapToken")),h||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=c),h?(this.map=h,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new window.mapboxgl.Map(Zi({container:this.$mapContainer,style:this.getMapStyle(u),attributionControl:o,bearing:f},d))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatAmapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"getMapStyle",value:function(e){return"string"!=typeof e?e:hC[e]?hC[e]:e}}]),t}()).prototype,"config",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aC=ho(iC.prototype,"configService",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uC=ho(iC.prototype,"logger",[eC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sC=ho(iC.prototype,"coordinateSystemService",[tC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cC=ho(iC.prototype,"eventEmitter",[nC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rC=iC))||rC),gC=function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"getServiceConstructor",value:function(){return vC}}]),n}(xT),mC=Object.getOwnPropertySymbols,yC=Object.prototype.hasOwnProperty,bC=Object.prototype.propertyIsEnumerable;function _C(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var xC=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,i=_C(e),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))yC.call(n,a)&&(i[a]=n[a]);if(mC){r=mC(n);for(var u=0;u<r.length;u++)bC.call(n,r[u])&&(i[r[u]]=n[r[u]])}}return i},SC=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8},EC=o((function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}})),AC=o((function(e,t){var n=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(a(arguments[r]));return t.join(" ")}r=1;for(var i=arguments,o=i.length,u=String(e).replace(n,(function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}})),s=i[r];r<o;s=i[++r])p(s)||!b(s)?u+=" "+s:u+=" "+a(s);return u},t.deprecate=function(e,n){if(m(r.process))return function(){return t.deprecate(e,n).apply(this,arguments)};if(!0===process.noDeprecation)return e;var i=!1;return function(){if(!i){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation?console.trace(n):console.error(n),i=!0}return e.apply(this,arguments)}};var i,o={};function a(e,n){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),c(r,e,r.depth)}function u(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function s(e,t){return e}function c(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return g(i)||(i=c(e,i,r)),i}var o=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(p(t))return e.stylize("null","null")}(e,n);if(o)return o;var a=Object.keys(n),u=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(n);if(0===a.length){if(S(n)){var s=n.name?": "+n.name:"";return e.stylize("[Function"+s+"]","special")}if(y(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(_(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return l(n)}var b,E="",A=!1,w=["{","}"];(h(n)&&(A=!0,w=["[","]"]),S(n))&&(E=" [Function"+(n.name?": "+n.name:"")+"]");return y(n)&&(E=" "+RegExp.prototype.toString.call(n)),_(n)&&(E=" "+Date.prototype.toUTCString.call(n)),x(n)&&(E=" "+l(n)),0!==a.length||A&&0!=n.length?r<0?y(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),b=A?function(e,t,n,r,i){for(var o=[],a=0,u=t.length;a<u;++a)C(t,String(a))?o.push(f(e,t,n,r,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(f(e,t,n,r,i,!0))})),o}(e,n,r,u,a):a.map((function(t){return f(e,n,r,u,t,A)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(b,E,w)):w[0]+E+w[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,o){var a,u,s;if((s=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?u=s.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):s.set&&(u=e.stylize("[Setter]","special")),C(r,i)||(a="["+i+"]"),u||(e.seen.indexOf(s.value)<0?(u=p(n)?c(e,s.value,null):c(e,s.value,n-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+u.split("\n").map((function(e){return"   "+e})).join("\n")):u=e.stylize("[Circular]","special")),m(a)){if(o&&i.match(/^\d+$/))return u;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+u}function h(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function p(e){return null===e}function v(e){return"number"==typeof e}function g(e){return"string"==typeof e}function m(e){return void 0===e}function y(e){return b(e)&&"[object RegExp]"===E(e)}function b(e){return"object"==typeof e&&null!==e}function _(e){return b(e)&&"[object Date]"===E(e)}function x(e){return b(e)&&("[object Error]"===E(e)||e instanceof Error)}function S(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(m(i)&&(i=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(i)){var n=process.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=d,t.isNull=p,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=y,t.isObject=b,t.isDate=_,t.isError=x,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=SC;var w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var e=new Date,t=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),w[e.getMonth()],t].join(" ")}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",T(),t.format.apply(t,arguments))},t.inherits=EC,t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}})),wC=(AC.format,AC.deprecate,AC.debuglog,AC.inspect,AC.isArray,AC.isBoolean,AC.isNull,AC.isNullOrUndefined,AC.isNumber,AC.isString,AC.isSymbol,AC.isUndefined,AC.isRegExp,AC.isObject,AC.isDate,AC.isError,AC.isFunction,AC.isPrimitive,AC.isBuffer,AC.log,AC.inherits,AC._extend,o((function(e){
/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function t(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function n(e){return r.Buffer&&"function"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var i=Object.prototype.hasOwnProperty,o=Array.prototype.slice,a="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function s(e){return!n(e)&&("function"==typeof r.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var c=e.exports=v,l=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(AC.isFunction(e)){if(a)return e.name;var t=e.toString().match(l);return t&&t[1]}}function h(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function d(e){if(a||!AC.isFunction(e))return AC.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function p(e,t,n,r,i){throw new c.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function v(e,t){e||p(e,!0,t,"==",c.ok)}function g(e,r,i,a){if(e===r)return!0;if(n(e)&&n(r))return 0===t(e,r);if(AC.isDate(e)&&AC.isDate(r))return e.getTime()===r.getTime();if(AC.isRegExp(e)&&AC.isRegExp(r))return e.source===r.source&&e.global===r.global&&e.multiline===r.multiline&&e.lastIndex===r.lastIndex&&e.ignoreCase===r.ignoreCase;if(null!==e&&"object"==typeof e||null!==r&&"object"==typeof r){if(s(e)&&s(r)&&u(e)===u(r)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===t(new Uint8Array(e.buffer),new Uint8Array(r.buffer));if(n(e)!==n(r))return!1;var c=(a=a||{actual:[],expected:[]}).actual.indexOf(e);return-1!==c&&c===a.expected.indexOf(r)||(a.actual.push(e),a.expected.push(r),function(e,t,n,r){if(null==e||null==t)return!1;if(AC.isPrimitive(e)||AC.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=m(e),a=m(t);if(i&&!a||!i&&a)return!1;if(i)return e=o.call(e),t=o.call(t),g(e,t,n);var u,s,c=_(e),l=_(t);if(c.length!==l.length)return!1;for(c.sort(),l.sort(),s=c.length-1;s>=0;s--)if(c[s]!==l[s])return!1;for(s=c.length-1;s>=0;s--)if(u=c[s],!g(e[u],t[u],n,r))return!1;return!0}(e,r,i,a))}return i?e===r:e==r}function m(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function b(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&p(i,n,"Missing expected exception"+r);var o="string"==typeof r,a=!e&&i&&!n;if((!e&&AC.isError(i)&&o&&y(i,n)||a)&&p(i,n,"Got unwanted exception"+r),e&&i&&n&&!y(i,n)||!e&&i)throw i}c.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return h(d(e.actual),128)+" "+e.operator+" "+h(d(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||p;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=f(t),o=r.indexOf("\n"+i);if(o>=0){var a=r.indexOf("\n",o+1);r=r.substring(a+1)}this.stack=r}}},AC.inherits(c.AssertionError,Error),c.fail=p,c.ok=v,c.equal=function(e,t,n){e!=t&&p(e,t,n,"==",c.equal)},c.notEqual=function(e,t,n){e==t&&p(e,t,n,"!=",c.notEqual)},c.deepEqual=function(e,t,n){g(e,t,!1)||p(e,t,n,"deepEqual",c.deepEqual)},c.deepStrictEqual=function(e,t,n){g(e,t,!0)||p(e,t,n,"deepStrictEqual",c.deepStrictEqual)},c.notDeepEqual=function(e,t,n){g(e,t,!1)&&p(e,t,n,"notDeepEqual",c.notDeepEqual)},c.notDeepStrictEqual=function e(t,n,r){g(t,n,!0)&&p(t,n,r,"notDeepStrictEqual",e)},c.strictEqual=function(e,t,n){e!==t&&p(e,t,n,"===",c.strictEqual)},c.notStrictEqual=function(e,t,n){e===t&&p(e,t,n,"!==",c.notStrictEqual)},c.throws=function(e,t,n){b(!0,e,t,n)},c.doesNotThrow=function(e,t,n){b(!1,e,t,n)},c.ifError=function(e){if(e)throw e},c.strict=xC((function e(t,n){t||p(t,!0,n,"==",e)}),c,{equal:c.strictEqual,deepEqual:c.deepStrictEqual,notEqual:c.notStrictEqual,notDeepEqual:c.notDeepStrictEqual}),c.strict.strict=c.strict;var _=Object.keys||function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t}}))),TC=o((function(e,t){var n=/^\[object .+?Constructor\]$/,i=/^(?:0|[1-9]\d*)$/,o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1;var a="object"==typeof r&&r&&r.Object===Object&&r,u="object"==typeof self&&self&&self.Object===Object&&self,s=a||u||Function("return this")(),c=t&&!t.nodeType&&t,l=c&&e&&!e.nodeType&&e,f=l&&l.exports===c,h=f&&a.process,d=function(){try{var e=l&&l.require&&l.require("util").types;return e||h&&h.binding&&h.binding("util")}catch(e){}}(),p=d&&d.isTypedArray;function v(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var g=Array.prototype,m=Function.prototype,y=Object.prototype,b=s["__core-js_shared__"],_=m.toString,x=y.hasOwnProperty,S=function(){var e=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),E=y.toString,A=_.call(Object),w=RegExp("^"+_.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=f?s.Buffer:void 0,C=s.Symbol,k=s.Uint8Array,M=T?T.allocUnsafe:void 0,I=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object),O=Object.create,P=y.propertyIsEnumerable,R=g.splice,L=C?C.toStringTag:void 0,N=function(){try{var e=ae(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),D=T?T.isBuffer:void 0,j=Math.max,F=Date.now,z=ae(s,"Map"),U=ae(Object,"create"),B=function(){function e(){}return function(t){if(!xe(t))return{};if(O)return O(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function V(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function G(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function H(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function W(e){var t=this.__data__=new G(e);this.size=t.size}function q(e,t){var n=ge(e),r=!n&&ve(e),i=!n&&!r&&ye(e),o=!n&&!r&&!i&&Ee(e),a=n||r||i||o,u=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],s=u.length;for(var c in e)!t&&!x.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ue(c,s))||u.push(c);return u}function X(e,t,n){(void 0!==n&&!pe(e[t],n)||void 0===n&&!(t in e))&&K(e,t,n)}function Z(e,t,n){var r=e[t];x.call(e,t)&&pe(r,n)&&(void 0!==n||t in e)||K(e,t,n)}function Y(e,t){for(var n=e.length;n--;)if(pe(e[n][0],t))return n;return-1}function K(e,t,n){"__proto__"==t&&N?N(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}V.prototype.clear=function(){this.__data__=U?U(null):{},this.size=0},V.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},V.prototype.get=function(e){var t=this.__data__;if(U){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return x.call(t,e)?t[e]:void 0},V.prototype.has=function(e){var t=this.__data__;return U?void 0!==t[e]:x.call(t,e)},V.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=U&&void 0===t?"__lodash_hash_undefined__":t,this},G.prototype.clear=function(){this.__data__=[],this.size=0},G.prototype.delete=function(e){var t=this.__data__,n=Y(t,e);return!(n<0)&&(n==t.length-1?t.pop():R.call(t,n,1),--this.size,!0)},G.prototype.get=function(e){var t=this.__data__,n=Y(t,e);return n<0?void 0:t[n][1]},G.prototype.has=function(e){return Y(this.__data__,e)>-1},G.prototype.set=function(e,t){var n=this.__data__,r=Y(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},H.prototype.clear=function(){this.size=0,this.__data__={hash:new V,map:new(z||G),string:new V}},H.prototype.delete=function(e){var t=oe(this,e).delete(e);return this.size-=t?1:0,t},H.prototype.get=function(e){return oe(this,e).get(e)},H.prototype.has=function(e){return oe(this,e).has(e)},H.prototype.set=function(e,t){var n=oe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},W.prototype.clear=function(){this.__data__=new G,this.size=0},W.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},W.prototype.get=function(e){return this.__data__.get(e)},W.prototype.has=function(e){return this.__data__.has(e)},W.prototype.set=function(e,t){var n=this.__data__;if(n instanceof G){var r=n.__data__;if(!z||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new H(r)}return n.set(e,t),this.size=n.size,this};var Q,J=function(e,t,n){for(var r=-1,i=Object(e),o=n(e),a=o.length;a--;){var u=o[Q?a:++r];if(!1===t(i[u],u,i))break}return e};function $(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":L&&L in Object(e)?function(e){var t=x.call(e,L),n=e[L];try{e[L]=void 0;var r=!0}catch(e){}var i=E.call(e);r&&(t?e[L]=n:delete e[L]);return i}(e):function(e){return E.call(e)}(e)}function ee(e){return Se(e)&&"[object Arguments]"==$(e)}function te(e){return!(!xe(e)||(t=e,S&&S in t))&&(be(e)?w:n).test(function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function ne(e){if(!xe(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=se(e),n=[];for(var r in e)("constructor"!=r||!t&&x.call(e,r))&&n.push(r);return n}function re(e,t,n,r,i){e!==t&&J(t,(function(o,a){if(i||(i=new W),xe(o))!function(e,t,n,r,i,o,a){var u=ce(e,n),s=ce(t,n),c=a.get(s);if(c)return void X(e,n,c);var l=o?o(u,s,n+"",e,t,a):void 0,f=void 0===l;if(f){var h=ge(s),d=!h&&ye(s),p=!h&&!d&&Ee(s);l=s,h||d||p?ge(u)?l=u:Se(m=u)&&me(m)?l=function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(u):d?(f=!1,l=function(e,t){if(t)return e.slice();var n=e.length,r=M?M(n):new e.constructor(n);return e.copy(r),r}(s,!0)):p?(f=!1,v=s,g=!0?function(e){var t=new e.constructor(e.byteLength);return new k(t).set(new k(e)),t}(v.buffer):v.buffer,l=new v.constructor(g,v.byteOffset,v.length)):l=[]:function(e){if(!Se(e)||"[object Object]"!=$(e))return!1;var t=I(e);if(null===t)return!0;var n=x.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&_.call(n)==A}(s)||ve(s)?(l=u,ve(u)?l=function(e){return function(e,t,n,r){var i=!n;n||(n={});var o=-1,a=t.length;for(;++o<a;){var u=t[o],s=r?r(n[u],e[u],u,n,e):void 0;void 0===s&&(s=e[u]),i?K(n,u,s):Z(n,u,s)}return n}(e,Ae(e))}(u):xe(u)&&!be(u)||(l=function(e){return"function"!=typeof e.constructor||se(e)?{}:B(I(e))}(s))):f=!1}var v,g;var m;f&&(a.set(s,l),i(l,s,r,o,a),a.delete(s));X(e,n,l)}(e,t,a,n,re,r,i);else{var u=r?r(ce(e,a),o,a+"",e,t,i):void 0;void 0===u&&(u=o),X(e,a,u)}}),Ae)}function ie(e,t){return de(function(e,t,n){return t=j(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=j(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var u=Array(t+1);++i<t;)u[i]=r[i];return u[t]=n(a),v(e,this,u)}}(e,t,Ce),e+"")}function oe(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function ae(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return te(n)?n:void 0}function ue(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&i.test(e))&&e>-1&&e%1==0&&e<t}function se(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||y)}function ce(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var le,fe,he,de=(le=N?function(e,t){return N(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:Ce,fe=0,he=0,function(){var e=F(),t=16-(e-he);if(he=e,t>0){if(++fe>=800)return arguments[0]}else fe=0;return le.apply(void 0,arguments)});function pe(e,t){return e===t||e!=e&&t!=t}var ve=ee(function(){return arguments}())?ee:function(e){return Se(e)&&x.call(e,"callee")&&!P.call(e,"callee")},ge=Array.isArray;function me(e){return null!=e&&_e(e.length)&&!be(e)}var ye=D||function(){return!1};function be(e){if(!xe(e))return!1;var t=$(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function _e(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function xe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Se(e){return null!=e&&"object"==typeof e}var Ee=p?function(e){return function(t){return e(t)}}(p):function(e){return Se(e)&&_e(e.length)&&!!o[$(e)]};function Ae(e){return me(e)?q(e,!0):ne(e)}var we,Te=(we=function(e,t,n,r){re(e,t,n,r)},ie((function(e,t){var n=-1,r=t.length,i=r>1?t[r-1]:void 0,o=r>2?t[2]:void 0;for(i=we.length>3&&"function"==typeof i?(r--,i):void 0,o&&function(e,t,n){if(!xe(n))return!1;var r=typeof t;return!!("number"==r?me(n)&&ue(t,n.length):"string"==r&&t in n)&&pe(n[t],e)}(t[0],t[1],o)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var a=t[n];a&&we(e,a,n,i)}return e})));function Ce(e){return e}e.exports=Te}));var CC=function(e){return null==e},kC=Array.isArray,MC=/^\[object .+?Constructor\]$/,IC="object"==typeof r&&r&&r.Object===Object&&r,OC="object"==typeof self&&self&&self.Object===Object&&self,PC=IC||OC||Function("return this")();function RC(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){var i=e.length,o=n+(r?1:-1);for(;r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}(e,NC,n);var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function LC(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function NC(e){return e!=e}function DC(e,t){return e.has(t)}function jC(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var FC=Array.prototype,zC=Function.prototype,UC=Object.prototype,BC=PC["__core-js_shared__"],VC=function(){var e=/[^.]+$/.exec(BC&&BC.keys&&BC.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),GC=zC.toString,HC=UC.hasOwnProperty,WC=UC.toString,qC=RegExp("^"+GC.call(HC).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),XC=FC.splice,ZC=ok(PC,"Map"),YC=ok(PC,"Set"),KC=ok(Object,"create");function QC(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function JC(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function $C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ek(e){var t=-1,n=e?e.length:0;for(this.__data__=new $C;++t<n;)this.add(e[t])}function tk(e,t){for(var n,r,i=e.length;i--;)if((n=e[i][0])===(r=t)||n!=n&&r!=r)return i;return-1}function nk(e){return!(!ak(e)||(t=e,VC&&VC in t))&&(function(e){var t=ak(e)?WC.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?qC:MC).test(function(e){if(null!=e){try{return GC.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}QC.prototype.clear=function(){this.__data__=KC?KC(null):{}},QC.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},QC.prototype.get=function(e){var t=this.__data__;if(KC){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return HC.call(t,e)?t[e]:void 0},QC.prototype.has=function(e){var t=this.__data__;return KC?void 0!==t[e]:HC.call(t,e)},QC.prototype.set=function(e,t){return this.__data__[e]=KC&&void 0===t?"__lodash_hash_undefined__":t,this},JC.prototype.clear=function(){this.__data__=[]},JC.prototype.delete=function(e){var t=this.__data__,n=tk(t,e);return!(n<0)&&(n==t.length-1?t.pop():XC.call(t,n,1),!0)},JC.prototype.get=function(e){var t=this.__data__,n=tk(t,e);return n<0?void 0:t[n][1]},JC.prototype.has=function(e){return tk(this.__data__,e)>-1},JC.prototype.set=function(e,t){var n=this.__data__,r=tk(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},$C.prototype.clear=function(){this.__data__={hash:new QC,map:new(ZC||JC),string:new QC}},$C.prototype.delete=function(e){return ik(this,e).delete(e)},$C.prototype.get=function(e){return ik(this,e).get(e)},$C.prototype.has=function(e){return ik(this,e).has(e)},$C.prototype.set=function(e,t){return ik(this,e).set(e,t),this},ek.prototype.add=ek.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},ek.prototype.has=function(e){return this.__data__.has(e)};var rk=YC&&1/jC(new YC([,-0]))[1]==1/0?function(e){return new YC(e)}:function(){};function ik(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function ok(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return nk(n)?n:void 0}function ak(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var uk=function(e){return e&&e.length?function(e,t,n){var r=-1,i=RC,o=e.length,a=!0,u=[],s=u;if(n)a=!1,i=LC;else if(o>=200){var c=t?null:rk(e);if(c)return jC(c);a=!1,i=DC,s=new ek}else s=t?[]:u;e:for(;++r<o;){var l=e[r],f=t?t(l):l;if(l=n||0!==l?l:0,a&&f==f){for(var h=s.length;h--;)if(s[h]===f)continue e;t&&s.push(f),u.push(l)}else i(s,f,n)||(s!==u&&s.push(f),u.push(l))}return u}(e):[]};var sk=Function.prototype,ck=Object.prototype,lk=sk.toString,fk=ck.hasOwnProperty,hk=lk.call(Object),dk=ck.toString,pk=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object);var vk,gk,mk,yk,bk,_k=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=dk.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=pk(e);if(null===t)return!0;var n=fk.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&lk.call(n)==hk},xk=i(o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,n.default)((0,o.default)(e)&&e.length>=1,"Must merge at least 1 JSON schema."),r.default.apply(void 0,[{}].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e),[function(e,t,r){if(!(0,i.default)(e)){if("required"===r)return(0,a.default)(e.concat(t));if((0,u.default)(e)){if(!(0,u.default)(t))throw new Error('Failed to merge schemas because "'+r+'" has different values.')}else n.default.deepEqual(e,t,'Failed to merge schemas because "'+r+'" has different values: '+JSON.stringify(e)+" and "+JSON.stringify(t)+".")}}]))};var n=s(wC),r=s(TC),i=s(CC),o=s(kC),a=s(uk),u=s(_k);function s(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default})));var Sk,Ek,Ak,wk,Tk,Ck,kk,Mk,Ik,Ok,Pk,Rk,Lk,Nk=(vk=Q(),gk=J(nr.IGlobalConfigService),vk((bk=ho((yk=function(){function e(){Gi(this,e),fo(this,"configService",bk,this),this.enabled=void 0}return Wi(e,[{key:"apply",value:function(e,t){var n=this,r=(t.rendererService,t.postProcessingPassFactory),i=t.normalPassFactory;e.hooks.init.tap("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),o=t.enableMultiPassRenderer,a=t.passes,u=void 0===a?[]:a;n.enabled=!!o&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=n.createMultiPassRenderer(e,u,r,i),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){}))}},{key:"createMultiPassRenderer",value:function(e,t,n,r){var i=e.multiPassRenderer,o=e.getLayerConfig(),a=o.enablePicking;o.enableTAA;return a&&i.add(r("pixelPicking")),i}}]),e}()).prototype,"configService",[gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mk=yk))||mk),Dk=(qi(Sk={},e.BlendType.additive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:1,dstAlpha:1}}),qi(Sk,e.BlendType.normal,{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),qi(Sk,e.BlendType.subtractive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:e.gl.ZERO,dstAlpha:e.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:e.gl.FUNC_SUBTRACT,alpha:e.gl.FUNC_SUBTRACT}}),qi(Sk,e.BlendType.max,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MAX_EXT}}),qi(Sk,e.BlendType.min,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MIN_EXT}}),Sk),jk={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},Fk=0,zk=(Ek=RA(nr.ILogService),Ak=RA(nr.IGlobalConfigService),wk=RA(nr.IShaderModuleService),Ck=ho((Tk=function(t){Yi(r,t);var n=io(r);function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Gi(this,r),(e=n.call(this)).id="".concat(Fk++),e.name="".concat(Fk),e.type=void 0,e.visible=!0,e.zIndex=0,e.minZoom=void 0,e.maxZoom=void 0,e.inited=!1,e.layerModelNeedUpdate=!1,e.pickedFeatureID=null,e.selectedFeatureID=null,e.styleNeedUpdate=!1,e.dataState={dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1},e.hooks={init:new ax,afterInit:new ax,beforeRender:new ax,beforeRenderData:new ox,afterRender:new ex,beforePickingEncode:new ex,afterPickingEncode:new ex,beforeHighlight:new ex(["pickedColor"]),afterHighlight:new ex,beforeSelect:new ex(["pickedColor"]),afterSelect:new ex,beforeDestroy:new ex,afterDestroy:new ex},e.models=[],e.multiPassRenderer=void 0,e.plugins=void 0,e.sourceOption=void 0,e.layerModel=void 0,fo(e,"logger",Ck,no(e)),fo(e,"configService",kk,no(e)),fo(e,"shaderModuleService",Mk,no(e)),e.cameraService=void 0,e.coordinateService=void 0,e.iconService=void 0,e.fontService=void 0,e.rendererService=void 0,e.layerService=void 0,e.interactionService=void 0,e.mapService=void 0,e.styleAttributeService=void 0,e.layerSource=void 0,e.postProcessingPassFactory=void 0,e.normalPassFactory=void 0,e.animateOptions={enable:!1},e.container=void 0,e.encodedData=void 0,e.configSchema=void 0,e.currentPickId=null,e.rawConfig=void 0,e.needUpdateConfig=void 0,e.pendingStyleAttributes=[],e.scaleOptions={},e.animateStartTime=void 0,e.aniamateStatus=!1,e.sourceEvent=function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.emit("dataUpdate"),e.reRender()},e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return Wi(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){if(this.inited){var t=this.container.get(nr.SceneID);this.configService.setLayerConfig(t,this.id,Zi(Zi(Zi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=Zi(Zi({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e){this.container=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var e=this,t=this.container.get(nr.SceneID),n=this.rawConfig.enableMultiPassRenderer,r=void 0!==n&&n;this.configService.setLayerConfig(t,this.id,{enableMultiPassRenderer:r}),this.iconService=this.container.get(nr.IIconService),this.fontService=this.container.get(nr.IFontService),this.rendererService=this.container.get(nr.IRendererService),this.layerService=this.container.get(nr.ILayerService),this.interactionService=this.container.get(nr.IInteractionService),this.mapService=this.container.get(nr.IMapService),this.cameraService=this.container.get(nr.ICameraService),this.coordinateService=this.container.get(nr.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(nr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(nr.IFactoryNormalPass),this.styleAttributeService=this.container.get(nr.IStyleAttributeService),this.multiPassRenderer=this.container.get(nr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(t){var n=t.attributeName,r=t.attributeField,i=t.attributeValues,o=t.updateOptions;e.styleAttributeService.updateStyleAttribute(n,{scale:Zi({field:r},e.splitValuesAndCallbackInAttribute(i,e.getLayerConfig()[n]))},o)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(nr.ILayerPlugin);var i,o=lo(this.plugins);try{for(o.s();!(i=o.n()).done;){i.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(e){o.e(e)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Zi(Zi({},this.getDefaultConfig()),this.rawConfig));var e=this.getLayerConfig().animateOption;(null==e?void 0:e.enable)&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){return this.updateStyleAttribute("filter",e,t,n),this}},{key:"shape",value:function(e,t,n){return this.updateStyleAttribute("shape",e,t,n),this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return Og(e)?(t.enable=!0,t=Zi(Zi({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return this.sourceOption={data:e,options:t},this}},{key:"setData",value:function(e,t){var n=this;return this.inited?this.layerSource.setData(e,t):this.on("inited",(function(){n.layerSource.setData(e,t)})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=to(e,["passes"]);return n&&function(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),this.rawConfig=Zi(Zi({},this.rawConfig),r),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(e,t){return Og(e)?this.scaleOptions=Zi(Zi({},this.scaleOptions),e):this.scaleOptions[e]=t,this}},{key:"render",value:function(){return this.renderModels(),this}},{key:"active",value:function(e){var t={};return t.enableHighlight=!!Og(e)||e,Og(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(Og(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:Og(t)?t.color:this.getLayerConfig().highlightColor}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:Og(t)?t.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(Gh(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!Og(e)||e,Og(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(Og(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:Og(t)?t.color:this.getLayerConfig().selectColor}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:Og(t)?t.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(Gh(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){this.updateLayerConfig({blend:e}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<=(void 0===o?1/0:o)}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach((function(e){return e.destroy()})),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){this.layerSource=e;var t=this.mapService.getZoom();this.layerSource.cluster&&this.layerSource.updateClusterData(t),this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=xk([jk,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.ticks?t.ticks().map((function(n){return qi({value:n},e,t(n))})):t.invertExtent?t.range().map((function(n){return qi({value:t.invertExtent(n)},e,n)})):void 0:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"buildLayerModel",value:function(t){var n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,o=t.triangulation,a=to(t,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(n,{vs:r,fs:i});var u=this.shaderModuleService.getModule(n),s=u.vs,c=u.fs,l=u.uniforms,f=this.rendererService.createModel,h=this.styleAttributeService.createAttributesAndIndices(this.encodedData,o);return f(Zi({attributes:h.attributes,uniforms:l,fs:c,vs:s,elements:h.elements,blend:Dk[e.BlendType.normal]},a))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var e=this;return this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),this}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:Pg(e)?void 0:e||t,callback:Pg(e)?e:void 0}}},{key:"updateStyleAttribute",value:function(e,t,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(e,{scale:Zi({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r})}}]),r}(u)).prototype,"logger",[Ek],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kk=ho(Tk.prototype,"configService",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mk=ho(Tk.prototype,"shaderModuleService",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk),Uk=(Ik=RA(nr.IGlobalConfigService),Ok=RA(nr.IShaderModuleService),Rk=ho((Pk=function(){function t(e){Gi(this,t),this.triangulation=void 0,this.layer=void 0,fo(this,"configService",Rk,this),fo(this,"shaderModuleService",Lk,this),this.rendererService=void 0,this.iconService=void 0,this.fontService=void 0,this.styleAttributeService=void 0,this.mapService=void 0,this.cameraService=void 0,this.layerService=void 0,this.layer=e,this.rendererService=e.getContainer().get(nr.IRendererService),this.styleAttributeService=e.getContainer().get(nr.IStyleAttributeService),this.mapService=e.getContainer().get(nr.IMapService),this.iconService=e.getContainer().get(nr.IIconService),this.fontService=e.getContainer().get(nr.IFontService),this.cameraService=e.getContainer().get(nr.ICameraService),this.layerService=e.getContainer().get(nr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate()}return Wi(t,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend,n=void 0===t?"normal":t;return Dk[e.BlendType[n]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}()).prototype,"configService",[Ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lk=ho(Pk.prototype,"shaderModuleService",[Ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pk);Ot({target:"String",proto:!0,forced:lw("sub")},{sub:function(){return cw(this,"sub","","")}}),Hu("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Bk=Gk,Vk=Gk;function Gk(e,t,n){n=n||2;var r,i,o,a,u,s,c,l=t&&t.length,f=l?t[0]*n:e.length,h=Hk(e,0,f,n,!0),d=[];if(!h||h.next===h.prev)return d;if(l&&(h=function(e,t,n,r){var i,o,a,u,s,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,u=i<o-1?t[i+1]*r:e.length,(s=Hk(e,a,u,r,!1))===s.next&&(s.steiner=!0),c.push(tM(s));for(c.sort(Qk),i=0;i<c.length;i++)Jk(c[i],n),n=Wk(n,n.next);return n}(e,t,h,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<f;p+=n)(u=e[p])<r&&(r=u),(s=e[p+1])<i&&(i=s),u>o&&(o=u),s>a&&(a=s);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return qk(h,d,n,r,i,c),d}function Hk(e,t,n,r,i){var o,a;if(i===pM(e,t,n,r)>0)for(o=t;o<n;o+=r)a=fM(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=fM(o,e[o],e[o+1],a);return a&&oM(a,a.next)&&(hM(a),a=a.next),a}function Wk(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!oM(r,r.next)&&0!==iM(r.prev,r,r.next))r=r.next;else{if(hM(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function qk(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=eM(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,u,s,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,u=0,t=0;t<c&&(u++,r=r.nextZ);t++);for(s=c;u>0||s>0&&r;)0!==u&&(0===s||!r||n.z<=r.z)?(i=n,n=n.nextZ,u--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);for(var u,s,c=e;e.prev!==e.next;)if(u=e.prev,s=e.next,o?Zk(e,r,i,o):Xk(e))t.push(u.i/n),t.push(e.i/n),t.push(s.i/n),hM(e),e=s.next,c=s.next;else if((e=s)===c){a?1===a?qk(e=Yk(Wk(e),t,n),t,n,r,i,o,2):2===a&&Kk(e,t,n,r,i,o):qk(Wk(e),t,n,r,i,o,1);break}}}function Xk(e){var t=e.prev,n=e,r=e.next;if(iM(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(nM(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&iM(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Zk(e,t,n,r){var i=e.prev,o=e,a=e.next;if(iM(i,o,a)>=0)return!1;for(var u=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,s=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=eM(u,s,t,n,r),h=eM(c,l,t,n,r),d=e.prevZ,p=e.nextZ;d&&d.z>=f&&p&&p.z<=h;){if(d!==e.prev&&d!==e.next&&nM(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&iM(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&nM(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&iM(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==e.prev&&d!==e.next&&nM(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&iM(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&nM(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&iM(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Yk(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!oM(i,o)&&aM(i,r,r.next,o)&&cM(i,o)&&cM(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),hM(r),hM(r.next),r=e=o),r=r.next}while(r!==e);return Wk(r)}function Kk(e,t,n,r,i,o){var a=e;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&rM(a,u)){var s=lM(a,u);return a=Wk(a,a.next),s=Wk(s,s.next),qk(a,t,n,r,i,o),void qk(s,t,n,r,i,o)}u=u.next}a=a.next}while(a!==e)}function Qk(e,t){return e.x-t.x}function Jk(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var u=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=i&&u>a){if(a=u,u===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var s,c=n,l=n.x,f=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&nM(o<f?i:a,o,l,f,o<f?a:i,o,r.x,r.y)&&(s=Math.abs(o-r.y)/(i-r.x),cM(r,e)&&(s<h||s===h&&(r.x>n.x||r.x===n.x&&$k(n,r)))&&(n=r,h=s)),r=r.next}while(r!==c);return n}(e,t)){var n=lM(t,e);Wk(t,t.next),Wk(n,n.next)}}function $k(e,t){return iM(e.prev,e,t.prev)<0&&iM(t.next,e,e.next)<0}function eM(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function tM(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function nM(e,t,n,r,i,o,a,u){return(i-a)*(t-u)-(e-a)*(o-u)>=0&&(e-a)*(r-u)-(n-a)*(t-u)>=0&&(n-a)*(o-u)-(i-a)*(r-u)>=0}function rM(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&aM(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(cM(e,t)&&cM(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(iM(e.prev,e,t.prev)||iM(e,t.prev,t))||oM(e,t)&&iM(e.prev,e,e.next)>0&&iM(t.prev,t,t.next)>0)}function iM(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function oM(e,t){return e.x===t.x&&e.y===t.y}function aM(e,t,n,r){var i=sM(iM(e,t,n)),o=sM(iM(e,t,r)),a=sM(iM(n,r,e)),u=sM(iM(n,r,t));return i!==o&&a!==u||(!(0!==i||!uM(e,n,t))||(!(0!==o||!uM(e,r,t))||(!(0!==a||!uM(n,e,r))||!(0!==u||!uM(n,t,r)))))}function uM(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function sM(e){return e>0?1:e<0?-1:0}function cM(e,t){return iM(e.prev,e,e.next)<0?iM(e,t,e.next)>=0&&iM(e,e.prev,t)>=0:iM(e,t,e.prev)<0||iM(e,e.next,t)<0}function lM(e,t){var n=new dM(e.i,e.x,e.y),r=new dM(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function fM(e,t,n,r){var i=new dM(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function hM(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dM(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pM(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}Gk.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(pM(e,0,o,n));if(i)for(var u=0,s=t.length;u<s;u++){var c=t[u]*n,l=u<s-1?t[u+1]*n:e.length;a-=Math.abs(pM(e,c,l,n))}var f=0;for(u=0;u<r.length;u+=3){var h=r[u]*n,d=r[u+1]*n,p=r[u+2]*n;f+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},Gk.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},Bk.default=Vk;var vM=Bv(),gM=(Bv(),Bv()),mM=Bv(),yM=Bv();function bM(e,t){return function(e,t,n){return e[0]=t,e[1]=n,e}(e,-t[1],t[0])}function _M(e,t,n){return $v(e,t,n),qv(e,e),e}function xM(e,t){return e[0]===t[0]&&e[1]===t[1]}var SM=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Gi(this,e),this.join=void 0,this.cap=void 0,this.miterLimit=void 0,this.thickness=void 0,this.normal=void 0,this.lastFlip=-1,this.miter=Vv(0,0),this.started=!1,this.dash=!1,this.totalDistance=0,this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1}return Wi(e,[{key:"extrude",value:function(e){var t={positions:[],indices:[],normals:[]};if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=1,i=0;r<n;r++){var o=e[r-1],a=e[r],u=r<e.length-1?e[r+1]:null;if(!xM(o,a))i+=this.segment(t,i,o,a,u)}if(this.dash)for(var s=0;s<t.positions.length/6;s++)t.positions[6*s+5]=this.totalDistance;return t}},{key:"segment",value:function(e,t,n,r,i){var o=0,a=e.indices,u=e.positions,s=e.normals,c="square"===this.cap,l="bevel"===this.join,f=Jf([r[0],r[1]]),h=Jf([n[0],n[1]]);_M(gM,f,h);var d=0;if(this.dash&&(d=this.lineSegmentDistance(f,h),this.totalDistance+=d),this.normal||(this.normal=Bv(),bM(this.normal,gM)),!this.started)if(this.started=!0,c){var p=Bv(),v=Bv();Hv(p,this.normal,gM),Hv(v,this.normal,gM),s.push(v[0],v[1],0),s.push(p[0],p[1],0),u.push(n[0],n[1],0,this.totalDistance-d,-this.thickness,0),u.push(n[0],n[1],0,this.totalDistance-d,this.thickness,0)}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance-d);if(a.push(t+0,t+1,t+2),i){var g=Jf([i[0],i[1]]);xM(f,g)&&Hv(g,f,qv(g,Wv(g,f,h))),_M(mM,g,f);var m=ao(function(e,t,n,r,i){return Hv(e,n,r),qv(e,e),[i/Xv(t=Vv(-e[1],e[0]),Vv(-n[1],n[0])),t]}(yM,Bv(),gM,mM,this.thickness),2),y=m[0],b=m[1],_=Xv(yM,this.normal)<0?-1:1,x=l;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(s.push(this.normal[0],this.normal[1],0),s.push(b[0],b[1],0),u.push(r[0],r[1],0,this.totalDistance,-this.thickness*_,0),u.push(r[0],r[1],0,this.totalDistance,this.thickness*_,0),a.push.apply(a,uo(this.lastFlip!==-_?[t,t+2,t+3]:[t+2,t+1,t+3])),a.push(t+2,t+3,t+4),bM(vM,mM),Gv(this.normal,vM),s.push(this.normal[0],this.normal[1],0),u.push(r[0],r[1],0,this.totalDistance,-this.thickness*_,0),o+=3):(this.extrusions(u,s,r,b,y,this.totalDistance),a.push.apply(a,uo(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),_=-1,Gv(this.normal,b),o+=2),this.lastFlip=_}else{if(bM(this.normal,gM),c){var S=Bv(),E=Bv();$v(E,gM,this.normal),Hv(S,gM,this.normal),s.push(E[0],E[1],0),s.push(S[0],S[1],0),u.push(r[0],r[1],0,this.totalDistance,this.thickness,0),u.push(r[0],r[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,uo(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),o+=2}return o}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0,o,-i,0),e.push(n[0],n[1],0,o,i,0)}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();var EM,AM,wM,TM=function(e){return"number"==typeof e||Pm(e)&&"[object Number]"==Ig(e)};function CM(e){if(TM(e[0]))return e;if(TM(e[0][0]))throw new Error("");if(TM(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("")}function kM(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=Bk.flatten(e),a=o.vertices,u=o.dimensions,s=[],c=[],l=[],f=0;f<a.length/u;f++)2===u?s.push(a[2*f],a[2*f+1],1,-1,-1):s.push(a[3*f],a[3*f+1],1,-1,-1),l.push(0,0,1);var h=Bk(o.vertices,o.holes,o.dimensions);c.push.apply(c,uo(h));for(var d=function(e){var n=o.vertices.slice(e*u,(e+1)*u),r=o.vertices.slice((e+1)*u,(e+2)*u);0===r.length&&(r=o.vertices.slice(0,u));var i=s.length/5;s.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var a=MM([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],t);l.push.apply(l,uo(a).concat(uo(a),uo(a),uo(a))),c.push.apply(c,uo([1,2,0,3,2,1].map((function(e){return e+i}))))},p=0;p<i;p++)d(p);return{positions:s,index:c,normals:l}}function MM(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=gv(),o=gv(),a=gv();r&&(e=Zf(e),t=Zf(t),n=Zf(n));var u=yv.apply(Fv,uo(e)),s=yv.apply(Fv,uo(t)),c=yv.apply(Fv,uo(n));Iv(i,c,s),Iv(o,u,s),kv(a,i,o);var l=gv();return Tv(l,a),l}function IM(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function OM(){return IM(30)}function PM(){return IM(4)}function RM(){return IM(3)}function LM(){return IM(6,1)}function NM(){return IM(5)}!function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"}(AM||(AM={})),function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"}(wM||(wM={}));var DM=(qi(EM={},wM.CIRCLE,OM),qi(EM,wM.HEXAGON,LM),qi(EM,wM.TRIANGLE,RM),qi(EM,wM.SQUARE,PM),qi(EM,wM.PENTAGON,NM),qi(EM,AM.CYLINDER,OM),qi(EM,AM.HEXAGONCOLUMN,LM),qi(EM,AM.TRIANGLECOLUMN,RM),qi(EM,AM.SQUARECOLUMN,PM),qi(EM,AM.PENTAGONCOLUMN,NM),EM),jM={};function FM(e){var t=CM(e.coordinates);return{vertices:[].concat(uo(t),uo(t),uo(t),uo(t)),indices:[0,1,2,2,3,0],size:t.length}}function zM(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(jM&&jM[e])return jM[e];var n=DM[e]?DM[e]():DM.cylinder(),r=kM([n],t);return jM[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function UM(e){var t=CM(e.coordinates);return{vertices:uo(t),indices:[0],size:t.length}}function BM(e){var t=e.coordinates,n=t;Array.isArray(n[0][0])&&(n=t[0]);var r=new SM({dash:!0,join:"bevel"}).extrude(n);return{vertices:r.positions,indices:r.indices,normals:r.normals,size:6}}function VM(e){var t=e.coordinates,n=Bk.flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:Bk(r,o,i),vertices:r,size:i}}function GM(e){var t=kM(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function HM(e){var t=function(e){var t=DM[e]?DM[e]():DM.circle();return-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[t],r=Bk.flatten(n),i=Bk(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=Bk.flatten(e),o=i.vertices,a=i.dimensions,u=[],s=[],c=0;c<o.length/a;c++)2===a?u.push(o[2*c],o[2*c+1],1):u.push(o[3*c],o[3*c+1],1);var l=Bk(i.vertices,i.holes,i.dimensions);s.push.apply(s,uo(l));for(var f=function(e){var t=i.vertices.slice(e*a,(e+1)*a),n=i.vertices.slice((e+1)*a,(e+2)*a);0===n.length&&(n=i.vertices.slice(0,a));var r=u.length/3;u.push(t[0],t[1],1,n[0],n[1],1,t[0],t[1],0,n[0],n[1],0),s.push.apply(s,uo([0,2,1,2,3,1].map((function(e){return e+r}))))},h=0;h<r;h++)f(h);return{positions:u,index:s}}([t]);var n,r,i}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function WM(e){var t=e.coordinates;return{vertices:[].concat(uo(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],uo(t[1]),[0,1,0],uo(t[0]),[0,0,1],uo(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function qM(e){for(var t=e.coordinates,n=[],r=[],i=function(e){n.push(e,1,e,t[0][0],t[0][1],t[1][0],t[1][1],e,-1,e,t[0][0],t[0][1],t[1][0],t[1][1]),29!==e&&r.push.apply(r,uo([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},o=0;o<30;o++)i(o);return{vertices:n,indices:r,size:7}}function XM(e){var t=e.coordinates;2===t.length&&t.push(0);e.size;var n=ZM(-1,1),r=ZM(1,1),i=ZM(-1,-1),o=ZM(1,-1);return{vertices:[].concat(uo(t),uo(n),uo(t),uo(i),uo(t),uo(o),uo(t),uo(r)),indices:[0,1,2,3,0,2],size:5}}function ZM(e,t){return[(e+1)/2,(t+1)/2]}var YM=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,u=e.windowColor,s=void 0===u?"rgb(30,60,89)":u,c=e.time,l=void 0===c?0:c;return{u_opacity:n,u_baseColor:Bh(i),u_brightColor:Bh(a),u_windowColor:Bh(s),u_time:this.layer.getLayerAnimateTime()||l}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nv_texCoord = a_Uv;\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n#pragma include "picking"\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\nfloat s = step(hot, n);\nvec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\nreturn mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\nreturn fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\nfloat LinearizeDepth()\n{\nfloat z = gl_FragCoord.z * 2.0 - 1.0;\nreturn (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\nvec3 fog(vec3 color, vec3 fogColor, float depth){\nfloat fogFactor=clamp(depth,0.0,1.0);\nvec3 output_color=mix(fogColor,color,fogFactor);\nreturn output_color;\n}\nfloat sdRect(vec2 p, vec2 sz) {\nvec2 d = abs(p) - sz;\nfloat outside = length(max(d, 0.));\nfloat inside = min(max(d.x, d.y), 0.);\nreturn outside + inside;\n}\nvoid main() {\ngl_FragColor = v_Color;\nvec3 baseColor = u_baseColor.xyz;\nvec3 brightColor = u_brightColor.xyz;\nvec3 windowColor = u_windowColor.xyz;\nfloat targetColId = 5.;\nfloat depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\nvec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\nif(v_texCoord.x < 0.) {\nvec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\ngl_FragColor = vec4( foggedColor, v_Color.w);\n}else {\nvec2 st = v_texCoord;\nvec2  UvScale = v_texCoord;\nfloat tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\nfloat tStart = 0.25 * tStep;\nfloat tEnd = 0.75 * tStep;\nfloat u = mod(UvScale.x, tStep);\nfloat v = mod(UvScale.y, tStep);\nfloat ux = floor(UvScale.x/tStep);\nfloat uy = floor(UvScale.y/tStep);\nfloat n = random(vec2(ux,uy));\nfloat lightP = u_time;\nfloat head = 1.0- step(0.005,st.y);\nfloat sU = step(tStart, u) - step(tEnd, u);\nfloat sV = step(tStart, v) - step(tEnd, v);\nvec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\nfloat dist = sdRect(vec2(u,v), windowSize);\nfloat s = sU * sV;\nfloat curColId = floor(UvScale.x / tStep);\nfloat sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\nfloat mLightP = mod(lightP, 2.);\nfloat sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\nif(ux == targetColId){\nn =0.;\n}\nfloat timeP = min(0.75, abs ( sin(u_time/3.0) ) );\nfloat hot = smoothstep(1.0,0.0,timeP);\nvec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\nfloat sFinal = s * sCol * sRow;\ncolor += mix(baseColor, brightColor, sFinal*n);\nif (st.y<0.01){\ncolor = baseColor;\n}\nif(head ==1.0) {\ncolor = brightColor;\n}\ncolor = color * v_Color.rgb;\nvec3 foggedColor = fog(color,fogColor,depth);\ngl_FragColor = vec4(foggedColor,1.0);\n}\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:GM})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){e.size;return[n[3],n[4]]}}})}}]),r}(Uk),KM=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="PolygonLayer",e}return Wi(n,[{key:"buildModels",value:function(){this.layerModel=new YM(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(zk),QM='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',JM=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\nvec4 project_pos = project_position(vec4(a_Pos.xy + offset, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(project_pos);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:QM,triangulation:HM,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n=e.coordinates;return[n[0],n[1],0]}}})}}]),r}(Uk),$M=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = project_common_position_to_clipspace(project_pos);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:QM,triangulation:zM,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n=e.coordinates;return[n[0],n[1],0]}}})}}]),r}(Uk);var eI=function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).texture=void 0,e.colorTexture=void 0,e.heatmapFramerBuffer=void 0,e.intensityModel=void 0,e.colorModel=void 0,e.shapeType=void 0,e}return Wi(r,[{key:"render",value:function(){var e=this,t=this.rendererService,n=t.clear;(0,t.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t,n=this.rendererService,r=n.createFramebuffer,i=(n.clear,n.getViewportSize),o=n.createTexture2D,a=(n.useFramebuffer,this.styleAttributeService.getLayerStyleAttribute("shape")),u=(null==a||null===(t=a.scale)||void 0===t?void 0:t.field)||"heatmap";this.shapeType=u,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel="heatmap"===u?this.buildHeatmapColor():this.build3dHeatMap();Hh(this.layer.getLayerConfig().rampColors);var s=i(),c=s.width,l=s.height;return this.heatmapFramerBuffer=r({color:o({width:Math.floor(c/4),height:Math.floor(l/4),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.LINEAR,mag:e.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:e.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return[void 0===i?1:i]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\n#define GAUSS_COEF  0.3989422804014327\n#pragma include "projection"\nvoid main(){\nv_weight = a_Size;\nfloat ZERO = 1.0 / 255.0 / 16.0;\nfloat extrude_x = a_Dir.x * 2.0 -1.0;\nfloat extrude_y = a_Dir.y * 2.0 -1.0;\nvec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\nfloat S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;\nv_extrude = extrude_dir * S;\nvec2 offset = project_pixel(v_extrude * u_radius);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\nfloat d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\nfloat val = v_weight * u_intensity * GAUSS_COEF * exp(d);\ngl_FragColor = vec4(val, 1., 1., 1.);\n}",triangulation:XM,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:e.gl.ONE,srcAlpha:1,dstRGB:e.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main() {\nv_texCoord = a_Uv;\nv_intensity = texture2D(u_texture, v_texCoord).r;\ngl_Position = vec4(a_Position.xy, 0, 1.);\n}",fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor =color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var t=this.shaderModuleService.getModule("heatmapColor"),n=t.vs,r=t.fs,i=t.uniforms,o=this.rendererService,a=o.createAttribute,u=o.createElements,s=o.createBuffer;return(0,o.createModel)({vs:n,fs:r,attributes:{a_Position:a({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:e.gl.FLOAT}),size:3}),a_Uv:a({buffer:s({data:[0,1,1,1,0,0,1,0],type:e.gl.FLOAT}),size:2})},uniforms:Zi({},i),depth:{enable:!1},blend:this.getBlend(),count:6,elements:u({data:[0,2,1,2,3,1],type:e.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.intensity,r=void 0===n?10:n,i=e.radius,o=void 0===i?5:i;this.intensityModel.draw({uniforms:{u_opacity:t||1,u_radius:o,u_intensity:r}})}},{key:"drawColorMode",value:function(){var e=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var e=this.layer.getLayerConfig().opacity,t=$p(Yp(),Qp.apply(vv,uo(this.cameraService.getViewProjectionMatrixUncentered())));this.colorModel.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:uo(t)}})}},{key:"build3dHeatMap",value:function(){var t=(0,this.rendererService.getViewportSize)(),n=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,u=e/2,s=t/2,c=0;c<a;c++)for(var l=c-s,f=0;f<o;f++){var h=f-u;r.push(h/u,-l/s,0),i.push(f/e),i.push(1-c/t)}for(var d=0;d<t;d++)for(var p=0;p<e;p++){var v=p+o*d,g=p+o*(d+1),m=p+1+o*(d+1),y=p+1+o*d;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(t.width/4,t.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\nfloat t2 = t * t;\nfloat one_minus_t = 1.0 - t;\nfloat one_minus_t2 = one_minus_t * one_minus_t;\nreturn (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\nreturn toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec2 pos =(a_Uv * vec2(2.0) - vec2(1.0));\nvec4 p1 = vec4(pos, 0.0, 1.0);\nvec4 p2 = vec4(pos, 1.0, 1.0);\nvec4 inverseP1 = u_InverseViewProjectionMatrix * p1;\nvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\ninverseP1 = inverseP1 / inverseP1.w;\ninverseP2 = inverseP2 / inverseP2.w;\nfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z);\nvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\nvec4 b= vec4(0.5000, 0, 1, 0.5000);\nfloat fh;\nv_intensity = texture2D(u_texture, v_texCoord).r;\nfh = toBezier(v_intensity, b).y;\ngl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n}',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor = color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var r=this.shaderModuleService.getModule("heatmap3dColor"),i=r.vs,o=r.fs,a=r.uniforms,u=this.rendererService,s=u.createAttribute,c=u.createElements,l=u.createBuffer;return(0,u.createModel)({vs:i,fs:o,attributes:{a_Position:s({buffer:l({data:n.vertices,type:e.gl.FLOAT}),size:3}),a_Uv:s({buffer:l({data:n.uvs,type:e.gl.FLOAT}),size:2})},primitive:e.gl.TRIANGLES,uniforms:Zi({},a),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,srcAlpha:1,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:c({data:n.indices,type:e.gl.UNSIGNED_INT,count:n.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var n=Hh(this.layer.getLayerConfig().rampColors);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.NEAREST,mag:e.gl.NEAREST,flipY:!1})}}]),r}(Uk),tI={heatmap:eI,heatmap3d:eI,grid:JM,grid3d:$M,hexagon:function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\nsetPickingColor(a_PickingColor);\n}',fragmentShader:QM,triangulation:HM,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n=e.coordinates;return[n[0],n[1],0]}}})}}]),r}(Uk)},nI=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="HeatMapLayer",e}return Wi(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new tI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var e=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach((function(t){return t.draw({uniforms:e.layerModel.getUninforms()})})),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),n}(zk),rI={image:function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).texture=void 0,e}return Wi(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(){var t=this,n=this.layer.getSource(),r=this.rendererService.createTexture2D;return this.texture=r({height:0,width:0}),n.data.images.then((function(e){t.texture=r({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.renderLayers()})),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\n}",triangulation:WM,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(Uk)},iI=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="ImageLayer",e}return Wi(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new rI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),n}(zk),oI='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_aimate.x == Animate) {\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',aI={solid:0,dash:1},uI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.lineType,r=void 0===n?"solid":n,i=e.dashArray,o=void 0===i?[10,5]:i;return 2===o.length&&o.push(0,0),{u_opacity:t||1,segmentNumber:30,u_line_type:aI[r||"solid"],u_dash_array:o,u_blur:.9}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = 0.314;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nreturn mid;\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nfloat total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));\nv_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\nsetPickingColor(a_PickingColor);\n}',fragmentShader:oI,triangulation:qM,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}})}}]),r}(Uk),sI={solid:0,dash:1},cI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.lineType,r=void 0===n?"solid":n,i=e.dashArray,o=void 0===i?[10,5]:i;return 2===o.length&&o.push(0,0),{u_opacity:t||1,segmentNumber:30,u_line_type:sI[r]||0,u_dash_array:o}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nfloat total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\nsetPickingColor(a_PickingColor);\n}',fragmentShader:oI,triangulation:qM,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}})}}]),r}(Uk),lI={solid:0,dash:1},fI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.lineType,r=void 0===n?"solid":n,i=e.dashArray,o=void 0===i?[10,5]:i;return 2===o.length&&o.push(0,0),{u_opacity:t||1,segmentNumber:30,u_line_type:lI[r]||0,u_dash_array:o}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 delta = source - target;\nvec2 sin_half_delta = sin(delta / 2.0);\nfloat a =\nsin_half_delta.y * sin_half_delta.y +\ncos(source.y) * cos(target.y) *\nsin_half_delta.x * sin_half_delta.x;\nreturn 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\nif(abs(angularDist - PI) < 0.001) {\nreturn (1.0 - t) * source + t * target;\n}\nfloat a = sin((1.0 - t) * angularDist) / sin(angularDist);\nfloat b = sin(t * angularDist) / sin(angularDist);\nvec2 sin_source = sin(source);\nvec2 cos_source = cos(source);\nvec2 sin_target = sin(target);\nvec2 cos_target = cos(target);\nfloat x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\nfloat y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\nfloat z = a * sin_source.y + b * sin_target.y;\nreturn vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = radians(a_Instance.rg);\nvec2 target = radians(a_Instance.ba);\nfloat angularDist = getAngularDist(source, target);\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nfloat total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nv_distance_ratio = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\nvec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\nv_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\nsetPickingColor(a_PickingColor);\n}',fragmentShader:oI,triangulation:qM,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}})}}]),r}(Uk),hI={solid:0,dash:1},dI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.lineType,r=void 0===n?"solid":n,i=e.dashArray,o=void 0===i?[10,5,0,0]:i;return 2===o.length&&o.push(0,0),{u_opacity:t||1,u_line_type:hI[r],u_dash_array:o}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5.0, 0];\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying vec2 v_normal;\nvarying float v_distance_ratio;\nvarying float v_side;\nvoid main() {\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = a_Distance / a_Total_Distance;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = a_Distance / a_Total_Distance;\n}\nv_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nv_side = a_Miter * a_Size.x;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nuniform float u_opacity : 1.0;\nvarying vec4 v_color;\nvarying vec2 v_normal;\nuniform float u_dash_offset : 0.0;\nuniform float u_dash_ratio : 0.1;\nvarying float v_distance_ratio;\nvarying vec4 v_dash_array;\nvarying float v_side;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvoid main() {\ngl_FragColor = v_color;\nfloat blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\ngl_FragColor.a *= u_opacity * blur ;\nif(u_aimate.x == Animate) {\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:BM,primitive:e.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){this.layer.getLayerConfig().lineType;this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0],o[1]]:[o,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[4]]}}})}}]),r}(Uk),pI={arc:uI,arc3d:cI,greatcircle:fI,line:dI},vI=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="LineLayer",e}return Wi(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new pI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}}]),n}(zk),gI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform mat4 u_ModelMatrix;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec3 size = a_Size * a_Position;\nvec2 offset = project_pixel(size.xy);\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);\nfloat lightWeight = calc_lighting(pos);\nv_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\ngl_Position = project_common_position_to_clipspace(pos);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:zM,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=e.size;if(i){var o=[];return Array.isArray(i)&&(o=2===i.length?[i[0],i[0],i[1]]:i),Array.isArray(i)||(o=[i]),o}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n=CM(e.coordinates);return[n[0],n[1],0]}}})}}]),r}(Uk),mI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.stroke,i=void 0===r?"rgb(0,0,0,0)":r,o=e.strokeWidth,a=void 0===o?1:o,u=e.strokeOpacity,s=void 0===u?1:u;return{u_opacity:n,u_stroke_width:a,u_stroke_color:Bh(i),u_stroke_opacity:s}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),FM)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec2 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform float u_stroke_width : 2;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nvec2 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nv_radius = newSize;\nvec2 offset = project_pixel(extrude * (newSize + u_stroke_width));\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\nfloat antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);\nv_data = vec4(extrude, antialiasblur,shape_type);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define Animate 0.0\nuniform float u_blur : 0;\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 1;\nuniform vec4 u_stroke_color : [0, 0, 0, 0];\nuniform float u_stroke_opacity : 1;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nlowp float antialiasblur = v_data.z;\nfloat antialiased_blur = -max(u_blur, antialiasblur);\nfloat r = v_radius / (v_radius + u_stroke_width);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nfloat opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\nfloat color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,\n0.0,\ninner_df\n);\nvec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;\nfloat PI = 3.14159;\nfloat N_RINGS = 3.0;\nfloat FREQ = 1.0;\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\ngl_FragColor.a = gl_FragColor.a * opacity_t;\nif(u_aimate.x == Animate) {\nfloat d = length(v_data.xy);\nfloat intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);\ngl_FragColor = vec4(gl_FragColor.xyz, intensity);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:FM,depth:{enable:!1},blend:this.getBlend()})]}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=[1,1,-1,1,-1,-1,1,-1],o=r%4*2;return[i[o],i[o+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?5:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var o=e.shape,a=void 0===o?2:o;return[t.layer.getLayerConfig().shape2d.indexOf(a)]}}})}}]),r}(Uk),yI='uniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_stroke_width : 1;\nuniform vec4 u_stroke_color : [1, 1, 1, 1];\nuniform float u_stroke_opacity : 1;\nuniform float u_opacity : 1;\nvarying float v_size;\n#pragma include "picking"\nvoid main(){\nvec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\nvec2 fragmentPosition = 2.0*gl_PointCoord - 1.0;\nfloat distance = length(fragmentPosition);\nfloat distanceSqrd = distance * distance;\nfloat radius = 1.;\nfloat r = 1.0 - smoothstep(radius-(radius*0.01),\nradius+(radius*0.01),\ndistanceSqrd);\nvec4 textureColor=texture2D(u_texture,pos);\nif(v_color == vec4(1.0)){\ngl_FragColor= vec4(textureColor.xyz, textureColor.w);\n}else {\ngl_FragColor= step(0.01, textureColor.z) * v_color;\n}\ngl_FragColor.a =gl_FragColor.a * u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',bI='precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform float u_stroke_width : 1;\nvarying float v_size;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_size = a_Size;\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',_I=function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).texture=void 0,e}return Wi(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var t=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",(function(){t.updateTexture(),t.layer.render()})),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:bI,fragmentShader:yI,triangulation:UM,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.fontService.mapping,a=e.shape,u=o[t.fontService.getGlyph(a)];return[u.x,u.y]}}})}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"initIconFontGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.fontWeight,r=void 0===n?"normal":n,i=t.fontFamily,o=void 0===i?"sans-serif":i,a=this.layer.getEncodedData(),u=[];a.forEach((function(t){var n=t.shape,r=void 0===n?"":n;r=r.toString();var i=e.fontService.getGlyph(r);-1===u.indexOf(i)&&u.push(i)})),this.fontService.setFontOptions({characterSet:u,fontWeight:r,fontFamily:o,fontSize:48})}}]),r}(Uk),xI=function(t){Yi(r,t);var n=io(r);function r(){var t;Gi(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(t=n.call.apply(n,[this].concat(o))).texture=void 0,t.updateTexture=function(){var n=t.rendererService.createTexture2D;t.texture&&t.texture.destroy(),t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.LINEAR,min:e.gl.LINEAR,width:1024,height:t.iconService.canvasHeight||128}),t.layer.render()},t}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity;return this.rendererService.getDirty()&&this.texture.update(),{u_opacity:e||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:bI,fragmentShader:yI,triangulation:UM,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?5:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var o=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[o.x,o.y]}}})}}]),r}(Uk);function SI(e){var t=e.coordinates;return{vertices:uo(t),indices:[0],size:t.length}}var EI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.stroke,i=void 0===r?"rgb(0,0,0,0)":r,o=e.strokeWidth;return{u_opacity:n,u_stroke_width:void 0===o?1:o,u_stroke_color:Bh(i)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(project_pos);\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity : 1;\nvarying vec4 v_color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a =gl_FragColor.a * u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:SI,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?1:i;return Array.isArray(o)?[o[0]]:[o]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:e.BlendType.additive}}}]),r}(Uk),AI=function(){function e(t,n,r){Gi(this,e),this.boxCells=[],this.xCellCount=void 0,this.yCellCount=void 0,this.boxKeys=void 0,this.bboxes=void 0,this.width=void 0,this.height=void 0,this.xScale=void 0,this.yScale=void 0,this.boxUid=void 0;var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return Wi(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var u=0;u<this.boxKeys.length;u++)a.push({key:this.boxKeys[u],x1:this.bboxes[4*u],y1:this.bboxes[4*u+1],x2:this.bboxes[4*u+2],y2:this.bboxes[4*u+3]});return o?a.filter(o):a}var s={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,s,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,i,o,a,u){var s=a.seenUids,c=this.boxCells[i];if(null!==c){var l,f=this.bboxes,h=lo(c);try{for(h.s();!(l=h.n()).done;){var d=l.value;if(!s.box[d]){s.box[d]=!0;var p=4*d;if(e<=f[p+2]&&t<=f[p+3]&&n>=f[p+0]&&r>=f[p+1]&&(!u||u(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:f[p],y1:f[p+1],x2:f[p+2],y2:f[p+3]})}}}}catch(e){h.e(e)}finally{h.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,u){for(var s=this.convertToXCellCoord(e),c=this.convertToYCellCoord(t),l=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),h=s;h<=l;h++)for(var d=c;d<=f;d++){var p=this.xCellCount*d+h;if(i.call(this,e,t,n,r,p,o,a,u))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),wI=function(){function e(t,n){Gi(this,e),this.width=void 0,this.height=void 0,this.grid=void 0,this.viewportPadding=100,this.screenRightBoundary=void 0,this.screenBottomBoundary=void 0,this.gridRightBoundary=void 0,this.gridBottomBoundary=void 0,this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new AI(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return Wi(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=function(e,t,n,r){var i=new Xp(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}(t,n,0,1),i=zv();return Uv(i,r,Qp.apply(vv,uo(e))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function TI(e,t,n,r,i,o,a){var u=0,s=-8,c=0,l=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=l.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(l.push({glyph:e,x:u,y:s+0,vertical:!1,scale:1,metrics:n}),u+=n.advance+a)})),l.length!==h){var n=u-a;c=Math.max(n,c),function(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var u=t[a].advance*o.scale,s=(e[r].x+u)*i,c=n;c<=r;c++)e[c].x-=s}}(l,t,h,l.length-1,f)}u=0,s+=r}));var d=function(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}(i),p=d.horizontalAlign,v=d.verticalAlign;!function(e,t,n,r,i,o,a){var u,s=(t-n)*i,c=(-r*a+.5)*o,l=lo(e);try{for(l.s();!(u=l.n()).done;){var f=u.value;f.x+=s,f.y+=c}}catch(e){l.e(e)}finally{l.f()}}(l,f,p,v,c,r,n.length);var g=s- -8;e.top+=-v*g,e.bottom=e.top+g,e.left+=-p*c,e.right=e.left+c}var CI='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_opacity : 1.0;\nuniform float u_stroke_opacity: 1.0;\nuniform vec4 u_stroke : [0, 0, 0, 1];\nuniform float u_strokeWidth : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n#pragma include "picking"\nvoid main() {\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - u_strokeWidth / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke.rgb, u_stroke.a * u_opacity), smoothstep(0., 0.5, 1. - dist));\ngl_FragColor.a= gl_FragColor.a * alpha;\ngl_FragColor = filterColor(gl_FragColor);\n}',kI='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nv_uv = a_tex / u_sdf_map_size;\nfloat fontScale = a_Size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nvec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\ngl_Position = vec4(projected_position.xy / projected_position.w\n+ a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\nsetPickingColor(a_PickingColor);\n}';function MI(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,o=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,uo(o).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],uo(o),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],uo(o),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],uo(o),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var II,OI,PI,RI,LI,NI,DI,jI=function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).glyphInfo=void 0,e.glyphInfoMap={},e.texture=void 0,e.currentZoom=-1,e.extent=void 0,e.textureHeight=0,e.textCount=0,e.preTextStyle={},e.buildModels=function(){return e.initGlyph(),e.updateTexture(),e.filterGlyphs(),[e.layer.buildLayerModel({moduleName:"pointText",vertexShader:kI,fragmentShader:CI,triangulation:MI.bind(no(e)),depth:{enable:!1},blend:e.getBlend()})]},e}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.stroke,i=void 0===r?"#fff":r,o=e.strokeWidth,a=void 0===o?0:o,u=e.strokeOpacity,s=void 0===u?1:u,c=e.textAnchor,l=void 0===c?"center":c,f=e.textAllowOverlap,h=void 0!==f&&f,d=e.halo,p=void 0===d?.5:d,v=e.gamma,g=void 0===v?2:v,m=this.fontService,y=m.canvas,b=m.mapping;return Object.keys(b).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(b).length),this.preTextStyle={textAnchor:l,textAllowOverlap:h},{u_opacity:n,u_stroke_opacity:s,u_sdf_map:this.texture,u_stroke:Bh(i),u_halo_blur:p,u_gamma_scale:g,u_sdf_map_size:[y.width,y.height],u_strokeWidth:a}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var e=this.layer.getLayerConfig(),t=e.textAnchor,n=void 0===t?"center":t,r=e.textAllowOverlap,i=void 0===r||r;return this.preTextStyle={textAnchor:n,textAllowOverlap:i},this.buildModels()}},{key:"needUpdate",value:function(){var e=this.layer.getLayerConfig().textAllowOverlap,t=void 0!==e&&e,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=th(this.extent,r);return(!t&&(Math.abs(this.currentZoom-n)>1||!i)||t!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:e.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?12:i;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:e.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){return eh(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=this.layer.getEncodedData(),a=[];o.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,i=lo(r=r.toString());try{for(i.s();!(t=i.n()).done;){var o=t.value;-1===a.indexOf(o)&&a.push(o)}}catch(e){i.e(e)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:a,fontWeight:n,fontFamily:i})}},{key:"generateGlyphLayout",value:function(){var e=this,t=this.fontService.mapping,n=this.layer.getLayerConfig(),r=n.spacing,i=void 0===r?2:r,o=n.textAnchor,a=void 0===o?"center":o,u=n.textOffset,s=this.layer.getEncodedData();this.glyphInfo=s.map((function(n){var r=n.shape,o=void 0===r?"":r,s=n.coordinates,c=n.id,l=n.size,f=void 0===l?1:l,h=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],u=e.split("\n"),s=[],c={positionedGlyphs:s,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return TI(c,t,u,n,r,i,o),!!s.length&&c}(o.toString(),t,f,a,"center",i,u),d=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=void 0===i?[]:i,a=[],u=lo(o);try{for(u.s();!(t=u.n()).done;){var s=t.value,c=s.metrics,l=4,f=c.advance*s.scale/2,h=r?[s.x+f,s.y]:[0,0],d=r?[0,0]:[s.x+f+n[0],s.y+n[1]],p=(0-l)*s.scale-f+d[0],v=(0-l)*s.scale+d[1],g=p+c.width*s.scale,m=v+c.height*s.scale,y={x:p,y:v},b={x:g,y:v},_={x:p,y:m},x={x:g,y:m};a.push({tl:y,tr:b,bl:_,br:x,tex:c,glyphOffset:h})}}catch(e){u.e(e)}finally{u.f()}return a}(h,u,!1);return n.shaping=h,n.glyphQuads=d,n.centroid=CM(s),e.glyphInfoMap[c]={shaping:h,glyphQuads:d,centroid:CM(s)},n}))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[4,4]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,u=o.height,s=new wI(a,u);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a=t.centroid,u=t.size/24,c=e.mapService.lngLatToContainer(a),l=s.placeCollisionBox({x1:n.left*u-r[0],x2:n.right*u+r[0],y1:n.top*u-r[1],y2:n.bottom*u+r[1],anchorPointX:c.x,anchorPointY:c.y}).box;return!(!l||!l.length)&&(s.insertCollisionBox(l,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.textureHeight=n.height,this.texture&&this.texture.destroy(),this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:kI,fragmentShader:CI,triangulation:MI.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Uk),FI={fill:mI,image:xI,normal:EI,extrude:gI,text:jI,icon:_I},zI=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="PointLayer",e}return Wi(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new FI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":-1!==(null==n?void 0:n.indexOf(a))?"fill":-1!==(null==r?void 0:r.indexOf(a))?"extrude":i.hasOwnProperty(a)?"image":""!==this.fontService.getGlyph(a)?"icon":"text"}return"normal"}}]),n}(zk),UI=function(t){Yi(r,t);var n=io(r);function r(){return Gi(this,r),n.apply(this,arguments)}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity;return{u_opacity:void 0===e?1:e}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_Color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:GM})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,o=void 0===i?10:i;return Array.isArray(o)?[o[0]]:[o]}}})}}]),r}(Uk),BI={fill:function(e){Yi(n,e);var t=io(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Wi(n,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity;return{u_opacity:void 0===e?1:e}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nvarying vec4 v_Color;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_Color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:VM,depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(Uk),line:dI,extrude:UI,text:jI,point_fill:mI,point_image:xI,point_normal:EI,point_extrude:gI},VI=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="PolygonLayer",e}return Wi(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new BI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"===n?"fill":"extrude"===n?"extrude":"line"===n?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),n}(zk),GI=function(t){Yi(r,t);var n=io(r);function r(){var e;Gi(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).texture=void 0,e.colorTexture=void 0,e}return Wi(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,u=e.noDataValue,s=void 0===u?-9999999:u,c=e.domain,l=void 0===c?[0,1]:c;return this.updateColorTexure(),{u_opacity:n||1,u_texture:this.texture,u_domain:l,u_clampLow:i,u_clampHigh:void 0!==a?a:i,u_noDataValue:s,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0];this.texture=n({data:r.data,width:r.width,height:r.height,format:e.gl.LUMINANCE,type:e.gl.FLOAT});var i=Hh(this.layer.getLayerConfig().rampColors);return this.colorTexture=n({data:i.data,width:i.width,height:i.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nvoid main() {\nfloat value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\nif (value == u_noDataValue)\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\nelse if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\ngl_FragColor = vec4(0, 0, 0, 0);\nelse {\nfloat normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\nvec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\ngl_FragColor = color;\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\n}\n}",triangulation:WM,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"updateColorTexure",value:function(){var e=this.rendererService.createTexture2D,t=Hh(this.layer.getLayerConfig().rampColors);this.colorTexture=e({data:t.data,width:t.width,height:t.height,flipY:!1})}}]),r}(Uk),HI={raster:GI,raster3d:GI},WI=function(e){Yi(n,e);var t=io(n);function n(){var e;Gi(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="RasterLayer",e}return Wi(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new HI[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{raster:{},raster3d:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"raster"}}]),n}(zk),qI=(II=Q(),OI=J(nr.IGlobalConfigService),PI=J(nr.ILogService),II((NI=ho((LI=function(){function e(){Gi(this,e),fo(this,"configService",NI,this),fo(this,"logger",DI,this)}return Wi(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("DataMappingPlugin",(function(){n.generateMaping(e,{styleAttributeService:r})})),e.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){return e.dataState.dataMappingNeedUpdate=!1,n.generateMaping(e,{styleAttributeService:r}),!0})),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){if(!e.layerModelNeedUpdate){var t=r.getLayerStyleAttributes()||[],i=r.getLayerStyleAttribute("filter"),o=e.getSource().data.dataArray,a=t.filter((function(e){return e.needRemapping})),u=o;(null==i?void 0:i.needRemapping)&&(null==i?void 0:i.scale)&&(u=o.filter((function(e){return n.applyAttributeMapping(i,e)[0]}))),a.length&&((null==i?void 0:i.needRemapping)?(e.setEncodedData(n.mapping(t,u)),i.needRemapping=!1):e.setEncodedData(n.mapping(a,u,e.getEncodedData())),n.logger.debug("remapping finished"),e.emit("remapping",null))}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,u=a;(null==o?void 0:o.scale)&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),e.setEncodedData(this.mapping(i,u))}},{key:"mapping",value:function(e,t,n){var r=this;return t.map((function(t,i){var o=n?n[i]:{},a=Zi({id:t._id,coordinates:t.coordinates},o);return e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var n=r.applyAttributeMapping(e,t);e.needRemapping=!1,"color"===e.name&&(n=n.map((function(e){return Bh(e)}))),a[e.name]=Array.isArray(n)&&1===n.length?n[0]:n})),a}))}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}}]),e}()).prototype,"configService",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DI=ho(LI.prototype,"logger",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=LI))||RI),XI={},ZI={},YI=function(e){return ZI[e]},KI=function(e,t){ZI[e]=t},QI=function(e,t){XI[e]=t},JI={},$I={};function eO(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function tO(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function nO(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function rO(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+nO(-e,6):e>9999?"+"+nO(e,6):nO(e,4)}(e.getUTCFullYear())+"-"+nO(e.getUTCMonth()+1,2)+"-"+nO(e.getUTCDate(),2)+(i?"T"+nO(t,2)+":"+nO(n,2)+":"+nO(r,2)+"."+nO(i,3)+"Z":r?"T"+nO(t,2)+":"+nO(n,2)+":"+nO(r,2)+"Z":n||t?"T"+nO(t,2)+":"+nO(n,2)+"Z":"")}var iO=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,u=0,s=o<=0,c=!1;function l(){if(s)return $I;if(c)return c=!1,JI;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?s=!0:10===(r=e.charCodeAt(a++))?c=!0:13===r&&(c=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))c=!0;else if(13===r)c=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return s=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=l())!==$I;){for(var f=[];r!==JI&&r!==$I;)f.push(r),r=l();t&&null==(f=t(f,u++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?rO(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=eO(e);return function(r,i){return t(n(r),i,e)}}(e,t):eO(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=tO(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=tO(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(",").parse,oO=6378137;function aO(e){var t=0;if(e&&e.length>0){t+=Math.abs(uO(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(uO(e[n]))}return t}function uO(e){var t,n,r,i,o,a,u=0,s=e.length;if(s>2){for(a=0;a<s;a++)a===s-2?(r=s-2,i=s-1,o=0):a===s-1?(r=s-1,i=0,o=1):(r=a,i=a+1,o=a+2),t=e[r],n=e[i],u+=(sO(e[o][0])-sO(t[0]))*Math.sin(sO(n[1]));u=u*oO*oO/2}return u}function sO(e){return e*Math.PI/180}var cO={geometry:function e(t){var n,r=0;switch(t.type){case"Polygon":return aO(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)r+=aO(t.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)r+=e(t.geometries[n]);return r}},ring:uO},lO=function e(t,n){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(fO(e,n)),t;case"GeometryCollection":return t.geometries=t.geometries.map(fO(e,n)),t;case"Feature":return t.geometry=e(t.geometry,n),t;case"Polygon":case"MultiPolygon":return function(e,t){"Polygon"===e.type?e.coordinates=hO(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(fO(hO,t)));return e}(t,n);default:return t}};function fO(e,t){return function(n){return e(n,t)}}function hO(e,t){t=!!t,e[0]=dO(e[0],t);for(var n=1;n<e.length;n++)e[n]=dO(e[n],!t);return e}function dO(e,t){return function(e){return cO.ring(e)>=0}(e)===t?e:e.reverse()}function pO(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,u=[];return e.forEach((function(e,t){var s=[];(n&&r&&(s=[parseFloat(e[n]),parseFloat(e[r])]),n&&r&&i&&o)&&(s=[[parseFloat(e[n]),parseFloat(e[r])],[parseFloat(e[i]),parseFloat(e[o])]]);if(a){var c="Polygon";Array.isArray(a[0])||(c="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(c="LineString");var l={type:c,coordinates:uo(e[a])};lO(l,!0),s=l.coordinates}var f=Zi(Zi({},e),{},{_id:t,coordinates:s});u.push(f)})),{dataArray:u}}var vO=o((function(e,t){function n(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function r(e,t,r){return void 0===r&&(r={}),n({type:"Point",coordinates:e},t,r)}function i(e,t,r){void 0===r&&(r={});for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<a[a.length-1].length;u++)if(a[a.length-1][u]!==a[0][u])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:e},t,r)}function o(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:e},t,r)}function a(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function u(e,t,r){return void 0===r&&(r={}),n({type:"MultiLineString",coordinates:e},t,r)}function s(e,t,r){return void 0===r&&(r={}),n({type:"MultiPoint",coordinates:e},t,r)}function c(e,t,r){return void 0===r&&(r={}),n({type:"MultiPolygon",coordinates:e},t,r)}function l(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e*r}function f(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e/r}function h(e){return 180*(e%(2*Math.PI))/Math.PI}function d(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)&&!/^\s*$/.test(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:t.earthRadius/1.0936},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1/1.0936},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=n,t.geometry=function(e,t,n){switch(e){case"Point":return r(t).geometry;case"LineString":return o(t).geometry;case"Polygon":return i(t).geometry;case"MultiPoint":return s(t).geometry;case"MultiLineString":return u(t).geometry;case"MultiPolygon":return c(t).geometry;default:throw new Error(e+" is invalid")}},t.point=r,t.points=function(e,t,n){return void 0===n&&(n={}),a(e.map((function(e){return r(e,t)})),n)},t.polygon=i,t.polygons=function(e,t,n){return void 0===n&&(n={}),a(e.map((function(e){return i(e,t)})),n)},t.lineString=o,t.lineStrings=function(e,t,n){return void 0===n&&(n={}),a(e.map((function(e){return o(e,t)})),n)},t.featureCollection=a,t.multiLineString=u,t.multiPoint=s,t.multiPolygon=c,t.geometryCollection=function(e,t,r){return void 0===r&&(r={}),n({type:"GeometryCollection",geometries:e},t,r)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n},t.radiansToLength=l,t.lengthToRadians=f,t.lengthToDegrees=function(e,t){return h(f(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=h,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,n){if(void 0===t&&(t="kilometers"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return l(f(e,t),n)},t.convertArea=function(e,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=t.areaFactors[n];if(!i)throw new Error("invalid original units");var o=t.areaFactors[r];if(!o)throw new Error("invalid final units");return e/i*o},t.isNumber=d,t.isObject=function(e){return!!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!d(e))throw new Error("bbox must only contain numbers")}))},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(Ui(e)))throw new Error("id must be a number or a string")},t.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},t.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},t.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},t.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},t.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},t.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},t.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}}));i(vO);vO.earthRadius,vO.factors,vO.unitsFactors,vO.areaFactors,vO.feature,vO.geometry,vO.point,vO.points,vO.polygon,vO.polygons,vO.lineString,vO.lineStrings,vO.featureCollection,vO.multiLineString,vO.multiPoint,vO.multiPolygon,vO.geometryCollection,vO.round,vO.radiansToLength,vO.lengthToRadians,vO.lengthToDegrees,vO.bearingToAzimuth,vO.radiansToDegrees,vO.degreesToRadians,vO.convertLength,vO.convertArea,vO.isNumber,vO.isObject,vO.validateBBox,vO.validateId,vO.radians2degrees,vO.degrees2radians,vO.distanceToDegrees,vO.distanceToRadians,vO.radiansToDistance,vO.bearingToAngle,vO.convertDistance;var gO=o((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getCoord=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")},t.getCoords=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},t.containsNumber=function e(t){if(t.length>1&&vO.isNumber(t[0])&&vO.isNumber(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return e(t[0]);throw new Error("coordinates must only contain numbers")},t.geojsonType=function(e,t,n){if(!t||!n)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.type)},t.featureOf=function(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)},t.collectionOf=function(e,t,n){if(!e)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0,i=e.features;r<i.length;r++){var o=i[r];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!o.geometry||o.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+o.geometry.type)}},t.getGeom=function(e){return"Feature"===e.type?e.geometry:e},t.getType=function(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}}));i(gO);gO.getCoord;var mO=gO.getCoords,yO=(gO.containsNumber,gO.geojsonType,gO.featureOf,gO.collectionOf,gO.getGeom,gO.getType,o((function(e,t){function n(e,t,r){if(null!==e)for(var i,o,a,u,s,c,l,f,h=0,d=0,p=e.type,v="FeatureCollection"===p,g="Feature"===p,m=v?e.features.length:1,y=0;y<m;y++){s=(f=!!(l=v?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var b=0;b<s;b++){var _=0,x=0;if(null!==(u=f?l.geometries[b]:l)){c=u.coordinates;var S=u.type;switch(h=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===t(c,d,y,_,x))return!1;d++,_++;break;case"LineString":case"MultiPoint":for(i=0;i<c.length;i++){if(!1===t(c[i],d,y,_,x))return!1;d++,"MultiPoint"===S&&_++}"LineString"===S&&_++;break;case"Polygon":case"MultiLineString":for(i=0;i<c.length;i++){for(o=0;o<c[i].length-h;o++){if(!1===t(c[i][o],d,y,_,x))return!1;d++}"MultiLineString"===S&&_++,"Polygon"===S&&x++}"Polygon"===S&&_++;break;case"MultiPolygon":for(i=0;i<c.length;i++){for(x=0,o=0;o<c[i].length;o++){for(a=0;a<c[i][o].length-h;a++){if(!1===t(c[i][o][a],d,y,_,x))return!1;d++}x++}_++}break;case"GeometryCollection":for(i=0;i<u.geometries.length;i++)if(!1===n(u.geometries[i],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function r(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&!1!==t(e.features[n].properties,n);n++);break;case"Feature":t(e.properties,0)}}function i(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function o(e,t){var n,r,i,o,a,u,s,c,l,f,h=0,d="FeatureCollection"===e.type,p="Feature"===e.type,v=d?e.features.length:1;for(n=0;n<v;n++){for(u=d?e.features[n].geometry:p?e.geometry:e,c=d?e.features[n].properties:p?e.properties:{},l=d?e.features[n].bbox:p?e.bbox:void 0,f=d?e.features[n].id:p?e.id:void 0,a=(s=!!u&&"GeometryCollection"===u.type)?u.geometries.length:1,i=0;i<a;i++)if(null!==(o=s?u.geometries[i]:u))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,h,c,l,f))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],h,c,l,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,h,c,l,f))return!1;h++}}function a(e,t){o(e,(function(e,n,r,i,o){var a,u=null===e?null:e.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==t(vO.feature(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(u){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var s=0;s<e.coordinates.length;s++){var c={type:a,coordinates:e.coordinates[s]};if(!1===t(vO.feature(c,r),n,s))return!1}}))}function u(e,t){a(e,(function(e,r,i){var o=0;if(e.geometry){var a=e.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var u,s=0,c=0,l=0;return!1!==n(e,(function(n,a,f,h,d){if(void 0===u||r>s||h>c||d>l)return u=n,s=r,c=h,l=d,void(o=0);var p=vO.lineString([u,n],e.properties);if(!1===t(p,r,i,d,o))return!1;o++,u=n}))&&void 0}}}))}function s(e,t){if(!e)throw new Error("geojson is required");a(e,(function(e,n,r){if(null!==e.geometry){var i=e.geometry.type,o=e.geometry.coordinates;switch(i){case"LineString":if(!1===t(e,n,r,0,0))return!1;break;case"Polygon":for(var a=0;a<o.length;a++)if(!1===t(vO.lineString(o[a],e.properties),n,r,a))return!1}}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.coordEach=n,t.coordReduce=function(e,t,r,i){var o=r;return n(e,(function(e,n,i,a,u){o=0===n&&void 0===r?e:t(o,e,n,i,a,u)}),i),o},t.propEach=r,t.propReduce=function(e,t,n){var i=n;return r(e,(function(e,r){i=0===r&&void 0===n?e:t(i,e,r)})),i},t.featureEach=i,t.featureReduce=function(e,t,n){var r=n;return i(e,(function(e,i){r=0===i&&void 0===n?e:t(r,e,i)})),r},t.coordAll=function(e){var t=[];return n(e,(function(e){t.push(e)})),t},t.geomEach=o,t.geomReduce=function(e,t,n){var r=n;return o(e,(function(e,i,o,a,u){r=0===i&&void 0===n?e:t(r,e,i,o,a,u)})),r},t.flattenEach=a,t.flattenReduce=function(e,t,n){var r=n;return a(e,(function(e,i,o){r=0===i&&0===o&&void 0===n?e:t(r,e,i,o)})),r},t.segmentEach=u,t.segmentReduce=function(e,t,n){var r=n,i=!1;return u(e,(function(e,o,a,u,s){r=!1===i&&void 0===n?e:t(r,e,o,a,u,s),i=!0})),r},t.lineEach=s,t.lineReduce=function(e,t,n){var r=n;return s(e,(function(e,i,o,a){r=0===i&&void 0===n?e:t(r,e,i,o,a)})),r},t.findSegment=function(e,t){if(t=t||{},!vO.isObject(t))throw new Error("options is invalid");var n,r=t.featureIndex||0,i=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.segmentIndex||0,u=t.properties;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,n=e.features[r].geometry;break;case"Feature":u=u||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var s=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=s.length+a-1),vO.lineString([s[a],s[a+1]],u,t);case"Polygon":return o<0&&(o=s.length+o),a<0&&(a=s[o].length+a-1),vO.lineString([s[o][a],s[o][a+1]],u,t);case"MultiLineString":return i<0&&(i=s.length+i),a<0&&(a=s[i].length+a-1),vO.lineString([s[i][a],s[i][a+1]],u,t);case"MultiPolygon":return i<0&&(i=s.length+i),o<0&&(o=s[i].length+o),a<0&&(a=s[i][o].length-a-1),vO.lineString([s[i][o][a],s[i][o][a+1]],u,t)}throw new Error("geojson is invalid")},t.findPoint=function(e,t){if(t=t||{},!vO.isObject(t))throw new Error("options is invalid");var n,r=t.featureIndex||0,i=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.coordIndex||0,u=t.properties;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,n=e.features[r].geometry;break;case"Feature":u=u||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var s=n.coordinates;switch(n.type){case"Point":return vO.point(s,u,t);case"MultiPoint":return i<0&&(i=s.length+i),vO.point(s[i],u,t);case"LineString":return a<0&&(a=s.length+a),vO.point(s[a],u,t);case"Polygon":return o<0&&(o=s.length+o),a<0&&(a=s[o].length+a),vO.point(s[o][a],u,t);case"MultiLineString":return i<0&&(i=s.length+i),a<0&&(a=s[i].length+a),vO.point(s[i][a],u,t);case"MultiPolygon":return i<0&&(i=s.length+i),o<0&&(o=s[i].length+o),a<0&&(a=s[i][o].length-a),vO.point(s[i][o][a],u,t)}throw new Error("geojson is invalid")}})));i(yO);yO.coordEach,yO.coordReduce,yO.propEach,yO.propReduce,yO.featureEach,yO.featureReduce,yO.coordAll,yO.geomEach,yO.geomReduce;var bO=yO.flattenEach;yO.flattenReduce,yO.segmentEach,yO.segmentReduce,yO.lineEach,yO.lineReduce,yO.findSegment,yO.findPoint;function _O(e,t){var n=t.extent;return{images:new Promise((function(t){!function(e,t){var n=e,r=[];if("string"==typeof n)mf({url:n},(function(e,n){r.push(n),t(r)}));else{var i=n.length,o=0;n.forEach((function(e){mf({url:e},(function(e,n){o++,r.push(n),o===i&&t(r)}))}))}}(e,(function(e){t(e)}))})),_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}}var xO=function(e){return"string"==typeof e||!Fm(e)&&Pm(e)&&"[object String]"==Ig(e)};var SO=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},EO=Cm(Object.keys,Object),AO=Object.prototype.hasOwnProperty;var wO=function(e){if(!Im(e))return EO(e);var t=[];for(var n in Object(e))AO.call(e,n)&&"constructor"!=n&&t.push(n);return t};var TO=function(e){return Um(e)?ly(e):wO(e)};var CO=function(e,t){return e&&oy(t,TO(t),e)};var kO=function(e,t){return e&&oy(t,py(t),e)};var MO=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var IO=function(){return[]},OO=Object.prototype.propertyIsEnumerable,PO=Object.getOwnPropertySymbols,RO=PO?function(e){return null==e?[]:(e=Object(e),MO(PO(e),(function(t){return OO.call(e,t)})))}:IO;var LO=function(e,t){return oy(e,RO(e),t)};var NO=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},DO=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)NO(t,RO(e)),e=km(e);return t}:IO;var jO=function(e,t){return oy(e,DO(e),t)};var FO=function(e,t,n){var r=t(e);return Fm(e)?r:NO(r,n(e))};var zO=function(e){return FO(e,TO,RO)};var UO=function(e){return FO(e,py,DO)},BO=qg(_g,"DataView"),VO=qg(_g,"Promise"),GO=qg(_g,"WeakMap"),HO=jg(BO),WO=jg(Xg),qO=jg(VO),XO=jg(aS),ZO=jg(GO),YO=Ig;(BO&&"[object DataView]"!=YO(new BO(new ArrayBuffer(1)))||Xg&&"[object Map]"!=YO(new Xg)||VO&&"[object Promise]"!=YO(VO.resolve())||aS&&"[object Set]"!=YO(new aS)||GO&&"[object WeakMap]"!=YO(new GO))&&(YO=function(e){var t=Ig(e),n="[object Object]"==t?e.constructor:void 0,r=n?jg(n):"";if(r)switch(r){case HO:return"[object DataView]";case WO:return"[object Map]";case qO:return"[object Promise]";case XO:return"[object Set]";case ZO:return"[object WeakMap]"}return t});var KO=YO,QO=Object.prototype.hasOwnProperty;var JO=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&QO.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var $O=function(e,t){var n=t?Sm(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},eP=/\w*$/;var tP=function(e){var t=new e.constructor(e.source,eP.exec(e));return t.lastIndex=e.lastIndex,t},nP=xg?xg.prototype:void 0,rP=nP?nP.valueOf:void 0;var iP=function(e){return rP?Object(rP.call(e)):{}};var oP=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Sm(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return $O(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Em(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return tP(e);case"[object Set]":return new r;case"[object Symbol]":return iP(e)}};var aP=function(e){return Pm(e)&&"[object Map]"==KO(e)},uP=$m&&$m.isMap,sP=uP?Jm(uP):aP;var cP=function(e){return Pm(e)&&"[object Set]"==KO(e)},lP=$m&&$m.isSet,fP=lP?Jm(lP):cP,hP={};hP["[object Arguments]"]=hP["[object Array]"]=hP["[object ArrayBuffer]"]=hP["[object DataView]"]=hP["[object Boolean]"]=hP["[object Date]"]=hP["[object Float32Array]"]=hP["[object Float64Array]"]=hP["[object Int8Array]"]=hP["[object Int16Array]"]=hP["[object Int32Array]"]=hP["[object Map]"]=hP["[object Number]"]=hP["[object Object]"]=hP["[object RegExp]"]=hP["[object Set]"]=hP["[object String]"]=hP["[object Symbol]"]=hP["[object Uint8Array]"]=hP["[object Uint8ClampedArray]"]=hP["[object Uint16Array]"]=hP["[object Uint32Array]"]=!0,hP["[object Error]"]=hP["[object Function]"]=hP["[object WeakMap]"]=!1;var dP=function e(t,n,r,i,o,a){var u,s=1&n,c=2&n,l=4&n;if(r&&(u=o?r(t,i,o,a):r(t)),void 0!==u)return u;if(!Og(t))return t;var f=Fm(t);if(f){if(u=JO(t),!s)return Am(t,u)}else{var h=KO(t),d="[object Function]"==h||"[object GeneratorFunction]"==h;if(Gm(t))return _m(t,s);if("[object Object]"==h||"[object Arguments]"==h||d&&!o){if(u=c||d?{}:Om(t),!s)return c?jO(t,kO(u,t)):LO(t,CO(u,t))}else{if(!hP[h])return o?t:{};u=oP(t,h,s)}}a||(a=new vm);var p=a.get(t);if(p)return p;a.set(t,u),fP(t)?t.forEach((function(i){u.add(e(i,n,r,i,t,a))})):sP(t)&&t.forEach((function(i,o){u.set(o,e(i,n,r,o,t,a))}));var v=l?c?UO:zO:c?keysIn:TO,g=f?void 0:v(t);return SO(g||t,(function(i,o){g&&(i=t[o=i]),iy(u,o,e(i,n,r,o,t,a))})),u};var pP=function(e){return dP(e,5)};function vP(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,u=void 0===a?0:a,s=t.zoom,c=void 0===s?2:s;if(e.pointIndex){var l=e.pointIndex.getClusters(e.extent,Math.floor(c));return e.dataArray=l.map((function(e,t){return Zi({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var f=new hw({radius:r,minZoom:u,maxZoom:o}),h={type:"FeatureCollection",features:[]};return h.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:Zi({},e)}})),f.load(h.features),f}function gP(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var mP={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return gP(e)/e.length},sum:gP};var yP=function(e){Yi(n,e);var t=io(n);function n(e,r){var i;return Gi(this,n),(i=t.call(this)).data=void 0,i.extent=void 0,i.hooks={init:new ex},i.parser={type:"geojson"},i.transforms=[],i.cluster=!1,i.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},i.originData=void 0,i.rawData=void 0,i.clusterIndex=void 0,i.originData=e,i.initCfg(r),i.hooks.init.tap("parser",(function(){i.excuteParser()})),i.hooks.init.tap("cluster",(function(){i.initCluster()})),i.hooks.init.tap("transform",(function(){i.executeTrans()})),i.init(),i}return Wi(n,[{key:"setData",value:function(e,t){this.rawData=e,this.originData=e,this.initCfg(t),this.init(),this.emit("update")}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.extent,e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.extent,Math.floor(e));this.clusterOptions.zoom=e,a.forEach((function(e){e.id||(e.properties.point_count=1)})),(o||Pg(i))&&(a=a.map((function(e){var n=e.id;if(n){var r,a=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(xO(i)&&o){var u=function(e,t){return e.map((function(e){return 1*e[t]}))}(a,o);r=mP[i](u)}Pg(i)&&(r=i(a)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=YI("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser.type;if("geojson"!==(void 0===t?"geojson":t)||this.cluster)return e<this.data.dataArray.length?this.data.dataArray[e]:"null";var n=e<this.originData.features.length?this.originData.features[e]:"null",r=pP(n);if(0!==this.transforms.length){var i=this.data.dataArray.find((function(t){return t._id===e}));r.properties=i}return r}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(t){return t[e]===name}));return null==n?void 0:n._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"initCfg",value:function(e){e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=Zi(Zi({},this.clusterOptions),e.clusterOptions)))}},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=YI(t);this.data=n(this.originData,e),this.extent=Xf(this.data.dataArray)}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n=function(e){return XI[e]}(t.type)(e.data,t);Object.assign(e.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=vP(this.data,e)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),n}(u);var bP=ie.isFinite,_P=Number.isFinite||function(e){return"number"==typeof e&&bP(e)};Ot({target:"Number",stat:!0},{isFinite:_P});var xP=Math.PI/3,SP=[0,xP,2*xP,3*xP,4*xP,5*xP];function EP(e){return e[0]}function AP(e){return e[1]}var wP;KI("geojson",(function(e,t){var n=[],r={};return e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),lO(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:(bO(e,(function(e,t){var r=mO(e),i=t;if("MultiPolygon"===e.geometry.type)r.forEach((function(t){var r=Zi(Zi({},e.properties),{},{coordinates:[t],_id:i});n.push(r)}));else{var o=Zi(Zi({},e.properties),{},{coordinates:r,_id:i});n.push(o)}})),{dataArray:n,featureKeys:r})})),KI("image",_O),KI("csv",(function(e,t){return pO(iO(e),t)})),KI("json",pO),KI("raster",(function(e,t){var n=t.extent,r=t.width,i=t.height,o=t.min,a=t.max;return{_id:1,dataArray:[{_id:1,data:Array.from(e),width:r,height:i,min:o,max:a,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}})),QI("cluster",vP),QI("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),QI("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return Zi(Zi({},e),o[t])})),e})),QI("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),QI("grid",(function(e,t){var n=e.dataArray,r=t.size,i=function(e,t){var n,r,i=1/0,o=-1/0,a=lo(e);try{for(a.s();!(r=a.n()).done;){var u=r.value;n=u.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var s=function(e,t){var n=(i=e,i/6378e3*(180/Math.PI)),r=function(e,t){return t/6378e3*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);var i;return{yOffset:n,xOffset:r}}(t,(i+o)/2);if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var c,l={},f=lo(e);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=h.coordinates[1],p=h.coordinates[0];if(Number.isFinite(d)&&Number.isFinite(p)){var v=Math.floor((d+90)/s.yOffset),g=Math.floor((p+180)/s.xOffset),m="".concat(v,"-").concat(g);l[m]=l[m]||{count:0,points:[]},l[m].count+=1,l[m].points.push(h)}}}catch(e){f.e(e)}finally{f.f()}return{gridHash:l,gridOffset:s}}(n,void 0===r?10:r),o=i.gridHash,a=i.gridOffset,u=function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),u=parseInt(a[0],10),s=parseInt(a[1],10),c={};if(n.field&&n.method){var l=id(e[i].points,n.field);c[n.method]=rd[n.method](l)}return Object.assign(c,{_id:o,coordinates:[t.xOffset*(s+.5)-180,t.yOffset*(u+.5)-90],rawData:e[i].points,count:e[i].count}),r.push(c),r}),[])}(o,a,t);return{yOffset:a.yOffset/2,xOffset:a.xOffset/2,radius:a.xOffset,type:"grid",dataArray:u}})),QI("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,u=i/(2*Math.PI*6378e3)*(256<<20)/2,s=n.map((function(e){var t=ao(Jf(e.coordinates),2),n=t[0],r=t[1];return Zi(Zi({},e),{},{coordinates:[n,r]})}));return{dataArray:function(){var e,t,n,r=0,i=0,o=1,a=1,u=EP,s=AP;function c(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(l=+u.call(null,c=e[r],r,e))&&!isNaN(f=+s.call(null,c,r,e))){var c,l,f,h=Math.round(f/=n),d=Math.round(l=l/t-(1&h)/2),p=f-h;if(3*Math.abs(p)>1){var v=l-d,g=d+(l<d?-1:1)/2,m=h+(f<h?-1:1),y=l-g,b=f-m;v*v+p*p>y*y+b*b&&(d=g+(1&h?1:-1)/2,h=m)}var _=d+"-"+h,x=i[_];x?x.push(c):(o.push(x=i[_]=[c]),x.x=(d+(1&h)/2)*t,x.y=h*n)}return o}function l(e){var t=0,n=0;return SP.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,u=o-n;return t=i,n=o,[a,u]}))}return c.hexagon=function(t){return"m"+l(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var u=[],s=Math.round(i/n),c=Math.round(r/t),l=s*n;l<a+e;l+=n,++s)for(var f=c*t+(1&s)*t/2;f<o+t/2;f+=t)u.push([f,l]);return u},c.mesh=function(){var t=l(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(u=e,c):u},c.y=function(e){return arguments.length?(s=e,c):s},c.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(xP),n=1.5*e,c):e},c.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],c):[o-r,a-i]},c.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],c):[[r,i],[o,a]]},c.radius(1)}().radius(u).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}))(s).map((function(e,n){var r;if(t.field&&a){var i=id(e,t.field);e[a]=rd[a](i)}return qi(r={},t.method,e[a]),qi(r,"count",e.length),qi(r,"rawData",e),qi(r,"coordinates",[e.x,e.y]),qi(r,"_id",n),r})),radius:u,xOffset:u,yOffset:u,type:"hexagon"}}));var TP=Q()(wP=function(){function e(){Gi(this,e),this.mapService=void 0}return Wi(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(nr.IMapService),e.hooks.init.tap("DataSourcePlugin",(function(){var n=e.sourceOption,r=n.data,i=n.options;e.setSource(new yP(r,i)),t.updateClusterData(e)})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=t.updateClusterData(e),r=e.dataState.dataSourceNeedUpdate;return e.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(e){var t=e.getSource(),n=t.cluster,r=t.clusterOptions,i=r.zoom,o=void 0===i?0:i,a=r.maxZoom,u=void 0===a?16:a,s=this.mapService.getZoom()-1;return!!(n&&Math.abs(o-s)>1&&u>o)&&(t.updateClusterData(Math.floor(s)),!0)}}]),e}())||wP;function CP(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function kP(e){return 1===e.length&&(e=function(e){return function(t,n){return CP(e(t),n)}}(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var MP=kP(CP).right;function IP(e){return null===e?NaN:+e}var OP=Math.sqrt(50),PP=Math.sqrt(10),RP=Math.sqrt(2);function LP(e,t,n){var r,i,o,a,u=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=NP(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++u<i;)o[u]=(e+u)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++u<i;)o[u]=(e-u)/a;return r&&o.reverse(),o}function NP(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=OP?10:o>=PP?5:o>=RP?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=OP?10:o>=PP?5:o>=RP?2:1)}function DP(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=OP?i*=10:o>=PP?i*=5:o>=RP&&(i*=2),t<e?-i:i}function jP(e,t,n){if(null==n&&(n=IP),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}function FP(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function zP(){}function UP(e,t){var n=new zP;if(e instanceof zP)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}function BP(){}zP.prototype=UP.prototype={constructor:zP,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var VP=UP.prototype;BP.prototype=function(e,t){var n=new BP;if(e instanceof BP)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:BP,has:VP.has,add:function(e){return this["$"+(e+="")]=e,this},remove:VP.remove,clear:VP.clear,values:VP.keys,size:VP.size,empty:VP.empty,each:VP.each};var GP=Array.prototype,HP=GP.map,WP=GP.slice,qP={name:"implicit"};function XP(){var e=UP(),t=[],n=[],r=qP;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==qP)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=UP();for(var r,o,a=-1,u=n.length;++a<u;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=WP.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return XP(t,n).unknown(r)},FP.apply(i,arguments),i}function ZP(e){return function(){return e}}function YP(e){return 1==(e=+e)?KP:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):ZP(isNaN(t)?n:t)}}function KP(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):ZP(isNaN(e)?t:e)}var QP=function e(t){var n=YP(t);function r(e,t){var r=n((e=Ph(e)).r,(t=Ph(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=KP(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function JP(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function $P(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=aR(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function eR(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function tR(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function nR(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=aR(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var rR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,iR=new RegExp(rR.source,"g");function oR(e,t){var n,r,i,o=rR.lastIndex=iR.lastIndex=0,a=-1,u=[],s=[];for(e+="",t+="";(n=rR.exec(e))&&(r=iR.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),u[a]?u[a]+=i:u[++a]=i),(n=n[0])===(r=r[0])?u[a]?u[a]+=r:u[++a]=r:(u[++a]=null,s.push({i:a,x:tR(n,r)})),o=iR.lastIndex;return o<t.length&&(i=t.slice(o),u[a]?u[a]+=i:u[++a]=i),u.length<2?s[0]?function(e){return function(t){return e(t)+""}}(s[0].x):function(e){return function(){return e}}(t):(t=s.length,function(e){for(var n,r=0;r<t;++r)u[(n=s[r]).i]=n.x(e);return u.join("")})}function aR(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?ZP(t):("number"===i?tR:"string"===i?(n=kh(t))?(t=n,QP):oR:t instanceof kh?QP:t instanceof Date?eR:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?$P:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?nR:tR:JP))(e,t)}function uR(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function sR(e){return+e}var cR=[0,1];function lR(e){return e}function fR(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function hR(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function dR(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=fR(i,r),o=n(a,o)):(r=fR(r,i),o=n(o,a)),function(e){return o(r(e))}}function pR(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=fR(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=MP(e,t,1,r)-1;return o[n](i[n](t))}}function vR(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function gR(){var e,t,n,r,i,o,a=cR,u=cR,s=aR,c=lR;function l(){return r=Math.min(a.length,u.length)>2?pR:dR,i=o=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),u,s)))(e(c(t)))}return f.invert=function(n){return c(t((o||(o=r(u,a.map(e),tR)))(n)))},f.domain=function(e){return arguments.length?(a=HP.call(e,sR),c===lR||(c=hR(a)),l()):a.slice()},f.range=function(e){return arguments.length?(u=WP.call(e),l()):u.slice()},f.rangeRound=function(e){return u=WP.call(e),s=uR,l()},f.clamp=function(e){return arguments.length?(c=e?hR(a):lR,f):c!==lR},f.interpolate=function(e){return arguments.length?(s=e,l()):s},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,l()}}function mR(e,t){return gR()(e,t)}function yR(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function bR(e){return(e=yR(Math.abs(e)))?e[1]:NaN}var _R,xR=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function SR(e){if(!(t=xR.exec(e)))throw new Error("invalid format: "+e);var t;return new ER({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ER(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function AR(e,t){var n=yR(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}SR.prototype=ER.prototype,ER.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var wR={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return AR(100*e,t)},r:AR,s:function(e,t){var n=yR(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(_R=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+yR(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function TR(e){return e}var CR,kR,MR,IR=Array.prototype.map,OR=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function PR(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?TR:(t=IR.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,u=t[0],s=0;i>0&&u>0&&(s+u+1>r&&(u=Math.max(1,r-s)),o.push(e.substring(i-=u,i+u)),!((s+=u+1)>r));)u=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",u=void 0===e.numerals?TR:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(IR.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"-":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=SR(e)).fill,n=e.align,f=e.sign,h=e.symbol,d=e.zero,p=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):wR[y]||(void 0===g&&(g=12),m=!0,y="g"),(d||"0"===t&&"="===n)&&(d=!0,t="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",_="$"===h?o:/[%p]/.test(y)?s:"",x=wR[y],S=/[defgprs%]/.test(y);function E(e){var i,o,s,h=b,E=_;if("c"===y)E=x(e)+E,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==f&&(A=!1),h=(A?"("===f?f:c:"-"===f||"("===f?"":f)+h,E=("s"===y?OR[8+_R/3]:"")+E+(A&&"("===f?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(s=e.charCodeAt(i))||s>57){E=(46===s?a+e.slice(i+1):e.slice(i))+E,e=e.slice(0,i);break}}v&&!d&&(e=r(e,1/0));var w=h.length+e.length+E.length,T=w<p?new Array(p-w+1).join(t):"";switch(v&&d&&(e=r(T+e,T.length?p-E.length:1/0),T=""),n){case"<":e=h+e+E+T;break;case"=":e=h+T+e+E;break;case"^":e=T.slice(0,w=T.length>>1)+h+e+E+T.slice(w);break;default:e=T+h+e+E}return u(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),E.toString=function(){return e+""},E}return{format:f,formatPrefix:function(e,t){var n=f(((e=SR(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(bR(t)/3))),i=Math.pow(10,-r),o=OR[8+r/3];return function(e){return n(i*e)+o}}}}function RR(e,t,n,r){var i,o=DP(e,t,n);switch((r=SR(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(bR(t)/3)))-bR(Math.abs(e)))}(o,a))||(r.precision=i),MR(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,bR(t)-bR(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-bR(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return kR(r)}function LR(e){var t=e.domain;return e.ticks=function(e){var n=t();return LP(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return RR(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,u=i[o],s=i[a];return s<u&&(r=u,u=s,s=r,r=o,o=a,a=r),(r=NP(u,s,n))>0?r=NP(u=Math.floor(u/r)*r,s=Math.ceil(s/r)*r,n):r<0&&(r=NP(u=Math.ceil(u*r)/r,s=Math.floor(s*r)/r,n)),r>0?(i[o]=Math.floor(u/r)*r,i[a]=Math.ceil(s/r)*r,t(i)):r<0&&(i[o]=Math.ceil(u*r)/r,i[a]=Math.floor(s*r)/r,t(i)),e},e}function NR(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function DR(e){return Math.log(e)}function jR(e){return Math.exp(e)}function FR(e){return-Math.log(-e)}function zR(e){return-Math.exp(-e)}function UR(e){return isFinite(e)?+("1e"+e):e<0?0:e}function BR(e){return function(t){return-e(-t)}}function VR(e){var t,n,r=e(DR,jR),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?UR:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=BR(t),n=BR(n),e(FR,zR)):e(DR,jR),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),u=a[0],s=a[a.length-1];(r=s<u)&&(h=u,u=s,s=h);var c,l,f,h=t(u),d=t(s),p=null==e?10:+e,v=[];if(!(o%1)&&d-h<p){if(h=Math.round(h)-1,d=Math.round(d)+1,u>0){for(;h<d;++h)for(l=1,c=n(h);l<o;++l)if(!((f=c*l)<u)){if(f>s)break;v.push(f)}}else for(;h<d;++h)for(l=o-1,c=n(h);l>=1;--l)if(!((f=c*l)<u)){if(f>s)break;v.push(f)}}else v=LP(h,d,Math.min(d-h,p)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=kR(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(NR(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function GR(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function HR(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function WR(e){return e<0?-e*e:e*e}function qR(e){var t=e(lR,lR),n=1;function r(){return 1===n?e(lR,lR):.5===n?e(HR,WR):e(GR(n),GR(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},LR(t)}CR=PR({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),kR=CR.format,MR=CR.formatPrefix;var XR=new Date,ZR=new Date;function YR(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,u=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return u;do{u.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return u},i.filter=function(n){return YR((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return XR.setTime(+t),ZR.setTime(+r),e(XR),e(ZR),Math.floor(n(XR,ZR))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var KR=YR((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));KR.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?YR((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):KR:null};var QR=YR((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),JR=YR((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),$R=YR((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),eL=YR((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function tL(e){return YR((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var nL=tL(0),rL=tL(1),iL=(tL(2),tL(3),tL(4)),oL=(tL(5),tL(6),YR((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),aL=YR((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));aL.every=function(e){return isFinite(e=Math.floor(e))&&e>0?YR((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var uL=YR((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function sL(e){return YR((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var cL=sL(0),lL=sL(1),fL=(sL(2),sL(3),sL(4)),hL=(sL(5),sL(6),YR((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));function dL(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function pL(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vL(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}hL.every=function(e){return isFinite(e=Math.floor(e))&&e>0?YR((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var gL,mL,yL={"-":"",_:" ",0:"0"},bL=/^\s*\d+/,_L=/^%/,xL=/[\\^$*+?|[\]().{}]/g;function SL(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function EL(e){return e.replace(xL,"\\$&")}function AL(e){return new RegExp("^(?:"+e.map(EL).join("|")+")","i")}function wL(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function TL(e,t,n){var r=bL.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function CL(e,t,n){var r=bL.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function kL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function ML(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function IL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function OL(e,t,n){var r=bL.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function PL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function RL(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function LL(e,t,n){var r=bL.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function NL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function DL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function jL(e,t,n){var r=bL.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function FL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function zL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function UL(e,t,n){var r=bL.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function BL(e,t,n){var r=bL.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function VL(e,t,n){var r=bL.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function GL(e,t,n){var r=_L.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function HL(e,t,n){var r=bL.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function WL(e,t,n){var r=bL.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function qL(e,t){return SL(e.getDate(),t,2)}function XL(e,t){return SL(e.getHours(),t,2)}function ZL(e,t){return SL(e.getHours()%12||12,t,2)}function YL(e,t){return SL(1+eL.count(aL(e),e),t,3)}function KL(e,t){return SL(e.getMilliseconds(),t,3)}function QL(e,t){return KL(e,t)+"000"}function JL(e,t){return SL(e.getMonth()+1,t,2)}function $L(e,t){return SL(e.getMinutes(),t,2)}function eN(e,t){return SL(e.getSeconds(),t,2)}function tN(e){var t=e.getDay();return 0===t?7:t}function nN(e,t){return SL(nL.count(aL(e)-1,e),t,2)}function rN(e,t){var n=e.getDay();return e=n>=4||0===n?iL(e):iL.ceil(e),SL(iL.count(aL(e),e)+(4===aL(e).getDay()),t,2)}function iN(e){return e.getDay()}function oN(e,t){return SL(rL.count(aL(e)-1,e),t,2)}function aN(e,t){return SL(e.getFullYear()%100,t,2)}function uN(e,t){return SL(e.getFullYear()%1e4,t,4)}function sN(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+SL(t/60|0,"0",2)+SL(t%60,"0",2)}function cN(e,t){return SL(e.getUTCDate(),t,2)}function lN(e,t){return SL(e.getUTCHours(),t,2)}function fN(e,t){return SL(e.getUTCHours()%12||12,t,2)}function hN(e,t){return SL(1+uL.count(hL(e),e),t,3)}function dN(e,t){return SL(e.getUTCMilliseconds(),t,3)}function pN(e,t){return dN(e,t)+"000"}function vN(e,t){return SL(e.getUTCMonth()+1,t,2)}function gN(e,t){return SL(e.getUTCMinutes(),t,2)}function mN(e,t){return SL(e.getUTCSeconds(),t,2)}function yN(e){var t=e.getUTCDay();return 0===t?7:t}function bN(e,t){return SL(cL.count(hL(e)-1,e),t,2)}function _N(e,t){var n=e.getUTCDay();return e=n>=4||0===n?fL(e):fL.ceil(e),SL(fL.count(hL(e),e)+(4===hL(e).getUTCDay()),t,2)}function xN(e){return e.getUTCDay()}function SN(e,t){return SL(lL.count(hL(e)-1,e),t,2)}function EN(e,t){return SL(e.getUTCFullYear()%100,t,2)}function AN(e,t){return SL(e.getUTCFullYear()%1e4,t,4)}function wN(){return"+0000"}function TN(){return"%"}function CN(e){return+e}function kN(e){return Math.floor(+e/1e3)}!function(e){gL=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,u=e.months,s=e.shortMonths,c=AL(i),l=wL(i),f=AL(o),h=wL(o),d=AL(a),p=wL(a),v=AL(u),g=wL(u),m=AL(s),y=wL(s),b={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return s[e.getMonth()]},B:function(e){return u[e.getMonth()]},c:null,d:qL,e:qL,f:QL,H:XL,I:ZL,j:YL,L:KL,m:JL,M:$L,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:CN,s:kN,S:eN,u:tN,U:nN,V:rN,w:iN,W:oN,x:null,X:null,y:aN,Y:uN,Z:sN,"%":TN},_={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return s[e.getUTCMonth()]},B:function(e){return u[e.getUTCMonth()]},c:null,d:cN,e:cN,f:pN,H:lN,I:fN,j:hN,L:dN,m:vN,M:gN,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:CN,s:kN,S:mN,u:yN,U:bN,V:_N,w:xN,W:SN,x:null,X:null,y:EN,Y:AN,Z:wN,"%":TN},x={a:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:DL,e:DL,f:VL,H:FL,I:FL,j:jL,L:BL,m:NL,M:zL,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=l[r[0].toLowerCase()],n+r[0].length):-1},q:LL,Q:HL,s:WL,S:UL,u:CL,U:kL,V:ML,w:TL,W:IL,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:PL,Y:OL,Z:RL,"%":GL};function S(e,t){return function(n){var r,i,o,a=[],u=-1,s=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++u<c;)37===e.charCodeAt(u)&&(a.push(e.slice(s,u)),null!=(i=yL[r=e.charAt(++u)])?r=e.charAt(++u):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),s=u+1);return a.push(e.slice(s,u)),a.join("")}}function E(e,t){return function(n){var r,i,o=vL(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=pL(vL(o.y,0,1))).getUTCDay(),r=i>4||0===i?lL.ceil(r):lL(r),r=uL.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=dL(vL(o.y,0,1))).getDay(),r=i>4||0===i?rL.ceil(r):rL(r),r=eL.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?pL(vL(o.y,0,1)).getUTCDay():dL(vL(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,pL(o)):dL(o)}}function A(e,t,n,r){for(var i,o,a=0,u=t.length,s=n.length;a<u;){if(r>=s)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in yL?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),_.x=S(n,_),_.X=S(r,_),_.c=S(t,_),{format:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=E(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",_);return t.toString=function(){return e},t},utcParse:function(e){var t=E(e+="",!0);return t.toString=function(){return e},t}}}(e),mL=gL.format,gL.parse,gL.utcFormat,gL.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var MN,IN,ON,PN,RN,LN,NN,DN;function jN(e){return new Date(e)}function FN(e){return e instanceof Date?+e:+new Date(+e)}function zN(e,t,n,r,i,o,a,u,s){var c=mR(lR,lR),l=c.invert,f=c.domain,h=s(".%L"),d=s(":%S"),p=s("%I:%M"),v=s("%I %p"),g=s("%a %d"),m=s("%b %d"),y=s("%B"),b=s("%Y"),_=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function x(u){return(a(u)<u?h:o(u)<u?d:i(u)<u?p:r(u)<u?v:t(u)<u?n(u)<u?g:m:e(u)<u?y:b)(u)}function S(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=kP((function(e){return e[2]})).right(_,o);a===_.length?(i=DP(n/31536e6,r/31536e6,t),t=e):a?(i=(a=_[o/_[a-1][2]<_[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(DP(n,r,t),1),t=u)}return null==i?t:t.every(i)}return c.invert=function(e){return new Date(l(e))},c.domain=function(e){return arguments.length?f(HP.call(e,FN)):f().map(jN)},c.ticks=function(e,t){var n,r=f(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=S(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},c.tickFormat=function(e,t){return null==t?x:s(t)},c.nice=function(e,t){var n=f();return(e=S(e,n[0],n[n.length-1],t))?f(NR(n,e)):c},c.copy=function(){return vR(c,zN(e,t,n,r,i,o,a,u,s))},c}var UN,BN,VN,GN,HN,WN,qN,XN,ZN,YN,KN=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,QN=(qi(MN={},e.ScaleTypes.LINEAR,(function e(){var t=mR(lR,lR);return t.copy=function(){return vR(t,e())},FP.apply(t,arguments),LR(t)})),qi(MN,e.ScaleTypes.POWER,(function e(){var t=qR(gR());return t.copy=function(){return vR(t,e()).exponent(t.exponent())},FP.apply(t,arguments),t})),qi(MN,e.ScaleTypes.LOG,(function e(){var t=VR(gR()).domain([1,10]);return t.copy=function(){return vR(t,e()).base(t.base())},FP.apply(t,arguments),t})),qi(MN,e.ScaleTypes.IDENTITY,(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=HP.call(e,sR),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?HP.call(t,sR):[0,1],LR(r)})),qi(MN,e.ScaleTypes.TIME,(function(){return FP.apply(zN(aL,oL,nL,eL,$R,JR,QR,KR,mL).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),qi(MN,e.ScaleTypes.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=jP(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[MP(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(CP),o()},a.range=function(e){return arguments.length?(r=WP.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},FP.apply(a,arguments)})),qi(MN,e.ScaleTypes.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function u(e){return e<=e?a[MP(o,e,0,i)]:t}function s(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return u}return u.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],s()):[n,r]},u.range=function(e){return arguments.length?(i=(a=WP.call(e)).length-1,s()):a.slice()},u.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},u.unknown=function(e){return arguments.length?(t=e,u):u},u.thresholds=function(){return o.slice()},u.copy=function(){return e().domain([n,r]).range(a).unknown(t)},FP.apply(LR(u),arguments)})),qi(MN,e.ScaleTypes.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[MP(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=WP.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=WP.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},FP.apply(o,arguments)})),qi(MN,e.ScaleTypes.CAT,XP),MN),JN=(IN=Q(),ON=J(nr.IGlobalConfigService),PN=J(nr.ILogService),IN((NN=ho((LN=function(){function t(){Gi(this,t),fo(this,"configService",NN,this),fo(this,"logger",DN,this),this.scaleCache={},this.scaleOptions={}}return Wi(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;0!==i.length&&n.caculateScalesForAttributes(t||[],i)})),e.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;return n.caculateScalesForAttributes(t||[],i),e.layerModelNeedUpdate=!0,!0})),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes();if(t){var i=e.getSource().data.dataArray;if(0===i.length)return;var o=t.filter((function(e){return e.needRescale}));o.length&&(n.caculateScalesForAttributes(o,i),n.logger.debug("rescale finished"))}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;this.scaleCache={},t.forEach((function(t){if(t.scale){var i=t.scale,o=t.name;i.names=r.parseFields(t.scale.field||[]);var a=[];i.names.forEach((function(e){a.push(r.getOrCreateScale(e,t,n))})),a.some((function(t){return t.type===e.StyleScaleType.VARIABLE}))?(i.type=e.StyleScaleType.VARIABLE,a.forEach((function(e){var t;if(!i.callback)if(i.values&&"text"!==i.values){var n;if("linear"===(null===(n=e.option)||void 0===n?void 0:n.type)&&i.values.length>2){var r=e.scale.ticks(i.values.length);"color"===o&&e.scale.domain(r)}e.scale.range(i.values)}else"cat"===(null===(t=e.option)||void 0===t?void 0:t.type)&&e.scale.range(e.option.domain)}))):(i.type=e.StyleScaleType.CONSTANT,i.defaultValues=a.map((function(e,t){return e.scale(i.names[t])}))),i.scalers=a.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),t.needRescale=!1}}))}},{key:"getOrCreateScale",value:function(e,t,n){[e,t.name].join("_");var r,i=null===(r=t.scale)||void 0===r?void 0:r.values;return this.createScale(e,t.name,i,n)}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:xO(e)?e.split("*"):[e]}},{key:"createScale",value:function(t,n,r,i){var o,a=this.scaleOptions[n]&&this.scaleOptions[n].field===t?this.scaleOptions[n]:this.scaleOptions[t],u={field:t,scale:void 0,type:e.StyleScaleType.VARIABLE,option:a};if(!i||!i.length)return a&&a.type?u.scale=this.createDefaultScale(a):(u.scale=XP([t]),u.type=e.StyleScaleType.CONSTANT),u;var s=null===(o=i.find((function(e){return!Yb(e[t])})))||void 0===o?void 0:o[t];if(this.isNumber(t)||Yb(s)&&!a)u.scale=XP([t]),u.type=e.StyleScaleType.CONSTANT;else{var c=a&&a.type||this.getDefaultType(s);"text"===r&&(c=e.ScaleTypes.CAT);var l=this.createDefaultScaleConfig(c,t,i);Object.assign(l,a),u.scale=this.createDefaultScale(l),u.option=l}return u}},{key:"getDefaultType",value:function(t){var n=e.ScaleTypes.LINEAR;return"string"==typeof t&&(n=KN.test(t)?e.ScaleTypes.TIME:e.ScaleTypes.CAT),n}},{key:"createDefaultScaleConfig",value:function(t,n,r){var i={type:t},o=(null==r?void 0:r.map((function(e){return e[n]})))||[];return t!==e.ScaleTypes.CAT&&t!==e.ScaleTypes.QUANTILE?i.domain=function(e,t){var n,r,i,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(n=e[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=e[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=t(e[a],a,e))&&n>=n)for(r=i=n;++a<o;)null!=(n=t(e[a],a,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}(o):t===e.ScaleTypes.CAT?i.domain=fS(o):t===e.ScaleTypes.QUANTILE&&(i.domain=o),i}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=QN[t]();return n&&r.domain(n),r}}]),t}()).prototype,"configService",[ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DN=ho(LN.prototype,"logger",[PN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RN=LN))||RN),$N=(UN=Q(),BN=J(nr.ICameraService),VN=J(nr.IRendererService),UN((WN=ho((HN=function(){function e(){Gi(this,e),fo(this,"cameraService",WN,this),fo(this,"rendererService",qN,this)}return Wi(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.models.forEach((function(t){t.addUniforms(Zi({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}()).prototype,"cameraService",[BN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qN=ho(HN.prototype,"rendererService",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GN=HN))||GN),eD=Q()(XN=function(){function e(){Gi(this,e)}return Wi(e,[{key:"apply",value:function(e){e.hooks.init.tap("LayerModelPlugin",(function(){e.prepareBuildModel(),e.buildModels(),e.styleNeedUpdate=!1})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){return e.prepareBuildModel(),e.clearModels(),e.buildModels(),e.layerModelNeedUpdate=!1,!1}))}}]),e}())||XN,tD=Q()(ZN=function(){function e(){Gi(this,e)}return Wi(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){e.updateLayerConfig({});var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&setTimeout((function(){e.fitBounds(r)}),100)}))}}]),e}())||ZN,nD={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},rD={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},iD={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},oD={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var aD,uD,sD,cD,lD,fD,hD,dD,pD,vD,gD,mD,yD,bD,_D,xD,SD,ED,AD,wD,TD,CD=Q()(YN=function(){function e(){Gi(this,e)}return Wi(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(Zi({},(n={u_DirectionalLights:new Array(3).fill(Zi({},iD)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Zi({},oD)),u_NumOfSpotLights:0},t&&t.length||(t=[rD]),t.forEach((function(e,t){var r=e.type,i=void 0===r?"directional":r,o=to(e,["type"]),a=nD[i].lights,u=nD[i].num,s=n[u];n[a][s]=Zi(Zi({},n[a][s]),o),n[u]++})),n)));var t,n}))}))}}]),e}())||YN,kD=1,MD=2,ID=Q()(aD=function(){function t(){Gi(this,t)}return Wi(t,[{key:"apply",value:function(t,n){n.rendererService;var r=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){var n=t.getLayerConfig().enablePicking;r.registerStyleAttribute({name:"pickingColor",type:e.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var r=e.id;return n?Gh(r):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:kD})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:MD})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig().highlightColor,r="string"==typeof n?Bh(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Vh(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:MD,u_PickingColor:e,u_HighlightColor:r.map((function(e){return 255*e}))})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig().selectColor,r="string"==typeof n?Bh(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Vh(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:MD,u_PickingColor:e,u_HighlightColor:r.map((function(e){return 255*e}))})}))}))}}]),t}())||aD,OD=(uD=Q(),sD=J(nr.ILogService),uD((fD=ho((lD=function(){function t(){Gi(this,t),fo(this,"logger",fD,this)}return Wi(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("RegisterStyleAttributePlugin",(function(){n.registerBuiltinAttributes(r)}))}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:e.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}}),t.registerStyleAttribute({name:"filter",type:e.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t){return e.filter?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:e.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t){var n=e.color;return n&&n.length?n:[1,1,1,1]}}})}}]),t}()).prototype,"logger",[sD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cD=lD))||cD),PD=(hD=Q(),dD=J(nr.ICameraService),pD=J(nr.ICoordinateSystemService),vD=J(nr.IRendererService),hD((yD=ho((mD=function(){function e(){Gi(this,e),fo(this,"cameraService",yD,this),fo(this,"coordinateSystemService",bD,this),fo(this,"rendererService",_D,this)}return Wi(e,[{key:"apply",value:function(e){var t=this;e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){t.coordinateSystemService.refresh();var n=t.rendererService.getViewportSize(),r=n.width,i=n.height;e.models.forEach((function(n){var o;return n.addUniforms((qi(o={},ew.ProjectionMatrix,t.cameraService.getProjectionMatrix()),qi(o,ew.ViewMatrix,t.cameraService.getViewMatrix()),qi(o,ew.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),qi(o,ew.Zoom,t.cameraService.getZoom()),qi(o,ew.ZoomScale,t.cameraService.getZoomScale()),qi(o,ew.FocalDistance,t.cameraService.getFocalDistance()),qi(o,ew.CameraPosition,t.cameraService.getCameraPosition()),qi(o,ib.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),qi(o,ib.ViewportCenter,t.coordinateSystemService.getViewportCenter()),qi(o,ib.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),qi(o,ib.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),qi(o,ib.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),qi(o,ib.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),qi(o,"u_ViewportSize",[r,i]),qi(o,"u_DevicePixelRatio",window.devicePixelRatio),qi(o,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),qi(o,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),o))}))}))}}]),e}()).prototype,"cameraService",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=ho(mD.prototype,"coordinateSystemService",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=ho(mD.prototype,"rendererService",[vD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gD=mD))||gD),RD=Q()(xD=function(){function e(){Gi(this,e)}return Wi(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate()}))}}]),e}())||xD,LD=(SD=Q(),ED=J(nr.ILogService),SD((TD=ho((wD=function(){function e(){Gi(this,e),fo(this,"logger",TD,this)}return Wi(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||n.updateStyleAtrribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAtrribute",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=r.getLayerStyleAttribute("shape");if(o&&o.needRegenerateVertices||a&&a.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void i.forEach((function(e){return e.needRegenerateVertices=!1}));i.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){r.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1,n.logger.debug("regenerate vertex attributes: ".concat(t.name," finished"))}))}},{key:"initStyleAttribute",value:function(e,t){var n=this,r=t.styleAttributeService;(r.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){r.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1,n.logger.debug("init vertex attributes: ".concat(t.name," finished"))}))}}]),e}()).prototype,"logger",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AD=wD))||AD);OA.bind(nr.ILayerPlugin).to(TP).inRequestScope(),OA.bind(nr.ILayerPlugin).to(OD).inRequestScope(),OA.bind(nr.ILayerPlugin).to(JN).inRequestScope(),OA.bind(nr.ILayerPlugin).to(qI).inRequestScope(),OA.bind(nr.ILayerPlugin).to(tD).inRequestScope(),OA.bind(nr.ILayerPlugin).to(LD).inRequestScope(),OA.bind(nr.ILayerPlugin).to(RD).inRequestScope(),OA.bind(nr.ILayerPlugin).to(Nk).inRequestScope(),OA.bind(nr.ILayerPlugin).to(PD).inRequestScope(),OA.bind(nr.ILayerPlugin).to($N).inRequestScope(),OA.bind(nr.ILayerPlugin).to(CD).inRequestScope(),OA.bind(nr.ILayerPlugin).to(ID).inRequestScope(),OA.bind(nr.ILayerPlugin).to(eD).inRequestScope();e.BKDRHash=function(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t},e.BaseLayer=zk,e.BasePostProcessingPass=aA,e.CameraUniform=ew,e.CityBuildingLayer=KM,e.Control=rw,e.CoordinateUniform=ib,e.DOM=Da,e.GaodeMap=MT,e.HeatmapLayer=nI,e.ImageLayer=iI,e.LRUCache=ch,e.Layers=iw,e.LineLayer=vI,e.Logo=ow,e.MapServiceEvent=$A,e.Mapbox=gC,e.Marker=fw,e.MarkerLayer=dw,e.PointLayer=zI,e.PolygonLayer=VI,e.Popup=pw,e.RasterLayer=WI,e.Satistics=ad,e.Scale=aw,e.Scene=_T,e.SceneEventList=tw,e.TYPES=nr,e.Zoom=uw,e.aProjectFlat=Jf,e.anchorTranslate=Wh,e.applyAnchorClass=qh,e.bindAll=lh,e.boundsContains=th,e.container=OA,e.createLayerContainer=DA,e.createSceneContainer=NA,e.decodePickingColor=Vh,e.djb2hash=function(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0},e.encodePickingColor=Gh,e.extent=Xf,e.generateColorRamp=Hh,e.getArrayBuffer=gf,e.getImage=mf,e.getJSON=function(e,t){var n=vf(e);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var r;try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r)}else 401===n.status?t(new pf("".concat(n.statusText),n.status,e.url)):t(new pf(n.statusText,n.status,e.url))},n.send(),n},e.latitude=Kf,e.lazyInject=RA,e.lazyMultiInject=function(e){var t=PA.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},e.lngLatToMeters=Zf,e.lnglatDistance=$f,e.longitude=Yf,e.metersToLngLat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/qf*180,o=r/qf*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]},e.packCircleVertex=function(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,o=e.shape,a=e.opacity,u=e.stroke,s=e.strokeWidth,c=e.strokeOpacity,l=[],f=[],h=[],d=[QA(t[0],t[1]),QA(t[2],t[3])],p=[QA(u[0],u[1]),QA(u[2],u[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=ao(e,2),u=t[0],v=t[1];l.push([].concat(d,[8388608*(u+1)+2097152*(v+1)+131072*qA(o)+n,524288*(r+512)+64*(i+512)])),f.push([].concat(p,[s,c])),h.push([a,0,0,0])})),{packedBuffer:l,packedBuffer2:f,packedBuffer3:h}},e.padBounds=eh,e.project=function(e){var t=Math.PI/180,n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=Math.sin(r*t);return[6378137*e[0]*t,6378137*Math.log((1+i)/(1-i))/2]},e.rgb2arr=Bh,e.tranfrormCoord=function(e,t){return function e(t,n){if(Array.isArray(t[0]))return t.map((function(t){return e(t,n)}));return n(t)}(e,t)},e.unProjectFlat=function(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=ao(e,2),o=i[0],a=i[1];return o=(o/(256<<20)-.5)/t,a=(a/(256<<20)-r)/n,a=2*(Math.atan(Math.pow(Math.E,a))-Math.PI/4),[o/(r=Math.PI/180),a/r]},e.validateLngLat=Qf,e.version="2.2.22",Object.defineProperty(e,"__esModule",{value:!0})}));
